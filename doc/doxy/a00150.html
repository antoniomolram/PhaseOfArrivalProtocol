<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>MiXiM: PhyLayerBattery Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
      <li><a href="classes.html"><span>Class&nbsp;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>PhyLayerBattery Class Reference<br/>
<small>
[<a class="el" href="a00465.html">Power consumption - Classes using/defining power consumption</a>,&nbsp;<a class="el" href="a00445.html">phyLayer - physical layer modules</a>]</small>
</h1><!-- doxytag: class="PhyLayerBattery" --><!-- doxytag: inherits="PhyLayer" -->
<p>Extends <a class="el" href="a00149.html" title="Provides initialisation for several AnalogueModels and Deciders from modules directory...">PhyLayer</a> by adding power consumption for tx, rx and idle.  
<a href="#_details">More...</a></p>

<p><code>#include &lt;<a class="el" href="a00410_source.html">PhyLayerBattery.h</a>&gt;</code></p>

<p>Inherits <a class="el" href="a00149.html">PhyLayer</a>.</p>
<div class="dynheader">
Collaboration diagram for PhyLayerBattery:</div>
<div class="dynsection">
<div class="center"><img src="a00715.png" border="0" usemap="#PhyLayerBattery_coll__map" alt="Collaboration graph"/></div>
<map name="PhyLayerBattery_coll__map" id="PhyLayerBattery_coll__map">
<area shape="rect" href="a00149.html" title="Provides initialisation for several AnalogueModels and Deciders from modules directory..." alt="" coords="27,5,104,32"/></map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>

<p><a href="a00716.html">List of all members.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00150.html#a815f95ad9fe89412ff3c5991ec1cfafe">initialize</a> (int stage)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">OMNeT++ initialization function.  <a href="#a815f95ad9fe89412ff3c5991ec1cfafe"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00150.html#aaaaec355a89dc49db47a3ca1e4ffaf90">drawCurrent</a> (double amount, int activity)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Provides ability to draw power for the <a class="el" href="a00067.html" title="The basic Decider class.">Decider</a>.  <a href="#aaaaec355a89dc49db47a3ca1e4ffaf90"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ab297612cef7286db7722d19ea3a8924f"></a><!-- doxytag: member="PhyLayerBattery::setRadioState" ref="ab297612cef7286db7722d19ea3a8924f" args="(int rs)" -->
virtual simtime_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00150.html#ab297612cef7286db7722d19ea3a8924f">setRadioState</a> (int rs)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Captures radio switches to adjust power consumption. <br/></td></tr>
<tr><td colspan="2"><h2>Protected Types</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00150.html#a1eb13993a65f4147d7f99c936b4143c7">Activities</a> { <br/>
&nbsp;&nbsp;<b>SLEEP_ACCT</b> = 0, 
<b>RX_ACCT</b>, 
<b>TX_ACCT</b>, 
<b>SWITCHING_ACCT</b>, 
<br/>
&nbsp;&nbsp;<b>DECIDER_ACCT</b>
<br/>
 }</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"><p>Defines the power consuming activities (accounts) of the NIC. Should be the same as defined in the decider. </p>
<br/></td></tr>
<tr><td colspan="2"><h2>Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="a00067.html">Decider</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00150.html#a7d09d3b83e7a6ad89682101aaa084579">getDeciderFromName</a> (std::string name, <a class="el" href="a00026.html#af29abf3259af16b051ce48b0db7a64c0">ParameterMap</a> &amp;params)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Creates and returns an instance of the <a class="el" href="a00067.html" title="The basic Decider class.">Decider</a> with the specified name.  <a href="#a7d09d3b83e7a6ad89682101aaa084579"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a85f00b8792329952e92264e16e133dcf"></a><!-- doxytag: member="PhyLayerBattery::initializeDecider80211Battery" ref="a85f00b8792329952e92264e16e133dcf" args="(ParameterMap &amp;params)" -->
virtual <a class="el" href="a00067.html">Decider</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00150.html#a85f00b8792329952e92264e16e133dcf">initializeDecider80211Battery</a> (<a class="el" href="a00026.html#af29abf3259af16b051ce48b0db7a64c0">ParameterMap</a> &amp;params)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initializes a new <a class="el" href="a00069.html" title="Extends Decider80211 by drawing power during receiving of messages.">Decider80211Battery</a> from the passed parameter map. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ab076f8ff23ec67d1339fcc48decde9d5"></a><!-- doxytag: member="PhyLayerBattery::initializeDecider80211MultiChannel" ref="ab076f8ff23ec67d1339fcc48decde9d5" args="(ParameterMap &amp;params)" -->
virtual <a class="el" href="a00067.html">Decider</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00150.html#ab076f8ff23ec67d1339fcc48decde9d5">initializeDecider80211MultiChannel</a> (<a class="el" href="a00026.html#af29abf3259af16b051ce48b0db7a64c0">ParameterMap</a> &amp;params)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initializes a new <a class="el" href="a00070.html" title="Extends Decider80211 by multi channel support.">Decider80211MultiChannel</a> from the passed parameter map. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00150.html#a3daf838e7610c4e26c891d3ff88ecc8e">calcTXCurrentForPacket</a> (MacPkt *, <a class="el" href="a00118.html">MacToPhyControlInfo</a> *) const </td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Calculates the current needed for the transmission of the passed MacPkt.  <a href="#a3daf838e7610c4e26c891d3ff88ecc8e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a5970101ea41f75adff064d267d4cd828"></a><!-- doxytag: member="PhyLayerBattery::setRadioCurrent" ref="a5970101ea41f75adff064d267d4cd828" args="(int rs)" -->
virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00150.html#a5970101ea41f75adff064d267d4cd828">setRadioCurrent</a> (int rs)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Updates the actual current drawn for the passed state. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ac729b2f04d9a037e8c58025634607f9e"></a><!-- doxytag: member="PhyLayerBattery::setSwitchingCurrent" ref="ac729b2f04d9a037e8c58025634607f9e" args="(int from, int to)" -->
virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00150.html#ac729b2f04d9a037e8c58025634607f9e">setSwitchingCurrent</a> (int from, int to)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Updates the actual current drawn for switching between the passed states. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00150.html#a73a5457ba5a50d2d061a4cbf7dbd96b3">handleUpperMessage</a> (cMessage *msg)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Checks the hosts state and draws txCurrent from battery.  <a href="#a73a5457ba5a50d2d061a4cbf7dbd96b3"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00150.html#a2eb93cd77f9e7265e92164ae62fb1105">handleAirFrame</a> (AirFrame *frame)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Checks if the the host state is on and prevents reception of AirFrames if not.  <a href="#a2eb93cd77f9e7265e92164ae62fb1105"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00150.html#ab687d180a389989e036e158765fe6f29">handleHostState</a> (const <a class="el" href="a00094.html">HostState</a> &amp;state)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Captures changes in host state.  <a href="#ab687d180a389989e036e158765fe6f29"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a69a2284db629830c12a625e60d3221ad"></a><!-- doxytag: member="PhyLayerBattery::finishRadioSwitching" ref="a69a2284db629830c12a625e60d3221ad" args="()" -->
virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00150.html#a69a2284db629830c12a625e60d3221ad">finishRadioSwitching</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Captures radio switches to adjust power consumption. <br/></td></tr>
<tr><td colspan="2"><h2>Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a0100994772e797d41df4c41b4b9ad475"></a><!-- doxytag: member="PhyLayerBattery::numActivities" ref="a0100994772e797d41df4c41b4b9ad475" args="" -->
int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00150.html#a0100994772e797d41df4c41b4b9ad475">numActivities</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Number of power consuming activities (accounts). <br/></td></tr>
<tr><td colspan="2"><div class="groupHeader">The different currents in mA.</div></td></tr>
<tr><td colspan="2"><div class="groupText"><p><a class="anchor" id="amgrp0da57caa2cbec251d217f9d993eff627"></a> </p>
<br/><br/></div></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a15d15867a1ac057d60b8dc4a3771ce1b"></a><!-- doxytag: member="PhyLayerBattery::sleepCurrent" ref="a15d15867a1ac057d60b8dc4a3771ce1b" args="" -->
double&nbsp;</td><td class="memItemRight" valign="bottom"><b>sleepCurrent</b></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a43b742fc7d58613cd7cd82547ae72ab6"></a><!-- doxytag: member="PhyLayerBattery::rxCurrent" ref="a43b742fc7d58613cd7cd82547ae72ab6" args="" -->
double&nbsp;</td><td class="memItemRight" valign="bottom"><b>rxCurrent</b></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a1f391ec04019beba1fc114d37ed2c7ea"></a><!-- doxytag: member="PhyLayerBattery::decodingCurrentDelta" ref="a1f391ec04019beba1fc114d37ed2c7ea" args="" -->
double&nbsp;</td><td class="memItemRight" valign="bottom"><b>decodingCurrentDelta</b></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a99d73bba9a336c5d544628eb898f06ae"></a><!-- doxytag: member="PhyLayerBattery::txCurrent" ref="a99d73bba9a336c5d544628eb898f06ae" args="" -->
double&nbsp;</td><td class="memItemRight" valign="bottom"><b>txCurrent</b></td></tr>
<tr><td colspan="2"><div class="groupHeader">The different switching state currents in mA.</div></td></tr>
<tr><td colspan="2"><div class="groupText"><p><a class="anchor" id="amgrp218c885e0ffd7db2221f5db496828f23"></a> </p>
<br/><br/></div></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a6c3a45f4e9353dc06ff28b70ae07e094"></a><!-- doxytag: member="PhyLayerBattery::setupRxCurrent" ref="a6c3a45f4e9353dc06ff28b70ae07e094" args="" -->
double&nbsp;</td><td class="memItemRight" valign="bottom"><b>setupRxCurrent</b></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a8250904854cf5543b7e25dfe683122b4"></a><!-- doxytag: member="PhyLayerBattery::setupTxCurrent" ref="a8250904854cf5543b7e25dfe683122b4" args="" -->
double&nbsp;</td><td class="memItemRight" valign="bottom"><b>setupTxCurrent</b></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="afd08d6a185179e7017c862a9223a7357"></a><!-- doxytag: member="PhyLayerBattery::rxTxCurrent" ref="afd08d6a185179e7017c862a9223a7357" args="" -->
double&nbsp;</td><td class="memItemRight" valign="bottom"><b>rxTxCurrent</b></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a0ecdf48416041bfb393351216ab15022"></a><!-- doxytag: member="PhyLayerBattery::txRxCurrent" ref="a0ecdf48416041bfb393351216ab15022" args="" -->
double&nbsp;</td><td class="memItemRight" valign="bottom"><b>txRxCurrent</b></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Extends <a class="el" href="a00149.html" title="Provides initialisation for several AnalogueModels and Deciders from modules directory...">PhyLayer</a> by adding power consumption for tx, rx and idle. </p>
<p>Does two things, first before sending messages to the channel or receiving messages from the channel it checks the hosts current state. If the host is not able to send or the receive (e.g. no power) the messages are dropped.</p>
<p>Further it draws a current depending on the current radio state. For this it captures every call to "setRadioState()" and changes the current to previously set default values according to the new radios state. There are different currents for TX, RX, SLEEP and SWITCHING state. Its also possible to override "calcTXCurrentForPacket()" to calculate the current used during TX depending on the actual TX power instead of using the default value.</p>
<p>Does also provide battery access to the <a class="el" href="a00067.html" title="The basic Decider class.">Decider</a> by implementing DeciderToPhyInterfaces "drawCurrent()"-method. Using this method the <a class="el" href="a00067.html" title="The basic Decider class.">Decider</a> can define a current delta which is applied to the RX current during this radio state. This is meant to be used if the <a class="el" href="a00067.html" title="The basic Decider class.">Decider</a> wants to define different currents for "listening" and "decoding" phases in RX state.</p>
<p>Defines initialization for "Decider80211Battery". </p>

<p>Definition at line <a class="el" href="a00410_source.html#l00055">55</a> of file <a class="el" href="a00410_source.html">PhyLayerBattery.h</a>.</p>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a3daf838e7610c4e26c891d3ff88ecc8e"></a><!-- doxytag: member="PhyLayerBattery::calcTXCurrentForPacket" ref="a3daf838e7610c4e26c891d3ff88ecc8e" args="(MacPkt *, MacToPhyControlInfo *) const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">virtual double PhyLayerBattery::calcTXCurrentForPacket </td>
          <td>(</td>
          <td class="paramtype">MacPkt *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="a00118.html">MacToPhyControlInfo</a> *&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td> const<code> [inline, protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Calculates the current needed for the transmission of the passed MacPkt. </p>
<p>A return value below or equal zero is ignored and the default txCurrent is used instead.</p>
<p>Sub classing modules can override this method if they don't want to use a default TX-current for every transmission but a current depending on the actual used TX power for a packet. </p>

<p>Definition at line <a class="el" href="a00410_source.html#l00117">117</a> of file <a class="el" href="a00410_source.html">PhyLayerBattery.h</a>.</p>

<p>Referenced by <a class="el" href="a00409_source.html#l00097">handleUpperMessage()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00118"></a>00118   { <span class="keywordflow">return</span> -1.0; }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aaaaec355a89dc49db47a3ca1e4ffaf90"></a><!-- doxytag: member="PhyLayerBattery::drawCurrent" ref="aaaaec355a89dc49db47a3ca1e4ffaf90" args="(double amount, int activity)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void PhyLayerBattery::drawCurrent </td>
          <td>(</td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>amount</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>activity</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Provides ability to draw power for the <a class="el" href="a00067.html" title="The basic Decider class.">Decider</a>. </p>
<p>Method is defined in "DeciderToPhyInterface".</p>
<p>Note: This method should only be used by the <a class="el" href="a00067.html" title="The basic Decider class.">Decider</a> to draw power. The phy layer itself should call instead its protected method <a class="el" href="a00028.html#af62a4c6ab659f7bebc16cc789c559bc6" title="Draws the passed amount of current (in mA) over time from the battery on account...">BatteryAccess::drawCurrent()</a>! </p>

<p>Reimplemented from <a class="el" href="a00026.html#a81153199f268b4831f42b20b06959764">BasePhyLayer</a>.</p>

<p>Definition at line <a class="el" href="a00409_source.html#l00085">85</a> of file <a class="el" href="a00409_source.html">PhyLayerBattery.cc</a>.</p>

<p>References <a class="el" href="a00278_source.html#l00321">Radio::getCurrentState()</a>, <a class="el" href="a00260_source.html#l00110">BasePhyLayer::radio</a>, and <a class="el" href="a00278_source.html#l00206">Radio::RX</a>.</p>

<p>Referenced by <a class="el" href="a00409_source.html#l00097">handleUpperMessage()</a>, <a class="el" href="a00409_source.html#l00193">setRadioCurrent()</a>, and <a class="el" href="a00409_source.html#l00139">setSwitchingCurrent()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00085"></a>00085                                                              {
<a name="l00086"></a>00086   <span class="keywordflow">if</span>(<a class="code" href="a00026.html#a6aefa7200582ec18d6ac5f8f8092a166" title="The state machine storing the current radio state (TX, RX, SLEEP).">radio</a>-&gt;<a class="code" href="a00158.html#af01639feb0bc2c90e850b5130d350a12" title="Returns the state the Radio is currently in.">getCurrentState</a>() == <a class="code" href="a00158.html#a7314de88eaecfa054e682ccc84ef0ffaa0a9f9ba2fd83cf0f5f4eaf4f32d6a9c1" title="receiving state">Radio::RX</a>) {
<a name="l00087"></a>00087     <span class="keywordflow">if</span>(amount != 0.0) {
<a name="l00088"></a>00088       <a class="code" href="a00150.html#aaaaec355a89dc49db47a3ca1e4ffaf90" title="Provides ability to draw power for the Decider.">BatteryAccess::drawCurrent</a>(rxCurrent + amount, DECIDER_ACCT + activity);
<a name="l00089"></a>00089     } <span class="keywordflow">else</span> {
<a name="l00090"></a>00090       <a class="code" href="a00150.html#aaaaec355a89dc49db47a3ca1e4ffaf90" title="Provides ability to draw power for the Decider.">BatteryAccess::drawCurrent</a>(rxCurrent, RX_ACCT);
<a name="l00091"></a>00091     }
<a name="l00092"></a>00092   } <span class="keywordflow">else</span> {
<a name="l00093"></a>00093     opp_warning(<span class="stringliteral">&quot;Decider wanted to change power consumption while radio not in state RX.&quot;</span>);
<a name="l00094"></a>00094   }
<a name="l00095"></a>00095 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7d09d3b83e7a6ad89682101aaa084579"></a><!-- doxytag: member="PhyLayerBattery::getDeciderFromName" ref="a7d09d3b83e7a6ad89682101aaa084579" args="(std::string name, ParameterMap &amp;params)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="a00067.html">Decider</a> * PhyLayerBattery::getDeciderFromName </td>
          <td>(</td>
          <td class="paramtype">std::string&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="a00026.html#af29abf3259af16b051ce48b0db7a64c0">ParameterMap</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>params</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Creates and returns an instance of the <a class="el" href="a00067.html" title="The basic Decider class.">Decider</a> with the specified name. </p>
<p>Is able to initialize the following Deciders:</p>
<ul>
<li><a class="el" href="a00068.html" title="Decider for the 802.11 modules.">Decider80211</a></li>
<li><a class="el" href="a00069.html" title="Extends Decider80211 by drawing power during receiving of messages.">Decider80211Battery</a></li>
<li><a class="el" href="a00070.html" title="Extends Decider80211 by multi channel support.">Decider80211MultiChannel</a></li>
<li><a class="el" href="a00179.html" title="Decider implementation which decides a signals correctness by checking its SNR against...">SNRThresholdDecider</a> </li>
</ul>

<p>Reimplemented from <a class="el" href="a00149.html#aa09a8558e04d2aba287be91d7fbd2548">PhyLayer</a>.</p>

<p>Definition at line <a class="el" href="a00409_source.html#l00050">50</a> of file <a class="el" href="a00409_source.html">PhyLayerBattery.cc</a>.</p>

<p>References <a class="el" href="a00409_source.html#l00061">initializeDecider80211Battery()</a>, and <a class="el" href="a00409_source.html#l00073">initializeDecider80211MultiChannel()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00050"></a>00050                                                                                  {
<a name="l00051"></a>00051   <span class="keywordflow">if</span>(name == <span class="stringliteral">&quot;Decider80211Battery&quot;</span>) {
<a name="l00052"></a>00052     <span class="keywordflow">return</span> <a class="code" href="a00150.html#a85f00b8792329952e92264e16e133dcf" title="Initializes a new Decider80211Battery from the passed parameter map.">initializeDecider80211Battery</a>(params);
<a name="l00053"></a>00053   }
<a name="l00054"></a>00054   <span class="keywordflow">else</span> <span class="keywordflow">if</span>(name == <span class="stringliteral">&quot;Decider80211MultiChannel&quot;</span>) {
<a name="l00055"></a>00055     <span class="keywordflow">return</span> <a class="code" href="a00150.html#ab076f8ff23ec67d1339fcc48decde9d5" title="Initializes a new Decider80211MultiChannel from the passed parameter map.">initializeDecider80211MultiChannel</a>(params);
<a name="l00056"></a>00056   }
<a name="l00057"></a>00057 
<a name="l00058"></a>00058   <span class="keywordflow">return</span> <a class="code" href="a00150.html#a7d09d3b83e7a6ad89682101aaa084579" title="Creates and returns an instance of the Decider with the specified name.">PhyLayer::getDeciderFromName</a>(name, params);
<a name="l00059"></a>00059 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a2eb93cd77f9e7265e92164ae62fb1105"></a><!-- doxytag: member="PhyLayerBattery::handleAirFrame" ref="a2eb93cd77f9e7265e92164ae62fb1105" args="(AirFrame *frame)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void PhyLayerBattery::handleAirFrame </td>
          <td>(</td>
          <td class="paramtype">AirFrame *&nbsp;</td>
          <td class="paramname"> <em>frame</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Checks if the the host state is on and prevents reception of AirFrames if not. </p>
<p>Calls the base classes overriden method for normal handling. </p>

<p>Reimplemented from <a class="el" href="a00026.html#a8d6f371fa6ea6ca89cb78764a05f31dd">BasePhyLayer</a>.</p>

<p>Definition at line <a class="el" href="a00409_source.html#l00116">116</a> of file <a class="el" href="a00409_source.html">PhyLayerBattery.cc</a>.</p>

<p>References <a class="el" href="a00253_source.html#l00026">BatteryAccess::battery</a>, and <a class="el" href="a00014.html#ab9afb1ddcea070ee4fdf9807521cc806">BaseBattery::getState()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00116"></a>00116                                                     {
<a name="l00117"></a>00117   <span class="keywordflow">if</span> (<a class="code" href="a00028.html#a207a20e8fc1be11f6ff74674ca3f86f8" title="Stores pointer to the battery module.">battery</a> &amp;&amp; <a class="code" href="a00028.html#a207a20e8fc1be11f6ff74674ca3f86f8" title="Stores pointer to the battery module.">battery</a>-&gt;<a class="code" href="a00014.html#ab9afb1ddcea070ee4fdf9807521cc806" title="Current state of the battery.">getState</a>() != HostState::ACTIVE) {
<a name="l00118"></a>00118     coreEV&lt;&lt; <span class="stringliteral">&quot;host has FAILED, dropping air frame msg &quot;</span> &lt;&lt; frame-&gt;getName() &lt;&lt; endl;
<a name="l00119"></a>00119     <span class="keyword">delete</span> frame;
<a name="l00120"></a>00120     <span class="keywordflow">return</span>;
<a name="l00121"></a>00121   }
<a name="l00122"></a>00122   <a class="code" href="a00150.html#a2eb93cd77f9e7265e92164ae62fb1105" title="Checks if the the host state is on and prevents reception of AirFrames if not.">PhyLayer::handleAirFrame</a>(frame);
<a name="l00123"></a>00123 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab687d180a389989e036e158765fe6f29"></a><!-- doxytag: member="PhyLayerBattery::handleHostState" ref="ab687d180a389989e036e158765fe6f29" args="(const HostState &amp;state)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void PhyLayerBattery::handleHostState </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="a00094.html">HostState</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>state</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Captures changes in host state. </p>
<p>Note: Does not yet cancel any ongoing transmissions if the state changes to off. </p>

<p>Reimplemented from <a class="el" href="a00024.html#a44220aa650488eee8ad121f8bc599265">BaseModule</a>.</p>

<p>Definition at line <a class="el" href="a00409_source.html#l00125">125</a> of file <a class="el" href="a00409_source.html">PhyLayerBattery.cc</a>.</p>

<p>References <a class="el" href="a00285_source.html#l00069">HostState::get()</a>, <a class="el" href="a00278_source.html#l00321">Radio::getCurrentState()</a>, <a class="el" href="a00260_source.html#l00110">BasePhyLayer::radio</a>, <a class="el" href="a00409_source.html#l00210">setRadioState()</a>, and <a class="el" href="a00278_source.html#l00210">Radio::SLEEP</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00125"></a>00125                                                             {
<a name="l00126"></a>00126   <span class="keywordflow">if</span> (state.<a class="code" href="a00094.html#a3167de707748fd5280fce231d6cbcf90" title="Returns the host state.">get</a>() != HostState::ACTIVE &amp;&amp; <a class="code" href="a00026.html#a6aefa7200582ec18d6ac5f8f8092a166" title="The state machine storing the current radio state (TX, RX, SLEEP).">radio</a>-&gt;<a class="code" href="a00158.html#af01639feb0bc2c90e850b5130d350a12" title="Returns the state the Radio is currently in.">getCurrentState</a>() != <a class="code" href="a00158.html#a7314de88eaecfa054e682ccc84ef0ffaac023b5b1d5d9ddbbff72007fb46449a7" title="sleeping">Radio::SLEEP</a>) {
<a name="l00127"></a>00127     coreEV&lt;&lt; <span class="stringliteral">&quot;host is no longer in active state (maybe FAILED, SLEEP, OFF or BROKEN), force into sleep state!&quot;</span> &lt;&lt; endl;
<a name="l00128"></a>00128     <a class="code" href="a00150.html#ab297612cef7286db7722d19ea3a8924f" title="Captures radio switches to adjust power consumption.">setRadioState</a>(<a class="code" href="a00158.html#a7314de88eaecfa054e682ccc84ef0ffaac023b5b1d5d9ddbbff72007fb46449a7" title="sleeping">Radio::SLEEP</a>);
<a name="l00129"></a>00129     <span class="comment">// it would be good to create a radioState OFF, as well</span>
<a name="l00130"></a>00130   }
<a name="l00131"></a>00131 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a73a5457ba5a50d2d061a4cbf7dbd96b3"></a><!-- doxytag: member="PhyLayerBattery::handleUpperMessage" ref="a73a5457ba5a50d2d061a4cbf7dbd96b3" args="(cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void PhyLayerBattery::handleUpperMessage </td>
          <td>(</td>
          <td class="paramtype">cMessage *&nbsp;</td>
          <td class="paramname"> <em>msg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Checks the hosts state and draws txCurrent from battery. </p>
<p>Prevents sending of AirFrames if the hosts state is not on. Sets current power consumption for TX mode. Calls the base classes overriden method for normal handling. </p>

<p>Reimplemented from <a class="el" href="a00026.html#a17b1d469775962d23835dd5f43a639ac">BasePhyLayer</a>.</p>

<p>Definition at line <a class="el" href="a00409_source.html#l00097">97</a> of file <a class="el" href="a00409_source.html">PhyLayerBattery.cc</a>.</p>

<p>References <a class="el" href="a00253_source.html#l00026">BatteryAccess::battery</a>, <a class="el" href="a00410_source.html#l00117">calcTXCurrentForPacket()</a>, <a class="el" href="a00409_source.html#l00085">drawCurrent()</a>, and <a class="el" href="a00014.html#ab9afb1ddcea070ee4fdf9807521cc806">BaseBattery::getState()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00097"></a>00097                                                       {
<a name="l00098"></a>00098   <span class="keywordflow">if</span> (<a class="code" href="a00028.html#a207a20e8fc1be11f6ff74674ca3f86f8" title="Stores pointer to the battery module.">battery</a> &amp;&amp; <a class="code" href="a00028.html#a207a20e8fc1be11f6ff74674ca3f86f8" title="Stores pointer to the battery module.">battery</a>-&gt;<a class="code" href="a00014.html#ab9afb1ddcea070ee4fdf9807521cc806" title="Current state of the battery.">getState</a>() != HostState::ACTIVE) {
<a name="l00099"></a>00099     coreEV&lt;&lt; <span class="stringliteral">&quot;host has FAILED, dropping msg &quot;</span> &lt;&lt; msg-&gt;getName() &lt;&lt; endl;
<a name="l00100"></a>00100     <span class="keyword">delete</span> msg;
<a name="l00101"></a>00101     <span class="keywordflow">return</span>;
<a name="l00102"></a>00102   }
<a name="l00103"></a>00103 
<a name="l00104"></a>00104   MacPkt* pkt = <span class="keyword">static_cast&lt;</span>MacPkt*<span class="keyword">&gt;</span>(msg);
<a name="l00105"></a>00105   <a class="code" href="a00118.html" title="Stores information which is needed by the physical layer when sending a MacPkt.">MacToPhyControlInfo</a>* cInfo = <span class="keyword">static_cast&lt;</span><a class="code" href="a00118.html" title="Stores information which is needed by the physical layer when sending a MacPkt.">MacToPhyControlInfo</a>*<span class="keyword">&gt;</span>(pkt-&gt;getControlInfo());
<a name="l00106"></a>00106 
<a name="l00107"></a>00107   <span class="keywordtype">double</span> current = <a class="code" href="a00150.html#a3daf838e7610c4e26c891d3ff88ecc8e" title="Calculates the current needed for the transmission of the passed MacPkt.">calcTXCurrentForPacket</a>(pkt, cInfo);
<a name="l00108"></a>00108 
<a name="l00109"></a>00109   <span class="keywordflow">if</span>(current &gt; 0) {
<a name="l00110"></a>00110     <a class="code" href="a00150.html#aaaaec355a89dc49db47a3ca1e4ffaf90" title="Provides ability to draw power for the Decider.">BatteryAccess::drawCurrent</a>(current, TX_ACCT);
<a name="l00111"></a>00111   }
<a name="l00112"></a>00112 
<a name="l00113"></a>00113   <a class="code" href="a00150.html#a73a5457ba5a50d2d061a4cbf7dbd96b3" title="Checks the hosts state and draws txCurrent from battery.">PhyLayer::handleUpperMessage</a>(msg);
<a name="l00114"></a>00114 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a815f95ad9fe89412ff3c5991ec1cfafe"></a><!-- doxytag: member="PhyLayerBattery::initialize" ref="a815f95ad9fe89412ff3c5991ec1cfafe" args="(int stage)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void PhyLayerBattery::initialize </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>stage</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>OMNeT++ initialization function. </p>
<p>Read simple parameters. Read and parse xml file for decider and analogue models configuration. </p>

<p>Reimplemented from <a class="el" href="a00026.html#a08704deaf03b73c8eda67cc60e670853">BasePhyLayer</a>.</p>

<p>Definition at line <a class="el" href="a00409_source.html#l00024">24</a> of file <a class="el" href="a00409_source.html">PhyLayerBattery.cc</a>.</p>

<p>References <a class="el" href="a00278_source.html#l00321">Radio::getCurrentState()</a>, <a class="el" href="a00222_source.html#l00108">ChannelAccess::getNic()</a>, <a class="el" href="a00410_source.html#l00058">numActivities</a>, <a class="el" href="a00260_source.html#l00110">BasePhyLayer::radio</a>, <a class="el" href="a00252_source.html#l00026">BatteryAccess::registerWithBattery()</a>, and <a class="el" href="a00409_source.html#l00193">setRadioCurrent()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00024"></a>00024                                           {
<a name="l00025"></a>00025   <a class="code" href="a00150.html#a815f95ad9fe89412ff3c5991ec1cfafe" title="OMNeT++ initialization function.">PhyLayer::initialize</a>(stage);
<a name="l00026"></a>00026   <span class="keywordflow">if</span> (stage == 0) {
<a name="l00027"></a>00027     <a class="code" href="a00150.html#a0100994772e797d41df4c41b4b9ad475" title="Number of power consuming activities (accounts).">numActivities</a> = hasPar(<span class="stringliteral">&quot;numActivities&quot;</span>) ? par(<span class="stringliteral">&quot;numActivities&quot;</span>).longValue() : 5;
<a name="l00028"></a>00028 
<a name="l00029"></a>00029     <span class="comment">/* parameters belong to the NIC, not just phy layer</span>
<a name="l00030"></a>00030 <span class="comment">     *</span>
<a name="l00031"></a>00031 <span class="comment">     * if/when variable transmit power is supported, txCurrent</span>
<a name="l00032"></a>00032 <span class="comment">     * should be specified as an xml table of available transmit</span>
<a name="l00033"></a>00033 <span class="comment">     * power levels and corresponding txCurrent */</span>
<a name="l00034"></a>00034     sleepCurrent = rxCurrent = decodingCurrentDelta = txCurrent = 0;
<a name="l00035"></a>00035     setupRxCurrent = setupTxCurrent = rxTxCurrent = txRxCurrent = 0;
<a name="l00036"></a>00036     sleepCurrent = <a class="code" href="a00041.html#ac7301299af515cfc4d495e2ed51e0198" title="Pointer to nic Module.">getNic</a>()-&gt;par( <span class="stringliteral">&quot;sleepCurrent&quot;</span> );
<a name="l00037"></a>00037     rxCurrent = <a class="code" href="a00041.html#ac7301299af515cfc4d495e2ed51e0198" title="Pointer to nic Module.">getNic</a>()-&gt;par( <span class="stringliteral">&quot;rxCurrent&quot;</span> );
<a name="l00038"></a>00038     decodingCurrentDelta = <a class="code" href="a00041.html#ac7301299af515cfc4d495e2ed51e0198" title="Pointer to nic Module.">getNic</a>()-&gt;par( <span class="stringliteral">&quot;decodingCurrentDelta&quot;</span> );
<a name="l00039"></a>00039     txCurrent = <a class="code" href="a00041.html#ac7301299af515cfc4d495e2ed51e0198" title="Pointer to nic Module.">getNic</a>()-&gt;par( <span class="stringliteral">&quot;txCurrent&quot;</span> );
<a name="l00040"></a>00040     setupRxCurrent = <a class="code" href="a00041.html#ac7301299af515cfc4d495e2ed51e0198" title="Pointer to nic Module.">getNic</a>()-&gt;par( <span class="stringliteral">&quot;setupRxCurrent&quot;</span> );
<a name="l00041"></a>00041     setupTxCurrent = <a class="code" href="a00041.html#ac7301299af515cfc4d495e2ed51e0198" title="Pointer to nic Module.">getNic</a>()-&gt;par( <span class="stringliteral">&quot;setupTxCurrent&quot;</span> );
<a name="l00042"></a>00042     rxTxCurrent = <a class="code" href="a00041.html#ac7301299af515cfc4d495e2ed51e0198" title="Pointer to nic Module.">getNic</a>()-&gt;par( <span class="stringliteral">&quot;rxTxCurrent&quot;</span> );
<a name="l00043"></a>00043     txRxCurrent = <a class="code" href="a00041.html#ac7301299af515cfc4d495e2ed51e0198" title="Pointer to nic Module.">getNic</a>()-&gt;par( <span class="stringliteral">&quot;txRxCurrent&quot;</span> );
<a name="l00044"></a>00044   } <span class="keywordflow">else</span> {
<a name="l00045"></a>00045     <a class="code" href="a00028.html#a2286e83003b2919cbb496260a5b0d009" title="Registers this module as a device with the battery module.">registerWithBattery</a>(<span class="stringliteral">&quot;physical layer&quot;</span>, <a class="code" href="a00150.html#a0100994772e797d41df4c41b4b9ad475" title="Number of power consuming activities (accounts).">numActivities</a>);
<a name="l00046"></a>00046     <a class="code" href="a00150.html#a5970101ea41f75adff064d267d4cd828" title="Updates the actual current drawn for the passed state.">setRadioCurrent</a>(<a class="code" href="a00026.html#a6aefa7200582ec18d6ac5f8f8092a166" title="The state machine storing the current radio state (TX, RX, SLEEP).">radio</a>-&gt;<a class="code" href="a00158.html#af01639feb0bc2c90e850b5130d350a12" title="Returns the state the Radio is currently in.">getCurrentState</a>());
<a name="l00047"></a>00047   }
<a name="l00048"></a>00048 }
</pre></div></p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>src/modules/phy/<a class="el" href="a00410_source.html">PhyLayerBattery.h</a></li>
<li>src/modules/phy/<a class="el" href="a00409_source.html">PhyLayerBattery.cc</a></li>
</ul>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed Dec 14 16:01:50 2011 for MiXiM by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
