<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>MiXiM: MoBANCoordinator Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
      <li><a href="classes.html"><span>Class&nbsp;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>MoBANCoordinator Class Reference<br/>
<small>
[<a class="el" href="a00448.html">mobility - modules handling the mobility of the hosts</a>]</small>
</h1><!-- doxytag: class="MoBANCoordinator" -->
<p>This is the coordinator module of the MoBAN mobility model. It should be instantiated in the top level simulation network in MiXiM, once per WBAN. The coordinator module is the main module that provides the group mobility and correlation between nodes in a WBAN. In the initialization phase, it reads three user defined input files which are the postures specification file, a configuration file which includes all required parameter for specific distributions, and the previously logged mobility <a class="el" href="a00147.html" title="Data type for one instance of mobility pattern.">pattern</a>, if it is requested to use a logged <a class="el" href="a00147.html" title="Data type for one instance of mobility pattern.">pattern</a>. Note that all WBAN instances may use the same input files if they are exactly in the same situation.  
<a href="#_details">More...</a></p>

<p><code>#include &lt;<a class="el" href="a00364_source.html">MoBANCoordinator.h</a>&gt;</code></p>
<div class="dynheader">
Collaboration diagram for MoBANCoordinator:</div>
<div class="dynsection">
<div class="center"><img src="a00681.png" border="0" usemap="#MoBANCoordinator_coll__map" alt="Collaboration graph"/></div>
<map name="MoBANCoordinator_coll__map" id="MoBANCoordinator_coll__map">
<area shape="rect" href="a00062.html" title="Class for storing 3D coordinates." alt="" coords="199,5,255,32"/><area shape="rect" href="a00027.html" title="Provides information and utility methods for the whole simulation." alt="" coords="111,115,228,141"/><area shape="rect" href="a00154.html" title="to store the specification of a posture on the MoBAN mobility model." alt="" coords="252,115,319,141"/><area shape="rect" href="a00147.html" title="Data type for one instance of mobility pattern." alt="" coords="343,115,524,141"/><area shape="rect" href="a00155.html" title="Class to provide spatial and temporal correlation in the posture selection process..." alt="" coords="548,115,673,141"/></map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>

<p><a href="a00682.html">List of all members.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Classes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00147.html">pattern</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Data type for one instance of mobility <a class="el" href="a00147.html" title="Data type for one instance of mobility pattern.">pattern</a>.  <a href="a00147.html#_details">More...</a><br/></td></tr>
<tr><td colspan="2"><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a9e116be526a0d4f1f4482728f32c237c"></a><!-- doxytag: member="MoBANCoordinator::initialize" ref="a9e116be526a0d4f1f4482728f32c237c" args="(int)" -->
virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00125.html#a9e116be526a0d4f1f4482728f32c237c">initialize</a> (int)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initializes the MoBAN mobility model. <br/></td></tr>
<tr><td colspan="2"><h2>Protected Types</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00125.html#a891080762617c76085a1c4cd618fbb93">posture_sel_type</a> { <b>UNIFORM_RANDOM</b> =  0, 
<b>MARKOV_BASE</b>
 }</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"><p>Possible (supported) strategies for posture selection. </p>
<br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aba7c0480967381f3cb5c09b05029abe7"></a><!-- doxytag: member="MoBANCoordinator::Pattern" ref="aba7c0480967381f3cb5c09b05029abe7" args="" -->
typedef struct <br class="typebreak"/>
<a class="el" href="a00147.html">MoBANCoordinator::pattern</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00125.html#aba7c0480967381f3cb5c09b05029abe7">Pattern</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Data type for one instance of mobility <a class="el" href="a00147.html" title="Data type for one instance of mobility pattern.">pattern</a>. <br/></td></tr>
<tr><td colspan="2"><h2>Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00125.html#a16e49488978538b472692ccd1cd893e9">handleMessage</a> (cMessage *msg)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Handes self messages and initiate the next message for updateInterval seconds later.  <a href="#a16e49488978538b472692ccd1cd893e9"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00125.html#a3746b224f6ff4655f5618c5c48bb6c48">finish</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">To be called at the end of simulation run.  <a href="#a3746b224f6ff4655f5618c5c48bb6c48"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00125.html#ab622d4b167d9d5dbc7529969a6688597">selectPosture</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Function to select the next posture considering the current posture and the Markov model.  <a href="#ab622d4b167d9d5dbc7529969a6688597"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="a00062.html">Coord</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00125.html#adebee0a447b7e85d444054fa3a4ee013">selectDestination</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Function to select the destination in the case of a mobile posture.  <a href="#adebee0a447b7e85d444054fa3a4ee013"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00125.html#a6d83b8c03d91b0fee3e335b214f51b4c">selectSpeed</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Select a velocity value within the given velocity range.  <a href="#a6d83b8c03d91b0fee3e335b214f51b4c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">simtime_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00125.html#ab4f9d86a51c84b083817db1fcbe9dbab">selectDuration</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Select a stay time duration in the specified range for the new posture.  <a href="#ab4f9d86a51c84b083817db1fcbe9dbab"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00125.html#ab69a463af831ecb1c87daa61c09c9509">mainProcess</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The main process of the MoBAN mobility model.  <a href="#ab69a463af831ecb1c87daa61c09c9509"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00125.html#abfe32e4c7881e7b5d5276e5b90fb82a6">stepMove</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Making one step move and publishing the new reference point position to all belonging nodes.  <a href="#abfe32e4c7881e7b5d5276e5b90fb82a6"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00125.html#a021924498600208cbb2a2f45525a1d70">isInsideWorld</a> (const <a class="el" href="a00062.html">Coord</a> &amp;) const </td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Checks if all nodes of the WBAN are inside the simulation environment w ith the given position of the logical center.  <a href="#a021924498600208cbb2a2f45525a1d70"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00125.html#aab85ba2010884afd66f619718e1194d7">readPostureSpecificationFile</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Reading the input postures specification file and making the posture data base.  <a href="#aab85ba2010884afd66f619718e1194d7"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00125.html#a138ebd67882d6cf1154126f47d35d49c">readConfigurationFile</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Reads the input configuration file.  <a href="#a138ebd67882d6cf1154126f47d35d49c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00125.html#a31810405333b184c9db891fa9bd8a12a">readMobilityPatternFile</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Reads the previously logged mobility <a class="el" href="a00147.html" title="Data type for one instance of mobility pattern.">pattern</a> and make mobility <a class="el" href="a00147.html" title="Data type for one instance of mobility pattern.">pattern</a> data base.  <a href="#a31810405333b184c9db891fa9bd8a12a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a7e5b78357b30b23f2f8285dcde5c6dd9"></a><!-- doxytag: member="MoBANCoordinator::publishToNodes" ref="a7e5b78357b30b23f2f8285dcde5c6dd9" args="()" -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00125.html#a7e5b78357b30b23f2f8285dcde5c6dd9">publishToNodes</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Publishes the reference point and other information of the posture to the signaling system of the belonging nodes. <br/></td></tr>
<tr><td colspan="2"><h2>Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a970cba11aaab643710065c962ce626fc"></a><!-- doxytag: member="MoBANCoordinator::debug" ref="a970cba11aaab643710065c962ce626fc" args="" -->
bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00125.html#a970cba11aaab643710065c962ce626fc">debug</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Debug switch for all other modules. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a19061b8cb8295d5afce5e95bb1c8ea99"></a><!-- doxytag: member="MoBANCoordinator::world" ref="a19061b8cb8295d5afce5e95bb1c8ea99" args="" -->
<a class="el" href="a00027.html">BaseWorldUtility</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00125.html#a19061b8cb8295d5afce5e95bb1c8ea99">world</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Pointer to the <a class="el" href="a00027.html" title="Provides information and utility methods for the whole simulation.">BaseWorldUtility</a>. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a7ad23bfc4185e34e462e2b06d349a78f"></a><!-- doxytag: member="MoBANCoordinator::network" ref="a7ad23bfc4185e34e462e2b06d349a78f" args="" -->
cModule *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00125.html#a7ad23bfc4185e34e462e2b06d349a78f">network</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Pointer to the top level (network). <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a4b679462d1e5489af4b5a5480f22fdaa"></a><!-- doxytag: member="MoBANCoordinator::updateInterval" ref="a4b679462d1e5489af4b5a5480f22fdaa" args="" -->
simtime_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00125.html#a4b679462d1e5489af4b5a5480f22fdaa">updateInterval</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Interval for updating the move (NED parameter). <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aaaf28b9f6f1de9fdf6872f123a7f3d53"></a><!-- doxytag: member="MoBANCoordinator::MoveMsg" ref="aaaf28b9f6f1de9fdf6872f123a7f3d53" args="" -->
cMessage *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00125.html#aaaf28b9f6f1de9fdf6872f123a7f3d53">MoveMsg</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">A self message to trigger move step every updateInterval seconds. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a92a0e36ffb244bc6ed6beaf98e986c05"></a><!-- doxytag: member="MoBANCoordinator::numNodes" ref="a92a0e36ffb244bc6ed6beaf98e986c05" args="" -->
unsigned int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00125.html#a92a0e36ffb244bc6ed6beaf98e986c05">numNodes</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The number of nodes in the this WBAN. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="afdfb553fa2576a3e72a6111b12f14a97"></a><!-- doxytag: member="MoBANCoordinator::speed" ref="afdfb553fa2576a3e72a6111b12f14a97" args="" -->
double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00125.html#afdfb553fa2576a3e72a6111b12f14a97">speed</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Currently selected speed for the mobile posture. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a5320bb16f51acc82b6419911a280e11d"></a><!-- doxytag: member="MoBANCoordinator::index" ref="a5320bb16f51acc82b6419911a280e11d" args="" -->
int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00125.html#a5320bb16f51acc82b6419911a280e11d">index</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Index of this WBAN. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="abb700aed062784b7cb21eec3e146c80d"></a><!-- doxytag: member="MoBANCoordinator::logfile" ref="abb700aed062784b7cb21eec3e146c80d" args="" -->
FILE *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00125.html#abb700aed062784b7cb21eec3e146c80d">logfile</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Pointer to the file for logging MoBAN mobility <a class="el" href="a00147.html" title="Data type for one instance of mobility pattern.">pattern</a> for future use. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a3880f0e3e0e489b1edd2692a441b903f"></a><!-- doxytag: member="MoBANCoordinator::numPostures" ref="a3880f0e3e0e489b1edd2692a441b903f" args="" -->
unsigned int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00125.html#a3880f0e3e0e489b1edd2692a441b903f">numPostures</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Number of predefined postures. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="afbb28bcb93bda1faadc7030d86be43b5"></a><!-- doxytag: member="MoBANCoordinator::postureList" ref="afbb28bcb93bda1faadc7030d86be43b5" args="" -->
std::vector&lt; <a class="el" href="a00154.html">Posture</a> * &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00125.html#afbb28bcb93bda1faadc7030d86be43b5">postureList</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The list of all predefined postures (posture data base). <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a19a97a40859c36012f3a63a7c9ef9b46"></a><!-- doxytag: member="MoBANCoordinator::currentPosture" ref="a19a97a40859c36012f3a63a7c9ef9b46" args="" -->
<a class="el" href="a00154.html">Posture</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00125.html#a19a97a40859c36012f3a63a7c9ef9b46">currentPosture</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The current selected posture. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ae65c511653f346fbb079389ab23b62cf"></a><!-- doxytag: member="MoBANCoordinator::duration" ref="ae65c511653f346fbb079389ab23b62cf" args="" -->
simtime_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00125.html#ae65c511653f346fbb079389ab23b62cf">duration</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The selected duration of the current posture. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aac48e46d43458a8f960cc33e84ac85e8"></a><!-- doxytag: member="MoBANCoordinator::minDuration" ref="aac48e46d43458a8f960cc33e84ac85e8" args="" -->
simtime_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00125.html#aac48e46d43458a8f960cc33e84ac85e8">minDuration</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The minimum value of the duration for stable postures. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a02c4e8d23a6b0b2e1a1d94abe1974b9f"></a><!-- doxytag: member="MoBANCoordinator::maxDuration" ref="a02c4e8d23a6b0b2e1a1d94abe1974b9f" args="" -->
simtime_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00125.html#a02c4e8d23a6b0b2e1a1d94abe1974b9f">maxDuration</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The maximum value of the duration for stable postures. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a2066591b0b290550ee350b5a57c0c700"></a><!-- doxytag: member="MoBANCoordinator::nodeIndex" ref="a2066591b0b290550ee350b5a57c0c700" args="" -->
int *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00125.html#a2066591b0b290550ee350b5a57c0c700">nodeIndex</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">the index list of nodes belong to this WBAN <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a2d0384199e2090caae09813e7d7f0d3b"></a><!-- doxytag: member="MoBANCoordinator::logicalCenter" ref="a2d0384199e2090caae09813e7d7f0d3b" args="" -->
<a class="el" href="a00062.html">Coord</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00125.html#a2d0384199e2090caae09813e7d7f0d3b">logicalCenter</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Current position of the logical center of the group. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ac1a5ee7eeedb62fdfcee79fb6234f762"></a><!-- doxytag: member="MoBANCoordinator::step" ref="ac1a5ee7eeedb62fdfcee79fb6234f762" args="" -->
int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00125.html#ac1a5ee7eeedb62fdfcee79fb6234f762">step</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Number of steps already moved. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="af177cb826e1fec16faf7c7cbd0390cf5"></a><!-- doxytag: member="MoBANCoordinator::numSteps" ref="af177cb826e1fec16faf7c7cbd0390cf5" args="" -->
int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00125.html#af177cb826e1fec16faf7c7cbd0390cf5">numSteps</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Total number of steps of the current move or current posture. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a56143810b39a6031abe1cc59a18136c3"></a><!-- doxytag: member="MoBANCoordinator::targetPos" ref="a56143810b39a6031abe1cc59a18136c3" args="" -->
<a class="el" href="a00062.html">Coord</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00125.html#a56143810b39a6031abe1cc59a18136c3">targetPos</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Selected destination for the ongoing move of the logical center. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a25c1728a5480570b4b8fe51b4a4a5f02"></a><!-- doxytag: member="MoBANCoordinator::stepTarget" ref="a25c1728a5480570b4b8fe51b4a4a5f02" args="" -->
<a class="el" href="a00062.html">Coord</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00125.html#a25c1728a5480570b4b8fe51b4a4a5f02">stepTarget</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The intermediate target of the current move step. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a56735487e55a96bd1294af15883f2d9c"></a><!-- doxytag: member="MoBANCoordinator::stepSize" ref="a56735487e55a96bd1294af15883f2d9c" args="" -->
<a class="el" href="a00062.html">Coord</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00125.html#a56735487e55a96bd1294af15883f2d9c">stepSize</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The size of the current move step. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a6f67cb3412735ec31734d8a345688e5b"></a><!-- doxytag: member="MoBANCoordinator::useMobilityPattern" ref="a6f67cb3412735ec31734d8a345688e5b" args="" -->
bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00125.html#a6f67cb3412735ec31734d8a345688e5b">useMobilityPattern</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Variable that shows if reusing previously logged mobility <a class="el" href="a00147.html" title="Data type for one instance of mobility pattern.">pattern</a> is requested. The value is gotten from the parameter of the module. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ae19a9a2dce220a75c4757381b5f348a7"></a><!-- doxytag: member="MoBANCoordinator::mobilityPattern" ref="ae19a9a2dce220a75c4757381b5f348a7" args="" -->
<a class="el" href="a00147.html">Pattern</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00125.html#ae19a9a2dce220a75c4757381b5f348a7">mobilityPattern</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The mobility <a class="el" href="a00147.html" title="Data type for one instance of mobility pattern.">pattern</a> data base. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a00cbcb40ee4039ffd5723ffa4334d88f"></a><!-- doxytag: member="MoBANCoordinator::patternLength" ref="a00cbcb40ee4039ffd5723ffa4334d88f" args="" -->
int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00125.html#a00cbcb40ee4039ffd5723ffa4334d88f">patternLength</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The number of mobility <a class="el" href="a00147.html" title="Data type for one instance of mobility pattern.">pattern</a> instances which has been read from the input file (length of mobility <a class="el" href="a00147.html" title="Data type for one instance of mobility pattern.">pattern</a> data base). <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aeff87bd9af8cb9aa14eada4b73ec4fbe"></a><!-- doxytag: member="MoBANCoordinator::currentPattern" ref="aeff87bd9af8cb9aa14eada4b73ec4fbe" args="" -->
int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00125.html#aeff87bd9af8cb9aa14eada4b73ec4fbe">currentPattern</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The index of the currently applied mobility <a class="el" href="a00147.html" title="Data type for one instance of mobility pattern.">pattern</a> from. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a406987de5c4e38c461e0857583c115b2"></a><!-- doxytag: member="MoBANCoordinator::markovMatrix" ref="a406987de5c4e38c461e0857583c115b2" args="" -->
double **&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00125.html#a406987de5c4e38c461e0857583c115b2">markovMatrix</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">A matrix which maintains the transition probabilities of the Markov Model of posture <a class="el" href="a00147.html" title="Data type for one instance of mobility pattern.">pattern</a>. To be given through configuration file. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a626ad8d08de1e3d7fad2c8032f199933"></a><!-- doxytag: member="MoBANCoordinator::postureSelStrategy" ref="a626ad8d08de1e3d7fad2c8032f199933" args="" -->
<a class="el" href="a00125.html#a891080762617c76085a1c4cd618fbb93">posture_sel_type</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00125.html#a626ad8d08de1e3d7fad2c8032f199933">postureSelStrategy</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The requested strategy for posture selection. To be given through configuration file. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a51f9fc44b5168e7ef6e58fd221bf3f0a"></a><!-- doxytag: member="MoBANCoordinator::transitions" ref="a51f9fc44b5168e7ef6e58fd221bf3f0a" args="" -->
<a class="el" href="a00155.html">PostureTransition</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00125.html#a51f9fc44b5168e7ef6e58fd221bf3f0a">transitions</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Class for performing operation for spatial and temporal correlations in posture selection. <br/></td></tr>
<tr><td colspan="2"><h2>Private Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="af51033716d0f6ccefc6616e7358c774c"></a><!-- doxytag: member="MoBANCoordinator::MoBANCoordinator" ref="af51033716d0f6ccefc6616e7358c774c" args="(const MoBANCoordinator &amp;)" -->
&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00125.html#af51033716d0f6ccefc6616e7358c774c">MoBANCoordinator</a> (const <a class="el" href="a00125.html">MoBANCoordinator</a> &amp;)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Copy constructor is not allowed. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a068bd3c432674c05300e8b0481d2e892"></a><!-- doxytag: member="MoBANCoordinator::operator=" ref="a068bd3c432674c05300e8b0481d2e892" args="(const MoBANCoordinator &amp;)" -->
<a class="el" href="a00125.html">MoBANCoordinator</a> &amp;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00125.html#a068bd3c432674c05300e8b0481d2e892">operator=</a> (const <a class="el" href="a00125.html">MoBANCoordinator</a> &amp;)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Assignment operator is not allowed. <br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>This is the coordinator module of the MoBAN mobility model. It should be instantiated in the top level simulation network in MiXiM, once per WBAN. The coordinator module is the main module that provides the group mobility and correlation between nodes in a WBAN. In the initialization phase, it reads three user defined input files which are the postures specification file, a configuration file which includes all required parameter for specific distributions, and the previously logged mobility <a class="el" href="a00147.html" title="Data type for one instance of mobility pattern.">pattern</a>, if it is requested to use a logged <a class="el" href="a00147.html" title="Data type for one instance of mobility pattern.">pattern</a>. Note that all WBAN instances may use the same input files if they are exactly in the same situation. </p>
<p>After the initialization phase, the MoBAN coordinator decides about the posture and the position of the Logical center of the group (WBAN). The absolute position of the reference point of each belonging node is calculated by adding the current position of the logical center by the reference point of that node in the selected posture. The coordinator publish the position of the reference point as well as the speed and the radius of the local movement of nodes to their signaling systems.</p>
<dl class="author"><dt><b>Author:</b></dt><dd>Majid Nabi </dd></dl>

<p>Definition at line <a class="el" href="a00364_source.html#l00087">87</a> of file <a class="el" href="a00364_source.html">MoBANCoordinator.h</a>.</p>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a3746b224f6ff4655f5618c5c48bb6c48"></a><!-- doxytag: member="MoBANCoordinator::finish" ref="a3746b224f6ff4655f5618c5c48bb6c48" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void MoBANCoordinator::finish </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>To be called at the end of simulation run. </p>
<p>This function is called at the end of simulation run. </p>

<p>Definition at line <a class="el" href="a00363_source.html#l00337">337</a> of file <a class="el" href="a00363_source.html">MoBANCoordinator.cc</a>.</p>

<p>References <a class="el" href="a00364_source.html#l00124">logfile</a>, and <a class="el" href="a00364_source.html#l00111">MoveMsg</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00337"></a>00337                               {
<a name="l00338"></a>00338 
<a name="l00339"></a>00339   cancelAndDelete(<a class="code" href="a00125.html#aaaf28b9f6f1de9fdf6872f123a7f3d53" title="A self message to trigger move step every updateInterval seconds.">MoveMsg</a>);
<a name="l00340"></a>00340   fclose(<a class="code" href="a00125.html#abb700aed062784b7cb21eec3e146c80d" title="Pointer to the file for logging MoBAN mobility pattern for future use.">logfile</a>);
<a name="l00341"></a>00341 
<a name="l00342"></a>00342 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a16e49488978538b472692ccd1cd893e9"></a><!-- doxytag: member="MoBANCoordinator::handleMessage" ref="a16e49488978538b472692ccd1cd893e9" args="(cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void MoBANCoordinator::handleMessage </td>
          <td>(</td>
          <td class="paramtype">cMessage *&nbsp;</td>
          <td class="paramname"> <em>msg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Handes self messages and initiate the next message for updateInterval seconds later. </p>
<p>Handling self message and initiate the next message with the given parameter updateInterval. </p>

<p>Definition at line <a class="el" href="a00363_source.html#l00119">119</a> of file <a class="el" href="a00363_source.html">MoBANCoordinator.cc</a>.</p>

<p>References <a class="el" href="a00364_source.html#l00111">MoveMsg</a>, <a class="el" href="a00363_source.html#l00133">stepMove()</a>, and <a class="el" href="a00364_source.html#l00108">updateInterval</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00119"></a>00119                                                    {
<a name="l00120"></a>00120   <span class="keywordflow">if</span> (msg == <a class="code" href="a00125.html#aaaf28b9f6f1de9fdf6872f123a7f3d53" title="A self message to trigger move step every updateInterval seconds.">MoveMsg</a>) {
<a name="l00121"></a>00121     <a class="code" href="a00125.html#abfe32e4c7881e7b5d5276e5b90fb82a6" title="Making one step move and publishing the new reference point position to all belonging...">stepMove</a>();
<a name="l00122"></a>00122     scheduleAt(simTime() + <a class="code" href="a00125.html#a4b679462d1e5489af4b5a5480f22fdaa" title="Interval for updating the move (NED parameter).">updateInterval</a>, msg);
<a name="l00123"></a>00123   } <span class="keywordflow">else</span>
<a name="l00124"></a>00124     error(<span class="stringliteral">&quot;MoBAN Coordinator: unexpected message!&quot;</span>);
<a name="l00125"></a>00125 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a021924498600208cbb2a2f45525a1d70"></a><!-- doxytag: member="MoBANCoordinator::isInsideWorld" ref="a021924498600208cbb2a2f45525a1d70" args="(const Coord &amp;) const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool MoBANCoordinator::isInsideWorld </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="a00062.html">Coord</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>tPos</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td> const<code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Checks if all nodes of the WBAN are inside the simulation environment w ith the given position of the logical center. </p>
<p>Checks if all nodes of the WBAN are inside the simulation environment with the given position of the logical center. </p>

<p>Definition at line <a class="el" href="a00363_source.html#l00315">315</a> of file <a class="el" href="a00363_source.html">MoBANCoordinator.cc</a>.</p>

<p>References <a class="el" href="a00364_source.html#l00133">currentPosture</a>, <a class="el" href="a00251_source.html#l00081">BaseWorldUtility::getPgs()</a>, <a class="el" href="a00367_source.html#l00205">Posture::getPs()</a>, <a class="el" href="a00367_source.html#l00229">Posture::getRadius()</a>, <a class="el" href="a00282_source.html#l00218">Coord::isInBoundary()</a>, <a class="el" href="a00364_source.html#l00115">numNodes</a>, <a class="el" href="a00364_source.html#l00102">world</a>, and <a class="el" href="a00282_source.html#l00041">Coord::ZERO</a>.</p>

<p>Referenced by <a class="el" href="a00363_source.html#l00288">selectDestination()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00315"></a>00315                                                             {
<a name="l00316"></a>00316   <a class="code" href="a00062.html" title="Class for storing 3D coordinates.">Coord</a> absolutePosition;
<a name="l00317"></a>00317 
<a name="l00318"></a>00318   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="a00125.html#a92a0e36ffb244bc6ed6beaf98e986c05" title="The number of nodes in the this WBAN.">numNodes</a>; ++i) {
<a name="l00319"></a>00319     <span class="keyword">const</span> <span class="keywordtype">double</span> dRadius = <a class="code" href="a00125.html#a19a97a40859c36012f3a63a7c9ef9b46" title="The current selected posture.">currentPosture</a>-&gt;<a class="code" href="a00154.html#aa31f6833169d93db33ce6a9c51de8301" title="Returns the singular movement radius of a node in this posture.">getRadius</a>(i);
<a name="l00320"></a>00320 
<a name="l00321"></a>00321     absolutePosition = tPos + <a class="code" href="a00125.html#a19a97a40859c36012f3a63a7c9ef9b46" title="The current selected posture.">currentPosture</a>-&gt;<a class="code" href="a00154.html#a911a247ba10ac6e2258dd63618977b71" title="Returns the relative position of a node in this posture.">getPs</a>(i);
<a name="l00322"></a>00322 
<a name="l00323"></a>00323     absolutePosition.x += dRadius;
<a name="l00324"></a>00324     absolutePosition.y += dRadius;
<a name="l00325"></a>00325     absolutePosition.z += dRadius;
<a name="l00326"></a>00326 
<a name="l00327"></a>00327     <span class="keywordflow">if</span> (!absolutePosition.<a class="code" href="a00062.html#a7a42e29d7a15ed0b53e47137549e00a6" title="Checks if this coordinate is inside a specified rectangle.">isInBoundary</a>(<a class="code" href="a00062.html#a2d291cbb8e58af4ce8c68e9c8671b5d6" title="Constant with all values set to 0.">Coord::ZERO</a>, <a class="code" href="a00125.html#a19061b8cb8295d5afce5e95bb1c8ea99" title="Pointer to the BaseWorldUtility.">world</a>-&gt;<a class="code" href="a00027.html#a179c8bf9d4613cbb1af0a85d779827a6" title="Returns the playgroundSize.">getPgs</a>()))
<a name="l00328"></a>00328       <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00329"></a>00329   }
<a name="l00330"></a>00330 
<a name="l00331"></a>00331   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00332"></a>00332 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab69a463af831ecb1c87daa61c09c9509"></a><!-- doxytag: member="MoBANCoordinator::mainProcess" ref="ab69a463af831ecb1c87daa61c09c9509" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void MoBANCoordinator::mainProcess </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>The main process of the MoBAN mobility model. </p>
<p>The main process of the MoBAN mobility model. To be called whenever a destination is reached or the duration of the previous posture expires. It select the behavior of the next movement (the posture and the destination), and prepare the required variables to make the movement. In the case of using a logged mobility <a class="el" href="a00147.html" title="Data type for one instance of mobility pattern.">pattern</a>, the new posture and other parameters are obtained from the <a class="el" href="a00147.html" title="Data type for one instance of mobility pattern.">pattern</a>. </p>

<p>Definition at line <a class="el" href="a00363_source.html#l00164">164</a> of file <a class="el" href="a00363_source.html">MoBANCoordinator.cc</a>.</p>

<p>References <a class="el" href="a00364_source.html#l00195">currentPattern</a>, <a class="el" href="a00364_source.html#l00133">currentPosture</a>, <a class="el" href="a00282_source.html#l00178">Coord::distance()</a>, <a class="el" href="a00364_source.html#l00136">duration</a>, <a class="el" href="a00251_source.html#l00081">BaseWorldUtility::getPgs()</a>, <a class="el" href="a00367_source.html#l00250">Posture::getPostureID()</a>, <a class="el" href="a00367_source.html#l00245">Posture::getPostureName()</a>, <a class="el" href="a00364_source.html#l00121">index</a>, <a class="el" href="a00282_source.html#l00069">Coord::info()</a>, <a class="el" href="a00367_source.html#l00265">Posture::isMobile()</a>, <a class="el" href="a00364_source.html#l00124">logfile</a>, <a class="el" href="a00364_source.html#l00148">logicalCenter</a>, <a class="el" href="a00364_source.html#l00187">mobilityPattern</a>, <a class="el" href="a00364_source.html#l00154">numSteps</a>, <a class="el" href="a00364_source.html#l00192">patternLength</a>, <a class="el" href="a00364_source.html#l00130">postureList</a>, <a class="el" href="a00284_source.html#l00132">FWMath::round()</a>, <a class="el" href="a00363_source.html#l00288">selectDestination()</a>, <a class="el" href="a00363_source.html#l00279">selectDuration()</a>, <a class="el" href="a00363_source.html#l00244">selectPosture()</a>, <a class="el" href="a00363_source.html#l00307">selectSpeed()</a>, <a class="el" href="a00364_source.html#l00118">speed</a>, <a class="el" href="a00364_source.html#l00151">step</a>, <a class="el" href="a00364_source.html#l00163">stepSize</a>, <a class="el" href="a00364_source.html#l00160">stepTarget</a>, <a class="el" href="a00364_source.html#l00157">targetPos</a>, <a class="el" href="a00364_source.html#l00108">updateInterval</a>, <a class="el" href="a00364_source.html#l00168">useMobilityPattern</a>, and <a class="el" href="a00364_source.html#l00102">world</a>.</p>

<p>Referenced by <a class="el" href="a00363_source.html#l00055">initialize()</a>, and <a class="el" href="a00363_source.html#l00133">stepMove()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00164"></a>00164                                    {
<a name="l00165"></a>00165   <span class="comment">//select the new posture and set the variable currentPosture as well as the reference points of all nodes within the WBAN.</span>
<a name="l00166"></a>00166   <span class="keywordflow">if</span> (<a class="code" href="a00125.html#a6f67cb3412735ec31734d8a345688e5b" title="Variable that shows if reusing previously logged mobility pattern is requested. The...">useMobilityPattern</a>) {
<a name="l00167"></a>00167     <a class="code" href="a00125.html#aeff87bd9af8cb9aa14eada4b73ec4fbe" title="The index of the currently applied mobility pattern from.">currentPattern</a> = (<a class="code" href="a00125.html#aeff87bd9af8cb9aa14eada4b73ec4fbe" title="The index of the currently applied mobility pattern from.">currentPattern</a> + 1) % <a class="code" href="a00125.html#a00cbcb40ee4039ffd5723ffa4334d88f" title="The number of mobility pattern instances which has been read from the input file...">patternLength</a>;
<a name="l00168"></a>00168     <span class="keywordtype">int</span> postureID = <a class="code" href="a00125.html#ae19a9a2dce220a75c4757381b5f348a7" title="The mobility pattern data base.">mobilityPattern</a>[<a class="code" href="a00125.html#aeff87bd9af8cb9aa14eada4b73ec4fbe" title="The index of the currently applied mobility pattern from.">currentPattern</a>].postureID;
<a name="l00169"></a>00169     <a class="code" href="a00125.html#a19a97a40859c36012f3a63a7c9ef9b46" title="The current selected posture.">currentPosture</a> = <a class="code" href="a00125.html#afbb28bcb93bda1faadc7030d86be43b5" title="The list of all predefined postures (posture data base).">postureList</a>[postureID];
<a name="l00170"></a>00170   } <span class="keywordflow">else</span>
<a name="l00171"></a>00171     <a class="code" href="a00125.html#ab622d4b167d9d5dbc7529969a6688597" title="Function to select the next posture considering the current posture and the Markov...">selectPosture</a>();
<a name="l00172"></a>00172 
<a name="l00173"></a>00173   EV&lt;&lt;<span class="stringliteral">&quot;New posture is selected:&quot;</span>&lt;&lt;<a class="code" href="a00125.html#a19a97a40859c36012f3a63a7c9ef9b46" title="The current selected posture.">currentPosture</a>-&gt;<a class="code" href="a00154.html#ad5d32a4a05de7bc9d69c0070b989d30a" title="Returns posture name.">getPostureName</a>() &lt;&lt; endl;
<a name="l00174"></a>00174 
<a name="l00175"></a>00175   <span class="keywordflow">if</span> (<a class="code" href="a00125.html#a19a97a40859c36012f3a63a7c9ef9b46" title="The current selected posture.">currentPosture</a>-&gt;<a class="code" href="a00154.html#a9c622bfcc0a70fc09ad0f6f57bfe7a63" title="Check if this posture is mobile by checking the maximum possible speed.">isMobile</a>())
<a name="l00176"></a>00176   {
<a name="l00177"></a>00177     <span class="keywordtype">double</span> distance;
<a name="l00178"></a>00178 
<a name="l00179"></a>00179     <span class="keywordflow">if</span> (<a class="code" href="a00125.html#a6f67cb3412735ec31734d8a345688e5b" title="Variable that shows if reusing previously logged mobility pattern is requested. The...">useMobilityPattern</a>) {
<a name="l00180"></a>00180       <a class="code" href="a00125.html#a56143810b39a6031abe1cc59a18136c3" title="Selected destination for the ongoing move of the logical center.">targetPos</a> = <a class="code" href="a00125.html#ae19a9a2dce220a75c4757381b5f348a7" title="The mobility pattern data base.">mobilityPattern</a>[<a class="code" href="a00125.html#aeff87bd9af8cb9aa14eada4b73ec4fbe" title="The index of the currently applied mobility pattern from.">currentPattern</a>].targetPos;
<a name="l00181"></a>00181       <a class="code" href="a00125.html#afdfb553fa2576a3e72a6111b12f14a97" title="Currently selected speed for the mobile posture.">speed</a> = <a class="code" href="a00125.html#ae19a9a2dce220a75c4757381b5f348a7" title="The mobility pattern data base.">mobilityPattern</a>[<a class="code" href="a00125.html#aeff87bd9af8cb9aa14eada4b73ec4fbe" title="The index of the currently applied mobility pattern from.">currentPattern</a>].speed;
<a name="l00182"></a>00182     }
<a name="l00183"></a>00183     <span class="keywordflow">else</span> {
<a name="l00184"></a>00184       <a class="code" href="a00125.html#a56143810b39a6031abe1cc59a18136c3" title="Selected destination for the ongoing move of the logical center.">targetPos</a> = <a class="code" href="a00125.html#adebee0a447b7e85d444054fa3a4ee013" title="Function to select the destination in the case of a mobile posture.">selectDestination</a>();
<a name="l00185"></a>00185       <a class="code" href="a00125.html#afdfb553fa2576a3e72a6111b12f14a97" title="Currently selected speed for the mobile posture.">speed</a> = <a class="code" href="a00125.html#a6d83b8c03d91b0fee3e335b214f51b4c" title="Select a velocity value within the given velocity range.">selectSpeed</a>();
<a name="l00186"></a>00186     }
<a name="l00187"></a>00187 
<a name="l00188"></a>00188     <span class="keywordflow">if</span> (<a class="code" href="a00125.html#afdfb553fa2576a3e72a6111b12f14a97" title="Currently selected speed for the mobile posture.">speed</a>==0)
<a name="l00189"></a>00189       error(<span class="stringliteral">&quot;The velocity in a mobile posture should not be zero!&quot;</span>);
<a name="l00190"></a>00190 
<a name="l00191"></a>00191     distance = <a class="code" href="a00125.html#a2d0384199e2090caae09813e7d7f0d3b" title="Current position of the logical center of the group.">logicalCenter</a>.<a class="code" href="a00062.html#ab6a7bfcc5c55e5d8edbc7c0cb5a11626" title="Returns the distance to Coord &amp;#39;a&amp;#39;.">distance</a>(<a class="code" href="a00125.html#a56143810b39a6031abe1cc59a18136c3" title="Selected destination for the ongoing move of the logical center.">targetPos</a>);
<a name="l00192"></a>00192     <a class="code" href="a00125.html#ae65c511653f346fbb079389ab23b62cf" title="The selected duration of the current posture.">duration</a> = distance / <a class="code" href="a00125.html#afdfb553fa2576a3e72a6111b12f14a97" title="Currently selected speed for the mobile posture.">speed</a>;
<a name="l00193"></a>00193 
<a name="l00194"></a>00194     <span class="keywordflow">if</span> (<a class="code" href="a00125.html#ae65c511653f346fbb079389ab23b62cf" title="The selected duration of the current posture.">duration</a> &gt;= <a class="code" href="a00125.html#a4b679462d1e5489af4b5a5480f22fdaa" title="Interval for updating the move (NED parameter).">updateInterval</a>)
<a name="l00195"></a>00195       <a class="code" href="a00125.html#af177cb826e1fec16faf7c7cbd0390cf5" title="Total number of steps of the current move or current posture.">numSteps</a> = <a class="code" href="a00092.html#ad5b2d4a46bf7af77e9cc0070b6a82c18">FWMath::round</a>(<a class="code" href="a00125.html#ae65c511653f346fbb079389ab23b62cf" title="The selected duration of the current posture.">duration</a> / <a class="code" href="a00125.html#a4b679462d1e5489af4b5a5480f22fdaa" title="Interval for updating the move (NED parameter).">updateInterval</a>);
<a name="l00196"></a>00196     <span class="keywordflow">else</span>
<a name="l00197"></a>00197       <a class="code" href="a00125.html#af177cb826e1fec16faf7c7cbd0390cf5" title="Total number of steps of the current move or current posture.">numSteps</a> = 1; <span class="comment">//The selected target position is quite close so that in less than one step, it will be reached with the given velocity.</span>
<a name="l00198"></a>00198 
<a name="l00199"></a>00199     <a class="code" href="a00125.html#a56735487e55a96bd1294af15883f2d9c" title="The size of the current move step.">stepSize</a> = <a class="code" href="a00125.html#a56143810b39a6031abe1cc59a18136c3" title="Selected destination for the ongoing move of the logical center.">targetPos</a> - <a class="code" href="a00125.html#a2d0384199e2090caae09813e7d7f0d3b" title="Current position of the logical center of the group.">logicalCenter</a>;
<a name="l00200"></a>00200     <a class="code" href="a00125.html#a56735487e55a96bd1294af15883f2d9c" title="The size of the current move step.">stepSize</a> = <a class="code" href="a00125.html#a56735487e55a96bd1294af15883f2d9c" title="The size of the current move step.">stepSize</a> / <a class="code" href="a00125.html#af177cb826e1fec16faf7c7cbd0390cf5" title="Total number of steps of the current move or current posture.">numSteps</a>;
<a name="l00201"></a>00201     <a class="code" href="a00125.html#a25c1728a5480570b4b8fe51b4a4a5f02" title="The intermediate target of the current move step.">stepTarget</a> = logicalCenter + <a class="code" href="a00125.html#a56735487e55a96bd1294af15883f2d9c" title="The size of the current move step.">stepSize</a>;
<a name="l00202"></a>00202   }
<a name="l00203"></a>00203   <span class="keywordflow">else</span>
<a name="l00204"></a>00204   {
<a name="l00205"></a>00205     <span class="keywordflow">if</span> (<a class="code" href="a00125.html#a6f67cb3412735ec31734d8a345688e5b" title="Variable that shows if reusing previously logged mobility pattern is requested. The...">useMobilityPattern</a>)
<a name="l00206"></a>00206       <a class="code" href="a00125.html#ae65c511653f346fbb079389ab23b62cf" title="The selected duration of the current posture.">duration</a> = <a class="code" href="a00125.html#ae19a9a2dce220a75c4757381b5f348a7" title="The mobility pattern data base.">mobilityPattern</a>[<a class="code" href="a00125.html#aeff87bd9af8cb9aa14eada4b73ec4fbe" title="The index of the currently applied mobility pattern from.">currentPattern</a>].duration;
<a name="l00207"></a>00207     <span class="keywordflow">else</span>
<a name="l00208"></a>00208       <a class="code" href="a00125.html#ae65c511653f346fbb079389ab23b62cf" title="The selected duration of the current posture.">duration</a> = <a class="code" href="a00125.html#ab4f9d86a51c84b083817db1fcbe9dbab" title="Select a stay time duration in the specified range for the new posture.">selectDuration</a>();
<a name="l00209"></a>00209 
<a name="l00210"></a>00210     <span class="keywordflow">if</span> (<a class="code" href="a00125.html#ae65c511653f346fbb079389ab23b62cf" title="The selected duration of the current posture.">duration</a> &lt; <a class="code" href="a00125.html#a4b679462d1e5489af4b5a5480f22fdaa" title="Interval for updating the move (NED parameter).">updateInterval</a>)
<a name="l00211"></a>00211       error(<span class="stringliteral">&quot;The duration of a posture should be bigger than the updateInterval value!&quot;</span>);
<a name="l00212"></a>00212 
<a name="l00213"></a>00213     <a class="code" href="a00125.html#af177cb826e1fec16faf7c7cbd0390cf5" title="Total number of steps of the current move or current posture.">numSteps</a> = <a class="code" href="a00092.html#ad5b2d4a46bf7af77e9cc0070b6a82c18">FWMath::round</a>(<a class="code" href="a00125.html#ae65c511653f346fbb079389ab23b62cf" title="The selected duration of the current posture.">duration</a> / <a class="code" href="a00125.html#a4b679462d1e5489af4b5a5480f22fdaa" title="Interval for updating the move (NED parameter).">updateInterval</a>) ;
<a name="l00214"></a>00214   }
<a name="l00215"></a>00215   <a class="code" href="a00125.html#ac1a5ee7eeedb62fdfcee79fb6234f762" title="Number of steps already moved.">step</a> = 0;
<a name="l00216"></a>00216 
<a name="l00217"></a>00217     <span class="comment">//show posture name in the graphical interface</span>
<a name="l00218"></a>00218   <span class="keywordflow">if</span>(ev.isGUI()){
<a name="l00219"></a>00219     <span class="keywordtype">char</span> dis_str[100];
<a name="l00220"></a>00220     sprintf(dis_str,<span class="stringliteral">&quot;p=%f,50;i=block/wheelbarrow;is=vs;t=%s Duration:%f&quot;</span>,<a class="code" href="a00125.html#a19061b8cb8295d5afce5e95bb1c8ea99" title="Pointer to the BaseWorldUtility.">world</a>-&gt;<a class="code" href="a00027.html#a179c8bf9d4613cbb1af0a85d779827a6" title="Returns the playgroundSize.">getPgs</a>()-&gt;x+10+(<a class="code" href="a00125.html#a5320bb16f51acc82b6419911a280e11d" title="Index of this WBAN.">index</a>*30),<a class="code" href="a00125.html#a19a97a40859c36012f3a63a7c9ef9b46" title="The current selected posture.">currentPosture</a>-&gt;<a class="code" href="a00154.html#ad5d32a4a05de7bc9d69c0070b989d30a" title="Returns posture name.">getPostureName</a>(),SIMTIME_DBL(<a class="code" href="a00125.html#ae65c511653f346fbb079389ab23b62cf" title="The selected duration of the current posture.">duration</a>));
<a name="l00221"></a>00221     setDisplayString(dis_str);
<a name="l00222"></a>00222   }
<a name="l00223"></a>00223 
<a name="l00224"></a>00224     <span class="comment">// write the move step into the output log file</span>
<a name="l00225"></a>00225   <span class="keywordflow">if</span> (<a class="code" href="a00125.html#a19a97a40859c36012f3a63a7c9ef9b46" title="The current selected posture.">currentPosture</a>-&gt;<a class="code" href="a00154.html#a9c622bfcc0a70fc09ad0f6f57bfe7a63" title="Check if this posture is mobile by checking the maximum possible speed.">isMobile</a>())
<a name="l00226"></a>00226     fprintf(<a class="code" href="a00125.html#abb700aed062784b7cb21eec3e146c80d" title="Pointer to the file for logging MoBAN mobility pattern for future use.">logfile</a>,<span class="stringliteral">&quot;%s %d %f %f %f %f \n&quot;</span>,<a class="code" href="a00125.html#a19a97a40859c36012f3a63a7c9ef9b46" title="The current selected posture.">currentPosture</a>-&gt;<a class="code" href="a00154.html#ad5d32a4a05de7bc9d69c0070b989d30a" title="Returns posture name.">getPostureName</a>(),<a class="code" href="a00125.html#a19a97a40859c36012f3a63a7c9ef9b46" title="The current selected posture.">currentPosture</a>-&gt;<a class="code" href="a00154.html#ac22213164bd88de7d5eb77eb92247ef1" title="Returns the unique Id (index) of this posture.">getPostureID</a>(), <a class="code" href="a00125.html#a56143810b39a6031abe1cc59a18136c3" title="Selected destination for the ongoing move of the logical center.">targetPos</a>.x,<a class="code" href="a00125.html#a56143810b39a6031abe1cc59a18136c3" title="Selected destination for the ongoing move of the logical center.">targetPos</a>.y,<a class="code" href="a00125.html#a56143810b39a6031abe1cc59a18136c3" title="Selected destination for the ongoing move of the logical center.">targetPos</a>.z,<a class="code" href="a00125.html#afdfb553fa2576a3e72a6111b12f14a97" title="Currently selected speed for the mobile posture.">speed</a>);
<a name="l00227"></a>00227   <span class="keywordflow">else</span>
<a name="l00228"></a>00228     fprintf(<a class="code" href="a00125.html#abb700aed062784b7cb21eec3e146c80d" title="Pointer to the file for logging MoBAN mobility pattern for future use.">logfile</a>,<span class="stringliteral">&quot;%s %d %f \n&quot;</span>,<a class="code" href="a00125.html#a19a97a40859c36012f3a63a7c9ef9b46" title="The current selected posture.">currentPosture</a>-&gt;<a class="code" href="a00154.html#ad5d32a4a05de7bc9d69c0070b989d30a" title="Returns posture name.">getPostureName</a>(),<a class="code" href="a00125.html#a19a97a40859c36012f3a63a7c9ef9b46" title="The current selected posture.">currentPosture</a>-&gt;<a class="code" href="a00154.html#ac22213164bd88de7d5eb77eb92247ef1" title="Returns the unique Id (index) of this posture.">getPostureID</a>(), SIMTIME_DBL(<a class="code" href="a00125.html#ae65c511653f346fbb079389ab23b62cf" title="The selected duration of the current posture.">duration</a>));
<a name="l00229"></a>00229 
<a name="l00230"></a>00230 
<a name="l00231"></a>00231   EV &lt;&lt; <span class="stringliteral">&quot;New posture : &quot;</span> &lt;&lt; <a class="code" href="a00125.html#a19a97a40859c36012f3a63a7c9ef9b46" title="The current selected posture.">currentPosture</a>-&gt;<a class="code" href="a00154.html#ad5d32a4a05de7bc9d69c0070b989d30a" title="Returns posture name.">getPostureName</a>() &lt;&lt; endl;
<a name="l00232"></a>00232   EV &lt;&lt; <span class="stringliteral">&quot;Destination:&quot;</span> &lt;&lt; <a class="code" href="a00125.html#a56143810b39a6031abe1cc59a18136c3" title="Selected destination for the ongoing move of the logical center.">targetPos</a>.<a class="code" href="a00062.html#a86994bfa7096155d951abb03dcf30bf1" title="Returns a string with the value of the coordinate.">info</a>() &lt;&lt; <span class="stringliteral">&quot; Total Time=&quot;</span> &lt;&lt; <a class="code" href="a00125.html#ae65c511653f346fbb079389ab23b62cf" title="The selected duration of the current posture.">duration</a> &lt;&lt; endl;
<a name="l00233"></a>00233 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a138ebd67882d6cf1154126f47d35d49c"></a><!-- doxytag: member="MoBANCoordinator::readConfigurationFile" ref="a138ebd67882d6cf1154126f47d35d49c" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool MoBANCoordinator::readConfigurationFile </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reads the input configuration file. </p>
<p>Function to read the configuration file which includes the information for configuring and tuning the model for a specific application scenario. The configuration file can provide the Markov model transition matrices, different area types and time domains, and the proper matrix for each time-space combination. However, these are all optional and will b e given just in the case that the space-time correlation are required to be simulated. The function will be called in the initialization phase. </p>

<p>Definition at line <a class="el" href="a00363_source.html#l00514">514</a> of file <a class="el" href="a00363_source.html">MoBANCoordinator.cc</a>.</p>

<p>References <a class="el" href="a00369_source.html#l00153">PostureTransition::addAreaType()</a>, <a class="el" href="a00369_source.html#l00230">PostureTransition::addCombination()</a>, <a class="el" href="a00369_source.html#l00445">PostureTransition::addMatrix()</a>, <a class="el" href="a00369_source.html#l00115">PostureTransition::addSteadyState()</a>, <a class="el" href="a00369_source.html#l00191">PostureTransition::addTimeDomain()</a>, <a class="el" href="a00364_source.html#l00133">currentPosture</a>, <a class="el" href="a00282_source.html#l00069">Coord::info()</a>, <a class="el" href="a00364_source.html#l00148">logicalCenter</a>, <a class="el" href="a00284_source.html#l00142">FWMath::max()</a>, <a class="el" href="a00364_source.html#l00142">maxDuration</a>, <a class="el" href="a00364_source.html#l00139">minDuration</a>, <a class="el" href="a00364_source.html#l00127">numPostures</a>, <a class="el" href="a00364_source.html#l00130">postureList</a>, <a class="el" href="a00364_source.html#l00209">postureSelStrategy</a>, <a class="el" href="a00369_source.html#l00176">PostureTransition::setAreaBoundry()</a>, <a class="el" href="a00369_source.html#l00213">PostureTransition::setTimeBoundry()</a>, <a class="el" href="a00364_source.html#l00212">transitions</a>, and <a class="el" href="a00364_source.html#l00108">updateInterval</a>.</p>

<p>Referenced by <a class="el" href="a00363_source.html#l00055">initialize()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00514"></a>00514                                              {
<a name="l00515"></a>00515   cXMLElement* xmlConfig = par(<span class="stringliteral">&quot;configFile&quot;</span>).xmlValue();
<a name="l00516"></a>00516   <span class="keywordflow">if</span> (xmlConfig == 0)
<a name="l00517"></a>00517     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00518"></a>00518 
<a name="l00519"></a>00519   cXMLElementList tagList;
<a name="l00520"></a>00520   cXMLElement* tempTag;
<a name="l00521"></a>00521   <span class="keyword">const</span> <span class="keywordtype">char</span>* str;
<a name="l00522"></a>00522   std::string sstr; <span class="comment">//for easier comparison</span>
<a name="l00523"></a>00523 
<a name="l00524"></a>00524   <span class="comment">/* Reading the initial posture if it is given*/</span>
<a name="l00525"></a>00525   <span class="keywordtype">int</span> postureID;
<a name="l00526"></a>00526   tagList = xmlConfig-&gt;getElementsByTagName(<span class="stringliteral">&quot;initialPosture&quot;</span>);
<a name="l00527"></a>00527 
<a name="l00528"></a>00528   <span class="keywordflow">if</span> (tagList.empty())
<a name="l00529"></a>00529     postureID = 0; <span class="comment">// no initial posture has been specified. The first one is selected!</span>
<a name="l00530"></a>00530   <span class="keywordflow">else</span> {
<a name="l00531"></a>00531     tempTag = tagList.front();
<a name="l00532"></a>00532     str = tempTag-&gt;getAttribute(<span class="stringliteral">&quot;postureID&quot;</span>);
<a name="l00533"></a>00533     postureID = strtol(str, 0, 0);
<a name="l00534"></a>00534   }
<a name="l00535"></a>00535   <a class="code" href="a00125.html#a19a97a40859c36012f3a63a7c9ef9b46" title="The current selected posture.">currentPosture</a> = <a class="code" href="a00125.html#afbb28bcb93bda1faadc7030d86be43b5" title="The list of all predefined postures (posture data base).">postureList</a>[postureID];
<a name="l00536"></a>00536   EV&lt;&lt; <span class="stringliteral">&quot;Initial Posture:&quot;</span>&lt;&lt; postureID &lt;&lt;endl;
<a name="l00537"></a>00537 
<a name="l00538"></a>00538 
<a name="l00539"></a>00539   <span class="comment">/* Reading the initial position of the logical center if it is given */</span>
<a name="l00540"></a>00540   tagList = xmlConfig-&gt;getElementsByTagName(<span class="stringliteral">&quot;initialLocation&quot;</span>);
<a name="l00541"></a>00541   <span class="keywordflow">if</span>(tagList.empty())
<a name="l00542"></a>00542     <a class="code" href="a00125.html#a2d0384199e2090caae09813e7d7f0d3b" title="Current position of the logical center of the group.">logicalCenter</a>=<a class="code" href="a00062.html" title="Class for storing 3D coordinates.">Coord</a>(10,10,5); <span class="comment">// no initial location has been specified .</span>
<a name="l00543"></a>00543   <span class="keywordflow">else</span>
<a name="l00544"></a>00544   {
<a name="l00545"></a>00545     <span class="keywordtype">double</span> x,y,z;
<a name="l00546"></a>00546     tempTag= tagList.front();
<a name="l00547"></a>00547 
<a name="l00548"></a>00548     str = tempTag-&gt;getAttribute(<span class="stringliteral">&quot;x&quot;</span>); x = strtod(str, 0);
<a name="l00549"></a>00549     str = tempTag-&gt;getAttribute(<span class="stringliteral">&quot;y&quot;</span>); y = strtod(str, 0);
<a name="l00550"></a>00550     str = tempTag-&gt;getAttribute(<span class="stringliteral">&quot;z&quot;</span>); z = strtod(str, 0);
<a name="l00551"></a>00551     <a class="code" href="a00125.html#a2d0384199e2090caae09813e7d7f0d3b" title="Current position of the logical center of the group.">logicalCenter</a> = <a class="code" href="a00062.html" title="Class for storing 3D coordinates.">Coord</a>(x,y,z);
<a name="l00552"></a>00552   }
<a name="l00553"></a>00553   EV &lt;&lt; <span class="stringliteral">&quot;Initial position of the LC:&quot;</span>&lt;&lt; <a class="code" href="a00125.html#a2d0384199e2090caae09813e7d7f0d3b" title="Current position of the logical center of the group.">logicalCenter</a>.<a class="code" href="a00062.html#a86994bfa7096155d951abb03dcf30bf1" title="Returns a string with the value of the coordinate.">info</a>() &lt;&lt;endl;
<a name="l00554"></a>00554 
<a name="l00555"></a>00555   <span class="comment">/* Reading the given range for duration of stable postures */</span>
<a name="l00556"></a>00556   tagList = xmlConfig-&gt;getElementsByTagName(<span class="stringliteral">&quot;durationRange&quot;</span>);
<a name="l00557"></a>00557   <span class="keywordflow">if</span>(tagList.empty())
<a name="l00558"></a>00558   {
<a name="l00559"></a>00559     <span class="comment">// no duration is specified. We assign a value!</span>
<a name="l00560"></a>00560     <a class="code" href="a00125.html#aac48e46d43458a8f960cc33e84ac85e8" title="The minimum value of the duration for stable postures.">minDuration</a> = <a class="code" href="a00125.html#a4b679462d1e5489af4b5a5480f22fdaa" title="Interval for updating the move (NED parameter).">updateInterval</a>;
<a name="l00561"></a>00561     <a class="code" href="a00125.html#a02c4e8d23a6b0b2e1a1d94abe1974b9f" title="The maximum value of the duration for stable postures.">maxDuration</a> = 100;
<a name="l00562"></a>00562   }
<a name="l00563"></a>00563   <span class="keywordflow">else</span>
<a name="l00564"></a>00564   {
<a name="l00565"></a>00565     <span class="keywordtype">double</span> min,max;
<a name="l00566"></a>00566     tempTag= tagList.front();
<a name="l00567"></a>00567 
<a name="l00568"></a>00568     str = tempTag-&gt;getAttribute(<span class="stringliteral">&quot;min&quot;</span>); min = strtod(str, 0);
<a name="l00569"></a>00569     str = tempTag-&gt;getAttribute(<span class="stringliteral">&quot;max&quot;</span>); max = strtod(str, 0);
<a name="l00570"></a>00570 
<a name="l00571"></a>00571     <a class="code" href="a00125.html#aac48e46d43458a8f960cc33e84ac85e8" title="The minimum value of the duration for stable postures.">minDuration</a> = <a class="code" href="a00092.html#a7fd5acab90d26f509178dbda7935adcf">FWMath::max</a>(SIMTIME_DBL(<a class="code" href="a00125.html#a4b679462d1e5489af4b5a5480f22fdaa" title="Interval for updating the move (NED parameter).">updateInterval</a>),min); <span class="comment">// the minimum should be bigger than the update interval.</span>
<a name="l00572"></a>00572     <a class="code" href="a00125.html#a02c4e8d23a6b0b2e1a1d94abe1974b9f" title="The maximum value of the duration for stable postures.">maxDuration</a> = <a class="code" href="a00092.html#a7fd5acab90d26f509178dbda7935adcf">FWMath::max</a>(min,max);
<a name="l00573"></a>00573   }
<a name="l00574"></a>00574   EV &lt;&lt; <span class="stringliteral">&quot;Posture duration range: (&quot;</span>&lt;&lt; <a class="code" href="a00125.html#aac48e46d43458a8f960cc33e84ac85e8" title="The minimum value of the duration for stable postures.">minDuration</a> &lt;&lt; <span class="stringliteral">&quot; , &quot;</span> &lt;&lt; <a class="code" href="a00125.html#a02c4e8d23a6b0b2e1a1d94abe1974b9f" title="The maximum value of the duration for stable postures.">maxDuration</a> &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; endl;
<a name="l00575"></a>00575 
<a name="l00576"></a>00576 
<a name="l00577"></a>00577   <a class="code" href="a00125.html#a51f9fc44b5168e7ef6e58fd221bf3f0a" title="Class for performing operation for spatial and temporal correlations in posture selection...">transitions</a> = <span class="keyword">new</span> <a class="code" href="a00155.html" title="Class to provide spatial and temporal correlation in the posture selection process...">PostureTransition</a>(<a class="code" href="a00125.html#a3880f0e3e0e489b1edd2692a441b903f" title="Number of predefined postures.">numPostures</a>);
<a name="l00578"></a>00578 
<a name="l00579"></a>00579 
<a name="l00580"></a>00580   <span class="comment">/* Reading the Markov transition matrices, if there are any. */</span>
<a name="l00581"></a>00581   tagList = xmlConfig-&gt;getElementsByTagName(<span class="stringliteral">&quot;markovMatrices&quot;</span>);
<a name="l00582"></a>00582 
<a name="l00583"></a>00583   <span class="keywordflow">if</span>(tagList.empty())
<a name="l00584"></a>00584   {
<a name="l00585"></a>00585     <a class="code" href="a00125.html#a626ad8d08de1e3d7fad2c8032f199933" title="The requested strategy for posture selection. To be given through configuration file...">postureSelStrategy</a> = UNIFORM_RANDOM; <span class="comment">// no posture selection strategy is required. uniform random is applied</span>
<a name="l00586"></a>00586     EV &lt;&lt; <span class="stringliteral">&quot;Posture Selection strategy: UNIFORM_RANDOM &quot;</span>&lt;&lt; endl;
<a name="l00587"></a>00587     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00588"></a>00588   }
<a name="l00589"></a>00589 
<a name="l00590"></a>00590   tempTag = tagList.front();
<a name="l00591"></a>00591 
<a name="l00592"></a>00592   cXMLElementList matrixList;
<a name="l00593"></a>00593   matrixList = tempTag-&gt;getElementsByTagName(<span class="stringliteral">&quot;MarkovMatrix&quot;</span>);
<a name="l00594"></a>00594 
<a name="l00595"></a>00595   <span class="keywordflow">if</span>(tagList.empty())
<a name="l00596"></a>00596   {
<a name="l00597"></a>00597     <a class="code" href="a00125.html#a626ad8d08de1e3d7fad2c8032f199933" title="The requested strategy for posture selection. To be given through configuration file...">postureSelStrategy</a> = UNIFORM_RANDOM; <span class="comment">// no posture selection strategy is required. uniform random is applied</span>
<a name="l00598"></a>00598     EV &lt;&lt; <span class="stringliteral">&quot;Posture Selection strategy: UNIFORM_RANDOM &quot;</span>&lt;&lt; endl;
<a name="l00599"></a>00599     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00600"></a>00600   }
<a name="l00601"></a>00601 
<a name="l00602"></a>00602   <a class="code" href="a00125.html#a626ad8d08de1e3d7fad2c8032f199933" title="The requested strategy for posture selection. To be given through configuration file...">postureSelStrategy</a> = MARKOV_BASE;
<a name="l00603"></a>00603 
<a name="l00604"></a>00604   <span class="comment">// make an empty matrix for the Markov Chain</span>
<a name="l00605"></a>00605     <span class="keywordtype">double</span>** matrix = <span class="keyword">new</span> <span class="keywordtype">double</span>* [<a class="code" href="a00125.html#a3880f0e3e0e489b1edd2692a441b903f" title="Number of predefined postures.">numPostures</a>];
<a name="l00606"></a>00606   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0;i&lt;<a class="code" href="a00125.html#a3880f0e3e0e489b1edd2692a441b903f" title="Number of predefined postures.">numPostures</a>;++i)
<a name="l00607"></a>00607     matrix[i] = <span class="keyword">new</span> <span class="keywordtype">double</span> [numPostures];
<a name="l00608"></a>00608 
<a name="l00609"></a>00609   <span class="keywordtype">bool</span> setDefault=<span class="keyword">false</span>; <span class="comment">// variable to remember if the default matrix is defined.</span>
<a name="l00610"></a>00610   cXMLElementList::const_iterator matrixTag;
<a name="l00611"></a>00611   <span class="keywordflow">for</span>(matrixTag = matrixList.begin(); matrixTag != matrixList.end(); matrixTag++)
<a name="l00612"></a>00612   {
<a name="l00613"></a>00613 
<a name="l00614"></a>00614     cXMLElementList rowList;
<a name="l00615"></a>00615     cXMLElementList cellList;
<a name="l00616"></a>00616     <span class="keywordtype">int</span> i=0,j=0;
<a name="l00617"></a>00617     <span class="keywordtype">bool</span> thisDefault = <span class="keyword">false</span>;
<a name="l00618"></a>00618 
<a name="l00619"></a>00619     <span class="keywordflow">if</span> ( (*matrixTag)-&gt;getAttribute(<span class="stringliteral">&quot;type&quot;</span>) != NULL)
<a name="l00620"></a>00620     {
<a name="l00621"></a>00621       sstr = (*matrixTag)-&gt;getAttribute(<span class="stringliteral">&quot;type&quot;</span>);
<a name="l00622"></a>00622       <span class="keywordflow">if</span> ( sstr == <span class="stringliteral">&quot;Default&quot;</span> || sstr == <span class="stringliteral">&quot;default&quot;</span> )
<a name="l00623"></a>00623       {
<a name="l00624"></a>00624         <span class="keywordflow">if</span> (setDefault)
<a name="l00625"></a>00625           error (<span class="stringliteral">&quot;There are more than one default matrix defined in the configuration file!&quot;</span>);
<a name="l00626"></a>00626         <span class="keywordflow">else</span>
<a name="l00627"></a>00627           {setDefault = <span class="keyword">true</span>; thisDefault = <span class="keyword">true</span>;}
<a name="l00628"></a>00628       }
<a name="l00629"></a>00629     }
<a name="l00630"></a>00630 
<a name="l00631"></a>00631 
<a name="l00632"></a>00632     sstr = (*matrixTag)-&gt;getAttribute(<span class="stringliteral">&quot;name&quot;</span>);
<a name="l00633"></a>00633 
<a name="l00634"></a>00634     rowList = (*matrixTag)-&gt;getElementsByTagName(<span class="stringliteral">&quot;row&quot;</span>);
<a name="l00635"></a>00635     <span class="keywordflow">if</span> (rowList.size()!= numPostures &amp;&amp; rowList.size()!= 1)
<a name="l00636"></a>00636       error(<span class="stringliteral">&quot;Number of rows in  the Markov transition matrix should be equal to either the number&quot;</span>
<a name="l00637"></a>00637           <span class="stringliteral">&quot; of postures (full Markov matrix) or one (steady state vector).&quot;</span>);
<a name="l00638"></a>00638 
<a name="l00639"></a>00639     <span class="keywordflow">if</span> (rowList.size()!= numPostures &amp;&amp; thisDefault )
<a name="l00640"></a>00640       error(<span class="stringliteral">&quot;Dimension of the default Markov matrix should be equal to the number of postures in the configuration file.&quot;</span>);
<a name="l00641"></a>00641 
<a name="l00642"></a>00642     <span class="keywordflow">if</span> ( (rowList.size()== 1) &amp;&amp; (!setDefault) )
<a name="l00643"></a>00643       error(<span class="stringliteral">&quot;A default matrix is supposed to be defined before a steady state can be defined in the configuration file.&quot;</span>);
<a name="l00644"></a>00644 
<a name="l00645"></a>00645     <span class="keywordflow">for</span>(cXMLElementList::const_iterator row = rowList.begin(); row != rowList.end(); row++)
<a name="l00646"></a>00646     {
<a name="l00647"></a>00647       cellList = (*row)-&gt;getElementsByTagName(<span class="stringliteral">&quot;cell&quot;</span>);
<a name="l00648"></a>00648       <span class="keywordflow">if</span> (cellList.size()!= numPostures)
<a name="l00649"></a>00649         error(<span class="stringliteral">&quot;Number of columns in  the Markov transition matrix should be equal to the number of postures.&quot;</span>);
<a name="l00650"></a>00650 
<a name="l00651"></a>00651       j=0;
<a name="l00652"></a>00652       <span class="keywordflow">for</span>(cXMLElementList::const_iterator cell = cellList.begin(); cell != cellList.end(); cell++)
<a name="l00653"></a>00653       {
<a name="l00654"></a>00654         str = (*cell)-&gt;getAttribute(<span class="stringliteral">&quot;value&quot;</span>);
<a name="l00655"></a>00655         matrix[i][j] = strtod(str, 0);
<a name="l00656"></a>00656         j++;
<a name="l00657"></a>00657       }
<a name="l00658"></a>00658 
<a name="l00659"></a>00659       ++i;
<a name="l00660"></a>00660     }
<a name="l00661"></a>00661 
<a name="l00662"></a>00662     <span class="keywordflow">if</span> (rowList.size() == 1)
<a name="l00663"></a>00663       <a class="code" href="a00125.html#a51f9fc44b5168e7ef6e58fd221bf3f0a" title="Class for performing operation for spatial and temporal correlations in posture selection...">transitions</a>-&gt;<a class="code" href="a00155.html#ac5c424a8372a3d6f39ccc06c88d4249f" title="Receives a steady state vector, extracts the corresponding transition matrix considering...">addSteadyState</a>(sstr, matrix[0]); <span class="comment">// steady state</span>
<a name="l00664"></a>00664     <span class="keywordflow">else</span>
<a name="l00665"></a>00665        <a class="code" href="a00125.html#a51f9fc44b5168e7ef6e58fd221bf3f0a" title="Class for performing operation for spatial and temporal correlations in posture selection...">transitions</a>-&gt;<a class="code" href="a00155.html#a10abfb612543bbc52f6a13a0e138d822" title="Adds two matrices with dimension numPos*numPose .">addMatrix</a>(sstr, matrix, thisDefault);     <span class="comment">// A full Markovian matrix</span>
<a name="l00666"></a>00666 
<a name="l00667"></a>00667     EV &lt;&lt; <span class="stringliteral">&quot;Markov transition matrix &quot;</span>&lt;&lt; sstr &lt;&lt; <span class="stringliteral">&quot; :&quot;</span> &lt;&lt;endl;
<a name="l00668"></a>00668     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=0;k &lt; i ; ++k)
<a name="l00669"></a>00669     {
<a name="l00670"></a>00670       <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> f=0; f&lt;numPostures ;++f)
<a name="l00671"></a>00671         EV &lt;&lt; matrix[k][f]&lt;&lt;<span class="stringliteral">&quot; &quot;</span>;
<a name="l00672"></a>00672       EV &lt;&lt; endl;
<a name="l00673"></a>00673     }
<a name="l00674"></a>00674 
<a name="l00675"></a>00675   }
<a name="l00676"></a>00676 
<a name="l00677"></a>00677   <span class="comment">/* Reading the Area types, if there are any. */</span>
<a name="l00678"></a>00678   tagList = xmlConfig-&gt;getElementsByTagName(<span class="stringliteral">&quot;areaTypes&quot;</span>);
<a name="l00679"></a>00679 
<a name="l00680"></a>00680   <span class="keywordflow">if</span>( tagList.empty() )
<a name="l00681"></a>00681     EV &lt;&lt; <span class="stringliteral">&quot;No area type is given. So there is no spatial correlation in posture selection.&quot;</span> &lt;&lt; endl;
<a name="l00682"></a>00682   <span class="keywordflow">else</span>{
<a name="l00683"></a>00683 
<a name="l00684"></a>00684       tempTag = tagList.front();
<a name="l00685"></a>00685       cXMLElementList typeList = tempTag-&gt;getElementsByTagName(<span class="stringliteral">&quot;areaType&quot;</span>);
<a name="l00686"></a>00686 
<a name="l00687"></a>00687       <span class="keywordflow">if</span>( typeList.empty() )
<a name="l00688"></a>00688         error (<span class="stringliteral">&quot;No areaType has been defined in areaTypes!&quot;</span>);
<a name="l00689"></a>00689 
<a name="l00690"></a>00690       <span class="keywordflow">for</span>(cXMLElementList::const_iterator aType = typeList.begin(); aType != typeList.end(); aType++)
<a name="l00691"></a>00691       {
<a name="l00692"></a>00692         sstr = (*aType)-&gt;getAttribute(<span class="stringliteral">&quot;name&quot;</span>);
<a name="l00693"></a>00693 
<a name="l00694"></a>00694         EV &lt;&lt; <span class="stringliteral">&quot;Area type &quot;</span> &lt;&lt; sstr &lt;&lt; <span class="stringliteral">&quot; :&quot;</span> &lt;&lt; endl;
<a name="l00695"></a>00695 
<a name="l00696"></a>00696         <span class="keywordtype">int</span> typeID = <a class="code" href="a00125.html#a51f9fc44b5168e7ef6e58fd221bf3f0a" title="Class for performing operation for spatial and temporal correlations in posture selection...">transitions</a>-&gt;<a class="code" href="a00155.html#a261ad915b2a9c7cdf7082660360190e4" title="Adds a area type to the list with the given name and returns the index of this area...">addAreaType</a>(sstr);
<a name="l00697"></a>00697 
<a name="l00698"></a>00698         cXMLElementList boundList = (*aType)-&gt;getElementsByTagName(<span class="stringliteral">&quot;boundary&quot;</span>);
<a name="l00699"></a>00699         <span class="keywordflow">if</span>( boundList.empty() )
<a name="l00700"></a>00700           error (<span class="stringliteral">&quot;No boundary is given for a area type!&quot;</span>);
<a name="l00701"></a>00701 
<a name="l00702"></a>00702         <a class="code" href="a00062.html" title="Class for storing 3D coordinates.">Coord</a> minBound, maxBound;
<a name="l00703"></a>00703         <span class="keywordflow">for</span>(cXMLElementList::const_iterator aBound = boundList.begin(); aBound != boundList.end(); aBound++)
<a name="l00704"></a>00704         {
<a name="l00705"></a>00705           str = (*aBound)-&gt;getAttribute(<span class="stringliteral">&quot;xMin&quot;</span>); minBound.x = (strtod(str, 0));
<a name="l00706"></a>00706           str = (*aBound)-&gt;getAttribute(<span class="stringliteral">&quot;yMin&quot;</span>); minBound.y = (strtod(str, 0));
<a name="l00707"></a>00707           str = (*aBound)-&gt;getAttribute(<span class="stringliteral">&quot;zMin&quot;</span>); minBound.z = (strtod(str, 0));
<a name="l00708"></a>00708 
<a name="l00709"></a>00709           str = (*aBound)-&gt;getAttribute(<span class="stringliteral">&quot;xMax&quot;</span>); maxBound.x = (strtod(str, 0));
<a name="l00710"></a>00710           str = (*aBound)-&gt;getAttribute(<span class="stringliteral">&quot;yMax&quot;</span>); maxBound.y = (strtod(str, 0));
<a name="l00711"></a>00711           str = (*aBound)-&gt;getAttribute(<span class="stringliteral">&quot;zMax&quot;</span>); maxBound.z = (strtod(str, 0));
<a name="l00712"></a>00712 
<a name="l00713"></a>00713           <a class="code" href="a00125.html#a51f9fc44b5168e7ef6e58fd221bf3f0a" title="Class for performing operation for spatial and temporal correlations in posture selection...">transitions</a>-&gt;<a class="code" href="a00155.html#a309ed6acf7eca6469f0ea0f06ee41780" title="Adds the given boundary to the existing area type specified by the given ID .">setAreaBoundry</a>(typeID,minBound,maxBound);
<a name="l00714"></a>00714           EV &lt;&lt; <span class="stringliteral">&quot;Low bound: &quot;</span>&lt;&lt; minBound.<a class="code" href="a00062.html#a86994bfa7096155d951abb03dcf30bf1" title="Returns a string with the value of the coordinate.">info</a>() &lt;&lt; endl;
<a name="l00715"></a>00715           EV &lt;&lt; <span class="stringliteral">&quot;High bound: &quot;</span>&lt;&lt; maxBound.<a class="code" href="a00062.html#a86994bfa7096155d951abb03dcf30bf1" title="Returns a string with the value of the coordinate.">info</a>() &lt;&lt; endl;
<a name="l00716"></a>00716         }
<a name="l00717"></a>00717       }
<a name="l00718"></a>00718     }
<a name="l00719"></a>00719 
<a name="l00720"></a>00720   <span class="comment">/* Reading the time domains, if there are any. */</span>
<a name="l00721"></a>00721   tagList = xmlConfig-&gt;getElementsByTagName(<span class="stringliteral">&quot;timeDomains&quot;</span>);
<a name="l00722"></a>00722 
<a name="l00723"></a>00723   <span class="keywordflow">if</span>( tagList.empty() )
<a name="l00724"></a>00724     EV &lt;&lt; <span class="stringliteral">&quot;No time domain is given. So there is no temporal correlation in posture selection.&quot;</span> &lt;&lt; endl;
<a name="l00725"></a>00725   <span class="keywordflow">else</span>{
<a name="l00726"></a>00726 
<a name="l00727"></a>00727       tempTag = tagList.front();
<a name="l00728"></a>00728       cXMLElementList typeList = tempTag-&gt;getElementsByTagName(<span class="stringliteral">&quot;timeDomain&quot;</span>);
<a name="l00729"></a>00729 
<a name="l00730"></a>00730       <span class="keywordflow">if</span>( typeList.empty() )
<a name="l00731"></a>00731         error (<span class="stringliteral">&quot;No timeDomain has been defined in timeDomains!&quot;</span>);
<a name="l00732"></a>00732 
<a name="l00733"></a>00733       <span class="keywordflow">for</span>(cXMLElementList::const_iterator aType = typeList.begin(); aType != typeList.end(); aType++)
<a name="l00734"></a>00734       {
<a name="l00735"></a>00735         sstr = (*aType)-&gt;getAttribute(<span class="stringliteral">&quot;name&quot;</span>);
<a name="l00736"></a>00736 
<a name="l00737"></a>00737         EV &lt;&lt; <span class="stringliteral">&quot;Time domain &quot;</span> &lt;&lt; sstr &lt;&lt; <span class="stringliteral">&quot; :&quot;</span> &lt;&lt; endl;
<a name="l00738"></a>00738 
<a name="l00739"></a>00739         <span class="keywordtype">int</span> typeID = <a class="code" href="a00125.html#a51f9fc44b5168e7ef6e58fd221bf3f0a" title="Class for performing operation for spatial and temporal correlations in posture selection...">transitions</a>-&gt;<a class="code" href="a00155.html#a58c7924dfb8810ba37311217a7ba5c8d" title="Adds a time domain to the list with the given name and returns the index of the this...">addTimeDomain</a>(sstr);
<a name="l00740"></a>00740 
<a name="l00741"></a>00741         cXMLElementList boundList = (*aType)-&gt;getElementsByTagName(<span class="stringliteral">&quot;boundary&quot;</span>);
<a name="l00742"></a>00742         <span class="keywordflow">if</span>( boundList.empty() )
<a name="l00743"></a>00743           error (<span class="stringliteral">&quot;No boundary is given for a time domain!&quot;</span>);
<a name="l00744"></a>00744 
<a name="l00745"></a>00745         simtime_t minTime,maxTime;
<a name="l00746"></a>00746         <span class="keywordflow">for</span>(cXMLElementList::const_iterator aBound = boundList.begin(); aBound != boundList.end(); aBound++)
<a name="l00747"></a>00747         {
<a name="l00748"></a>00748           str = (*aBound)-&gt;getAttribute(<span class="stringliteral">&quot;tMin&quot;</span>); minTime = strtod(str,0);
<a name="l00749"></a>00749           str = (*aBound)-&gt;getAttribute(<span class="stringliteral">&quot;tMax&quot;</span>); maxTime = strtod(str,0);
<a name="l00750"></a>00750 
<a name="l00751"></a>00751           <a class="code" href="a00125.html#a51f9fc44b5168e7ef6e58fd221bf3f0a" title="Class for performing operation for spatial and temporal correlations in posture selection...">transitions</a>-&gt;<a class="code" href="a00155.html#ac26d34882db804ce0aa2a8081e526729" title="Adds the given boundary to the existing time domain specified by the given ID .">setTimeBoundry</a>(typeID,minTime,maxTime);
<a name="l00752"></a>00752           EV &lt;&lt; <span class="stringliteral">&quot;Low bound: (&quot;</span>&lt;&lt; minTime &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; maxTime &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; endl;
<a name="l00753"></a>00753         }
<a name="l00754"></a>00754       }
<a name="l00755"></a>00755   }
<a name="l00756"></a>00756 
<a name="l00757"></a>00757   <span class="comment">/* Reading the combinations, if there are any. */</span>
<a name="l00758"></a>00758   tagList = xmlConfig-&gt;getElementsByTagName(<span class="stringliteral">&quot;combinations&quot;</span>);
<a name="l00759"></a>00759 
<a name="l00760"></a>00760   <span class="keywordflow">if</span>( tagList.empty() )
<a name="l00761"></a>00761     EV &lt;&lt; <span class="stringliteral">&quot;No combination is given. The default Markov model is then used for the whole time and space!&quot;</span> &lt;&lt; endl;
<a name="l00762"></a>00762   <span class="keywordflow">else</span>{
<a name="l00763"></a>00763         tempTag = tagList.front();
<a name="l00764"></a>00764       cXMLElementList combList = tempTag-&gt;getElementsByTagName(<span class="stringliteral">&quot;combination&quot;</span>);
<a name="l00765"></a>00765 
<a name="l00766"></a>00766       <span class="keywordflow">if</span>( combList.empty() )
<a name="l00767"></a>00767         error (<span class="stringliteral">&quot;No combination has been defined in combinations!&quot;</span>);
<a name="l00768"></a>00768 
<a name="l00769"></a>00769       EV &lt;&lt; <span class="stringliteral">&quot;Combinations: &quot;</span> &lt;&lt; endl;
<a name="l00770"></a>00770 
<a name="l00771"></a>00771       <span class="keywordflow">for</span>(cXMLElementList::const_iterator aComb = combList.begin(); aComb != combList.end(); aComb++)
<a name="l00772"></a>00772       {
<a name="l00773"></a>00773         std::string areaName,timeName,matrixName;
<a name="l00774"></a>00774 
<a name="l00775"></a>00775         <span class="keywordflow">if</span> ((*aComb)-&gt;getAttribute(<span class="stringliteral">&quot;areaType&quot;</span>) != NULL)
<a name="l00776"></a>00776           areaName = (*aComb)-&gt;getAttribute(<span class="stringliteral">&quot;areaType&quot;</span>);
<a name="l00777"></a>00777         <span class="keywordflow">else</span>
<a name="l00778"></a>00778           areaName.clear();
<a name="l00779"></a>00779 
<a name="l00780"></a>00780         <span class="keywordflow">if</span> ( (*aComb)-&gt;getAttribute(<span class="stringliteral">&quot;timeDomain&quot;</span>) != NULL )
<a name="l00781"></a>00781           timeName = (*aComb)-&gt;getAttribute(<span class="stringliteral">&quot;timeDomain&quot;</span>);
<a name="l00782"></a>00782         <span class="keywordflow">else</span>
<a name="l00783"></a>00783           timeName.clear();
<a name="l00784"></a>00784 
<a name="l00785"></a>00785         <span class="keywordflow">if</span> ( (*aComb)-&gt;getAttribute(<span class="stringliteral">&quot;matrix&quot;</span>) != NULL )
<a name="l00786"></a>00786           matrixName = (*aComb)-&gt;getAttribute(<span class="stringliteral">&quot;matrix&quot;</span>);
<a name="l00787"></a>00787         <span class="keywordflow">else</span>
<a name="l00788"></a>00788           error(<span class="stringliteral">&quot;No transition matrix is specified for a combination.&quot;</span>);
<a name="l00789"></a>00789 
<a name="l00790"></a>00790         <a class="code" href="a00125.html#a51f9fc44b5168e7ef6e58fd221bf3f0a" title="Class for performing operation for spatial and temporal correlations in posture selection...">transitions</a>-&gt;<a class="code" href="a00155.html#a5b4ab00961c0039aac63143d28e88272" title="Adds a space-time combination to the list.">addCombination</a>(areaName, timeName, matrixName);
<a name="l00791"></a>00791 
<a name="l00792"></a>00792         EV &lt;&lt; <span class="stringliteral">&quot;(&quot;</span> &lt;&lt; areaName &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; timeName &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; matrixName &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; endl;
<a name="l00793"></a>00793       }
<a name="l00794"></a>00794     }
<a name="l00795"></a>00795 
<a name="l00796"></a>00796   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00797"></a>00797 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a31810405333b184c9db891fa9bd8a12a"></a><!-- doxytag: member="MoBANCoordinator::readMobilityPatternFile" ref="a31810405333b184c9db891fa9bd8a12a" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool MoBANCoordinator::readMobilityPatternFile </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reads the previously logged mobility <a class="el" href="a00147.html" title="Data type for one instance of mobility pattern.">pattern</a> and make mobility <a class="el" href="a00147.html" title="Data type for one instance of mobility pattern.">pattern</a> data base. </p>
<p>This function reads the input mobility <a class="el" href="a00147.html" title="Data type for one instance of mobility pattern.">pattern</a> file and make a list of the mobility patterns. It will be called in the initialization phase if the useMobilityPattern parameter is true. </p>

<p>Definition at line <a class="el" href="a00363_source.html#l00364">364</a> of file <a class="el" href="a00363_source.html">MoBANCoordinator.cc</a>.</p>

<p>References <a class="el" href="a00364_source.html#l00195">currentPattern</a>, <a class="el" href="a00364_source.html#l00187">mobilityPattern</a>, <a class="el" href="a00364_source.html#l00192">patternLength</a>, and <a class="el" href="a00364_source.html#l00130">postureList</a>.</p>

<p>Referenced by <a class="el" href="a00363_source.html#l00055">initialize()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00364"></a>00364                                                {
<a name="l00365"></a>00365   <a class="code" href="a00125.html#a00cbcb40ee4039ffd5723ffa4334d88f" title="The number of mobility pattern instances which has been read from the input file...">patternLength</a> = 0;
<a name="l00366"></a>00366   <span class="keywordtype">double</span> x, y, z, s;
<a name="l00367"></a>00367   <span class="keywordtype">int</span> id;
<a name="l00368"></a>00368   <span class="keywordtype">char</span> file_name[70];
<a name="l00369"></a>00369   <span class="keywordtype">char</span> posture_name[50];
<a name="l00370"></a>00370 
<a name="l00371"></a>00371   sprintf(file_name, <span class="stringliteral">&quot;%s&quot;</span>, par(<span class="stringliteral">&quot;mobilityPatternFile&quot;</span>).stringValue());
<a name="l00372"></a>00372   FILE *fp = fopen(file_name, <span class="stringliteral">&quot;r&quot;</span>);
<a name="l00373"></a>00373   <span class="keywordflow">if</span> (fp == NULL)
<a name="l00374"></a>00374     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00375"></a>00375 
<a name="l00376"></a>00376   <span class="comment">//Count number of patterns (lines in the input file)</span>
<a name="l00377"></a>00377   <span class="keywordtype">int</span> c;
<a name="l00378"></a>00378   <span class="keywordflow">while</span> ((c = fgetc(fp)) != EOF)
<a name="l00379"></a>00379     <span class="keywordflow">if</span> (c == <span class="charliteral">&apos;\n&apos;</span>)
<a name="l00380"></a>00380       <a class="code" href="a00125.html#a00cbcb40ee4039ffd5723ffa4334d88f" title="The number of mobility pattern instances which has been read from the input file...">patternLength</a>++;
<a name="l00381"></a>00381   fclose(fp);
<a name="l00382"></a>00382 
<a name="l00383"></a>00383   EV&lt;&lt; <span class="stringliteral">&quot;Mobility Pattern Length:&quot;</span> &lt;&lt; <a class="code" href="a00125.html#a00cbcb40ee4039ffd5723ffa4334d88f" title="The number of mobility pattern instances which has been read from the input file...">patternLength</a> &lt;&lt; endl;
<a name="l00384"></a>00384 
<a name="l00385"></a>00385   <a class="code" href="a00125.html#ae19a9a2dce220a75c4757381b5f348a7" title="The mobility pattern data base.">mobilityPattern</a> = <span class="keyword">new</span> <a class="code" href="a00125.html#aba7c0480967381f3cb5c09b05029abe7" title="Data type for one instance of mobility pattern.">Pattern</a>[<a class="code" href="a00125.html#a00cbcb40ee4039ffd5723ffa4334d88f" title="The number of mobility pattern instances which has been read from the input file...">patternLength</a>];
<a name="l00386"></a>00386 
<a name="l00387"></a>00387   fp = fopen(file_name,<span class="stringliteral">&quot;r&quot;</span>);
<a name="l00388"></a>00388 
<a name="l00389"></a>00389   <span class="keywordtype">int</span> i=0;
<a name="l00390"></a>00390   <span class="keywordflow">while</span> (fscanf(fp,<span class="stringliteral">&quot;%s %d&quot;</span>,posture_name,&amp;<span class="keywordtype">id</span>)!= -1) {
<a name="l00391"></a>00391     <a class="code" href="a00125.html#ae19a9a2dce220a75c4757381b5f348a7" title="The mobility pattern data base.">mobilityPattern</a>[i].postureID = id;
<a name="l00392"></a>00392     <span class="keywordflow">if</span> (<a class="code" href="a00125.html#afbb28bcb93bda1faadc7030d86be43b5" title="The list of all predefined postures (posture data base).">postureList</a>[<span class="keywordtype">id</span>]-&gt;isMobile())
<a name="l00393"></a>00393     {
<a name="l00394"></a>00394       assert( fscanf(fp,<span class="stringliteral">&quot;%le %le %le %le&quot;</span>,&amp;x,&amp;y,&amp;z,&amp;s)!=-1 );
<a name="l00395"></a>00395       <a class="code" href="a00125.html#ae19a9a2dce220a75c4757381b5f348a7" title="The mobility pattern data base.">mobilityPattern</a>[i].targetPos = <a class="code" href="a00062.html" title="Class for storing 3D coordinates.">Coord</a>(x,y,z);
<a name="l00396"></a>00396       <a class="code" href="a00125.html#ae19a9a2dce220a75c4757381b5f348a7" title="The mobility pattern data base.">mobilityPattern</a>[i].speed = s;
<a name="l00397"></a>00397     }
<a name="l00398"></a>00398     <span class="keywordflow">else</span>
<a name="l00399"></a>00399     {
<a name="l00400"></a>00400       assert ( fscanf(fp,<span class="stringliteral">&quot;%le&quot;</span>,&amp;x)!=-1 );
<a name="l00401"></a>00401       <a class="code" href="a00125.html#ae19a9a2dce220a75c4757381b5f348a7" title="The mobility pattern data base.">mobilityPattern</a>[i].duration = x;
<a name="l00402"></a>00402     }
<a name="l00403"></a>00403     ++i;
<a name="l00404"></a>00404   }
<a name="l00405"></a>00405 
<a name="l00406"></a>00406   fclose(fp);
<a name="l00407"></a>00407 
<a name="l00408"></a>00408   <a class="code" href="a00125.html#aeff87bd9af8cb9aa14eada4b73ec4fbe" title="The index of the currently applied mobility pattern from.">currentPattern</a> = -1;
<a name="l00409"></a>00409 
<a name="l00410"></a>00410   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00411"></a>00411 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aab85ba2010884afd66f619718e1194d7"></a><!-- doxytag: member="MoBANCoordinator::readPostureSpecificationFile" ref="aab85ba2010884afd66f619718e1194d7" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool MoBANCoordinator::readPostureSpecificationFile </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reading the input postures specification file and making the posture data base. </p>
<p>Function to read the specified posture specification input file and make the posture data base. The posture specification includes the specification of a set of possible body postures in the target application. The specification of each posture should provide the speed range of the global movement of the whole WBAN and the relative position of the reference point, movement radius around the reference point and movement velocity of all nodes in the WBAN. The function will be called in the initialization phase. </p>

<p>Definition at line <a class="el" href="a00363_source.html#l00420">420</a> of file <a class="el" href="a00363_source.html">MoBANCoordinator.cc</a>.</p>

<p>References <a class="el" href="a00364_source.html#l00115">numNodes</a>, <a class="el" href="a00364_source.html#l00127">numPostures</a>, and <a class="el" href="a00364_source.html#l00130">postureList</a>.</p>

<p>Referenced by <a class="el" href="a00363_source.html#l00055">initialize()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00420"></a>00420                                                     {
<a name="l00421"></a>00421 
<a name="l00422"></a>00422   cXMLElement* xmlPosture = par(<span class="stringliteral">&quot;postureSpecFile&quot;</span>).xmlValue();
<a name="l00423"></a>00423   <span class="keywordflow">if</span> (xmlPosture == 0)
<a name="l00424"></a>00424     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00425"></a>00425 
<a name="l00426"></a>00426   <span class="keyword">const</span> <span class="keywordtype">char</span>* str;
<a name="l00427"></a>00427 
<a name="l00428"></a>00428   <span class="comment">//read the specification of every posture from file and make a list of postures</span>
<a name="l00429"></a>00429   cXMLElementList postures;
<a name="l00430"></a>00430 
<a name="l00431"></a>00431   postures = xmlPosture-&gt;getElementsByTagName(<span class="stringliteral">&quot;posture&quot;</span>);
<a name="l00432"></a>00432 
<a name="l00433"></a>00433   <span class="comment">//Find the number of defined postures</span>
<a name="l00434"></a>00434   <a class="code" href="a00125.html#a3880f0e3e0e489b1edd2692a441b903f" title="Number of predefined postures.">numPostures</a> = postures.size();
<a name="l00435"></a>00435   <span class="keywordflow">if</span> (<a class="code" href="a00125.html#a3880f0e3e0e489b1edd2692a441b903f" title="Number of predefined postures.">numPostures</a> == 0)
<a name="l00436"></a>00436     error(<span class="stringliteral">&quot;No posture is defined in the input posture specification file&quot;</span>);
<a name="l00437"></a>00437 
<a name="l00438"></a>00438   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> postureID;
<a name="l00439"></a>00439 
<a name="l00440"></a>00440   cXMLElementList::const_iterator posture;
<a name="l00441"></a>00441   <span class="keywordflow">for</span> (posture = postures.begin(); posture != postures.end(); posture++)
<a name="l00442"></a>00442   {
<a name="l00443"></a>00443     str = (*posture)-&gt;getAttribute(<span class="stringliteral">&quot;postureID&quot;</span>);
<a name="l00444"></a>00444     <span class="keyword">const</span> <span class="keywordtype">long</span> lPostureID = strtol(str, 0, 0);
<a name="l00445"></a>00445     <span class="keywordflow">if</span> ( lPostureID &lt; 0 || static_cast&lt;unsigned int&gt;(lPostureID) &gt;= <a class="code" href="a00125.html#a3880f0e3e0e489b1edd2692a441b903f" title="Number of predefined postures.">numPostures</a>)
<a name="l00446"></a>00446       error (<span class="stringliteral">&quot;Posture ID in input posture specification file is out of the range.&quot;</span>);
<a name="l00447"></a>00447 
<a name="l00448"></a>00448     postureID = <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span><span class="keyword">&gt;</span>(lPostureID);
<a name="l00449"></a>00449     <a class="code" href="a00125.html#afbb28bcb93bda1faadc7030d86be43b5" title="The list of all predefined postures (posture data base).">postureList</a>.push_back(<span class="keyword">new</span> <a class="code" href="a00154.html" title="to store the specification of a posture on the MoBAN mobility model.">Posture</a>(postureID, <a class="code" href="a00125.html#a92a0e36ffb244bc6ed6beaf98e986c05" title="The number of nodes in the this WBAN.">numNodes</a>));
<a name="l00450"></a>00450 
<a name="l00451"></a>00451     str = (*posture)-&gt;getAttribute(<span class="stringliteral">&quot;name&quot;</span>);
<a name="l00452"></a>00452     <a class="code" href="a00125.html#afbb28bcb93bda1faadc7030d86be43b5" title="The list of all predefined postures (posture data base).">postureList</a>[postureID]-&gt;setPostureName(const_cast&lt;char*&gt; (str));
<a name="l00453"></a>00453 
<a name="l00454"></a>00454     str = (*posture)-&gt;getAttribute(<span class="stringliteral">&quot;minSpeed&quot;</span>);
<a name="l00455"></a>00455     <span class="keywordtype">double</span> minS = strtod(str, 0);
<a name="l00456"></a>00456     str = (*posture)-&gt;getAttribute(<span class="stringliteral">&quot;maxSpeed&quot;</span>);
<a name="l00457"></a>00457     <span class="keywordtype">double</span> maxS = strtod(str, 0);
<a name="l00458"></a>00458     <a class="code" href="a00125.html#afbb28bcb93bda1faadc7030d86be43b5" title="The list of all predefined postures (posture data base).">postureList</a>[postureID]-&gt;setPostureSpeed(minS, maxS);
<a name="l00459"></a>00459 
<a name="l00460"></a>00460     <span class="keywordtype">int</span> i = 0;
<a name="l00461"></a>00461     <span class="keywordtype">double</span> x, y, z, s, r;
<a name="l00462"></a>00462     cXMLElementList nodeParameters;
<a name="l00463"></a>00463 
<a name="l00464"></a>00464     nodeParameters = (*posture)-&gt;getElementsByTagName(<span class="stringliteral">&quot;nodeParameters&quot;</span>);
<a name="l00465"></a>00465     <span class="keywordflow">if</span> (nodeParameters.size() != <a class="code" href="a00125.html#a92a0e36ffb244bc6ed6beaf98e986c05" title="The number of nodes in the this WBAN.">numNodes</a>)
<a name="l00466"></a>00466       error (<span class="stringliteral">&quot;Some nodes may not have specified parameters in a posture in input posture specification file.&quot;</span>);
<a name="l00467"></a>00467 
<a name="l00468"></a>00468     cXMLElementList::const_iterator param;
<a name="l00469"></a>00469     <span class="keywordflow">for</span> (param = nodeParameters.begin(); param!= nodeParameters.end(); param++)
<a name="l00470"></a>00470     {
<a name="l00471"></a>00471       str = (*param)-&gt;getAttribute(<span class="stringliteral">&quot;positionX&quot;</span>);
<a name="l00472"></a>00472       x = strtod(str, 0);
<a name="l00473"></a>00473 
<a name="l00474"></a>00474       str = (*param)-&gt;getAttribute(<span class="stringliteral">&quot;positionY&quot;</span>);
<a name="l00475"></a>00475       y = strtod(str, 0);
<a name="l00476"></a>00476 
<a name="l00477"></a>00477       str = (*param)-&gt;getAttribute(<span class="stringliteral">&quot;positionZ&quot;</span>);
<a name="l00478"></a>00478       z = strtod(str, 0);
<a name="l00479"></a>00479 
<a name="l00480"></a>00480       str = (*param)-&gt;getAttribute(<span class="stringliteral">&quot;radius&quot;</span>);
<a name="l00481"></a>00481       r = strtod(str, 0);
<a name="l00482"></a>00482 
<a name="l00483"></a>00483       str = (*param)-&gt;getAttribute(<span class="stringliteral">&quot;speed&quot;</span>);
<a name="l00484"></a>00484       s = strtod(str, 0);
<a name="l00485"></a>00485 
<a name="l00486"></a>00486       <a class="code" href="a00125.html#afbb28bcb93bda1faadc7030d86be43b5" title="The list of all predefined postures (posture data base).">postureList</a>[postureID]-&gt;setPs(i, <a class="code" href="a00062.html" title="Class for storing 3D coordinates.">Coord</a>(x, y, z));
<a name="l00487"></a>00487       <a class="code" href="a00125.html#afbb28bcb93bda1faadc7030d86be43b5" title="The list of all predefined postures (posture data base).">postureList</a>[postureID]-&gt;setRadius(i, r);
<a name="l00488"></a>00488       <a class="code" href="a00125.html#afbb28bcb93bda1faadc7030d86be43b5" title="The list of all predefined postures (posture data base).">postureList</a>[postureID]-&gt;setSpeed(i, s);
<a name="l00489"></a>00489 
<a name="l00490"></a>00490       i++;
<a name="l00491"></a>00491     }
<a name="l00492"></a>00492   }
<a name="l00493"></a>00493 
<a name="l00494"></a>00494   <span class="comment">/* Report the obtained specification of the postures. */</span>
<a name="l00495"></a>00495   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="a00125.html#a3880f0e3e0e489b1edd2692a441b903f" title="Number of predefined postures.">numPostures</a>; ++i) {
<a name="l00496"></a>00496     EV&lt;&lt; <span class="stringliteral">&quot;Information for the posture:&quot;</span>&lt;&lt;i&lt;&lt;<span class="stringliteral">&quot; is&quot;</span>&lt;&lt;endl;
<a name="l00497"></a>00497     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j=0;j&lt;<a class="code" href="a00125.html#a92a0e36ffb244bc6ed6beaf98e986c05" title="The number of nodes in the this WBAN.">numNodes</a>;++j) {
<a name="l00498"></a>00498       EV &lt;&lt; <span class="stringliteral">&quot;Node &quot;</span>&lt;&lt;j&lt;&lt; <span class="stringliteral">&quot; position: &quot;</span>&lt;&lt;<a class="code" href="a00125.html#afbb28bcb93bda1faadc7030d86be43b5" title="The list of all predefined postures (posture data base).">postureList</a>[i]-&gt;getPs(j).info()&lt;&lt;
<a name="l00499"></a>00499           <span class="stringliteral">&quot; and radius:&quot;</span>&lt;&lt;<a class="code" href="a00125.html#afbb28bcb93bda1faadc7030d86be43b5" title="The list of all predefined postures (posture data base).">postureList</a>[i]-&gt;getRadius(j)&lt;&lt;<span class="stringliteral">&quot; and speed:&quot;</span>&lt;&lt; <a class="code" href="a00125.html#afbb28bcb93bda1faadc7030d86be43b5" title="The list of all predefined postures (posture data base).">postureList</a>[i]-&gt;getSpeed(j) &lt;&lt; endl;
<a name="l00500"></a>00500     }
<a name="l00501"></a>00501   }
<a name="l00502"></a>00502 
<a name="l00503"></a>00503   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00504"></a>00504 
<a name="l00505"></a>00505 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="adebee0a447b7e85d444054fa3a4ee013"></a><!-- doxytag: member="MoBANCoordinator::selectDestination" ref="adebee0a447b7e85d444054fa3a4ee013" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="a00062.html">Coord</a> MoBANCoordinator::selectDestination </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Function to select the destination in the case of a mobile posture. </p>
<p>Select a position inside the simulation area as the destination for the new mobile posture. It is called whenever a new stable posture is selected. It is taken into account that all nodes should be inside the area. </p>

<p>Definition at line <a class="el" href="a00363_source.html#l00288">288</a> of file <a class="el" href="a00363_source.html">MoBANCoordinator.cc</a>.</p>

<p>References <a class="el" href="a00250_source.html#l00082">BaseWorldUtility::getRandomPosition()</a>, <a class="el" href="a00363_source.html#l00315">isInsideWorld()</a>, <a class="el" href="a00364_source.html#l00148">logicalCenter</a>, and <a class="el" href="a00364_source.html#l00102">world</a>.</p>

<p>Referenced by <a class="el" href="a00363_source.html#l00164">mainProcess()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00288"></a>00288                                           {
<a name="l00289"></a>00289   <a class="code" href="a00062.html" title="Class for storing 3D coordinates.">Coord</a> res;
<a name="l00290"></a>00290   res = <a class="code" href="a00125.html#a19061b8cb8295d5afce5e95bb1c8ea99" title="Pointer to the BaseWorldUtility.">world</a>-&gt;<a class="code" href="a00027.html#a3c574ecd7a055ba2407f638ce548bc24" title="Random position somewhere in the playground.">getRandomPosition</a>();
<a name="l00291"></a>00291   res.z = (<a class="code" href="a00125.html#a2d0384199e2090caae09813e7d7f0d3b" title="Current position of the logical center of the group.">logicalCenter</a>.z); <span class="comment">// the z value remain the same</span>
<a name="l00292"></a>00292 
<a name="l00293"></a>00293   <span class="comment">//check if it is okay using CoverRadius</span>
<a name="l00294"></a>00294   <span class="keywordflow">while</span> (!<a class="code" href="a00125.html#a021924498600208cbb2a2f45525a1d70" title="Checks if all nodes of the WBAN are inside the simulation environment w ith the given...">isInsideWorld</a>(res)) {
<a name="l00295"></a>00295     res = <a class="code" href="a00125.html#a19061b8cb8295d5afce5e95bb1c8ea99" title="Pointer to the BaseWorldUtility.">world</a>-&gt;<a class="code" href="a00027.html#a3c574ecd7a055ba2407f638ce548bc24" title="Random position somewhere in the playground.">getRandomPosition</a>();
<a name="l00296"></a>00296     res.z = (<a class="code" href="a00125.html#a2d0384199e2090caae09813e7d7f0d3b" title="Current position of the logical center of the group.">logicalCenter</a>.z);
<a name="l00297"></a>00297   }
<a name="l00298"></a>00298 
<a name="l00299"></a>00299   <span class="keywordflow">return</span> res;
<a name="l00300"></a>00300 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab4f9d86a51c84b083817db1fcbe9dbab"></a><!-- doxytag: member="MoBANCoordinator::selectDuration" ref="ab4f9d86a51c84b083817db1fcbe9dbab" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">simtime_t MoBANCoordinator::selectDuration </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Select a stay time duration in the specified range for the new posture. </p>
<p>Select a stay time duration in the specified duration range for the new posture. It is called whenever a new stable posture is selected. The selected value should be at least more than the value of updateInterval parameter. </p>

<p>Definition at line <a class="el" href="a00363_source.html#l00279">279</a> of file <a class="el" href="a00363_source.html">MoBANCoordinator.cc</a>.</p>

<p>References <a class="el" href="a00364_source.html#l00142">maxDuration</a>, and <a class="el" href="a00364_source.html#l00139">minDuration</a>.</p>

<p>Referenced by <a class="el" href="a00363_source.html#l00164">mainProcess()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00279"></a>00279                                            {
<a name="l00280"></a>00280   <span class="keywordflow">return</span> uniform(<a class="code" href="a00125.html#aac48e46d43458a8f960cc33e84ac85e8" title="The minimum value of the duration for stable postures.">minDuration</a>, <a class="code" href="a00125.html#a02c4e8d23a6b0b2e1a1d94abe1974b9f" title="The maximum value of the duration for stable postures.">maxDuration</a>);
<a name="l00281"></a>00281 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab622d4b167d9d5dbc7529969a6688597"></a><!-- doxytag: member="MoBANCoordinator::selectPosture" ref="ab622d4b167d9d5dbc7529969a6688597" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void MoBANCoordinator::selectPosture </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Function to select the next posture considering the current posture and the Markov model. </p>
<p>Select a new posture randomly or based on the given Markov model. If the requested strategy is not uniform random, A Markov chain will be used. If the strategy is INDIVIDUAL_MARKOV, we should retrieve the transition matrix for the current part of the area. If it is INDIVIDUAL_MARKOV, we have the base transition matrix and a steady state vector for the current part of the area. So the closest transition matrix to the base matrix is calculated which satisfies the required steady state vector. In any case, the next posture is selected considering the current posture and according to the final Markov transition matrix. </p>

<p>Definition at line <a class="el" href="a00363_source.html#l00244">244</a> of file <a class="el" href="a00363_source.html">MoBANCoordinator.cc</a>.</p>

<p>References <a class="el" href="a00364_source.html#l00133">currentPosture</a>, <a class="el" href="a00369_source.html#l00306">PostureTransition::getMatrix()</a>, <a class="el" href="a00367_source.html#l00250">Posture::getPostureID()</a>, <a class="el" href="a00364_source.html#l00148">logicalCenter</a>, <a class="el" href="a00364_source.html#l00200">markovMatrix</a>, <a class="el" href="a00364_source.html#l00127">numPostures</a>, <a class="el" href="a00364_source.html#l00130">postureList</a>, <a class="el" href="a00364_source.html#l00209">postureSelStrategy</a>, and <a class="el" href="a00364_source.html#l00212">transitions</a>.</p>

<p>Referenced by <a class="el" href="a00363_source.html#l00164">mainProcess()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00244"></a>00244                                      {
<a name="l00245"></a>00245   <span class="keywordtype">int</span> postureID;
<a name="l00246"></a>00246 
<a name="l00247"></a>00247   <span class="keywordflow">if</span> (<a class="code" href="a00125.html#a626ad8d08de1e3d7fad2c8032f199933" title="The requested strategy for posture selection. To be given through configuration file...">postureSelStrategy</a> == UNIFORM_RANDOM) {
<a name="l00248"></a>00248     postureID = floor(uniform(0, <a class="code" href="a00125.html#a3880f0e3e0e489b1edd2692a441b903f" title="Number of predefined postures.">numPostures</a>)); <span class="comment">// uniformly random posture selection</span>
<a name="l00249"></a>00249     <a class="code" href="a00125.html#a19a97a40859c36012f3a63a7c9ef9b46" title="The current selected posture.">currentPosture</a> = <a class="code" href="a00125.html#afbb28bcb93bda1faadc7030d86be43b5" title="The list of all predefined postures (posture data base).">postureList</a>[postureID];
<a name="l00250"></a>00250     <span class="keywordflow">return</span>;
<a name="l00251"></a>00251   }
<a name="l00252"></a>00252 
<a name="l00253"></a>00253   <span class="comment">/* Here we check the area and the time to determine the corresponding posture transition matrix */</span>
<a name="l00254"></a>00254   <a class="code" href="a00125.html#a406987de5c4e38c461e0857583c115b2" title="A matrix which maintains the transition probabilities of the Markov Model of posture...">markovMatrix</a> = <a class="code" href="a00125.html#a51f9fc44b5168e7ef6e58fd221bf3f0a" title="Class for performing operation for spatial and temporal correlations in posture selection...">transitions</a>-&gt;<a class="code" href="a00155.html#a93efe929bf92a744b9343730011579bf" title="Gets a time and location, and returns the corresponding Markov transition matrix...">getMatrix</a>(simTime(),<a class="code" href="a00125.html#a2d0384199e2090caae09813e7d7f0d3b" title="Current position of the logical center of the group.">logicalCenter</a>);
<a name="l00255"></a>00255 
<a name="l00256"></a>00256   <span class="comment">/* Using transition matrix to select the next posture */</span>
<a name="l00257"></a>00257   <span class="keywordtype">double</span> randomValue = uniform(0, 1);
<a name="l00258"></a>00258   <span class="keywordtype">double</span> comp = 0;
<a name="l00259"></a>00259   <span class="keywordtype">int</span> currentP = <a class="code" href="a00125.html#a19a97a40859c36012f3a63a7c9ef9b46" title="The current selected posture.">currentPosture</a>-&gt;<a class="code" href="a00154.html#ac22213164bd88de7d5eb77eb92247ef1" title="Returns the unique Id (index) of this posture.">getPostureID</a>(); <span class="comment">// it determines the column in the matrix</span>
<a name="l00260"></a>00260 
<a name="l00261"></a>00261   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; static_cast&lt;int&gt;(<a class="code" href="a00125.html#a3880f0e3e0e489b1edd2692a441b903f" title="Number of predefined postures.">numPostures</a>); ++i)
<a name="l00262"></a>00262   {
<a name="l00263"></a>00263     comp += <a class="code" href="a00125.html#a406987de5c4e38c461e0857583c115b2" title="A matrix which maintains the transition probabilities of the Markov Model of posture...">markovMatrix</a>[i][currentP];
<a name="l00264"></a>00264     <span class="keywordflow">if</span> (randomValue &lt; comp)
<a name="l00265"></a>00265     {
<a name="l00266"></a>00266       postureID = i;
<a name="l00267"></a>00267       <span class="keywordflow">break</span>;
<a name="l00268"></a>00268     }
<a name="l00269"></a>00269   }
<a name="l00270"></a>00270 
<a name="l00271"></a>00271   <a class="code" href="a00125.html#a19a97a40859c36012f3a63a7c9ef9b46" title="The current selected posture.">currentPosture</a> = <a class="code" href="a00125.html#afbb28bcb93bda1faadc7030d86be43b5" title="The list of all predefined postures (posture data base).">postureList</a>[postureID];
<a name="l00272"></a>00272 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6d83b8c03d91b0fee3e335b214f51b4c"></a><!-- doxytag: member="MoBANCoordinator::selectSpeed" ref="a6d83b8c03d91b0fee3e335b214f51b4c" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double MoBANCoordinator::selectSpeed </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Select a velocity value within the given velocity range. </p>
<p>Select a velocity value within the given velocity range. It is called whenever a new stable posture is selected. In the case of using a logged mobility <a class="el" href="a00147.html" title="Data type for one instance of mobility pattern.">pattern</a>, the speed value is retrieved from the <a class="el" href="a00147.html" title="Data type for one instance of mobility pattern.">pattern</a>. </p>

<p>Definition at line <a class="el" href="a00363_source.html#l00307">307</a> of file <a class="el" href="a00363_source.html">MoBANCoordinator.cc</a>.</p>

<p>References <a class="el" href="a00364_source.html#l00133">currentPosture</a>, <a class="el" href="a00367_source.html#l00255">Posture::getMaxSpeed()</a>, and <a class="el" href="a00367_source.html#l00260">Posture::getMinSpeed()</a>.</p>

<p>Referenced by <a class="el" href="a00363_source.html#l00164">mainProcess()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00307"></a>00307                                      {
<a name="l00308"></a>00308   <span class="keywordflow">return</span> (uniform(<a class="code" href="a00125.html#a19a97a40859c36012f3a63a7c9ef9b46" title="The current selected posture.">currentPosture</a>-&gt;<a class="code" href="a00154.html#a701f930d0e1c34df3f5b034d1340e707" title="Returns minimum value of the speed range of this posture.">getMinSpeed</a>(),
<a name="l00309"></a>00309       <a class="code" href="a00125.html#a19a97a40859c36012f3a63a7c9ef9b46" title="The current selected posture.">currentPosture</a>-&gt;<a class="code" href="a00154.html#a600788c2593ce2fdc86328d771f26236" title="Returns maximum value of the speed range of this posture.">getMaxSpeed</a>()));
<a name="l00310"></a>00310 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="abfe32e4c7881e7b5d5276e5b90fb82a6"></a><!-- doxytag: member="MoBANCoordinator::stepMove" ref="abfe32e4c7881e7b5d5276e5b90fb82a6" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void MoBANCoordinator::stepMove </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Making one step move and publishing the new reference point position to all belonging nodes. </p>
<p>If the new posture is stable , publish reference points, and then wait for the selected time duration. If the posture is a mobile posture, move the logical center of the WBAN step by step until it reaches the selected destination. To do so, the new position of the reference points are published every "updateInterval" seconds. Then go for another posture selection. </p>

<p><p>publish info if the posture is mobile or it is the first step after a posture change. So for a stable posture, just one time the information will be published.</p>
</p>

<p>Definition at line <a class="el" href="a00363_source.html#l00133">133</a> of file <a class="el" href="a00363_source.html">MoBANCoordinator.cc</a>.</p>

<p>References <a class="el" href="a00364_source.html#l00133">currentPosture</a>, <a class="el" href="a00367_source.html#l00265">Posture::isMobile()</a>, <a class="el" href="a00364_source.html#l00148">logicalCenter</a>, <a class="el" href="a00363_source.html#l00164">mainProcess()</a>, <a class="el" href="a00364_source.html#l00154">numSteps</a>, <a class="el" href="a00363_source.html#l00347">publishToNodes()</a>, <a class="el" href="a00364_source.html#l00151">step</a>, <a class="el" href="a00364_source.html#l00163">stepSize</a>, and <a class="el" href="a00364_source.html#l00160">stepTarget</a>.</p>

<p>Referenced by <a class="el" href="a00363_source.html#l00119">handleMessage()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00133"></a>00133                                 {
<a name="l00134"></a>00134   <a class="code" href="a00125.html#ac1a5ee7eeedb62fdfcee79fb6234f762" title="Number of steps already moved.">step</a>++;
<a name="l00135"></a>00135 
<a name="l00136"></a>00136   <span class="keywordflow">if</span> (<a class="code" href="a00125.html#a19a97a40859c36012f3a63a7c9ef9b46" title="The current selected posture.">currentPosture</a>-&gt;<a class="code" href="a00154.html#a9c622bfcc0a70fc09ad0f6f57bfe7a63" title="Check if this posture is mobile by checking the maximum possible speed.">isMobile</a>()) {
<a name="l00137"></a>00137     <span class="keywordflow">if</span> (<a class="code" href="a00125.html#ac1a5ee7eeedb62fdfcee79fb6234f762" title="Number of steps already moved.">step</a> == <a class="code" href="a00125.html#af177cb826e1fec16faf7c7cbd0390cf5" title="Total number of steps of the current move or current posture.">numSteps</a>) { <span class="comment">// reach the target</span>
<a name="l00138"></a>00138       <a class="code" href="a00125.html#a2d0384199e2090caae09813e7d7f0d3b" title="Current position of the logical center of the group.">logicalCenter</a> = <a class="code" href="a00125.html#a25c1728a5480570b4b8fe51b4a4a5f02" title="The intermediate target of the current move step.">stepTarget</a>;
<a name="l00139"></a>00139       <a class="code" href="a00125.html#ab69a463af831ecb1c87daa61c09c9509" title="The main process of the MoBAN mobility model.">mainProcess</a>();
<a name="l00140"></a>00140     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="a00125.html#ac1a5ee7eeedb62fdfcee79fb6234f762" title="Number of steps already moved.">step</a> &lt; <a class="code" href="a00125.html#af177cb826e1fec16faf7c7cbd0390cf5" title="Total number of steps of the current move or current posture.">numSteps</a>) {
<a name="l00141"></a>00141       <span class="comment">// step forward</span>
<a name="l00142"></a>00142       <a class="code" href="a00125.html#a2d0384199e2090caae09813e7d7f0d3b" title="Current position of the logical center of the group.">logicalCenter</a> = <a class="code" href="a00125.html#a25c1728a5480570b4b8fe51b4a4a5f02" title="The intermediate target of the current move step.">stepTarget</a>;
<a name="l00143"></a>00143       <a class="code" href="a00125.html#a25c1728a5480570b4b8fe51b4a4a5f02" title="The intermediate target of the current move step.">stepTarget</a> += <a class="code" href="a00125.html#a56735487e55a96bd1294af15883f2d9c" title="The size of the current move step.">stepSize</a>;
<a name="l00144"></a>00144     } <span class="keywordflow">else</span>
<a name="l00145"></a>00145       error(<span class="stringliteral">&quot;step should be less than numSteps&quot;</span>);
<a name="l00146"></a>00146   } <span class="keywordflow">else</span> {
<a name="l00147"></a>00147     <span class="keywordflow">if</span> (<a class="code" href="a00125.html#ac1a5ee7eeedb62fdfcee79fb6234f762" title="Number of steps already moved.">step</a> == <a class="code" href="a00125.html#af177cb826e1fec16faf7c7cbd0390cf5" title="Total number of steps of the current move or current posture.">numSteps</a>)
<a name="l00148"></a>00148       <a class="code" href="a00125.html#ab69a463af831ecb1c87daa61c09c9509" title="The main process of the MoBAN mobility model.">mainProcess</a>();
<a name="l00149"></a>00149   }
<a name="l00150"></a>00150 
<a name="l00154"></a>00154   <span class="keywordflow">if</span> (<a class="code" href="a00125.html#a19a97a40859c36012f3a63a7c9ef9b46" title="The current selected posture.">currentPosture</a>-&gt;<a class="code" href="a00154.html#a9c622bfcc0a70fc09ad0f6f57bfe7a63" title="Check if this posture is mobile by checking the maximum possible speed.">isMobile</a>() || <a class="code" href="a00125.html#ac1a5ee7eeedb62fdfcee79fb6234f762" title="Number of steps already moved.">step</a> == 1)
<a name="l00155"></a>00155     <a class="code" href="a00125.html#a7e5b78357b30b23f2f8285dcde5c6dd9" title="Publishes the reference point and other information of the posture to the signaling...">publishToNodes</a>();
<a name="l00156"></a>00156 }
</pre></div></p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>src/modules/mobility/<a class="el" href="a00364_source.html">MoBANCoordinator.h</a></li>
<li>src/modules/mobility/<a class="el" href="a00363_source.html">MoBANCoordinator.cc</a></li>
</ul>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed Dec 14 16:01:50 2011 for MiXiM by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
