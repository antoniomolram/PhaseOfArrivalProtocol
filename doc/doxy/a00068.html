<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>MiXiM: Decider80211 Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
      <li><a href="classes.html"><span>Class&nbsp;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>Decider80211 Class Reference<br/>
<small>
[<a class="el" href="a00447.html">decider - decider modules</a>,&nbsp;<a class="el" href="a00457.html">IEEE 802.11 - Classes for the IEEE 802.11 implementation of MiXiM</a>]</small>
</h1><!-- doxytag: class="Decider80211" --><!-- doxytag: inherits="BaseDecider" -->
<p><a class="el" href="a00067.html" title="The basic Decider class.">Decider</a> for the 802.11 modules.  
<a href="#_details">More...</a></p>

<p><code>#include &lt;<a class="el" href="a00390_source.html">Decider80211.h</a>&gt;</code></p>

<p>Inherits <a class="el" href="a00016.html">BaseDecider</a>.</p>

<p>Inherited by <a class="el" href="a00069.html">Decider80211Battery</a>.</p>
<div class="dynheader">
Collaboration diagram for Decider80211:</div>
<div class="dynsection">
<div class="center"><img src="a00582.png" border="0" usemap="#Decider80211_coll__map" alt="Collaboration graph"/></div>
<map name="Decider80211_coll__map" id="Decider80211_coll__map">
<area shape="rect" href="a00016.html" title="Provides some base functionality for most common deciders." alt="" coords="9,5,105,32"/></map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>

<p><a href="a00583.html">List of all members.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Public Types</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00068.html#aadf94ce46e3edca3fa4d93150f72f4ae">Decider80211ControlKinds</a> { <b>NOTHING</b> =  22100, 
<a class="el" href="a00068.html#aadf94ce46e3edca3fa4d93150f72f4aeae12bbafd7ed8d0978ac925c1a493aabb">BITERROR</a>, 
<a class="el" href="a00068.html#aadf94ce46e3edca3fa4d93150f72f4aeae5c2edad30720b7e527373b28bd4e1ab">COLLISION</a>, 
<a class="el" href="a00068.html#aadf94ce46e3edca3fa4d93150f72f4aea397fbae93de43832a0bb2bc1bf7003a5">LAST_DECIDER_80211_CONTROL_KIND</a>
 }</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"><p>Control message kinds used by this <a class="el" href="a00067.html" title="The basic Decider class.">Decider</a>. </p>
 <a href="a00068.html#aadf94ce46e3edca3fa4d93150f72f4ae">More...</a><br/></td></tr>
<tr><td colspan="2"><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a2949e3ea4938d9893426905d66307d4b"></a><!-- doxytag: member="Decider80211::Decider80211" ref="a2949e3ea4938d9893426905d66307d4b" args="(DeciderToPhyInterface *phy, double threshold, double sensitivity, int channel, int myIndex=&#45;1, bool debug=false)" -->
&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00068.html#a2949e3ea4938d9893426905d66307d4b">Decider80211</a> (<a class="el" href="a00076.html">DeciderToPhyInterface</a> *<a class="el" href="a00067.html#ac0f72556cb799d883b4219cab58320bb">phy</a>, double threshold, double <a class="el" href="a00016.html#a5eece8bf532f92912ccbd0a3bc4d6fb0">sensitivity</a>, int channel, int <a class="el" href="a00016.html#a33e7f02028e78116193d09d6cdbc987e">myIndex</a>=-1, bool <a class="el" href="a00016.html#aa22cd5156240713e37578172ba5557ce">debug</a>=false)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initializes the <a class="el" href="a00067.html" title="The basic Decider class.">Decider</a> with a pointer to its <a class="el" href="a00149.html" title="Provides initialisation for several AnalogueModels and Deciders from modules directory...">PhyLayer</a> and specific values for threshold and sensitivity. <br/></td></tr>
<tr><td colspan="2"><h2>Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="a00072.html">DeciderResult</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00068.html#ae4dc79c5a292dbb30e9541c46b40850c">checkIfSignalOk</a> (AirFrame *frame)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Checks if the passed completed AirFrame was received correctly.  <a href="#ae4dc79c5a292dbb30e9541c46b40850c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual simtime_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00068.html#a1f929f5b474f7b42c5c47acdd740cc68">processNewSignal</a> (AirFrame *frame)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Processes a new <a class="el" href="a00168.html" title="The signal class stores the physical representation of the signal of an AirFrame...">Signal</a>. Returns the time it wants to handle the signal again.  <a href="#a1f929f5b474f7b42c5c47acdd740cc68"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual simtime_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00068.html#a2f8e006c849f1c14f4578b70358d0ecf">processSignalEnd</a> (AirFrame *frame)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Processes a received AirFrame.  <a href="#a2f8e006c849f1c14f4578b70358d0ecf"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a8fa275c3922106556c98a2f51b502794"></a><!-- doxytag: member="Decider80211::packetOk" ref="a8fa275c3922106556c98a2f51b502794" args="(double snirMin, int lengthMPDU, double bitrate)" -->
bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00068.html#a8fa275c3922106556c98a2f51b502794">packetOk</a> (double snirMin, int lengthMPDU, double bitrate)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">computes if packet is ok or has errors <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00068.html#a973d7c599c1d660491b3a5ab0b48393c">calcChannelSenseRSSI</a> (simtime_t_cref start, simtime_t_cref end) const </td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Calculates the RSSI value for the passed interval.  <a href="#a973d7c599c1d660491b3a5ab0b48393c"></a><br/></td></tr>
<tr><td colspan="2"><h2>Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a252eace2ccbe59484cd209be494a3983"></a><!-- doxytag: member="Decider80211::snrThreshold" ref="a252eace2ccbe59484cd209be494a3983" args="" -->
double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00068.html#a252eace2ccbe59484cd209be494a3983">snrThreshold</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">threshold value for checking a SNR-map (SNR-threshold) <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a15af6d061ab83d73474b6b94684707b6"></a><!-- doxytag: member="Decider80211::centerFrequency" ref="a15af6d061ab83d73474b6b94684707b6" args="" -->
double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00068.html#a15af6d061ab83d73474b6b94684707b6">centerFrequency</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The center frequency on which the decider listens for signals. <br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p><a class="el" href="a00067.html" title="The basic Decider class.">Decider</a> for the 802.11 modules. </p>
<p>Depending on the minimum of the snr included in the PhySDU this module computes a bit error probability. The header (1 Mbit/s) is always modulated with DBQPSK. The PDU is normally modulated either with DBPSK (1 and 2 Mbit/s) or CCK (5.5 and 11 Mbit/s). CCK is not easy to model, therefore it is modeled as DQPSK with a 16-QAM for 5.5 Mbit/s and a 256-QAM for 11 Mbit/s.</p>
<dl class="author"><dt><b>Author:</b></dt><dd>Marc Lï¿½bbers, David Raguin, Karl Wessel(port for MiXiM) </dd></dl>

<p>Definition at line <a class="el" href="a00390_source.html#l00029">29</a> of file <a class="el" href="a00390_source.html">Decider80211.h</a>.</p>
<hr/><h2>Member Enumeration Documentation</h2>
<a class="anchor" id="aadf94ce46e3edca3fa4d93150f72f4ae"></a><!-- doxytag: member="Decider80211::Decider80211ControlKinds" ref="aadf94ce46e3edca3fa4d93150f72f4ae" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="a00068.html#aadf94ce46e3edca3fa4d93150f72f4ae">Decider80211::Decider80211ControlKinds</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Control message kinds used by this <a class="el" href="a00067.html" title="The basic Decider class.">Decider</a>. </p>
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="aadf94ce46e3edca3fa4d93150f72f4aeae12bbafd7ed8d0978ac925c1a493aabb"></a><!-- doxytag: member="BITERROR" ref="aadf94ce46e3edca3fa4d93150f72f4aeae12bbafd7ed8d0978ac925c1a493aabb" args="" -->BITERROR</em>&nbsp;</td><td>
<p>The decider has recognized a bit error in the packet. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="aadf94ce46e3edca3fa4d93150f72f4aeae5c2edad30720b7e527373b28bd4e1ab"></a><!-- doxytag: member="COLLISION" ref="aadf94ce46e3edca3fa4d93150f72f4aeae5c2edad30720b7e527373b28bd4e1ab" args="" -->COLLISION</em>&nbsp;</td><td>
<p><a class="el" href="a00144.html" title="Class that keeps track of the number of packets sent.">Packet</a> lost due to collision. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="aadf94ce46e3edca3fa4d93150f72f4aea397fbae93de43832a0bb2bc1bf7003a5"></a><!-- doxytag: member="LAST_DECIDER_80211_CONTROL_KIND" ref="aadf94ce46e3edca3fa4d93150f72f4aea397fbae93de43832a0bb2bc1bf7003a5" args="" -->LAST_DECIDER_80211_CONTROL_KIND</em>&nbsp;</td><td>
<p>Sub-classing deciders should begin their own kinds at this value. </p>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="a00390_source.html#l00032">32</a> of file <a class="el" href="a00390_source.html">Decider80211.h</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00032"></a>00032                                 {
<a name="l00033"></a>00033     NOTHING = 22100,
<a name="l00035"></a>00035     <a class="code" href="a00068.html#aadf94ce46e3edca3fa4d93150f72f4aeae12bbafd7ed8d0978ac925c1a493aabb" title="The decider has recognized a bit error in the packet.">BITERROR</a>,
<a name="l00037"></a>00037     <a class="code" href="a00068.html#aadf94ce46e3edca3fa4d93150f72f4aeae5c2edad30720b7e527373b28bd4e1ab" title="Packet lost due to collision.">COLLISION</a>,
<a name="l00039"></a>00039     <a class="code" href="a00068.html#aadf94ce46e3edca3fa4d93150f72f4aea397fbae93de43832a0bb2bc1bf7003a5" title="Sub-classing deciders should begin their own kinds at this value.">LAST_DECIDER_80211_CONTROL_KIND</a>
<a name="l00040"></a>00040   };
</pre></div></p>

</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a973d7c599c1d660491b3a5ab0b48393c"></a><!-- doxytag: member="Decider80211::calcChannelSenseRSSI" ref="a973d7c599c1d660491b3a5ab0b48393c" args="(simtime_t_cref start, simtime_t_cref end) const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double Decider80211::calcChannelSenseRSSI </td>
          <td>(</td>
          <td class="paramtype">simtime_t_cref&nbsp;</td>
          <td class="paramname"> <em>start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">simtime_t_cref&nbsp;</td>
          <td class="paramname"> <em>end</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td> const<code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Calculates the RSSI value for the passed interval. </p>
<p>This method is called by <a class="el" href="a00016.html" title="Provides some base functionality for most common deciders.">BaseDecider</a> when it answers a ChannelSenseRequest or calculates the current channel state.</p>
<p>Returns the maximum RSSI value inside the passed time interval and the channel the <a class="el" href="a00067.html" title="The basic Decider class.">Decider</a> currently listens to. </p>

<p>Reimplemented from <a class="el" href="a00016.html#ae692d8bb6e760aaac0d87895cbad14dc">BaseDecider</a>.</p>

<p>Definition at line <a class="el" href="a00389_source.html#l00076">76</a> of file <a class="el" href="a00389_source.html">Decider80211.cc</a>.</p>

<p>References <a class="el" href="a00257_source.html#l00250">BaseDecider::calculateRSSIMapping()</a>, <a class="el" href="a00390_source.html#l00046">centerFrequency</a>, <a class="el" href="a00274_source.html#l00206">MappingUtils::findMax()</a>, <a class="el" href="a00273_source.html#l00084">Dimension::frequency</a>, <a class="el" href="a00273_source.html#l00423">Argument::MappedZero</a>, <a class="el" href="a00272_source.html#l00138">Argument::setArgValue()</a>, <a class="el" href="a00272_source.html#l00095">Argument::setTime()</a>, and <a class="el" href="a00273_source.html#l00196">DimensionSet::timeFreqDomain</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00076"></a>00076                                                                                         {
<a name="l00077"></a>00077   <a class="code" href="a00121.html" title="Represents a changeable mapping (mathematical function) from at least time to Argument::mapped_type...">Mapping</a>* rssiMap = <a class="code" href="a00016.html#a56d16fe07452dfb24fb994f57e435938" title="Calculates a RSSI-Mapping (or Noise-Strength-Mapping) for a Signal.">calculateRSSIMapping</a>(start, end);
<a name="l00078"></a>00078 
<a name="l00079"></a>00079   <a class="code" href="a00009.html" title="Defines an argument for a mapping.">Argument</a> min(<a class="code" href="a00083.html#ac3f34a560d6c4ad5dc8d72dc69359b77" title="Shortcut to a DimensionSet which contains time and frequency.">DimensionSet::timeFreqDomain</a>);
<a name="l00080"></a>00080   min.setTime(start);
<a name="l00081"></a>00081   min.setArgValue(<a class="code" href="a00082.html#ad4360e7d88c881d06ee61033ad99d66f" title="Shortcut to the frequency Dimension, same as &amp;#39;Dimension(&amp;quot;frequency&amp;quot;)&amp;#39;...">Dimension::frequency</a>, <a class="code" href="a00068.html#a15af6d061ab83d73474b6b94684707b6" title="The center frequency on which the decider listens for signals.">centerFrequency</a> - 11e6);
<a name="l00082"></a>00082   <a class="code" href="a00009.html" title="Defines an argument for a mapping.">Argument</a> max(<a class="code" href="a00083.html#ac3f34a560d6c4ad5dc8d72dc69359b77" title="Shortcut to a DimensionSet which contains time and frequency.">DimensionSet::timeFreqDomain</a>);
<a name="l00083"></a>00083   max.setTime(end);
<a name="l00084"></a>00084   max.setArgValue(<a class="code" href="a00082.html#ad4360e7d88c881d06ee61033ad99d66f" title="Shortcut to the frequency Dimension, same as &amp;#39;Dimension(&amp;quot;frequency&amp;quot;)&amp;#39;...">Dimension::frequency</a>, <a class="code" href="a00068.html#a15af6d061ab83d73474b6b94684707b6" title="The center frequency on which the decider listens for signals.">centerFrequency</a> + 11e6);
<a name="l00085"></a>00085 
<a name="l00086"></a>00086   Mapping::argument_value_t rssi = <a class="code" href="a00123.html#afbe1a1e1d2becd66d2c0d5a8ac42b478" title="Iterates over the passed mapping and returns value at the key entry with the highest...">MappingUtils::findMax</a>(*rssiMap, min, max, <a class="code" href="a00009.html#a8523627cdc70492e5e0935b9a3a78cc4" title="Zero value of a Argument value.">Argument::MappedZero</a> <span class="comment">/* the value if no maximum will be found */</span>);
<a name="l00087"></a>00087 
<a name="l00088"></a>00088   <span class="keyword">delete</span> rssiMap;
<a name="l00089"></a>00089   <span class="keywordflow">return</span> rssi;
<a name="l00090"></a>00090 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae4dc79c5a292dbb30e9541c46b40850c"></a><!-- doxytag: member="Decider80211::checkIfSignalOk" ref="ae4dc79c5a292dbb30e9541c46b40850c" args="(AirFrame *frame)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="a00072.html">DeciderResult</a> * Decider80211::checkIfSignalOk </td>
          <td>(</td>
          <td class="paramtype">AirFrame *&nbsp;</td>
          <td class="paramname"> <em>frame</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Checks if the passed completed AirFrame was received correctly. </p>
<p>Returns the result as a <a class="el" href="a00072.html" title="A class to represent the result of a processed packet (that is not noise) by the...">DeciderResult</a></p>
<dl class="return"><dt><b>Returns:</b></dt><dd>The result of the decider for the passed AirFrame. </dd></dl>

<p>Reimplemented in <a class="el" href="a00070.html#a6b3e68eb4495736532f3350c9541be53">Decider80211MultiChannel</a>.</p>

<p>Definition at line <a class="el" href="a00389_source.html#l00093">93</a> of file <a class="el" href="a00389_source.html">Decider80211.cc</a>.</p>

<p>References <a class="el" href="a00257_source.html#l00222">BaseDecider::calculateSnrMapping()</a>, <a class="el" href="a00390_source.html#l00046">centerFrequency</a>, <a class="el" href="a00273_source.html#l01314">Mapping::createConstIterator()</a>, <a class="el" href="a00274_source.html#l00289">MappingUtils::findMin()</a>, <a class="el" href="a00273_source.html#l00084">Dimension::frequency</a>, <a class="el" href="a00280_source.html#l00223">Signal::getBitrate()</a>, <a class="el" href="a00279_source.html#l00144">Signal::getReceptionEnd()</a>, <a class="el" href="a00279_source.html#l00140">Signal::getReceptionStart()</a>, <a class="el" href="a00056.html#ad4419c259e747867f003d07d62d4259f">ConstMappingIterator::getValue()</a>, <a class="el" href="a00273_source.html#l00423">Argument::MappedZero</a>, <a class="el" href="a00056.html#afdafa6870cd19b3d35674a7bc777585d">ConstMappingIterator::next()</a>, <a class="el" href="a00389_source.html#l00144">packetOk()</a>, <a class="el" href="a00272_source.html#l00138">Argument::setArgValue()</a>, <a class="el" href="a00272_source.html#l00095">Argument::setTime()</a>, <a class="el" href="a00390_source.html#l00043">snrThreshold</a>, and <a class="el" href="a00273_source.html#l00196">DimensionSet::timeFreqDomain</a>.</p>

<p>Referenced by <a class="el" href="a00389_source.html#l00185">processSignalEnd()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00094"></a>00094 {
<a name="l00095"></a>00095   <span class="comment">// check if the snrMapping is above the Decider&apos;s specific threshold,</span>
<a name="l00096"></a>00096   <span class="comment">// i.e. the Decider has received it correctly</span>
<a name="l00097"></a>00097 
<a name="l00098"></a>00098   <span class="comment">// first collect all necessary information</span>
<a name="l00099"></a>00099   <a class="code" href="a00121.html" title="Represents a changeable mapping (mathematical function) from at least time to Argument::mapped_type...">Mapping</a>* snrMap = <a class="code" href="a00016.html#abac709d59f48d292f147919854c002e2" title="Calculates a SNR-Mapping for a Signal.">calculateSnrMapping</a>(frame);
<a name="l00100"></a>00100   assert(snrMap);
<a name="l00101"></a>00101 
<a name="l00102"></a>00102   <a class="code" href="a00168.html" title="The signal class stores the physical representation of the signal of an AirFrame...">Signal</a>&amp; s = frame-&gt;getSignal();
<a name="l00103"></a>00103   simtime_t start = s.<a class="code" href="a00168.html#a7c4710243cf87caf7dfc9f313e2619b2" title="Returns the point in time when the receiving of the Signal started at the receiver...">getReceptionStart</a>();
<a name="l00104"></a>00104   simtime_t end = s.<a class="code" href="a00168.html#a2875223239e124d85949e1116cc12ae9" title="Returns the point in time when the receiving of the Signal ended at the receiver...">getReceptionEnd</a>();
<a name="l00105"></a>00105 
<a name="l00106"></a>00106   start = start + RED_PHY_HEADER_DURATION; <span class="comment">//its ok if the phy header is received only</span>
<a name="l00107"></a>00107                        <span class="comment">//partly - TODO: maybe solve this nicer</span>
<a name="l00108"></a>00108   <a class="code" href="a00009.html" title="Defines an argument for a mapping.">Argument</a> min(<a class="code" href="a00083.html#ac3f34a560d6c4ad5dc8d72dc69359b77" title="Shortcut to a DimensionSet which contains time and frequency.">DimensionSet::timeFreqDomain</a>);
<a name="l00109"></a>00109   min.setTime(start);
<a name="l00110"></a>00110   min.setArgValue(<a class="code" href="a00082.html#ad4360e7d88c881d06ee61033ad99d66f" title="Shortcut to the frequency Dimension, same as &amp;#39;Dimension(&amp;quot;frequency&amp;quot;)&amp;#39;...">Dimension::frequency</a>, <a class="code" href="a00068.html#a15af6d061ab83d73474b6b94684707b6" title="The center frequency on which the decider listens for signals.">centerFrequency</a> - 11e6);
<a name="l00111"></a>00111   <a class="code" href="a00009.html" title="Defines an argument for a mapping.">Argument</a> max(<a class="code" href="a00083.html#ac3f34a560d6c4ad5dc8d72dc69359b77" title="Shortcut to a DimensionSet which contains time and frequency.">DimensionSet::timeFreqDomain</a>);
<a name="l00112"></a>00112   max.setTime(end);
<a name="l00113"></a>00113   max.setArgValue(<a class="code" href="a00082.html#ad4360e7d88c881d06ee61033ad99d66f" title="Shortcut to the frequency Dimension, same as &amp;#39;Dimension(&amp;quot;frequency&amp;quot;)&amp;#39;...">Dimension::frequency</a>, <a class="code" href="a00068.html#a15af6d061ab83d73474b6b94684707b6" title="The center frequency on which the decider listens for signals.">centerFrequency</a> + 11e6);
<a name="l00114"></a>00114 
<a name="l00115"></a>00115   Mapping::argument_value_t snirMin = <a class="code" href="a00123.html#a5d9c4e3dcaddccfa65f21212d0fee2cf" title="Iterates over the passed mapping and returns value at the key entry with the smallest...">MappingUtils::findMin</a>(*snrMap, min, max, <a class="code" href="a00009.html#a8523627cdc70492e5e0935b9a3a78cc4" title="Zero value of a Argument value.">Argument::MappedZero</a> <span class="comment">/* the value if no minimum will be found */</span>);
<a name="l00116"></a>00116 
<a name="l00117"></a>00117   deciderEV &lt;&lt; <span class="stringliteral">&quot; snrMin: &quot;</span> &lt;&lt; snirMin &lt;&lt; endl;
<a name="l00118"></a>00118 
<a name="l00119"></a>00119   <a class="code" href="a00056.html" title="Defines an const iterator for a ConstMapping which is able to iterate over the Mapping...">ConstMappingIterator</a>* bitrateIt = s.<a class="code" href="a00168.html#af4c88f103d2a51fc2d93b4375b226432" title="Returns the function representing the bitrate of the signal.">getBitrate</a>()-&gt;<a class="code" href="a00121.html#acdf62aed4b8a469e63c036e75567c2e3" title="Returns an ConstMappingIterator by use of the respective implementation of the &amp;quot;createIterator(...">createConstIterator</a>();
<a name="l00120"></a>00120   bitrateIt-&gt;<a class="code" href="a00056.html#afdafa6870cd19b3d35674a7bc777585d" title="Iterates to the next position of the Mapping.">next</a>(); <span class="comment">//iterate to payload bitrate indicator</span>
<a name="l00121"></a>00121   <span class="keywordtype">double</span> payloadBitrate = bitrateIt-&gt;<a class="code" href="a00056.html#ad4419c259e747867f003d07d62d4259f" title="Returns the value of the Mapping at the current position.">getValue</a>();
<a name="l00122"></a>00122   <span class="keyword">delete</span> bitrateIt;
<a name="l00123"></a>00123 
<a name="l00124"></a>00124   <a class="code" href="a00073.html" title="Defines an extended DeciderResult for the 80211 protocol which stores the bit-rate...">DeciderResult80211</a>* result = 0;
<a name="l00125"></a>00125 
<a name="l00126"></a>00126   <span class="keywordflow">if</span> (snirMin &gt; <a class="code" href="a00068.html#a252eace2ccbe59484cd209be494a3983" title="threshold value for checking a SNR-map (SNR-threshold)">snrThreshold</a>) {
<a name="l00127"></a>00127     <span class="keywordflow">if</span>(<a class="code" href="a00068.html#a8fa275c3922106556c98a2f51b502794" title="computes if packet is ok or has errors">packetOk</a>(snirMin, frame-&gt;getBitLength() - (int)PHY_HEADER_LENGTH, payloadBitrate)) {
<a name="l00128"></a>00128       result = <span class="keyword">new</span> <a class="code" href="a00073.html" title="Defines an extended DeciderResult for the 80211 protocol which stores the bit-rate...">DeciderResult80211</a>(<span class="keyword">true</span>, payloadBitrate, snirMin);
<a name="l00129"></a>00129     } <span class="keywordflow">else</span> {
<a name="l00130"></a>00130       deciderEV &lt;&lt; <span class="stringliteral">&quot;Packet has BIT ERRORS! It is lost!\n&quot;</span>;
<a name="l00131"></a>00131       result = <span class="keyword">new</span> <a class="code" href="a00073.html" title="Defines an extended DeciderResult for the 80211 protocol which stores the bit-rate...">DeciderResult80211</a>(<span class="keyword">false</span>, payloadBitrate, snirMin);
<a name="l00132"></a>00132     }
<a name="l00133"></a>00133   } <span class="keywordflow">else</span> {
<a name="l00134"></a>00134     deciderEV &lt;&lt; <span class="stringliteral">&quot;Packet has ERRORS! It is lost!\n&quot;</span>;
<a name="l00135"></a>00135     result = <span class="keyword">new</span> <a class="code" href="a00073.html" title="Defines an extended DeciderResult for the 80211 protocol which stores the bit-rate...">DeciderResult80211</a>(<span class="keyword">false</span>, payloadBitrate, snirMin);
<a name="l00136"></a>00136   }
<a name="l00137"></a>00137 
<a name="l00138"></a>00138   <span class="keyword">delete</span> snrMap;
<a name="l00139"></a>00139   snrMap = 0;
<a name="l00140"></a>00140 
<a name="l00141"></a>00141   <span class="keywordflow">return</span> result;
<a name="l00142"></a>00142 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1f929f5b474f7b42c5c47acdd740cc68"></a><!-- doxytag: member="Decider80211::processNewSignal" ref="a1f929f5b474f7b42c5c47acdd740cc68" args="(AirFrame *frame)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">simtime_t Decider80211::processNewSignal </td>
          <td>(</td>
          <td class="paramtype">AirFrame *&nbsp;</td>
          <td class="paramname"> <em>frame</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Processes a new <a class="el" href="a00168.html" title="The signal class stores the physical representation of the signal of an AirFrame...">Signal</a>. Returns the time it wants to handle the signal again. </p>
<p>Default implementation checks if the signals receiving power is above the sensitivity of the radio and we are not already trying to receive another AirFrame. If thats the case it waits for the end of the signal. </p>

<p>Reimplemented from <a class="el" href="a00016.html#a6a480f87157d0509c0c1fccf94ea9fef">BaseDecider</a>.</p>

<p>Reimplemented in <a class="el" href="a00070.html#a52dbd000e68902786777f76dd2d6489f">Decider80211MultiChannel</a>.</p>

<p>Definition at line <a class="el" href="a00389_source.html#l00040">40</a> of file <a class="el" href="a00389_source.html">Decider80211.cc</a>.</p>

<p>References <a class="el" href="a00390_source.html#l00046">centerFrequency</a>, <a class="el" href="a00258_source.html#l00078">BaseDecider::currentSignal</a>, <a class="el" href="a00258_source.html#l00068">BaseDecider::EXPECT_END</a>, <a class="el" href="a00273_source.html#l00084">Dimension::frequency</a>, <a class="el" href="a00280_source.html#l00242">Signal::getReceivingPower()</a>, <a class="el" href="a00279_source.html#l00144">Signal::getReceptionEnd()</a>, <a class="el" href="a00279_source.html#l00140">Signal::getReceptionStart()</a>, <a class="el" href="a00266_source.html#l00075">Decider::notAgain</a>, <a class="el" href="a00258_source.html#l00072">BaseDecider::sensitivity</a>, <a class="el" href="a00272_source.html#l00138">Argument::setArgValue()</a>, <a class="el" href="a00257_source.html#l00168">BaseDecider::setChannelIdleStatus()</a>, <a class="el" href="a00272_source.html#l00095">Argument::setTime()</a>, and <a class="el" href="a00273_source.html#l00196">DimensionSet::timeFreqDomain</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00040"></a>00040                                                         {
<a name="l00041"></a>00041   <span class="keywordflow">if</span>(<a class="code" href="a00016.html#a22e578e992fab5ab54fe5fcdf196d9e3" title="pointer to the currently received AirFrame">currentSignal</a>.first != 0) {
<a name="l00042"></a>00042     deciderEV &lt;&lt; <span class="stringliteral">&quot;Already receiving another AirFrame!&quot;</span> &lt;&lt; endl;
<a name="l00043"></a>00043     <span class="keywordflow">return</span> <a class="code" href="a00067.html#a3edae7484aed7b0b874521c724bd3c30" title="simtime that tells the Phy-Layer not to pass an AirFrame again">notAgain</a>;
<a name="l00044"></a>00044   }
<a name="l00045"></a>00045 
<a name="l00046"></a>00046   <span class="comment">// get the receiving power of the Signal at start-time and center frequency</span>
<a name="l00047"></a>00047   <a class="code" href="a00168.html" title="The signal class stores the physical representation of the signal of an AirFrame...">Signal</a>&amp; signal = frame-&gt;getSignal();
<a name="l00048"></a>00048   <a class="code" href="a00009.html" title="Defines an argument for a mapping.">Argument</a> start(<a class="code" href="a00083.html#ac3f34a560d6c4ad5dc8d72dc69359b77" title="Shortcut to a DimensionSet which contains time and frequency.">DimensionSet::timeFreqDomain</a>);
<a name="l00049"></a>00049   start.setTime(signal.<a class="code" href="a00168.html#a7c4710243cf87caf7dfc9f313e2619b2" title="Returns the point in time when the receiving of the Signal started at the receiver...">getReceptionStart</a>());
<a name="l00050"></a>00050   start.setArgValue(<a class="code" href="a00082.html#ad4360e7d88c881d06ee61033ad99d66f" title="Shortcut to the frequency Dimension, same as &amp;#39;Dimension(&amp;quot;frequency&amp;quot;)&amp;#39;...">Dimension::frequency</a>, <a class="code" href="a00068.html#a15af6d061ab83d73474b6b94684707b6" title="The center frequency on which the decider listens for signals.">centerFrequency</a>);
<a name="l00051"></a>00051 
<a name="l00052"></a>00052   <span class="keywordtype">double</span> recvPower = signal.<a class="code" href="a00168.html#a513b1abac0b04549585257f7f5f8ebea" title="Calculates and returns the receiving power of this Signal. Ownership of the returned...">getReceivingPower</a>()-&gt;getValue(start);
<a name="l00053"></a>00053 
<a name="l00054"></a>00054   <span class="comment">// check whether signal is strong enough to receive</span>
<a name="l00055"></a>00055   <span class="keywordflow">if</span> ( recvPower &lt; <a class="code" href="a00016.html#a5eece8bf532f92912ccbd0a3bc4d6fb0" title="sensitivity value for receiving an AirFrame">sensitivity</a> )
<a name="l00056"></a>00056   {
<a name="l00057"></a>00057     deciderEV &lt;&lt; <span class="stringliteral">&quot;Signal is to weak (&quot;</span> &lt;&lt; recvPower &lt;&lt; <span class="stringliteral">&quot; &lt; &quot;</span> &lt;&lt; <a class="code" href="a00016.html#a5eece8bf532f92912ccbd0a3bc4d6fb0" title="sensitivity value for receiving an AirFrame">sensitivity</a>
<a name="l00058"></a>00058         &lt;&lt; <span class="stringliteral">&quot;) -&gt; do not receive.&quot;</span> &lt;&lt; endl;
<a name="l00059"></a>00059     <span class="comment">// Signal too weak, we can&apos;t receive it, tell PhyLayer that we don&apos;t want it again</span>
<a name="l00060"></a>00060     <span class="keywordflow">return</span> <a class="code" href="a00067.html#a3edae7484aed7b0b874521c724bd3c30" title="simtime that tells the Phy-Layer not to pass an AirFrame again">notAgain</a>;
<a name="l00061"></a>00061   }
<a name="l00062"></a>00062 
<a name="l00063"></a>00063   <span class="comment">// Signal is strong enough, receive this Signal and schedule it</span>
<a name="l00064"></a>00064   deciderEV &lt;&lt; <span class="stringliteral">&quot;Signal is strong enough (&quot;</span> &lt;&lt; recvPower &lt;&lt; <span class="stringliteral">&quot; &gt; &quot;</span> &lt;&lt; <a class="code" href="a00016.html#a5eece8bf532f92912ccbd0a3bc4d6fb0" title="sensitivity value for receiving an AirFrame">sensitivity</a>
<a name="l00065"></a>00065       &lt;&lt; <span class="stringliteral">&quot;) -&gt; Trying to receive AirFrame.&quot;</span> &lt;&lt; endl;
<a name="l00066"></a>00066 
<a name="l00067"></a>00067   <a class="code" href="a00016.html#a22e578e992fab5ab54fe5fcdf196d9e3" title="pointer to the currently received AirFrame">currentSignal</a>.first = frame;
<a name="l00068"></a>00068   <a class="code" href="a00016.html#a22e578e992fab5ab54fe5fcdf196d9e3" title="pointer to the currently received AirFrame">currentSignal</a>.second = <a class="code" href="a00016.html#ae4acbca8f960e9c49379ae2a82e2d90ba5539b8e545c0676dab0b0efb80dfeeac" title="Waiting for the end of the signal.">EXPECT_END</a>;
<a name="l00069"></a>00069 
<a name="l00070"></a>00070   <span class="comment">//channel turned busy</span>
<a name="l00071"></a>00071   <a class="code" href="a00016.html#ae535b44e34061014fe282c36c27b0193" title="Changes the &amp;quot;isIdle&amp;quot;-status to the passed value.">setChannelIdleStatus</a>(<span class="keyword">false</span>);
<a name="l00072"></a>00072 
<a name="l00073"></a>00073   <span class="keywordflow">return</span> ( signal.<a class="code" href="a00168.html#a2875223239e124d85949e1116cc12ae9" title="Returns the point in time when the receiving of the Signal ended at the receiver...">getReceptionEnd</a>());
<a name="l00074"></a>00074 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a2f8e006c849f1c14f4578b70358d0ecf"></a><!-- doxytag: member="Decider80211::processSignalEnd" ref="a2f8e006c849f1c14f4578b70358d0ecf" args="(AirFrame *frame)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">simtime_t Decider80211::processSignalEnd </td>
          <td>(</td>
          <td class="paramtype">AirFrame *&nbsp;</td>
          <td class="paramname"> <em>frame</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Processes a received AirFrame. </p>
<p>The SNR-mapping for the <a class="el" href="a00168.html" title="The signal class stores the physical representation of the signal of an AirFrame...">Signal</a> is created and checked against the Deciders SNR-threshold. Depending on that the received AirFrame is either sent up to the MAC-Layer or dropped.</p>
<dl class="return"><dt><b>Returns:</b></dt><dd>usually return a value for: 'do not pass it again' </dd></dl>

<p>Reimplemented from <a class="el" href="a00016.html#ab9cfef6c04e12d2524d45e881f341300">BaseDecider</a>.</p>

<p>Definition at line <a class="el" href="a00389_source.html#l00185">185</a> of file <a class="el" href="a00389_source.html">Decider80211.cc</a>.</p>

<p>References <a class="el" href="a00390_source.html#l00035">BITERROR</a>, <a class="el" href="a00389_source.html#l00093">checkIfSignalOk()</a>, <a class="el" href="a00258_source.html#l00078">BaseDecider::currentSignal</a>, <a class="el" href="a00265_source.html#l00004">DeciderResult::isSignalCorrect()</a>, <a class="el" href="a00266_source.html#l00075">Decider::notAgain</a>, <a class="el" href="a00266_source.html#l00072">Decider::phy</a>, <a class="el" href="a00076.html#a319e413b963f03ff218b0d0024fb66b9">DeciderToPhyInterface::sendControlMsgToMac()</a>, <a class="el" href="a00076.html#a3c0676323e402449d0972890c6a14df3">DeciderToPhyInterface::sendUp()</a>, and <a class="el" href="a00257_source.html#l00168">BaseDecider::setChannelIdleStatus()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00186"></a>00186 {
<a name="l00187"></a>00187   <span class="comment">// here the Signal is finally processed</span>
<a name="l00188"></a>00188 
<a name="l00189"></a>00189   <a class="code" href="a00072.html" title="A class to represent the result of a processed packet (that is not noise) by the...">DeciderResult</a>* result = <a class="code" href="a00068.html#ae4dc79c5a292dbb30e9541c46b40850c" title="Checks if the passed completed AirFrame was received correctly.">checkIfSignalOk</a>(frame);
<a name="l00190"></a>00190 
<a name="l00191"></a>00191   <span class="keywordflow">if</span> (result-&gt;<a class="code" href="a00072.html#aa0ff5bc718c64668cb1ce09c2c7dba80" title="A Function that returns a very basic result about the Signal.">isSignalCorrect</a>())
<a name="l00192"></a>00192   {
<a name="l00193"></a>00193     deciderEV &lt;&lt; <span class="stringliteral">&quot;packet was received correctly, it is now handed to upper layer...\n&quot;</span>;
<a name="l00194"></a>00194     <span class="comment">// go on with processing this AirFrame, send it to the Mac-Layer</span>
<a name="l00195"></a>00195     <a class="code" href="a00067.html#ac0f72556cb799d883b4219cab58320bb" title="A pointer to the physical layer of this Decider.">phy</a>-&gt;<a class="code" href="a00076.html#a3c0676323e402449d0972890c6a14df3" title="Called to send an AirFrame with DeciderResult to the MACLayer.">sendUp</a>(frame, result);
<a name="l00196"></a>00196   } <span class="keywordflow">else</span>
<a name="l00197"></a>00197   {
<a name="l00198"></a>00198     deciderEV &lt;&lt; <span class="stringliteral">&quot;packet was not received correctly, sending it as control message to upper layer\n&quot;</span>;
<a name="l00199"></a>00199     Mac80211Pkt* mac = <span class="keyword">static_cast&lt;</span>Mac80211Pkt*<span class="keyword">&gt;</span>(frame-&gt;decapsulate());
<a name="l00200"></a>00200     mac-&gt;setName(<span class="stringliteral">&quot;ERROR&quot;</span>);
<a name="l00201"></a>00201     mac-&gt;setKind(<a class="code" href="a00068.html#aadf94ce46e3edca3fa4d93150f72f4aeae12bbafd7ed8d0978ac925c1a493aabb" title="The decider has recognized a bit error in the packet.">BITERROR</a>);
<a name="l00202"></a>00202     <a class="code" href="a00067.html#ac0f72556cb799d883b4219cab58320bb" title="A pointer to the physical layer of this Decider.">phy</a>-&gt;<a class="code" href="a00076.html#a319e413b963f03ff218b0d0024fb66b9" title="Called by the Decider to send a control message to the MACLayer.">sendControlMsgToMac</a>(mac);
<a name="l00203"></a>00203     <span class="keyword">delete</span> result;
<a name="l00204"></a>00204   }
<a name="l00205"></a>00205 
<a name="l00206"></a>00206   <span class="comment">// we have processed this AirFrame and we prepare to receive the next one</span>
<a name="l00207"></a>00207   <a class="code" href="a00016.html#a22e578e992fab5ab54fe5fcdf196d9e3" title="pointer to the currently received AirFrame">currentSignal</a>.first = 0;
<a name="l00208"></a>00208 
<a name="l00209"></a>00209   <span class="comment">//channel is idle now</span>
<a name="l00210"></a>00210   <a class="code" href="a00016.html#ae535b44e34061014fe282c36c27b0193" title="Changes the &amp;quot;isIdle&amp;quot;-status to the passed value.">setChannelIdleStatus</a>(<span class="keyword">true</span>);
<a name="l00211"></a>00211 
<a name="l00212"></a>00212   <span class="keywordflow">return</span> <a class="code" href="a00067.html#a3edae7484aed7b0b874521c724bd3c30" title="simtime that tells the Phy-Layer not to pass an AirFrame again">notAgain</a>;
<a name="l00213"></a>00213 }
</pre></div></p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>src/modules/phy/<a class="el" href="a00390_source.html">Decider80211.h</a></li>
<li>src/modules/phy/<a class="el" href="a00389_source.html">Decider80211.cc</a></li>
</ul>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed Dec 14 16:01:49 2011 for MiXiM by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
