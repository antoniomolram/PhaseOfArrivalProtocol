<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>MiXiM: Mac80211 Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
      <li><a href="classes.html"><span>Class&nbsp;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>Mac80211 Class Reference<br/>
<small>
[<a class="el" href="a00444.html">macLayer - MAC layer modules</a>,&nbsp;<a class="el" href="a00457.html">IEEE 802.11 - Classes for the IEEE 802.11 implementation of MiXiM</a>]</small>
</h1><!-- doxytag: class="Mac80211" --><!-- doxytag: inherits="BaseMacLayer" -->
<p>An implementation of the 802.11b MAC.  
<a href="#_details">More...</a></p>

<p><code>#include &lt;<a class="el" href="a00338_source.html">Mac80211.h</a>&gt;</code></p>

<p>Inherits <a class="el" href="a00022.html">BaseMacLayer</a>.</p>

<p>Inherited by <a class="el" href="a00116.html">Mac80211MultiChannel</a>.</p>
<div class="dynheader">
Collaboration diagram for Mac80211:</div>
<div class="dynsection">
<div class="center"><img src="a00663.png" border="0" usemap="#Mac80211_coll__map" alt="Collaboration graph"/></div>
<map name="Mac80211_coll__map" id="Mac80211_coll__map">
<area shape="rect" href="a00022.html" title="A very simple MAC module template which provides de&#45; and encapsulation of messages..." alt="" coords="5,5,115,32"/></map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>

<p><a href="a00664.html">List of all members.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Classes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00134.html">NeighborEntry</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Data about a neighbor host.  <a href="a00134.html#_details">More...</a><br/></td></tr>
<tr><td colspan="2"><h2>Public Types</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#ae423db101e8431b0cbd67c347076c44a">Mac80211MessageKinds</a> { <br/>
&nbsp;&nbsp;<b>RTS</b> =  LAST_BASE_MAC_MESSAGE_KIND, 
<b>CTS</b>, 
<b>ACK</b>, 
<b>DATA</b>, 
<br/>
&nbsp;&nbsp;<b>BROADCAST</b>, 
<b>LAST_MAC_80211_MESSAGE_KIND</b>
<br/>
 }</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"><p>frame kinds </p>
<br/></td></tr>
<tr><td colspan="2"><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#ab81dae24d79c2ef010301e2c219966c1">initialize</a> (int)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialization of the module and some variables.  <a href="#ab81dae24d79c2ef010301e2c219966c1"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a2f3c51473a890e1c3e3afb5dc1b75252"></a><!-- doxytag: member="Mac80211::finish" ref="a2f3c51473a890e1c3e3afb5dc1b75252" args="()" -->
virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#a2f3c51473a890e1c3e3afb5dc1b75252">finish</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Called when the simulation has finished. <br/></td></tr>
<tr><td colspan="2"><h2>Protected Types</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#a381307739876ed0d015352b95bd93186">timerType</a> { <b>TIMEOUT</b>, 
<b>NAV</b>
 }</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#a7ff0b8b49d1a93feae6f808caf5fe447">State</a> { <br/>
&nbsp;&nbsp;<b>WFDATA</b> =  0, 
<b>QUIET</b> =  1, 
<b>IDLE</b> =  2, 
<b>CONTEND</b> =  3, 
<br/>
&nbsp;&nbsp;<b>WFCTS</b> =  4, 
<b>WFACK</b> =  5, 
<b>BUSY</b> =  6
<br/>
 }</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a565ab82077f95d80ec44a4a4fed08ab9"></a><!-- doxytag: member="Mac80211::MacPktList" ref="a565ab82077f95d80ec44a4a4fed08ab9" args="" -->
typedef std::list&lt; Mac80211Pkt * &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#a565ab82077f95d80ec44a4a4fed08ab9">MacPktList</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Type for a queue of Mac80211Pkts. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a072f068412a3577d8d11ca98c52a9c48"></a><!-- doxytag: member="Mac80211::NeighborList" ref="a072f068412a3577d8d11ca98c52a9c48" args="" -->
typedef std::list&lt; <a class="el" href="a00134.html">NeighborEntry</a> &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#a072f068412a3577d8d11ca98c52a9c48">NeighborList</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Type for a list of NeighborEntries. <br/></td></tr>
<tr><td colspan="2"><h2>Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#a990af33f857669759da0cbeebd1c2431">handleSelfMsg</a> (cMessage *)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Handle self messages such as timer...  <a href="#a990af33f857669759da0cbeebd1c2431"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#af7e230f8713536482417699f2f6bee71">handleUpperMsg</a> (cMessage *msg)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Handle messages from upper layer.  <a href="#af7e230f8713536482417699f2f6bee71"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#ac8bfb04590aab2434bd8d17ee4e213d9">handleLowerMsg</a> (cMessage *)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Handle messages from lower layer.  <a href="#ac8bfb04590aab2434bd8d17ee4e213d9"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a41f1a7b86f420e1f840c14badf2b0890"></a><!-- doxytag: member="Mac80211::handleLowerControl" ref="a41f1a7b86f420e1f840c14badf2b0890" args="(cMessage *)" -->
virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#a41f1a7b86f420e1f840c14badf2b0890">handleLowerControl</a> (cMessage *)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Handle messages from lower layer. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#a0a87fa1791117ef1dd1841ba217e4245">handleEndContentionTimer</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">handle end of contention  <a href="#a0a87fa1791117ef1dd1841ba217e4245"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#a0377ddefba33b8d50c7bf4045354d7bb">handleMsgNotForMe</a> (cMessage *af, simtime_t_cref duration)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">handle a message that is not for me or errornous  <a href="#a0377ddefba33b8d50c7bf4045354d7bb"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#aa0b767642d86d3b66f1d3258065fe5ae">handleMsgForMe</a> (Mac80211Pkt *)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">handle a message that was meant for me  <a href="#aa0b767642d86d3b66f1d3258065fe5ae"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#adfcf8b7a5e1db233a1bd717cecaf49bd">handleBroadcastMsg</a> (Mac80211Pkt *)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#afe4300147d9ea5e4d3e3d8c98ff20436">handleEndTransmission</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">handle the end of a transmission...  <a href="#afe4300147d9ea5e4d3e3d8c98ff20436"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#a7d36a55827a7ea91b2539c86d79349af">handleEndSifsTimer</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">handle end of SIFS  <a href="#a7d36a55827a7ea91b2539c86d79349af"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#ab5fcba8c7a3878ac59195a483ba35a12">handleTimeoutTimer</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">handle time out  <a href="#ab5fcba8c7a3878ac59195a483ba35a12"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#a23a142d65d7a0dcba4a60c0f509ab5b9">handleNavTimer</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">NAV timer expired, the exchange of messages of other stations is done.  <a href="#a23a142d65d7a0dcba4a60c0f509ab5b9"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#a98ad0d3935d620b33302e5230b395685">handleRTSframe</a> (Mac80211Pkt *)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#ab0844f9dbcece750c9a58ca9f0a73fe1">handleDATAframe</a> (Mac80211Pkt *)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#a50cb85360462eb7d256ec8a0b493ca44">handleACKframe</a> (Mac80211Pkt *)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#ae1e17af7dddc261d7947d48a1f4d0e21">handleCTSframe</a> (Mac80211Pkt *)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aa70252cee19dfda74662f06075ee52bf"></a><!-- doxytag: member="Mac80211::dataTransmissionFailed" ref="aa70252cee19dfda74662f06075ee52bf" args="()" -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><b>dataTransmissionFailed</b> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ad44649781514babc1a180bf5c82be983"></a><!-- doxytag: member="Mac80211::rtsTransmissionFailed" ref="ad44649781514babc1a180bf5c82be983" args="()" -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><b>rtsTransmissionFailed</b> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#a7a4ff22b4b999827a898794923115880">sendDATAframe</a> (Mac80211Pkt *)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">send data frame  <a href="#a7a4ff22b4b999827a898794923115880"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#a1c404a5176db493c2fefb71537783607">sendACKframe</a> (Mac80211Pkt *)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">send Acknoledgement  <a href="#a1c404a5176db493c2fefb71537783607"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#a1fd59a589e53facb68c13be84521a49e">sendCTSframe</a> (Mac80211Pkt *)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">send CTS frame  <a href="#a1fd59a589e53facb68c13be84521a49e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#a3104750758ab171b20ffcfeae0079a78">sendRTSframe</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">send RTS frame  <a href="#a3104750758ab171b20ffcfeae0079a78"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#a26b30d048980b56d79c04e859bfce009">sendBROADCASTframe</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">send broadcast frame  <a href="#a26b30d048980b56d79c04e859bfce009"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual MacPkt *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#aa44171fa07d51ec487f7481740525466">encapsMsg</a> (cPacket *netw)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">encapsulate packet  <a href="#aa44171fa07d51ec487f7481740525466"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a538f710b1bd35d7c653763830f43085c"></a><!-- doxytag: member="Mac80211::decapsMsg" ref="a538f710b1bd35d7c653763830f43085c" args="(MacPkt *frame)" -->
virtual cPacket *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#a538f710b1bd35d7c653763830f43085c">decapsMsg</a> (MacPkt *frame)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">decapsulate packet <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#ab3030c86acac78401f877a61cefcdad6">beginNewCycle</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">start a new contention period  <a href="#ab3030c86acac78401f877a61cefcdad6"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">simtime_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#ade2c913df312fd4fc46106c1134889b8">backoff</a> (bool rtscts=true)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Compute a backoff value.  <a href="#ade2c913df312fd4fc46106c1134889b8"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#a72e78257babff863ca8749b2bb1a97f4">testMaxAttempts</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Test if maximum number of retries to transmit is exceeded.  <a href="#a72e78257babff863ca8749b2bb1a97f4"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">simtime_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#a424851e88bb229fcc3c59cfea80a9079">timeOut</a> (<a class="el" href="a00115.html#ae423db101e8431b0cbd67c347076c44a">Mac80211MessageKinds</a> type, double br)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">return a timeOut value for a certain type of frame  <a href="#a424851e88bb229fcc3c59cfea80a9079"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">simtime_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#a6732e4a776e78432bf5dd9dd26de2f7d">packetDuration</a> (double bits, double br)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">computes the duration of a transmission over the physical channel, given a certain bitrate  <a href="#a6732e4a776e78432bf5dd9dd26de2f7d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ade8a90e665191333e610b60bad4a32a1"></a><!-- doxytag: member="Mac80211::stateName" ref="ade8a90e665191333e610b60bad4a32a1" args="(State state)" -->
const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#ade8a90e665191333e610b60bad4a32a1">stateName</a> (<a class="el" href="a00115.html#a7ff0b8b49d1a93feae6f808caf5fe447">State</a> <a class="el" href="a00115.html#a56fa75f3eb056ae29b1a4b8da0035d8c">state</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Produce a readable name of the given state. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a9fc6eb078e53740d354f8ea7b9d94713"></a><!-- doxytag: member="Mac80211::setState" ref="a9fc6eb078e53740d354f8ea7b9d94713" args="(State state)" -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#a9fc6eb078e53740d354f8ea7b9d94713">setState</a> (<a class="el" href="a00115.html#a7ff0b8b49d1a93feae6f808caf5fe447">State</a> <a class="el" href="a00115.html#a56fa75f3eb056ae29b1a4b8da0035d8c">state</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Sets the state, and produces a log message in between. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aa316943080d714ffc3c0bf54ea8aeb08"></a><!-- doxytag: member="Mac80211::rtsCts" ref="aa316943080d714ffc3c0bf54ea8aeb08" args="(Mac80211Pkt *m)" -->
bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#aa316943080d714ffc3c0bf54ea8aeb08">rtsCts</a> (Mac80211Pkt *m)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Check whether the next packet should be send with RTS/CTS. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a9ae0815a0e01c4d4fd13a87393f837a8"></a><!-- doxytag: member="Mac80211::suspendContention" ref="a9ae0815a0e01c4d4fd13a87393f837a8" args="()" -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#a9ae0815a0e01c4d4fd13a87393f837a8">suspendContention</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">suspend an ongoing contention, pick it up again when the channel becomes idle <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a7905be98b60b2a709dfbcd7e16bc761e"></a><!-- doxytag: member="Mac80211::retrieveBitrate" ref="a7905be98b60b2a709dfbcd7e16bc761e" args="(const LAddress::L2Type &amp;destAddress)" -->
double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#a7905be98b60b2a709dfbcd7e16bc761e">retrieveBitrate</a> (const <a class="el" href="a00105.html#aea56b60dcb5ae8c2bde465271daf7210">LAddress::L2Type</a> &amp;destAddress)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">figure out at which bitrate to send to this particular destination <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a8dd543a1a0b89f98af6d39d28dbd9e74"></a><!-- doxytag: member="Mac80211::addNeighbor" ref="a8dd543a1a0b89f98af6d39d28dbd9e74" args="(Mac80211Pkt *af)" -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#a8dd543a1a0b89f98af6d39d28dbd9e74">addNeighbor</a> (Mac80211Pkt *af)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">add a new entry to the neighbor list <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aaf9d15b3d9055b2f56d4eddce7cc9850"></a><!-- doxytag: member="Mac80211::findNeighbor" ref="aaf9d15b3d9055b2f56d4eddce7cc9850" args="(const LAddress::L2Type &amp;address)" -->
NeighborList::iterator&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#aaf9d15b3d9055b2f56d4eddce7cc9850">findNeighbor</a> (const <a class="el" href="a00105.html#aea56b60dcb5ae8c2bde465271daf7210">LAddress::L2Type</a> &amp;address)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">find a neighbor based on his address <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a967bb2466f35274cc945db0d9e044eeb"></a><!-- doxytag: member="Mac80211::findOldestNeighbor" ref="a967bb2466f35274cc945db0d9e044eeb" args="()" -->
NeighborList::iterator&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#a967bb2466f35274cc945db0d9e044eeb">findOldestNeighbor</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">find the oldest neighbor -- usually in order to overwrite this entry <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#a59cb9e6071f33bc460a2f3a662c4bc59">senseChannelWhileIdle</a> (simtime_t_cref duration)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Starts a channel sense request which sense the channel for the passed duration or until the channel is busy.  <a href="#a59cb9e6071f33bc460a2f3a662c4bc59"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a3a62f334346a15619853a8c6c87367aa"></a><!-- doxytag: member="Mac80211::createSignal" ref="a3a62f334346a15619853a8c6c87367aa" args="(simtime_t_cref start, simtime_t_cref length, double power, double bitrate)" -->
<a class="el" href="a00168.html">Signal</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#a3a62f334346a15619853a8c6c87367aa">createSignal</a> (simtime_t_cref start, simtime_t_cref length, double power, double <a class="el" href="a00115.html#a126c9db5a54bafa6ad74eb3ee24bd936">bitrate</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Creates the signal to be used for a packet to be sent. <br/></td></tr>
<tr><td colspan="2"><h2>Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a2d31f97b0662b8e37f090c3b996cec82"></a><!-- doxytag: member="Mac80211::timeout" ref="a2d31f97b0662b8e37f090c3b996cec82" args="" -->
cMessage *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#a2d31f97b0662b8e37f090c3b996cec82">timeout</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Timer used for time-outs after the transmission of a RTS, a CTS, or a DATA packet. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a35efb0198d0085a341aba515bec9146f"></a><!-- doxytag: member="Mac80211::nav" ref="a35efb0198d0085a341aba515bec9146f" args="" -->
cMessage *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#a35efb0198d0085a341aba515bec9146f">nav</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Timer used for the defer time of a node. Also called NAV : networks allocation vector. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a7bd4f3adc205b150f9fa406fa582f0b6"></a><!-- doxytag: member="Mac80211::contention" ref="a7bd4f3adc205b150f9fa406fa582f0b6" args="" -->
ChannelSenseRequest *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#a7bd4f3adc205b150f9fa406fa582f0b6">contention</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Used to sense if the channel is idle for contention periods. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ace80836b6fcb1681f6b2d49466f87fb0"></a><!-- doxytag: member="Mac80211::endSifs" ref="ace80836b6fcb1681f6b2d49466f87fb0" args="" -->
ChannelSenseRequest *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#ace80836b6fcb1681f6b2d49466f87fb0">endSifs</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Timer used to indicate the end of a SIFS. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a8104daf3041394b73fe545427cbc02d7"></a><!-- doxytag: member="Mac80211::chSenseStart" ref="a8104daf3041394b73fe545427cbc02d7" args="" -->
simtime_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#a8104daf3041394b73fe545427cbc02d7">chSenseStart</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Stores the the time a channel sensing started. Used to calculate the quiet-time of the channel if the sensing was aborted. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a56fa75f3eb056ae29b1a4b8da0035d8c"></a><!-- doxytag: member="Mac80211::state" ref="a56fa75f3eb056ae29b1a4b8da0035d8c" args="" -->
<a class="el" href="a00115.html#a7ff0b8b49d1a93feae6f808caf5fe447">State</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#a56fa75f3eb056ae29b1a4b8da0035d8c">state</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Current state of the MAC. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#a226566e4a56cfed2928acc87ff3af90a">defaultBitrate</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Default bitrate.  <a href="#a226566e4a56cfed2928acc87ff3af90a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a592eee2a24a6fcadd6fdf912a101719f"></a><!-- doxytag: member="Mac80211::txPower" ref="a592eee2a24a6fcadd6fdf912a101719f" args="" -->
double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#a592eee2a24a6fcadd6fdf912a101719f">txPower</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The power at which data is transmitted. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a67eba657efe23f5e5c21904f4744261d"></a><!-- doxytag: member="Mac80211::centerFreq" ref="a67eba657efe23f5e5c21904f4744261d" args="" -->
double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#a67eba657efe23f5e5c21904f4744261d">centerFreq</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Stores the center frequency the Mac uses. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a126c9db5a54bafa6ad74eb3ee24bd936"></a><!-- doxytag: member="Mac80211::bitrate" ref="a126c9db5a54bafa6ad74eb3ee24bd936" args="" -->
double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#a126c9db5a54bafa6ad74eb3ee24bd936">bitrate</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Current bit rate at which data is transmitted. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a979883a8da4b308de4a8e79b5bbbe2e6"></a><!-- doxytag: member="Mac80211::autoBitrate" ref="a979883a8da4b308de4a8e79b5bbbe2e6" args="" -->
bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#a979883a8da4b308de4a8e79b5bbbe2e6">autoBitrate</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Auto bit rate adaptation -- switch. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a1cd38454a518f922ba57f68d22e2f31e"></a><!-- doxytag: member="Mac80211::snrThresholds" ref="a1cd38454a518f922ba57f68d22e2f31e" args="" -->
std::vector&lt; double &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#a1cd38454a518f922ba57f68d22e2f31e">snrThresholds</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Hold RSSI thresholds at which to change the bitrates. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ae8892c105c3f0fb2b6f28634bb099f31"></a><!-- doxytag: member="Mac80211::queueLength" ref="ae8892c105c3f0fb2b6f28634bb099f31" args="" -->
unsigned&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#ae8892c105c3f0fb2b6f28634bb099f31">queueLength</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Maximal number of packets in the queue; should be set in the omnetpp.ini. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a5d8e9b53c8d6cb0116feed506d843e18"></a><!-- doxytag: member="Mac80211::nextIsBroadcast" ref="a5d8e9b53c8d6cb0116feed506d843e18" args="" -->
bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#a5d8e9b53c8d6cb0116feed506d843e18">nextIsBroadcast</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Boolean used to know if the next packet is a broadcast packet. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a969e8e3a592dffccea28596c61b2af50"></a><!-- doxytag: member="Mac80211::fromUpperLayer" ref="a969e8e3a592dffccea28596c61b2af50" args="" -->
<a class="el" href="a00115.html#a565ab82077f95d80ec44a4a4fed08ab9">MacPktList</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#a969e8e3a592dffccea28596c61b2af50">fromUpperLayer</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Buffering of messages from upper layer. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#a11fb608b3564e2d2cd41b463b1a8cc90">longRetryCounter</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Number of frame transmission attempt.  <a href="#a11fb608b3564e2d2cd41b463b1a8cc90"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a9bbc3d71eddb62c4e12dcd500a58b0bb"></a><!-- doxytag: member="Mac80211::shortRetryCounter" ref="a9bbc3d71eddb62c4e12dcd500a58b0bb" args="" -->
unsigned&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#a9bbc3d71eddb62c4e12dcd500a58b0bb">shortRetryCounter</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Number of frame transmission attempt. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a58484d1a6f2031548d433d18438042e9"></a><!-- doxytag: member="Mac80211::remainingBackoff" ref="a58484d1a6f2031548d433d18438042e9" args="" -->
simtime_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#a58484d1a6f2031548d433d18438042e9">remainingBackoff</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">remaining backoff time. If the backoff timer is interrupted, this variable holds the remaining backoff time. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a4a9d1c8d45c46f18afa0f07f5b6572f4"></a><!-- doxytag: member="Mac80211::currentIFS" ref="a4a9d1c8d45c46f18afa0f07f5b6572f4" args="" -->
simtime_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#a4a9d1c8d45c46f18afa0f07f5b6572f4">currentIFS</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">current IFS value (DIFS or EIFS) If an error has been detected, the next backoff requires EIFS, once a valid frame has been received, resets to DIFS. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a6ad4dd93415c98c969df05f53d739cfd"></a><!-- doxytag: member="Mac80211::rtsCtsThreshold" ref="a6ad4dd93415c98c969df05f53d739cfd" args="" -->
int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#a6ad4dd93415c98c969df05f53d739cfd">rtsCtsThreshold</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Number of bits in a packet before RTS/CTS is used. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ab9f0ea820748af6d640569fc76f39659"></a><!-- doxytag: member="Mac80211::delta" ref="ab9f0ea820748af6d640569fc76f39659" args="" -->
simtime_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#ab9f0ea820748af6d640569fc76f39659">delta</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Very small value used in timer scheduling in order to avoid multiple changements of state in the same simulation time. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ae62ff2c9617e5782f6f7231e36d1574d"></a><!-- doxytag: member="Mac80211::neighborhoodCacheSize" ref="ae62ff2c9617e5782f6f7231e36d1574d" args="" -->
unsigned&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#ae62ff2c9617e5782f6f7231e36d1574d">neighborhoodCacheSize</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Keep information for this many neighbors. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aede2e9e4e32ef871e3a59c51564123de"></a><!-- doxytag: member="Mac80211::neighborhoodCacheMaxAge" ref="aede2e9e4e32ef871e3a59c51564123de" args="" -->
simtime_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#aede2e9e4e32ef871e3a59c51564123de">neighborhoodCacheMaxAge</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Consider information in cache outdate if it is older than this. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a4caf1f3c2c004851555c9c691b82edf9"></a><!-- doxytag: member="Mac80211::neighbors" ref="a4caf1f3c2c004851555c9c691b82edf9" args="" -->
<a class="el" href="a00115.html#a072f068412a3577d8d11ca98c52a9c48">NeighborList</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#a4caf1f3c2c004851555c9c691b82edf9">neighbors</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">A list of this hosts neighbors. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#a9f9f566e85a76f63e63b5907bf9ad48a">switching</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#a026837b7167d230bbe79a1e0630c7578">fsc</a></td></tr>
<tr><td colspan="2"><h2>Private Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ae2d989af4eab21c27e527f80192a27ba"></a><!-- doxytag: member="Mac80211::Mac80211" ref="ae2d989af4eab21c27e527f80192a27ba" args="(const Mac80211 &amp;)" -->
&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#ae2d989af4eab21c27e527f80192a27ba">Mac80211</a> (const <a class="el" href="a00115.html">Mac80211</a> &amp;)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Copy constructor is not allowed. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aab98ee4e3ed888adc56f387a3cdc9138"></a><!-- doxytag: member="Mac80211::operator=" ref="aab98ee4e3ed888adc56f387a3cdc9138" args="(const Mac80211 &amp;)" -->
<a class="el" href="a00115.html">Mac80211</a> &amp;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00115.html#aab98ee4e3ed888adc56f387a3cdc9138">operator=</a> (const <a class="el" href="a00115.html">Mac80211</a> &amp;)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Assignment operator is not allowed. <br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>An implementation of the 802.11b MAC. </p>
<p>For more info, see the NED file.</p>
<dl class="author"><dt><b>Author:</b></dt><dd>David Raguin, Karl Wessel (port for MiXiM) </dd></dl>

<p>Definition at line <a class="el" href="a00338_source.html#l00042">42</a> of file <a class="el" href="a00338_source.html">Mac80211.h</a>.</p>
<hr/><h2>Member Enumeration Documentation</h2>
<a class="anchor" id="a7ff0b8b49d1a93feae6f808caf5fe447"></a><!-- doxytag: member="Mac80211::State" ref="a7ff0b8b49d1a93feae6f808caf5fe447" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="a00115.html#a7ff0b8b49d1a93feae6f808caf5fe447">Mac80211::State</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Definition of the states </p>

<p>Definition at line <a class="el" href="a00338_source.html#l00075">75</a> of file <a class="el" href="a00338_source.html">Mac80211.h</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00075"></a>00075                {
<a name="l00076"></a>00076       WFDATA = 0, <span class="comment">// waiting for data packet</span>
<a name="l00077"></a>00077       QUIET = 1,  <span class="comment">// waiting for the communication between two other nodes to end</span>
<a name="l00078"></a>00078       IDLE = 2,   <span class="comment">// no packet to send, no packet receiving</span>
<a name="l00079"></a>00079       CONTEND = 3,<span class="comment">// contention state (battle for the channel)</span>
<a name="l00080"></a>00080       WFCTS = 4,  <span class="comment">// RTS sent, waiting for CTS</span>
<a name="l00081"></a>00081       WFACK = 5,  <span class="comment">// DATA packet sent, waiting for ACK</span>
<a name="l00082"></a>00082       BUSY = 6    <span class="comment">// during transmission of an ACK or a BROADCAST packet</span>
<a name="l00083"></a>00083     };
</pre></div></p>

</div>
</div>
<a class="anchor" id="a381307739876ed0d015352b95bd93186"></a><!-- doxytag: member="Mac80211::timerType" ref="a381307739876ed0d015352b95bd93186" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="a00115.html#a381307739876ed0d015352b95bd93186">Mac80211::timerType</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Definition of the timer types </p>

<p>Definition at line <a class="el" href="a00338_source.html#l00069">69</a> of file <a class="el" href="a00338_source.html">Mac80211.h</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00069"></a>00069                    {
<a name="l00070"></a>00070       TIMEOUT,
<a name="l00071"></a>00071       NAV
<a name="l00072"></a>00072     };
</pre></div></p>

</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="ade2c913df312fd4fc46106c1134889b8"></a><!-- doxytag: member="Mac80211::backoff" ref="ade2c913df312fd4fc46106c1134889b8" args="(bool rtscts=true)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">simtime_t Mac80211::backoff </td>
          <td>(</td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>rtscts</em> = <code>true</code></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Compute a backoff value. </p>
<p>Compute the backoff value. </p>

<p>Definition at line <a class="el" href="a00337_source.html#l01014">1014</a> of file <a class="el" href="a00337_source.html">Mac80211.cc</a>.</p>

<p>References <a class="el" href="a00338_source.html#l00308">longRetryCounter</a>, and <a class="el" href="a00338_source.html#l00311">shortRetryCounter</a>.</p>

<p>Referenced by <a class="el" href="a00337_source.html#l00569">handleACKframe()</a>, <a class="el" href="a00337_source.html#l00783">handleEndTransmission()</a>, and <a class="el" href="a00337_source.html#l00061">initialize()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01014"></a>01014                                        {
<a name="l01015"></a>01015     <span class="keywordtype">unsigned</span> rc = (rtscts) ?  <a class="code" href="a00115.html#a11fb608b3564e2d2cd41b463b1a8cc90" title="Number of frame transmission attempt.">longRetryCounter</a> : <a class="code" href="a00115.html#a9bbc3d71eddb62c4e12dcd500a58b0bb" title="Number of frame transmission attempt.">shortRetryCounter</a>;
<a name="l01016"></a>01016     <span class="keywordtype">unsigned</span> cw = ((CW_MIN + 1) &lt;&lt; rc) - 1;
<a name="l01017"></a>01017     <span class="keywordflow">if</span>(cw &gt; CW_MAX) cw = CW_MAX;
<a name="l01018"></a>01018 
<a name="l01019"></a>01019     simtime_t value = ((double) intrand(cw + 1)) * ST;
<a name="l01020"></a>01020     debugEV &lt;&lt; simTime() &lt;&lt; <span class="stringliteral">&quot; random backoff = &quot;</span> &lt;&lt; value &lt;&lt; endl;
<a name="l01021"></a>01021 
<a name="l01022"></a>01022     <span class="keywordflow">return</span> value;
<a name="l01023"></a>01023 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab3030c86acac78401f877a61cefcdad6"></a><!-- doxytag: member="Mac80211::beginNewCycle" ref="ab3030c86acac78401f877a61cefcdad6" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Mac80211::beginNewCycle </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>start a new contention period </p>
<p>Start a new contention period if the channel is free and if there's a packet to send. Called at the end of a deferring period, a busy period, or after a failure. Called by the HandleMsgForMe(), HandleTimer() HandleUpperMsg(), and, without RTS/CTS, by <a class="el" href="a00115.html#a0377ddefba33b8d50c7bf4045354d7bb" title="handle a message that is not for me or errornous">handleMsgNotForMe()</a>. </p>

<p>Definition at line <a class="el" href="a00337_source.html#l00959">959</a> of file <a class="el" href="a00337_source.html">Mac80211.cc</a>.</p>

<p>References <a class="el" href="a00338_source.html#l00260">contention</a>, <a class="el" href="a00338_source.html#l00321">currentIFS</a>, <a class="el" href="a00338_source.html#l00301">fromUpperLayer</a>, <a class="el" href="a00119.html#affa30a25b96ffe387b22c68ca35f77a5">MacToPhyInterface::getChannelState()</a>, <a class="el" href="a00264_source.html#l00052">ChannelState::info()</a>, <a class="el" href="a00263_source.html#l00003">ChannelState::isIdle()</a>, <a class="el" href="a00295_source.html#l00074">LAddress::isL2Broadcast()</a>, <a class="el" href="a00338_source.html#l00257">nav</a>, <a class="el" href="a00338_source.html#l00298">nextIsBroadcast</a>, <a class="el" href="a00243_source.html#l00068">BaseMacLayer::phy</a>, <a class="el" href="a00338_source.html#l00316">remainingBackoff</a>, <a class="el" href="a00337_source.html#l00155">senseChannelWhileIdle()</a>, <a class="el" href="a00337_source.html#l01130">setState()</a>, and <a class="el" href="a00337_source.html#l01029">testMaxAttempts()</a>.</p>

<p>Referenced by <a class="el" href="a00337_source.html#l00569">handleACKframe()</a>, <a class="el" href="a00337_source.html#l00611">handleBroadcastMsg()</a>, <a class="el" href="a00337_source.html#l00783">handleEndTransmission()</a>, <a class="el" href="a00337_source.html#l00363">handleMsgNotForMe()</a>, <a class="el" href="a00337_source.html#l00677">handleNavTimer()</a>, <a class="el" href="a00337_source.html#l00720">handleTimeoutTimer()</a>, and <a class="el" href="a00337_source.html#l00170">handleUpperMsg()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00960"></a>00960 {
<a name="l00961"></a>00961     <span class="comment">// before trying to send one more time a packet, test if the</span>
<a name="l00962"></a>00962     <span class="comment">// maximum retry limit is reached. If it is the case, then</span>
<a name="l00963"></a>00963     <span class="comment">// delete the packet and send the next packet.</span>
<a name="l00964"></a>00964     <a class="code" href="a00115.html#a72e78257babff863ca8749b2bb1a97f4" title="Test if maximum number of retries to transmit is exceeded.">testMaxAttempts</a>();
<a name="l00965"></a>00965 
<a name="l00966"></a>00966     <span class="keywordflow">if</span> (<a class="code" href="a00115.html#a35efb0198d0085a341aba515bec9146f" title="Timer used for the defer time of a node. Also called NAV : networks allocation vector...">nav</a>-&gt;isScheduled()) {
<a name="l00967"></a>00967       debugEV &lt;&lt; <span class="stringliteral">&quot;cannot beginNewCycle until NAV expires at t &quot;</span> &lt;&lt; <a class="code" href="a00115.html#a35efb0198d0085a341aba515bec9146f" title="Timer used for the defer time of a node. Also called NAV : networks allocation vector...">nav</a>-&gt;getArrivalTime() &lt;&lt; endl;
<a name="l00968"></a>00968         <span class="keywordflow">return</span>;
<a name="l00969"></a>00969     }
<a name="l00970"></a>00970 
<a name="l00971"></a>00971     <span class="comment">/*</span>
<a name="l00972"></a>00972 <span class="comment">    if(timeout-&gt;isScheduled()) {</span>
<a name="l00973"></a>00973 <span class="comment">      cancelEvent(timeout);</span>
<a name="l00974"></a>00974 <span class="comment">    }</span>
<a name="l00975"></a>00975 <span class="comment">    */</span>
<a name="l00976"></a>00976 
<a name="l00977"></a>00977     <span class="keywordflow">if</span> (!<a class="code" href="a00115.html#a969e8e3a592dffccea28596c61b2af50" title="Buffering of messages from upper layer.">fromUpperLayer</a>.empty()) {
<a name="l00978"></a>00978 
<a name="l00979"></a>00979         <span class="comment">// look if the next packet is unicast or broadcast</span>
<a name="l00980"></a>00980         <a class="code" href="a00115.html#a5d8e9b53c8d6cb0116feed506d843e18" title="Boolean used to know if the next packet is a broadcast packet.">nextIsBroadcast</a> = <a class="code" href="a00105.html#a3890f1c7314c5695e32252468e6bd5a5" title="Test if a L2 address (pSrcAddr) is a broadcast address.">LAddress::isL2Broadcast</a>(<a class="code" href="a00115.html#a969e8e3a592dffccea28596c61b2af50" title="Buffering of messages from upper layer.">fromUpperLayer</a>.front()-&gt;getDestAddr());
<a name="l00981"></a>00981 
<a name="l00982"></a>00982         <a class="code" href="a00115.html#a9fc6eb078e53740d354f8ea7b9d94713" title="Sets the state, and produces a log message in between.">setState</a>(CONTEND);
<a name="l00983"></a>00983         <span class="keywordflow">if</span>(!<a class="code" href="a00115.html#a7bd4f3adc205b150f9fa406fa582f0b6" title="Used to sense if the channel is idle for contention periods.">contention</a>-&gt;isScheduled()) {
<a name="l00984"></a>00984           <a class="code" href="a00043.html" title="Provides information about the current state of the channel:.">ChannelState</a> channel = <a class="code" href="a00022.html#aa7b1e6bdb734765a9f4eff7d486dfbea" title="Handler to the physical layer.">phy</a>-&gt;<a class="code" href="a00119.html#affa30a25b96ffe387b22c68ca35f77a5" title="Returns the current state of the channel. See ChannelState for details.">getChannelState</a>();
<a name="l00985"></a>00985           debugEV &lt;&lt; simTime() &lt;&lt; <span class="stringliteral">&quot; do contention: medium = &quot;</span> &lt;&lt; channel.<a class="code" href="a00043.html#aa7125a711299c62119c5fe5bc3f43f1f" title="Output for this ChannelState.">info</a>() &lt;&lt; <span class="stringliteral">&quot;, backoff = &quot;</span>
<a name="l00986"></a>00986                &lt;&lt;  <a class="code" href="a00115.html#a58484d1a6f2031548d433d18438042e9" title="remaining backoff time. If the backoff timer is interrupted, this variable holds...">remainingBackoff</a> &lt;&lt; endl;
<a name="l00987"></a>00987 
<a name="l00988"></a>00988             <span class="keywordflow">if</span>(channel.<a class="code" href="a00043.html#ab09e4515d5428b1287a62ec1bd1b01fe" title="Returns true if the channel is considered idle, meaning depends on the used decider...">isIdle</a>()) {
<a name="l00989"></a>00989               <a class="code" href="a00115.html#a59cb9e6071f33bc460a2f3a662c4bc59" title="Starts a channel sense request which sense the channel for the passed duration or...">senseChannelWhileIdle</a>(<a class="code" href="a00115.html#a4a9d1c8d45c46f18afa0f07f5b6572f4" title="current IFS value (DIFS or EIFS) If an error has been detected, the next backoff...">currentIFS</a> + <a class="code" href="a00115.html#a58484d1a6f2031548d433d18438042e9" title="remaining backoff time. If the backoff timer is interrupted, this variable holds...">remainingBackoff</a>);
<a name="l00990"></a>00990                 <span class="comment">//scheduleAt(simTime() + currentIFS + remainingBackoff, contention);</span>
<a name="l00991"></a>00991             }
<a name="l00992"></a>00992         }
<a name="l00993"></a>00993     }
<a name="l00994"></a>00994     <span class="keywordflow">else</span> {
<a name="l00995"></a>00995         <span class="comment">// post-xmit backoff (minor nit: if random backoff=0, we punt)</span>
<a name="l00996"></a>00996 
<a name="l00997"></a>00997         <span class="keywordflow">if</span>(<a class="code" href="a00115.html#a58484d1a6f2031548d433d18438042e9" title="remaining backoff time. If the backoff timer is interrupted, this variable holds...">remainingBackoff</a> &gt; 0 &amp;&amp; !<a class="code" href="a00115.html#a7bd4f3adc205b150f9fa406fa582f0b6" title="Used to sense if the channel is idle for contention periods.">contention</a>-&gt;isScheduled()) {
<a name="l00998"></a>00998           <a class="code" href="a00043.html" title="Provides information about the current state of the channel:.">ChannelState</a> channel = <a class="code" href="a00022.html#aa7b1e6bdb734765a9f4eff7d486dfbea" title="Handler to the physical layer.">phy</a>-&gt;<a class="code" href="a00119.html#affa30a25b96ffe387b22c68ca35f77a5" title="Returns the current state of the channel. See ChannelState for details.">getChannelState</a>();
<a name="l00999"></a>00999           debugEV &lt;&lt; simTime() &lt;&lt; <span class="stringliteral">&quot; do contention: medium = &quot;</span> &lt;&lt; channel.<a class="code" href="a00043.html#aa7125a711299c62119c5fe5bc3f43f1f" title="Output for this ChannelState.">info</a>() &lt;&lt; <span class="stringliteral">&quot;, backoff = &quot;</span>
<a name="l01000"></a>01000                &lt;&lt;  <a class="code" href="a00115.html#a58484d1a6f2031548d433d18438042e9" title="remaining backoff time. If the backoff timer is interrupted, this variable holds...">remainingBackoff</a> &lt;&lt; endl;
<a name="l01001"></a>01001 
<a name="l01002"></a>01002             <span class="keywordflow">if</span>(channel.<a class="code" href="a00043.html#ab09e4515d5428b1287a62ec1bd1b01fe" title="Returns true if the channel is considered idle, meaning depends on the used decider...">isIdle</a>()) {
<a name="l01003"></a>01003               <a class="code" href="a00115.html#a59cb9e6071f33bc460a2f3a662c4bc59" title="Starts a channel sense request which sense the channel for the passed duration or...">senseChannelWhileIdle</a>(<a class="code" href="a00115.html#a4a9d1c8d45c46f18afa0f07f5b6572f4" title="current IFS value (DIFS or EIFS) If an error has been detected, the next backoff...">currentIFS</a> + <a class="code" href="a00115.html#a58484d1a6f2031548d433d18438042e9" title="remaining backoff time. If the backoff timer is interrupted, this variable holds...">remainingBackoff</a>);
<a name="l01004"></a>01004                 <span class="comment">//scheduleAt(simTime() + currentIFS + remainingBackoff, contention);</span>
<a name="l01005"></a>01005             }
<a name="l01006"></a>01006         }
<a name="l01007"></a>01007         <a class="code" href="a00115.html#a9fc6eb078e53740d354f8ea7b9d94713" title="Sets the state, and produces a log message in between.">setState</a>(IDLE);
<a name="l01008"></a>01008     }
<a name="l01009"></a>01009 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa44171fa07d51ec487f7481740525466"></a><!-- doxytag: member="Mac80211::encapsMsg" ref="aa44171fa07d51ec487f7481740525466" args="(cPacket *netw)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">MacPkt * Mac80211::encapsMsg </td>
          <td>(</td>
          <td class="paramtype">cPacket *&nbsp;</td>
          <td class="paramname"> <em>netw</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>encapsulate packet </p>
<p>Encapsulates the received network-layer packet into a MacPkt and set all needed header fields. </p>

<p>Reimplemented from <a class="el" href="a00022.html#a32d47cbd6940c09071e0f0e777cf6716">BaseMacLayer</a>.</p>

<p>Definition at line <a class="el" href="a00337_source.html#l00207">207</a> of file <a class="el" href="a00337_source.html">Mac80211.cc</a>.</p>

<p>References <a class="el" href="a00338_source.html#l00342">fsc</a>, <a class="el" href="a00242_source.html#l00310">BaseMacLayer::getUpperDestinationFromControlInfo()</a>, and <a class="el" href="a00243_source.html#l00081">BaseMacLayer::myMacAddr</a>.</p>

<p>Referenced by <a class="el" href="a00337_source.html#l00170">handleUpperMsg()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00208"></a>00208 {
<a name="l00209"></a>00209 
<a name="l00210"></a>00210     Mac80211Pkt *pkt = <span class="keyword">new</span> Mac80211Pkt(netw-&gt;getName());
<a name="l00211"></a>00211     <span class="comment">// headerLength, including final CRC-field AND the phy header length!</span>
<a name="l00212"></a>00212     pkt-&gt;setBitLength(MAC80211_HEADER_LENGTH);
<a name="l00213"></a>00213     pkt-&gt;setRetry(<span class="keyword">false</span>);                 <span class="comment">// this is not a retry</span>
<a name="l00214"></a>00214     pkt-&gt;setSequenceControl(<a class="code" href="a00115.html#a026837b7167d230bbe79a1e0630c7578">fsc</a>++);       <span class="comment">// add a unique fsc to it</span>
<a name="l00215"></a>00215     <span class="keywordflow">if</span>(<a class="code" href="a00115.html#a026837b7167d230bbe79a1e0630c7578">fsc</a> &lt;= 0) <a class="code" href="a00115.html#a026837b7167d230bbe79a1e0630c7578">fsc</a> = 1;
<a name="l00216"></a>00216 
<a name="l00217"></a>00217     <span class="comment">// copy dest address from the Control Info attached to the network</span>
<a name="l00218"></a>00218     <span class="comment">// mesage by the network layer</span>
<a name="l00219"></a>00219     cObject *<span class="keyword">const</span> cInfo = netw-&gt;removeControlInfo();
<a name="l00220"></a>00220 
<a name="l00221"></a>00221     debugEV &lt;&lt; <span class="stringliteral">&quot;CInfo removed, mac addr=&quot;</span> &lt;&lt; <a class="code" href="a00022.html#a48135ffa21044a71d92149d5301f9deb" title="Extracts the MAC address from the &amp;quot;control info&amp;quot; structure (object).">getUpperDestinationFromControlInfo</a>(cInfo) &lt;&lt; endl;
<a name="l00222"></a>00222     pkt-&gt;setDestAddr(<a class="code" href="a00022.html#a48135ffa21044a71d92149d5301f9deb" title="Extracts the MAC address from the &amp;quot;control info&amp;quot; structure (object).">getUpperDestinationFromControlInfo</a>(cInfo));
<a name="l00223"></a>00223 
<a name="l00224"></a>00224     <span class="comment">//delete the control info</span>
<a name="l00225"></a>00225     <span class="keyword">delete</span> cInfo;
<a name="l00226"></a>00226 
<a name="l00227"></a>00227     <span class="comment">//set the src address to own mac address (nic module id())</span>
<a name="l00228"></a>00228     pkt-&gt;setSrcAddr(<a class="code" href="a00022.html#a8a26df9da07801d8ccb530530ef57ee2" title="MAC address.">myMacAddr</a>);
<a name="l00229"></a>00229 
<a name="l00230"></a>00230     <span class="comment">//encapsulate the network packet</span>
<a name="l00231"></a>00231     pkt-&gt;encapsulate(netw);
<a name="l00232"></a>00232     debugEV &lt;&lt;<span class="stringliteral">&quot;pkt encapsulated, length: &quot;</span> &lt;&lt; pkt-&gt;getBitLength() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00233"></a>00233 
<a name="l00234"></a>00234     <span class="keywordflow">return</span> pkt;
<a name="l00235"></a>00235 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a50cb85360462eb7d256ec8a0b493ca44"></a><!-- doxytag: member="Mac80211::handleACKframe" ref="a50cb85360462eb7d256ec8a0b493ca44" args="(Mac80211Pkt *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Mac80211::handleACKframe </td>
          <td>(</td>
          <td class="paramtype">Mac80211Pkt *&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Handle ACK and delete corresponding packet from queue </p>

<p>Definition at line <a class="el" href="a00337_source.html#l00569">569</a> of file <a class="el" href="a00337_source.html">Mac80211.cc</a>.</p>

<p>References <a class="el" href="a00337_source.html#l01014">backoff()</a>, <a class="el" href="a00337_source.html#l00959">beginNewCycle()</a>, <a class="el" href="a00338_source.html#l00301">fromUpperLayer</a>, <a class="el" href="a00338_source.html#l00308">longRetryCounter</a>, <a class="el" href="a00338_source.html#l00316">remainingBackoff</a>, <a class="el" href="a00338_source.html#l00311">shortRetryCounter</a>, and <a class="el" href="a00338_source.html#l00253">timeout</a>.</p>

<p>Referenced by <a class="el" href="a00337_source.html#l00445">handleMsgForMe()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00570"></a>00570 {
<a name="l00571"></a>00571     <span class="comment">// cancel time-out event</span>
<a name="l00572"></a>00572     cancelEvent(<a class="code" href="a00115.html#a2d31f97b0662b8e37f090c3b996cec82" title="Timer used for time-outs after the transmission of a RTS, a CTS, or a DATA packet...">timeout</a>);
<a name="l00573"></a>00573 
<a name="l00574"></a>00574     <span class="comment">// the transmission is acknowledged : initialize long_retry_counter</span>
<a name="l00575"></a>00575     <a class="code" href="a00115.html#a11fb608b3564e2d2cd41b463b1a8cc90" title="Number of frame transmission attempt.">longRetryCounter</a> = 0;
<a name="l00576"></a>00576     <a class="code" href="a00115.html#a9bbc3d71eddb62c4e12dcd500a58b0bb" title="Number of frame transmission attempt.">shortRetryCounter</a> = 0;
<a name="l00577"></a>00577     <span class="comment">// post transmit backoff</span>
<a name="l00578"></a>00578     <a class="code" href="a00115.html#a58484d1a6f2031548d433d18438042e9" title="remaining backoff time. If the backoff timer is interrupted, this variable holds...">remainingBackoff</a> = <a class="code" href="a00115.html#ade2c913df312fd4fc46106c1134889b8" title="Compute a backoff value.">backoff</a>();
<a name="l00579"></a>00579     <span class="comment">// removes the acknowledged packet from the queue</span>
<a name="l00580"></a>00580     Mac80211Pkt *temp = <a class="code" href="a00115.html#a969e8e3a592dffccea28596c61b2af50" title="Buffering of messages from upper layer.">fromUpperLayer</a>.front();
<a name="l00581"></a>00581     <a class="code" href="a00115.html#a969e8e3a592dffccea28596c61b2af50" title="Buffering of messages from upper layer.">fromUpperLayer</a>.pop_front();
<a name="l00582"></a>00582     <span class="keyword">delete</span> temp;
<a name="l00583"></a>00583 
<a name="l00584"></a>00584     <span class="comment">// if thre&apos;s a packet to send and if the channel is free then start a new contention period</span>
<a name="l00585"></a>00585     <a class="code" href="a00115.html#ab3030c86acac78401f877a61cefcdad6" title="start a new contention period">beginNewCycle</a>();
<a name="l00586"></a>00586 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="adfcf8b7a5e1db233a1bd717cecaf49bd"></a><!-- doxytag: member="Mac80211::handleBroadcastMsg" ref="adfcf8b7a5e1db233a1bd717cecaf49bd" args="(Mac80211Pkt *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Mac80211::handleBroadcastMsg </td>
          <td>(</td>
          <td class="paramtype">Mac80211Pkt *&nbsp;</td>
          <td class="paramname"> <em>af</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Handle a broadcast packet. This packet is simply passed to the upper layer. No acknowledgement is needed. Called by handleLowerMsg(Mac80211Pkt *af) </p>

<p>Definition at line <a class="el" href="a00337_source.html#l00611">611</a> of file <a class="el" href="a00337_source.html">Mac80211.cc</a>.</p>

<p>References <a class="el" href="a00337_source.html#l00959">beginNewCycle()</a>, <a class="el" href="a00338_source.html#l00260">contention</a>, <a class="el" href="a00337_source.html#l00237">decapsMsg()</a>, <a class="el" href="a00240_source.html#l00115">BaseLayer::sendUp()</a>, <a class="el" href="a00338_source.html#l00271">state</a>, and <a class="el" href="a00338_source.html#l00339">switching</a>.</p>

<p>Referenced by <a class="el" href="a00337_source.html#l00250">handleLowerMsg()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00612"></a>00612 {
<a name="l00613"></a>00613   debugEV &lt;&lt; <span class="stringliteral">&quot;handle broadcast\n&quot;</span>;
<a name="l00614"></a>00614     <span class="keywordflow">if</span>((<a class="code" href="a00115.html#a56fa75f3eb056ae29b1a4b8da0035d8c" title="Current state of the MAC.">state</a> == BUSY) &amp;&amp; (!<a class="code" href="a00115.html#a9f9f566e85a76f63e63b5907bf9ad48a">switching</a>)) {
<a name="l00615"></a>00615         error(<span class="stringliteral">&quot;logic error: node is currently transmitting, can not receive &quot;</span>
<a name="l00616"></a>00616               <span class="stringliteral">&quot;(does the physical layer do its job correctly?)&quot;</span>);
<a name="l00617"></a>00617     }
<a name="l00618"></a>00618     <a class="code" href="a00021.html#adbf061566606041db811b519f0400ed5" title="Sends a message to the upper layer.">sendUp</a>(<a class="code" href="a00115.html#a538f710b1bd35d7c653763830f43085c" title="decapsulate packet">decapsMsg</a>(af));
<a name="l00619"></a>00619     <span class="keyword">delete</span> af;
<a name="l00620"></a>00620     <span class="keywordflow">if</span> (<a class="code" href="a00115.html#a56fa75f3eb056ae29b1a4b8da0035d8c" title="Current state of the MAC.">state</a> == CONTEND) {
<a name="l00621"></a>00621       assert(!<a class="code" href="a00115.html#a7bd4f3adc205b150f9fa406fa582f0b6" title="Used to sense if the channel is idle for contention periods.">contention</a>-&gt;isScheduled());
<a name="l00622"></a>00622     <span class="comment">//suspendContention();</span>
<a name="l00623"></a>00623 
<a name="l00624"></a>00624         <a class="code" href="a00115.html#ab3030c86acac78401f877a61cefcdad6" title="start a new contention period">beginNewCycle</a>();
<a name="l00625"></a>00625     }
<a name="l00626"></a>00626 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae1e17af7dddc261d7947d48a1f4d0e21"></a><!-- doxytag: member="Mac80211::handleCTSframe" ref="ae1e17af7dddc261d7947d48a1f4d0e21" args="(Mac80211Pkt *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Mac80211::handleCTSframe </td>
          <td>(</td>
          <td class="paramtype">Mac80211Pkt *&nbsp;</td>
          <td class="paramname"> <em>af</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Handle a CTS frame. Called by HandleMsgForMe(Mac80211Pkt* af) </p>

<p>Definition at line <a class="el" href="a00337_source.html#l00592">592</a> of file <a class="el" href="a00337_source.html">Mac80211.cc</a>.</p>

<p>References <a class="el" href="a00338_source.html#l00263">endSifs</a>, <a class="el" href="a00240_source.html#l00130">BaseLayer::sendControlDown()</a>, <a class="el" href="a00338_source.html#l00311">shortRetryCounter</a>, and <a class="el" href="a00338_source.html#l00253">timeout</a>.</p>

<p>Referenced by <a class="el" href="a00337_source.html#l00445">handleMsgForMe()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00593"></a>00593 {
<a name="l00594"></a>00594     <span class="comment">// cancel time-out event</span>
<a name="l00595"></a>00595     cancelEvent(<a class="code" href="a00115.html#a2d31f97b0662b8e37f090c3b996cec82" title="Timer used for time-outs after the transmission of a RTS, a CTS, or a DATA packet...">timeout</a>);
<a name="l00596"></a>00596     <a class="code" href="a00115.html#a9bbc3d71eddb62c4e12dcd500a58b0bb" title="Number of frame transmission attempt.">shortRetryCounter</a> = 0;
<a name="l00597"></a>00597     <span class="comment">// wait a short interframe space</span>
<a name="l00598"></a>00598     <span class="keywordflow">if</span>(<a class="code" href="a00115.html#ace80836b6fcb1681f6b2d49466f87fb0" title="Timer used to indicate the end of a SIFS.">endSifs</a>-&gt;isScheduled()) error(<span class="stringliteral">&quot;Mac80211::handleCTSframe when SIFS scheduled&quot;</span>);
<a name="l00599"></a>00599     <a class="code" href="a00115.html#ace80836b6fcb1681f6b2d49466f87fb0" title="Timer used to indicate the end of a SIFS.">endSifs</a>-&gt;setContextPointer(af);
<a name="l00600"></a>00600 
<a name="l00601"></a>00601     <a class="code" href="a00021.html#a6d01a0f56978740d7617c2e338858cc3" title="Sends a control message to a lower layer.">sendControlDown</a>(<a class="code" href="a00115.html#ace80836b6fcb1681f6b2d49466f87fb0" title="Timer used to indicate the end of a SIFS.">endSifs</a>);
<a name="l00602"></a>00602     <span class="comment">//scheduleAt(simTime() + SIFS, endSifs);</span>
<a name="l00603"></a>00603 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab0844f9dbcece750c9a58ca9f0a73fe1"></a><!-- doxytag: member="Mac80211::handleDATAframe" ref="ab0844f9dbcece750c9a58ca9f0a73fe1" args="(Mac80211Pkt *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Mac80211::handleDATAframe </td>
          <td>(</td>
          <td class="paramtype">Mac80211Pkt *&nbsp;</td>
          <td class="paramname"> <em>af</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Handle a frame which expected to be a DATA frame. Called by HandleMsgForMe() </p>

<p>Definition at line <a class="el" href="a00337_source.html#l00542">542</a> of file <a class="el" href="a00337_source.html">Mac80211.cc</a>.</p>

<p>References <a class="el" href="a00337_source.html#l00237">decapsMsg()</a>, <a class="el" href="a00338_source.html#l00263">endSifs</a>, <a class="el" href="a00338_source.html#l00211">findNeighbor()</a>, <a class="el" href="a00338_source.html#l00336">neighbors</a>, <a class="el" href="a00338_source.html#l00197">rtsCts()</a>, <a class="el" href="a00240_source.html#l00130">BaseLayer::sendControlDown()</a>, <a class="el" href="a00240_source.html#l00115">BaseLayer::sendUp()</a>, and <a class="el" href="a00338_source.html#l00253">timeout</a>.</p>

<p>Referenced by <a class="el" href="a00337_source.html#l00445">handleMsgForMe()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00543"></a>00543 {
<a name="l00544"></a>00544     NeighborList::iterator it;
<a name="l00545"></a>00545     <span class="keywordflow">if</span> (<a class="code" href="a00115.html#aa316943080d714ffc3c0bf54ea8aeb08" title="Check whether the next packet should be send with RTS/CTS.">rtsCts</a>(af)) cancelEvent(<a class="code" href="a00115.html#a2d31f97b0662b8e37f090c3b996cec82" title="Timer used for time-outs after the transmission of a RTS, a CTS, or a DATA packet...">timeout</a>);  <span class="comment">// cancel time-out event</span>
<a name="l00546"></a>00546     it = <a class="code" href="a00115.html#aaf9d15b3d9055b2f56d4eddce7cc9850" title="find a neighbor based on his address">findNeighbor</a>(af-&gt;getSrcAddr());
<a name="l00547"></a>00547     <span class="keywordflow">if</span>(it == <a class="code" href="a00115.html#a4caf1f3c2c004851555c9c691b82edf9" title="A list of this hosts neighbors.">neighbors</a>.end()) error(<span class="stringliteral">&quot;Mac80211::handleDATAframe: neighbor not registered&quot;</span>);
<a name="l00548"></a>00548     <span class="keywordflow">if</span>(af-&gt;getRetry() &amp;&amp; (it-&gt;fsc == af-&gt;getSequenceControl())) {
<a name="l00549"></a>00549       debugEV &lt;&lt; <span class="stringliteral">&quot;Mac80211::handleDATAframe suppressed duplicate message &quot;</span> &lt;&lt; af
<a name="l00550"></a>00550            &lt;&lt; <span class="stringliteral">&quot; fsc: &quot;</span> &lt;&lt; it-&gt;fsc &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00551"></a>00551     }
<a name="l00552"></a>00552     <span class="keywordflow">else</span> {
<a name="l00553"></a>00553         it-&gt;fsc = af-&gt;getSequenceControl();
<a name="l00554"></a>00554         <span class="comment">// pass the packet to the upper layer</span>
<a name="l00555"></a>00555         <a class="code" href="a00021.html#adbf061566606041db811b519f0400ed5" title="Sends a message to the upper layer.">sendUp</a>(<a class="code" href="a00115.html#a538f710b1bd35d7c653763830f43085c" title="decapsulate packet">decapsMsg</a>(af));
<a name="l00556"></a>00556     }
<a name="l00557"></a>00557     <span class="comment">// wait a short interframe space</span>
<a name="l00558"></a>00558     <span class="keywordflow">if</span>(<a class="code" href="a00115.html#ace80836b6fcb1681f6b2d49466f87fb0" title="Timer used to indicate the end of a SIFS.">endSifs</a>-&gt;isScheduled()) error(<span class="stringliteral">&quot;Mac80211::handleDATAframe when SIFS scheduled&quot;</span>);
<a name="l00559"></a>00559     <a class="code" href="a00115.html#ace80836b6fcb1681f6b2d49466f87fb0" title="Timer used to indicate the end of a SIFS.">endSifs</a>-&gt;setContextPointer(af);
<a name="l00560"></a>00560 
<a name="l00561"></a>00561     <a class="code" href="a00021.html#a6d01a0f56978740d7617c2e338858cc3" title="Sends a control message to a lower layer.">sendControlDown</a>(<a class="code" href="a00115.html#ace80836b6fcb1681f6b2d49466f87fb0" title="Timer used to indicate the end of a SIFS.">endSifs</a>);
<a name="l00562"></a>00562     <span class="comment">//scheduleAt(simTime() + SIFS, endSifs);</span>
<a name="l00563"></a>00563 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0a87fa1791117ef1dd1841ba217e4245"></a><!-- doxytag: member="Mac80211::handleEndContentionTimer" ref="a0a87fa1791117ef1dd1841ba217e4245" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Mac80211::handleEndContentionTimer </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>handle end of contention </p>
<p>The node has won the contention, and is now allowed to send an RTS/DATA or Broadcast packet. The backoff value is deleted and will be newly computed in the next contention period </p>

<p>Definition at line <a class="el" href="a00337_source.html#l00634">634</a> of file <a class="el" href="a00337_source.html">Mac80211.cc</a>.</p>

<p>References <a class="el" href="a00338_source.html#l00260">contention</a>, <a class="el" href="a00338_source.html#l00301">fromUpperLayer</a>, <a class="el" href="a00338_source.html#l00298">nextIsBroadcast</a>, <a class="el" href="a00243_source.html#l00068">BaseMacLayer::phy</a>, <a class="el" href="a00338_source.html#l00316">remainingBackoff</a>, <a class="el" href="a00338_source.html#l00197">rtsCts()</a>, <a class="el" href="a00337_source.html#l00935">sendBROADCASTframe()</a>, <a class="el" href="a00337_source.html#l00803">sendDATAframe()</a>, <a class="el" href="a00337_source.html#l00867">sendRTSframe()</a>, <a class="el" href="a00119.html#ad25abbad9aa16bdbf24bf1dd582b1c6f">MacToPhyInterface::setRadioState()</a>, <a class="el" href="a00338_source.html#l00271">state</a>, <a class="el" href="a00337_source.html#l01139">suspendContention()</a>, and <a class="el" href="a00278_source.html#l00208">Radio::TX</a>.</p>

<p>Referenced by <a class="el" href="a00337_source.html#l00278">handleLowerControl()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00635"></a>00635 {
<a name="l00636"></a>00636   <span class="keywordflow">if</span>(!<a class="code" href="a00115.html#a7bd4f3adc205b150f9fa406fa582f0b6" title="Used to sense if the channel is idle for contention periods.">contention</a>-&gt;getResult().isIdle()) {
<a name="l00637"></a>00637     <a class="code" href="a00115.html#a9ae0815a0e01c4d4fd13a87393f837a8" title="suspend an ongoing contention, pick it up again when the channel becomes idle">suspendContention</a>();
<a name="l00638"></a>00638     <span class="keywordflow">return</span>;
<a name="l00639"></a>00639   }
<a name="l00640"></a>00640 
<a name="l00641"></a>00641     <span class="keywordflow">if</span>(<a class="code" href="a00115.html#a56fa75f3eb056ae29b1a4b8da0035d8c" title="Current state of the MAC.">state</a> == IDLE) {
<a name="l00642"></a>00642         <a class="code" href="a00115.html#a58484d1a6f2031548d433d18438042e9" title="remaining backoff time. If the backoff timer is interrupted, this variable holds...">remainingBackoff</a> = 0;
<a name="l00643"></a>00643     }
<a name="l00644"></a>00644     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="a00115.html#a56fa75f3eb056ae29b1a4b8da0035d8c" title="Current state of the MAC.">state</a> == CONTEND) {
<a name="l00645"></a>00645         <span class="comment">// the node has won the channel, the backoff window is deleted and</span>
<a name="l00646"></a>00646         <span class="comment">// will be new calculated in the next contention period</span>
<a name="l00647"></a>00647         <a class="code" href="a00115.html#a58484d1a6f2031548d433d18438042e9" title="remaining backoff time. If the backoff timer is interrupted, this variable holds...">remainingBackoff</a> = 0;
<a name="l00648"></a>00648         <span class="comment">// unicast packet</span>
<a name="l00649"></a>00649         <a class="code" href="a00022.html#aa7b1e6bdb734765a9f4eff7d486dfbea" title="Handler to the physical layer.">phy</a>-&gt;<a class="code" href="a00119.html#ad25abbad9aa16bdbf24bf1dd582b1c6f" title="Tells the BasePhyLayer to switch to the specified radio state.">setRadioState</a>(<a class="code" href="a00158.html#a7314de88eaecfa054e682ccc84ef0ffaa55eab2480eb0876c6b76dc0df92882f7" title="transmitting state">Radio::TX</a>);
<a name="l00650"></a>00650         <span class="keywordflow">if</span> (!<a class="code" href="a00115.html#a5d8e9b53c8d6cb0116feed506d843e18" title="Boolean used to know if the next packet is a broadcast packet.">nextIsBroadcast</a>)
<a name="l00651"></a>00651         {
<a name="l00652"></a>00652             <span class="keywordflow">if</span>(<a class="code" href="a00115.html#aa316943080d714ffc3c0bf54ea8aeb08" title="Check whether the next packet should be send with RTS/CTS.">rtsCts</a>(<a class="code" href="a00115.html#a969e8e3a592dffccea28596c61b2af50" title="Buffering of messages from upper layer.">fromUpperLayer</a>.front())) {
<a name="l00653"></a>00653                 <span class="comment">// send a RTS</span>
<a name="l00654"></a>00654                 <a class="code" href="a00115.html#a3104750758ab171b20ffcfeae0079a78" title="send RTS frame">sendRTSframe</a>();
<a name="l00655"></a>00655             }
<a name="l00656"></a>00656             <span class="keywordflow">else</span> {
<a name="l00657"></a>00657                 <a class="code" href="a00115.html#a7a4ff22b4b999827a898794923115880" title="send data frame">sendDATAframe</a>(0);
<a name="l00658"></a>00658             }
<a name="l00659"></a>00659         }<span class="comment">// broadcast packet</span>
<a name="l00660"></a>00660         <span class="keywordflow">else</span> {
<a name="l00661"></a>00661             <a class="code" href="a00115.html#a26b30d048980b56d79c04e859bfce009" title="send broadcast frame">sendBROADCASTframe</a>();
<a name="l00662"></a>00662             <span class="comment">// removes the packet from the queue without waiting for an acknowledgement</span>
<a name="l00663"></a>00663             Mac80211Pkt *temp = <a class="code" href="a00115.html#a969e8e3a592dffccea28596c61b2af50" title="Buffering of messages from upper layer.">fromUpperLayer</a>.front();
<a name="l00664"></a>00664             <a class="code" href="a00115.html#a969e8e3a592dffccea28596c61b2af50" title="Buffering of messages from upper layer.">fromUpperLayer</a>.pop_front();
<a name="l00665"></a>00665             <span class="keyword">delete</span>(temp);
<a name="l00666"></a>00666         }
<a name="l00667"></a>00667     }
<a name="l00668"></a>00668     <span class="keywordflow">else</span> {
<a name="l00669"></a>00669         error(<span class="stringliteral">&quot;logic error: expiration of the contention timer outside of CONTEND/IDLE state, should not happen&quot;</span>);
<a name="l00670"></a>00670     }
<a name="l00671"></a>00671 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7d36a55827a7ea91b2539c86d79349af"></a><!-- doxytag: member="Mac80211::handleEndSifsTimer" ref="a7d36a55827a7ea91b2539c86d79349af" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Mac80211::handleEndSifsTimer </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>handle end of SIFS </p>
<p>Handle the end sifs timer. Then sends a CTS, a DATA, or an ACK frame </p>

<p>Definition at line <a class="el" href="a00337_source.html#l00741">741</a> of file <a class="el" href="a00337_source.html">Mac80211.cc</a>.</p>

<p>References <a class="el" href="a00338_source.html#l00263">endSifs</a>, <a class="el" href="a00338_source.html#l00301">fromUpperLayer</a>, <a class="el" href="a00243_source.html#l00068">BaseMacLayer::phy</a>, <a class="el" href="a00337_source.html#l00839">sendACKframe()</a>, <a class="el" href="a00337_source.html#l00904">sendCTSframe()</a>, <a class="el" href="a00337_source.html#l00803">sendDATAframe()</a>, <a class="el" href="a00119.html#ad25abbad9aa16bdbf24bf1dd582b1c6f">MacToPhyInterface::setRadioState()</a>, <a class="el" href="a00337_source.html#l01130">setState()</a>, and <a class="el" href="a00278_source.html#l00208">Radio::TX</a>.</p>

<p>Referenced by <a class="el" href="a00337_source.html#l00278">handleLowerControl()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00742"></a>00742 {
<a name="l00743"></a>00743   <span class="keywordflow">if</span>(!<a class="code" href="a00115.html#ace80836b6fcb1681f6b2d49466f87fb0" title="Timer used to indicate the end of a SIFS.">endSifs</a>-&gt;getResult().isIdle()){
<a name="l00744"></a>00744     <span class="comment">// delete the previously received frame</span>
<a name="l00745"></a>00745     <span class="keyword">delete</span> <span class="keyword">static_cast&lt;</span>Mac80211Pkt *<span class="keyword">&gt;</span>(<a class="code" href="a00115.html#ace80836b6fcb1681f6b2d49466f87fb0" title="Timer used to indicate the end of a SIFS.">endSifs</a>-&gt;getContextPointer());
<a name="l00746"></a>00746 
<a name="l00747"></a>00747     <span class="comment">// state in now IDLE or CONTEND</span>
<a name="l00748"></a>00748     <span class="keywordflow">if</span> (<a class="code" href="a00115.html#a969e8e3a592dffccea28596c61b2af50" title="Buffering of messages from upper layer.">fromUpperLayer</a>.empty())
<a name="l00749"></a>00749       <a class="code" href="a00115.html#a9fc6eb078e53740d354f8ea7b9d94713" title="Sets the state, and produces a log message in between.">setState</a>(IDLE);
<a name="l00750"></a>00750     <span class="keywordflow">else</span>
<a name="l00751"></a>00751       <a class="code" href="a00115.html#a9fc6eb078e53740d354f8ea7b9d94713" title="Sets the state, and produces a log message in between.">setState</a>(CONTEND);
<a name="l00752"></a>00752 
<a name="l00753"></a>00753     <span class="keywordflow">return</span>;
<a name="l00754"></a>00754   }
<a name="l00755"></a>00755 
<a name="l00756"></a>00756     Mac80211Pkt *frame = <span class="keyword">static_cast&lt;</span>Mac80211Pkt *<span class="keyword">&gt;</span>(<a class="code" href="a00115.html#ace80836b6fcb1681f6b2d49466f87fb0" title="Timer used to indicate the end of a SIFS.">endSifs</a>-&gt;getContextPointer());
<a name="l00757"></a>00757     <a class="code" href="a00022.html#aa7b1e6bdb734765a9f4eff7d486dfbea" title="Handler to the physical layer.">phy</a>-&gt;<a class="code" href="a00119.html#ad25abbad9aa16bdbf24bf1dd582b1c6f" title="Tells the BasePhyLayer to switch to the specified radio state.">setRadioState</a>(<a class="code" href="a00158.html#a7314de88eaecfa054e682ccc84ef0ffaa55eab2480eb0876c6b76dc0df92882f7" title="transmitting state">Radio::TX</a>);
<a name="l00758"></a>00758     <span class="keywordflow">switch</span> (frame-&gt;getKind())
<a name="l00759"></a>00759     {
<a name="l00760"></a>00760     <span class="keywordflow">case</span> RTS:
<a name="l00761"></a>00761         <a class="code" href="a00115.html#a1fd59a589e53facb68c13be84521a49e" title="send CTS frame">sendCTSframe</a>(frame);
<a name="l00762"></a>00762         <span class="keywordflow">break</span>;
<a name="l00763"></a>00763     <span class="keywordflow">case</span> CTS:
<a name="l00764"></a>00764         <a class="code" href="a00115.html#a7a4ff22b4b999827a898794923115880" title="send data frame">sendDATAframe</a>(frame);
<a name="l00765"></a>00765         <span class="keywordflow">break</span>;
<a name="l00766"></a>00766     <span class="keywordflow">case</span> DATA:
<a name="l00767"></a>00767         <a class="code" href="a00115.html#a1c404a5176db493c2fefb71537783607" title="send Acknoledgement">sendACKframe</a>(frame);
<a name="l00768"></a>00768         <span class="keywordflow">break</span>;
<a name="l00769"></a>00769     <span class="keywordflow">default</span>:
<a name="l00770"></a>00770         error(<span class="stringliteral">&quot;logic error: end sifs timer when previously received packet is not RTS/CTS/DATA&quot;</span>);
<a name="l00771"></a>00771         <span class="keywordflow">break</span>;
<a name="l00772"></a>00772     }
<a name="l00773"></a>00773 
<a name="l00774"></a>00774     <span class="comment">// don&apos;t need previous frame any more</span>
<a name="l00775"></a>00775     <span class="keyword">delete</span> frame;
<a name="l00776"></a>00776 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="afe4300147d9ea5e4d3e3d8c98ff20436"></a><!-- doxytag: member="Mac80211::handleEndTransmission" ref="afe4300147d9ea5e4d3e3d8c98ff20436" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Mac80211::handleEndTransmission </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>handle the end of a transmission... </p>
<p>Handle the end of transmission timer (end of the transmission of an ACK or a broadcast packet). Called by HandleTimer(cMessage* msg) </p>

<p>Definition at line <a class="el" href="a00337_source.html#l00783">783</a> of file <a class="el" href="a00337_source.html">Mac80211.cc</a>.</p>

<p>References <a class="el" href="a00337_source.html#l01014">backoff()</a>, <a class="el" href="a00337_source.html#l00959">beginNewCycle()</a>, <a class="el" href="a00338_source.html#l00308">longRetryCounter</a>, <a class="el" href="a00338_source.html#l00298">nextIsBroadcast</a>, <a class="el" href="a00338_source.html#l00316">remainingBackoff</a>, <a class="el" href="a00338_source.html#l00311">shortRetryCounter</a>, and <a class="el" href="a00338_source.html#l00271">state</a>.</p>

<p>Referenced by <a class="el" href="a00337_source.html#l00278">handleLowerControl()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00784"></a>00784 {
<a name="l00785"></a>00785   debugEV &lt;&lt; <span class="stringliteral">&quot;transmission of packet is over\n&quot;</span>;
<a name="l00786"></a>00786     <span class="keywordflow">if</span>(<a class="code" href="a00115.html#a56fa75f3eb056ae29b1a4b8da0035d8c" title="Current state of the MAC.">state</a> == BUSY) {
<a name="l00787"></a>00787         <span class="keywordflow">if</span>(<a class="code" href="a00115.html#a5d8e9b53c8d6cb0116feed506d843e18" title="Boolean used to know if the next packet is a broadcast packet.">nextIsBroadcast</a>) {
<a name="l00788"></a>00788             <a class="code" href="a00115.html#a9bbc3d71eddb62c4e12dcd500a58b0bb" title="Number of frame transmission attempt.">shortRetryCounter</a> = 0;
<a name="l00789"></a>00789             <a class="code" href="a00115.html#a11fb608b3564e2d2cd41b463b1a8cc90" title="Number of frame transmission attempt.">longRetryCounter</a> = 0;
<a name="l00790"></a>00790             <a class="code" href="a00115.html#a58484d1a6f2031548d433d18438042e9" title="remaining backoff time. If the backoff timer is interrupted, this variable holds...">remainingBackoff</a> = <a class="code" href="a00115.html#ade2c913df312fd4fc46106c1134889b8" title="Compute a backoff value.">backoff</a>();
<a name="l00791"></a>00791         }
<a name="l00792"></a>00792         <a class="code" href="a00115.html#ab3030c86acac78401f877a61cefcdad6" title="start a new contention period">beginNewCycle</a>();
<a name="l00793"></a>00793     }
<a name="l00794"></a>00794     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="a00115.html#a56fa75f3eb056ae29b1a4b8da0035d8c" title="Current state of the MAC.">state</a> == WFDATA) {
<a name="l00795"></a>00795       <a class="code" href="a00115.html#ab3030c86acac78401f877a61cefcdad6" title="start a new contention period">beginNewCycle</a>();
<a name="l00796"></a>00796     }
<a name="l00797"></a>00797 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac8bfb04590aab2434bd8d17ee4e213d9"></a><!-- doxytag: member="Mac80211::handleLowerMsg" ref="ac8bfb04590aab2434bd8d17ee4e213d9" args="(cMessage *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Mac80211::handleLowerMsg </td>
          <td>(</td>
          <td class="paramtype">cMessage *&nbsp;</td>
          <td class="paramname"> <em>msg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Handle messages from lower layer. </p>
<p>Handle all messages from lower layer. Checks the destination MAC adress of the packet. Then calls one of the three functions : <a class="el" href="a00115.html#a0377ddefba33b8d50c7bf4045354d7bb" title="handle a message that is not for me or errornous">handleMsgNotForMe()</a>, <a class="el" href="a00115.html#adfcf8b7a5e1db233a1bd717cecaf49bd">handleBroadcastMsg()</a>, or <a class="el" href="a00115.html#aa0b767642d86d3b66f1d3258065fe5ae" title="handle a message that was meant for me">handleMsgForMe()</a>. Called by <a class="el" href="a00021.html#a8039dac8d02052c97c1fcc209910fdde" title="Called every time a message arrives.">handleMessage()</a>. </p>

<p>Reimplemented from <a class="el" href="a00022.html#a413375cec02b990a521b62086a02264c">BaseMacLayer</a>.</p>

<p>Definition at line <a class="el" href="a00337_source.html#l00250">250</a> of file <a class="el" href="a00337_source.html">Mac80211.cc</a>.</p>

<p>References <a class="el" href="a00337_source.html#l01203">addNeighbor()</a>, <a class="el" href="a00338_source.html#l00260">contention</a>, <a class="el" href="a00338_source.html#l00321">currentIFS</a>, <a class="el" href="a00119.html#a00dd43576b4da205117d53bd3baadc71">MacToPhyInterface::getRadioState()</a>, <a class="el" href="a00337_source.html#l00611">handleBroadcastMsg()</a>, <a class="el" href="a00337_source.html#l00445">handleMsgForMe()</a>, <a class="el" href="a00337_source.html#l00363">handleMsgNotForMe()</a>, <a class="el" href="a00295_source.html#l00074">LAddress::isL2Broadcast()</a>, <a class="el" href="a00243_source.html#l00081">BaseMacLayer::myMacAddr</a>, <a class="el" href="a00243_source.html#l00068">BaseMacLayer::phy</a>, and <a class="el" href="a00278_source.html#l00206">Radio::RX</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00251"></a>00251 {
<a name="l00252"></a>00252     Mac80211Pkt *af = <span class="keyword">static_cast&lt;</span>Mac80211Pkt *<span class="keyword">&gt;</span>(msg);
<a name="l00253"></a>00253     <span class="keywordtype">int</span> radioState = <a class="code" href="a00022.html#aa7b1e6bdb734765a9f4eff7d486dfbea" title="Handler to the physical layer.">phy</a>-&gt;<a class="code" href="a00119.html#a00dd43576b4da205117d53bd3baadc71" title="Returns the current state the radio is in. See RadioState for possible values.">getRadioState</a>();
<a name="l00254"></a>00254     <span class="keywordflow">if</span>(radioState == <a class="code" href="a00158.html#a7314de88eaecfa054e682ccc84ef0ffaa0a9f9ba2fd83cf0f5f4eaf4f32d6a9c1" title="receiving state">Radio::RX</a>) {
<a name="l00255"></a>00255         <span class="comment">// end of the reception</span>
<a name="l00256"></a>00256         debugEV &lt;&lt; <span class="stringliteral">&quot; handleLowerMsg frame &quot;</span> &lt;&lt; af &lt;&lt; <span class="stringliteral">&quot; received from &quot;</span> &lt;&lt; af-&gt;getSrcAddr() &lt;&lt; <span class="stringliteral">&quot; addressed to &quot;</span> &lt;&lt; af-&gt;getDestAddr() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00257"></a>00257         <a class="code" href="a00115.html#a8dd543a1a0b89f98af6d39d28dbd9e74" title="add a new entry to the neighbor list">addNeighbor</a>(af);
<a name="l00258"></a>00258         <span class="keywordflow">if</span> (<a class="code" href="a00115.html#a7bd4f3adc205b150f9fa406fa582f0b6" title="Used to sense if the channel is idle for contention periods.">contention</a>-&gt;isScheduled()) {
<a name="l00259"></a>00259             error(<span class="stringliteral">&quot;Gaack! I am changing the IFS on an ongoing contention&quot;</span>);
<a name="l00260"></a>00260         }
<a name="l00261"></a>00261         <a class="code" href="a00115.html#a4a9d1c8d45c46f18afa0f07f5b6572f4" title="current IFS value (DIFS or EIFS) If an error has been detected, the next backoff...">currentIFS</a> = DIFS;
<a name="l00262"></a>00262         <span class="keywordflow">if</span>(af-&gt;getDestAddr() == <a class="code" href="a00022.html#a8a26df9da07801d8ccb530530ef57ee2" title="MAC address.">myMacAddr</a>) {
<a name="l00263"></a>00263             <a class="code" href="a00115.html#aa0b767642d86d3b66f1d3258065fe5ae" title="handle a message that was meant for me">handleMsgForMe</a>(af);
<a name="l00264"></a>00264         }
<a name="l00265"></a>00265         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="a00105.html#a3890f1c7314c5695e32252468e6bd5a5" title="Test if a L2 address (pSrcAddr) is a broadcast address.">LAddress::isL2Broadcast</a>(af-&gt;getDestAddr())) {
<a name="l00266"></a>00266             <a class="code" href="a00115.html#adfcf8b7a5e1db233a1bd717cecaf49bd">handleBroadcastMsg</a>(af);
<a name="l00267"></a>00267         }
<a name="l00268"></a>00268         <span class="keywordflow">else</span> {
<a name="l00269"></a>00269             <a class="code" href="a00115.html#a0377ddefba33b8d50c7bf4045354d7bb" title="handle a message that is not for me or errornous">handleMsgNotForMe</a>(af, af-&gt;getDuration());
<a name="l00270"></a>00270         }
<a name="l00271"></a>00271     }
<a name="l00272"></a>00272     <span class="keywordflow">else</span> {
<a name="l00273"></a>00273       debugEV &lt;&lt; <span class="stringliteral">&quot; handleLowerMsg frame &quot;</span> &lt;&lt; af &lt;&lt; <span class="stringliteral">&quot; deleted, strange race condition\n&quot;</span>;
<a name="l00274"></a>00274         <span class="keyword">delete</span> af;
<a name="l00275"></a>00275     }
<a name="l00276"></a>00276 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa0b767642d86d3b66f1d3258065fe5ae"></a><!-- doxytag: member="Mac80211::handleMsgForMe" ref="aa0b767642d86d3b66f1d3258065fe5ae" args="(Mac80211Pkt *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Mac80211::handleMsgForMe </td>
          <td>(</td>
          <td class="paramtype">Mac80211Pkt *&nbsp;</td>
          <td class="paramname"> <em>af</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>handle a message that was meant for me </p>
<p>Handle a packet for the node. The result of this reception is a function of the type of the received message (RTS,CTS,DATA, or ACK), and of the current state of the MAC (WFDATA, CONTEND, IDLE, WFCTS, or WFACK). Called by <a class="el" href="a00115.html#ac8bfb04590aab2434bd8d17ee4e213d9" title="Handle messages from lower layer.">handleLowerMsg()</a> </p>

<p>Definition at line <a class="el" href="a00337_source.html#l00445">445</a> of file <a class="el" href="a00337_source.html">Mac80211.cc</a>.</p>

<p>References <a class="el" href="a00338_source.html#l00260">contention</a>, <a class="el" href="a00337_source.html#l00569">handleACKframe()</a>, <a class="el" href="a00337_source.html#l00592">handleCTSframe()</a>, <a class="el" href="a00337_source.html#l00542">handleDATAframe()</a>, <a class="el" href="a00337_source.html#l00527">handleRTSframe()</a>, <a class="el" href="a00338_source.html#l00271">state</a>, <a class="el" href="a00337_source.html#l01112">stateName()</a>, and <a class="el" href="a00338_source.html#l00339">switching</a>.</p>

<p>Referenced by <a class="el" href="a00337_source.html#l00250">handleLowerMsg()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00446"></a>00446 {
<a name="l00447"></a>00447   debugEV &lt;&lt; <span class="stringliteral">&quot;handle msg for me &quot;</span> &lt;&lt; af-&gt;getName() &lt;&lt; <span class="stringliteral">&quot; in &quot;</span> &lt;&lt;  <a class="code" href="a00115.html#ade8a90e665191333e610b60bad4a32a1" title="Produce a readable name of the given state.">stateName</a>(<a class="code" href="a00115.html#a56fa75f3eb056ae29b1a4b8da0035d8c" title="Current state of the MAC.">state</a>) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00448"></a>00448 
<a name="l00449"></a>00449     <span class="keywordflow">switch</span> (<a class="code" href="a00115.html#a56fa75f3eb056ae29b1a4b8da0035d8c" title="Current state of the MAC.">state</a>)
<a name="l00450"></a>00450     {
<a name="l00451"></a>00451     <span class="keywordflow">case</span> IDLE:     <span class="comment">// waiting for the end of the contention period</span>
<a name="l00452"></a>00452     <span class="keywordflow">case</span> CONTEND:  <span class="comment">// or waiting for RTS</span>
<a name="l00453"></a>00453 
<a name="l00454"></a>00454         <span class="comment">// RTS or DATA accepted</span>
<a name="l00455"></a>00455         <span class="keywordflow">if</span> (af-&gt;getKind() == RTS) {
<a name="l00456"></a>00456           assert(!<a class="code" href="a00115.html#a7bd4f3adc205b150f9fa406fa582f0b6" title="Used to sense if the channel is idle for contention periods.">contention</a>-&gt;isScheduled());
<a name="l00457"></a>00457       <span class="comment">//suspendContention();</span>
<a name="l00458"></a>00458 
<a name="l00459"></a>00459             <a class="code" href="a00115.html#a98ad0d3935d620b33302e5230b395685">handleRTSframe</a>(af);
<a name="l00460"></a>00460         }
<a name="l00461"></a>00461         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (af-&gt;getKind() == DATA) {
<a name="l00462"></a>00462           assert(!<a class="code" href="a00115.html#a7bd4f3adc205b150f9fa406fa582f0b6" title="Used to sense if the channel is idle for contention periods.">contention</a>-&gt;isScheduled());
<a name="l00463"></a>00463           <span class="comment">//suspendContention();</span>
<a name="l00464"></a>00464 
<a name="l00465"></a>00465             <a class="code" href="a00115.html#ab0844f9dbcece750c9a58ca9f0a73fe1">handleDATAframe</a>(af);
<a name="l00466"></a>00466         }
<a name="l00467"></a>00467         <span class="keywordflow">else</span> {
<a name="l00468"></a>00468             error(<span class="stringliteral">&quot;in handleMsgForMe() IDLE/CONTEND, strange message %s&quot;</span>, af-&gt;getName());
<a name="l00469"></a>00469         }
<a name="l00470"></a>00470         <span class="keywordflow">break</span>;
<a name="l00471"></a>00471 
<a name="l00472"></a>00472     <span class="keywordflow">case</span> WFDATA:  <span class="comment">// waiting for DATA</span>
<a name="l00473"></a>00473         <span class="keywordflow">if</span> (af-&gt;getKind() == DATA) {
<a name="l00474"></a>00474             <a class="code" href="a00115.html#ab0844f9dbcece750c9a58ca9f0a73fe1">handleDATAframe</a>(af);
<a name="l00475"></a>00475         }
<a name="l00476"></a>00476         <span class="keywordflow">else</span> {
<a name="l00477"></a>00477           EV &lt;&lt; <span class="stringliteral">&quot;unexpected message -- probably a collision of RTSs\n&quot;</span>;
<a name="l00478"></a>00478             <span class="keyword">delete</span> af;
<a name="l00479"></a>00479         }
<a name="l00480"></a>00480         <span class="keywordflow">break</span>;
<a name="l00481"></a>00481 
<a name="l00482"></a>00482     <span class="keywordflow">case</span> WFACK:  <span class="comment">// waiting for ACK</span>
<a name="l00483"></a>00483         <span class="keywordflow">if</span> (af-&gt;getKind() == ACK) {
<a name="l00484"></a>00484             <a class="code" href="a00115.html#a50cb85360462eb7d256ec8a0b493ca44">handleACKframe</a>(af);
<a name="l00485"></a>00485         }
<a name="l00486"></a>00486         <span class="keywordflow">else</span> {
<a name="l00487"></a>00487             error(<span class="stringliteral">&quot;in handleMsgForMe() WFACK, strange message %s&quot;</span>, af-&gt;getName());
<a name="l00488"></a>00488         }
<a name="l00489"></a>00489         <span class="keyword">delete</span> af;
<a name="l00490"></a>00490         <span class="keywordflow">break</span>;
<a name="l00491"></a>00491 
<a name="l00492"></a>00492     <span class="keywordflow">case</span> WFCTS:  <span class="comment">// The MAC is waiting for CTS</span>
<a name="l00493"></a>00493         <span class="keywordflow">if</span> (af-&gt;getKind() == CTS) {
<a name="l00494"></a>00494             <a class="code" href="a00115.html#ae1e17af7dddc261d7947d48a1f4d0e21">handleCTSframe</a>(af);
<a name="l00495"></a>00495         }
<a name="l00496"></a>00496         <span class="keywordflow">else</span> {
<a name="l00497"></a>00497             EV &lt;&lt; <span class="stringliteral">&quot;unexpected msg -- deleted \n&quot;</span>;
<a name="l00498"></a>00498             <span class="keyword">delete</span> af;
<a name="l00499"></a>00499         }
<a name="l00500"></a>00500         <span class="keywordflow">break</span>;
<a name="l00501"></a>00501     <span class="keywordflow">case</span> QUIET: <span class="comment">// the node is currently deferring.</span>
<a name="l00502"></a>00502 
<a name="l00503"></a>00503         <span class="comment">// cannot handle any packet with its MAC adress</span>
<a name="l00504"></a>00504         <span class="keyword">delete</span> af;
<a name="l00505"></a>00505         <span class="keywordflow">break</span>;
<a name="l00506"></a>00506 
<a name="l00507"></a>00507     <span class="keywordflow">case</span> BUSY: <span class="comment">// currently transmitting an ACK or a BROADCAST packet</span>
<a name="l00508"></a>00508         <span class="keywordflow">if</span>(<a class="code" href="a00115.html#a9f9f566e85a76f63e63b5907bf9ad48a">switching</a>) {
<a name="l00509"></a>00509             EV &lt;&lt; <span class="stringliteral">&quot;message received during radio state switchover\n&quot;</span>;
<a name="l00510"></a>00510             <span class="keyword">delete</span> af;
<a name="l00511"></a>00511         }
<a name="l00512"></a>00512         <span class="keywordflow">else</span> {
<a name="l00513"></a>00513             error(<span class="stringliteral">&quot;logic error: node is currently transmitting, can not receive &quot;</span>
<a name="l00514"></a>00514                   <span class="stringliteral">&quot;(does the physical layer do its job correctly?)&quot;</span>);
<a name="l00515"></a>00515         }
<a name="l00516"></a>00516         <span class="keywordflow">break</span>;
<a name="l00517"></a>00517     <span class="keywordflow">default</span>:
<a name="l00518"></a>00518         error(<span class="stringliteral">&quot;unknown state %d&quot;</span>, <a class="code" href="a00115.html#a56fa75f3eb056ae29b1a4b8da0035d8c" title="Current state of the MAC.">state</a>);
<a name="l00519"></a>00519         <span class="keywordflow">break</span>;
<a name="l00520"></a>00520     }
<a name="l00521"></a>00521 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0377ddefba33b8d50c7bf4045354d7bb"></a><!-- doxytag: member="Mac80211::handleMsgNotForMe" ref="a0377ddefba33b8d50c7bf4045354d7bb" args="(cMessage *af, simtime_t_cref duration)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Mac80211::handleMsgNotForMe </td>
          <td>(</td>
          <td class="paramtype">cMessage *&nbsp;</td>
          <td class="paramname"> <em>af</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">simtime_t_cref&nbsp;</td>
          <td class="paramname"> <em>duration</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>handle a message that is not for me or errornous </p>
<p>Handle all ACKs,RTS, CTS, or DATA not for the node. If RTS/CTS is used the node must stay quiet until the current handshake between the two communicating nodes is over. This is done by scheduling the timer message nav (Network Allocation Vector). Without RTS/CTS a new contention is started. If an error occured the node must defer for EIFS. Called by <a class="el" href="a00115.html#ac8bfb04590aab2434bd8d17ee4e213d9" title="Handle messages from lower layer.">handleLowerMsg()</a> </p>

<p>Definition at line <a class="el" href="a00337_source.html#l00363">363</a> of file <a class="el" href="a00337_source.html">Mac80211.cc</a>.</p>

<p>References <a class="el" href="a00337_source.html#l00959">beginNewCycle()</a>, <a class="el" href="a00390_source.html#l00035">Decider80211::BITERROR</a>, <a class="el" href="a00390_source.html#l00037">Decider80211::COLLISION</a>, <a class="el" href="a00338_source.html#l00260">contention</a>, <a class="el" href="a00338_source.html#l00321">currentIFS</a>, <a class="el" href="a00338_source.html#l00301">fromUpperLayer</a>, <a class="el" href="a00338_source.html#l00308">longRetryCounter</a>, <a class="el" href="a00338_source.html#l00257">nav</a>, <a class="el" href="a00338_source.html#l00197">rtsCts()</a>, <a class="el" href="a00337_source.html#l01130">setState()</a>, <a class="el" href="a00338_source.html#l00311">shortRetryCounter</a>, <a class="el" href="a00338_source.html#l00271">state</a>, and <a class="el" href="a00338_source.html#l00253">timeout</a>.</p>

<p>Referenced by <a class="el" href="a00337_source.html#l00278">handleLowerControl()</a>, and <a class="el" href="a00337_source.html#l00250">handleLowerMsg()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00364"></a>00364 {
<a name="l00365"></a>00365   debugEV &lt;&lt; <span class="stringliteral">&quot;handle msg not for me &quot;</span> &lt;&lt; af-&gt;getName() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00366"></a>00366 
<a name="l00367"></a>00367     <span class="comment">// if the duration of the packet is null, then do nothing (to avoid</span>
<a name="l00368"></a>00368     <span class="comment">// the unuseful scheduling of a self message)</span>
<a name="l00369"></a>00369     <span class="keywordflow">if</span>(duration != 0) {
<a name="l00370"></a>00370         <span class="comment">// the node is already deferring</span>
<a name="l00371"></a>00371         <span class="keywordflow">if</span> (<a class="code" href="a00115.html#a56fa75f3eb056ae29b1a4b8da0035d8c" title="Current state of the MAC.">state</a> == QUIET)
<a name="l00372"></a>00372         {
<a name="l00373"></a>00373             <span class="comment">// the current value of the NAV is not sufficient</span>
<a name="l00374"></a>00374             <span class="keywordflow">if</span> (<a class="code" href="a00115.html#a35efb0198d0085a341aba515bec9146f" title="Timer used for the defer time of a node. Also called NAV : networks allocation vector...">nav</a>-&gt;getArrivalTime() &lt; simTime() + duration)
<a name="l00375"></a>00375             {
<a name="l00376"></a>00376                 cancelEvent(<a class="code" href="a00115.html#a35efb0198d0085a341aba515bec9146f" title="Timer used for the defer time of a node. Also called NAV : networks allocation vector...">nav</a>);
<a name="l00377"></a>00377                 scheduleAt(simTime() + duration, <a class="code" href="a00115.html#a35efb0198d0085a341aba515bec9146f" title="Timer used for the defer time of a node. Also called NAV : networks allocation vector...">nav</a>);
<a name="l00378"></a>00378                 debugEV &lt;&lt; <span class="stringliteral">&quot;NAV timer started for: &quot;</span> &lt;&lt; duration &lt;&lt; <span class="stringliteral">&quot; State QUIET\n&quot;</span>;
<a name="l00379"></a>00379             }
<a name="l00380"></a>00380         }
<a name="l00381"></a>00381         <span class="comment">// other states</span>
<a name="l00382"></a>00382         <span class="keywordflow">else</span>
<a name="l00383"></a>00383         {
<a name="l00384"></a>00384             <span class="comment">// if the MAC wait for another frame, it can delete its time out</span>
<a name="l00385"></a>00385             <span class="comment">// (exchange is aborted)</span>
<a name="l00386"></a>00386             <span class="keywordflow">if</span> (<a class="code" href="a00115.html#a2d31f97b0662b8e37f090c3b996cec82" title="Timer used for time-outs after the transmission of a RTS, a CTS, or a DATA packet...">timeout</a>-&gt;isScheduled()) {
<a name="l00387"></a>00387                 cancelEvent(<a class="code" href="a00115.html#a2d31f97b0662b8e37f090c3b996cec82" title="Timer used for time-outs after the transmission of a RTS, a CTS, or a DATA packet...">timeout</a>);
<a name="l00388"></a>00388                 <span class="keywordflow">if</span>(<a class="code" href="a00115.html#a56fa75f3eb056ae29b1a4b8da0035d8c" title="Current state of the MAC.">state</a> == WFACK) {
<a name="l00389"></a>00389                     <a class="code" href="a00115.html#a969e8e3a592dffccea28596c61b2af50" title="Buffering of messages from upper layer.">fromUpperLayer</a>.front()-&gt;setRetry(<span class="keyword">true</span>);
<a name="l00390"></a>00390                 }
<a name="l00391"></a>00391                 <span class="keywordflow">if</span>((<a class="code" href="a00115.html#a56fa75f3eb056ae29b1a4b8da0035d8c" title="Current state of the MAC.">state</a> == WFACK) || (<a class="code" href="a00115.html#a56fa75f3eb056ae29b1a4b8da0035d8c" title="Current state of the MAC.">state</a> == WFCTS)) {
<a name="l00392"></a>00392                     <span class="keywordflow">if</span>(<a class="code" href="a00115.html#aa316943080d714ffc3c0bf54ea8aeb08" title="Check whether the next packet should be send with RTS/CTS.">rtsCts</a>(<a class="code" href="a00115.html#a969e8e3a592dffccea28596c61b2af50" title="Buffering of messages from upper layer.">fromUpperLayer</a>.front())) {
<a name="l00393"></a>00393                         <a class="code" href="a00115.html#a11fb608b3564e2d2cd41b463b1a8cc90" title="Number of frame transmission attempt.">longRetryCounter</a>++;
<a name="l00394"></a>00394                     }
<a name="l00395"></a>00395                     <span class="keywordflow">else</span> {
<a name="l00396"></a>00396                         <a class="code" href="a00115.html#a9bbc3d71eddb62c4e12dcd500a58b0bb" title="Number of frame transmission attempt.">shortRetryCounter</a>++;
<a name="l00397"></a>00397                     }
<a name="l00398"></a>00398                 }
<a name="l00399"></a>00399             }
<a name="l00400"></a>00400             <span class="comment">// the node must defer for the time of the transmission</span>
<a name="l00401"></a>00401             scheduleAt(simTime() + duration, <a class="code" href="a00115.html#a35efb0198d0085a341aba515bec9146f" title="Timer used for the defer time of a node. Also called NAV : networks allocation vector...">nav</a>);
<a name="l00402"></a>00402             debugEV &lt;&lt; <span class="stringliteral">&quot;NAV timer started, not QUIET: &quot;</span> &lt;&lt; duration &lt;&lt; endl;
<a name="l00403"></a>00403 
<a name="l00404"></a>00404             assert(!<a class="code" href="a00115.html#a7bd4f3adc205b150f9fa406fa582f0b6" title="Used to sense if the channel is idle for contention periods.">contention</a>-&gt;isScheduled());
<a name="l00405"></a>00405             <span class="comment">//suspendContention();</span>
<a name="l00406"></a>00406 
<a name="l00407"></a>00407             <a class="code" href="a00115.html#a9fc6eb078e53740d354f8ea7b9d94713" title="Sets the state, and produces a log message in between.">setState</a>(QUIET);
<a name="l00408"></a>00408         }
<a name="l00409"></a>00409     }
<a name="l00410"></a>00410 
<a name="l00411"></a>00411     <span class="keywordflow">if</span>((af-&gt;getKind() == <a class="code" href="a00068.html#aadf94ce46e3edca3fa4d93150f72f4aeae12bbafd7ed8d0978ac925c1a493aabb" title="The decider has recognized a bit error in the packet.">Decider80211::BITERROR</a>) || (af-&gt;getKind() == <a class="code" href="a00068.html#aadf94ce46e3edca3fa4d93150f72f4aeae5c2edad30720b7e527373b28bd4e1ab" title="Packet lost due to collision.">Decider80211::COLLISION</a>)) {
<a name="l00412"></a>00412 
<a name="l00413"></a>00413       assert(!<a class="code" href="a00115.html#a7bd4f3adc205b150f9fa406fa582f0b6" title="Used to sense if the channel is idle for contention periods.">contention</a>-&gt;isScheduled());
<a name="l00414"></a>00414         <span class="comment">//suspendContention();</span>
<a name="l00415"></a>00415         <span class="comment">//if (contention-&gt;isScheduled()) {</span>
<a name="l00416"></a>00416         <span class="comment">//    error(&quot;Gaack! I am changing the IFS on an ongoing contention&quot;);</span>
<a name="l00417"></a>00417         <span class="comment">//}</span>
<a name="l00418"></a>00418 
<a name="l00419"></a>00419       <span class="comment">//handle broken cts and ACK frames</span>
<a name="l00420"></a>00420       <span class="keywordflow">if</span>(<a class="code" href="a00115.html#a56fa75f3eb056ae29b1a4b8da0035d8c" title="Current state of the MAC.">state</a> == WFCTS) {
<a name="l00421"></a>00421         assert(<a class="code" href="a00115.html#a2d31f97b0662b8e37f090c3b996cec82" title="Timer used for time-outs after the transmission of a RTS, a CTS, or a DATA packet...">timeout</a>-&gt;isScheduled());
<a name="l00422"></a>00422         cancelEvent(<a class="code" href="a00115.html#a2d31f97b0662b8e37f090c3b996cec82" title="Timer used for time-outs after the transmission of a RTS, a CTS, or a DATA packet...">timeout</a>);
<a name="l00423"></a>00423         rtsTransmissionFailed();
<a name="l00424"></a>00424       }
<a name="l00425"></a>00425       <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="a00115.html#a56fa75f3eb056ae29b1a4b8da0035d8c" title="Current state of the MAC.">state</a> == WFACK) {
<a name="l00426"></a>00426         assert(<a class="code" href="a00115.html#a2d31f97b0662b8e37f090c3b996cec82" title="Timer used for time-outs after the transmission of a RTS, a CTS, or a DATA packet...">timeout</a>-&gt;isScheduled());
<a name="l00427"></a>00427       cancelEvent(<a class="code" href="a00115.html#a2d31f97b0662b8e37f090c3b996cec82" title="Timer used for time-outs after the transmission of a RTS, a CTS, or a DATA packet...">timeout</a>);
<a name="l00428"></a>00428         dataTransmissionFailed();
<a name="l00429"></a>00429       }
<a name="l00430"></a>00430 
<a name="l00431"></a>00431         <a class="code" href="a00115.html#a4a9d1c8d45c46f18afa0f07f5b6572f4" title="current IFS value (DIFS or EIFS) If an error has been detected, the next backoff...">currentIFS</a> = EIFS;
<a name="l00432"></a>00432     }
<a name="l00433"></a>00433 
<a name="l00434"></a>00434     <a class="code" href="a00115.html#ab3030c86acac78401f877a61cefcdad6" title="start a new contention period">beginNewCycle</a>();
<a name="l00435"></a>00435     <span class="keyword">delete</span> af;
<a name="l00436"></a>00436 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a23a142d65d7a0dcba4a60c0f509ab5b9"></a><!-- doxytag: member="Mac80211::handleNavTimer" ref="a23a142d65d7a0dcba4a60c0f509ab5b9" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Mac80211::handleNavTimer </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>NAV timer expired, the exchange of messages of other stations is done. </p>
<p>Handle the NAV timer (end of a defering period). Called by HandleTimer(cMessage* msg) </p>

<p>Definition at line <a class="el" href="a00337_source.html#l00677">677</a> of file <a class="el" href="a00337_source.html">Mac80211.cc</a>.</p>

<p>References <a class="el" href="a00337_source.html#l00959">beginNewCycle()</a>, and <a class="el" href="a00338_source.html#l00271">state</a>.</p>

<p>Referenced by <a class="el" href="a00337_source.html#l00332">handleSelfMsg()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00678"></a>00678 {
<a name="l00679"></a>00679     <span class="keywordflow">if</span> (<a class="code" href="a00115.html#a56fa75f3eb056ae29b1a4b8da0035d8c" title="Current state of the MAC.">state</a> != QUIET)
<a name="l00680"></a>00680         error(<span class="stringliteral">&quot;logic error: expiration of the NAV timer outside of the state QUIET, should not happen&quot;</span>);
<a name="l00681"></a>00681 
<a name="l00682"></a>00682     <span class="comment">// if there&apos;s a packet to send and if the channel is free, then start a new contention period</span>
<a name="l00683"></a>00683 
<a name="l00684"></a>00684     <span class="comment">// lmf - Potential race condition: If nav expires at same time</span>
<a name="l00685"></a>00685     <span class="comment">// medium becomes IDLE (usual case), but the navTimeout comes</span>
<a name="l00686"></a>00686     <span class="comment">// before the mediumIndication, then the medium is still BUSY when</span>
<a name="l00687"></a>00687     <span class="comment">// beginNewCycle() is called, so the backoff doesn&apos;t resume.</span>
<a name="l00688"></a>00688     <span class="comment">// Usually it doesn&apos;t matter, since there is also an arriving</span>
<a name="l00689"></a>00689     <span class="comment">// frame and so beginNewCycle() will be called again by the</span>
<a name="l00690"></a>00690     <span class="comment">// handleMsgXXX.  But if there is no frame (mobility, exposed</span>
<a name="l00691"></a>00691     <span class="comment">// terminal, etc) there&apos;s a potential problem.</span>
<a name="l00692"></a>00692 
<a name="l00693"></a>00693     <a class="code" href="a00115.html#ab3030c86acac78401f877a61cefcdad6" title="start a new contention period">beginNewCycle</a>();
<a name="l00694"></a>00694 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a98ad0d3935d620b33302e5230b395685"></a><!-- doxytag: member="Mac80211::handleRTSframe" ref="a98ad0d3935d620b33302e5230b395685" args="(Mac80211Pkt *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Mac80211::handleRTSframe </td>
          <td>(</td>
          <td class="paramtype">Mac80211Pkt *&nbsp;</td>
          <td class="paramname"> <em>af</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Handle aframe wich is expected to be an RTS. Called by HandleMsgForMe() </p>

<p>Definition at line <a class="el" href="a00337_source.html#l00527">527</a> of file <a class="el" href="a00337_source.html">Mac80211.cc</a>.</p>

<p>References <a class="el" href="a00338_source.html#l00263">endSifs</a>, and <a class="el" href="a00240_source.html#l00130">BaseLayer::sendControlDown()</a>.</p>

<p>Referenced by <a class="el" href="a00337_source.html#l00445">handleMsgForMe()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00528"></a>00528 {
<a name="l00529"></a>00529     <span class="keywordflow">if</span>(<a class="code" href="a00115.html#ace80836b6fcb1681f6b2d49466f87fb0" title="Timer used to indicate the end of a SIFS.">endSifs</a>-&gt;isScheduled()) error(<span class="stringliteral">&quot;Mac80211::handleRTSframe when SIFS scheduled&quot;</span>);
<a name="l00530"></a>00530     <span class="comment">// wait a short interframe space</span>
<a name="l00531"></a>00531     <a class="code" href="a00115.html#ace80836b6fcb1681f6b2d49466f87fb0" title="Timer used to indicate the end of a SIFS.">endSifs</a>-&gt;setContextPointer(af);
<a name="l00532"></a>00532 
<a name="l00533"></a>00533     <a class="code" href="a00021.html#a6d01a0f56978740d7617c2e338858cc3" title="Sends a control message to a lower layer.">sendControlDown</a>(<a class="code" href="a00115.html#ace80836b6fcb1681f6b2d49466f87fb0" title="Timer used to indicate the end of a SIFS.">endSifs</a>);
<a name="l00534"></a>00534     <span class="comment">//scheduleAt(simTime() + SIFS, endSifs);</span>
<a name="l00535"></a>00535 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a990af33f857669759da0cbeebd1c2431"></a><!-- doxytag: member="Mac80211::handleSelfMsg" ref="a990af33f857669759da0cbeebd1c2431" args="(cMessage *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Mac80211::handleSelfMsg </td>
          <td>(</td>
          <td class="paramtype">cMessage *&nbsp;</td>
          <td class="paramname"> <em>msg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Handle self messages such as timer... </p>
<p>handle timers </p>

<p>Reimplemented from <a class="el" href="a00022.html#add5277c1a60dab10db40c8d9641e48c4">BaseMacLayer</a>.</p>

<p>Definition at line <a class="el" href="a00337_source.html#l00332">332</a> of file <a class="el" href="a00337_source.html">Mac80211.cc</a>.</p>

<p>References <a class="el" href="a00337_source.html#l00677">handleNavTimer()</a>, and <a class="el" href="a00337_source.html#l00720">handleTimeoutTimer()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00333"></a>00333 {
<a name="l00334"></a>00334   debugEV &lt;&lt; simTime() &lt;&lt; <span class="stringliteral">&quot; handleSelfMsg &quot;</span> &lt;&lt; msg-&gt;getName() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00335"></a>00335     <span class="keywordflow">switch</span> (msg-&gt;getKind())
<a name="l00336"></a>00336     {
<a name="l00337"></a>00337         <span class="comment">// the MAC was waiting for a CTS, a DATA, or an ACK packet but the timer has expired.</span>
<a name="l00338"></a>00338     <span class="keywordflow">case</span> TIMEOUT:
<a name="l00339"></a>00339         <a class="code" href="a00115.html#ab5fcba8c7a3878ac59195a483ba35a12" title="handle time out">handleTimeoutTimer</a>();   <span class="comment">// noch zu betrachten..</span>
<a name="l00340"></a>00340         <span class="keywordflow">break</span>;
<a name="l00341"></a>00341 
<a name="l00342"></a>00342         <span class="comment">// the MAC was waiting because an other communication had won the channel. This communication is now over</span>
<a name="l00343"></a>00343     <span class="keywordflow">case</span> NAV:
<a name="l00344"></a>00344         <a class="code" href="a00115.html#a23a142d65d7a0dcba4a60c0f509ab5b9" title="NAV timer expired, the exchange of messages of other stations is done.">handleNavTimer</a>();       <span class="comment">// noch zu betrachten...</span>
<a name="l00345"></a>00345         <span class="keywordflow">break</span>;
<a name="l00346"></a>00346 
<a name="l00347"></a>00347     <span class="keywordflow">default</span>:
<a name="l00348"></a>00348         error(<span class="stringliteral">&quot;unknown timer type&quot;</span>);
<a name="l00349"></a>00349         <span class="keywordflow">break</span>;
<a name="l00350"></a>00350     }
<a name="l00351"></a>00351 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab5fcba8c7a3878ac59195a483ba35a12"></a><!-- doxytag: member="Mac80211::handleTimeoutTimer" ref="ab5fcba8c7a3878ac59195a483ba35a12" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Mac80211::handleTimeoutTimer </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>handle time out </p>
<p>Handle the time out timer. Called by handleTimer(cMessage* msg) </p>

<p>Definition at line <a class="el" href="a00337_source.html#l00720">720</a> of file <a class="el" href="a00337_source.html">Mac80211.cc</a>.</p>

<p>References <a class="el" href="a00337_source.html#l00959">beginNewCycle()</a>, <a class="el" href="a00338_source.html#l00271">state</a>, and <a class="el" href="a00337_source.html#l01112">stateName()</a>.</p>

<p>Referenced by <a class="el" href="a00337_source.html#l00332">handleSelfMsg()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00721"></a>00721 {
<a name="l00722"></a>00722     debugEV &lt;&lt; simTime() &lt;&lt; <span class="stringliteral">&quot; handleTimeoutTimer &quot;</span> &lt;&lt; <a class="code" href="a00115.html#ade8a90e665191333e610b60bad4a32a1" title="Produce a readable name of the given state.">stateName</a>(<a class="code" href="a00115.html#a56fa75f3eb056ae29b1a4b8da0035d8c" title="Current state of the MAC.">state</a>) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00723"></a>00723     <span class="keywordflow">if</span>(<a class="code" href="a00115.html#a56fa75f3eb056ae29b1a4b8da0035d8c" title="Current state of the MAC.">state</a> == WFCTS) {
<a name="l00724"></a>00724       rtsTransmissionFailed();
<a name="l00725"></a>00725     }
<a name="l00726"></a>00726     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="a00115.html#a56fa75f3eb056ae29b1a4b8da0035d8c" title="Current state of the MAC.">state</a> == WFACK) {
<a name="l00727"></a>00727       dataTransmissionFailed();
<a name="l00728"></a>00728     }
<a name="l00729"></a>00729 
<a name="l00730"></a>00730     <span class="comment">// if there&apos;s a packet to send and if the channel is free then</span>
<a name="l00731"></a>00731     <span class="comment">// start a new contention period</span>
<a name="l00732"></a>00732     <span class="keywordflow">if</span> (<a class="code" href="a00115.html#a56fa75f3eb056ae29b1a4b8da0035d8c" title="Current state of the MAC.">state</a> != QUIET)
<a name="l00733"></a>00733         <a class="code" href="a00115.html#ab3030c86acac78401f877a61cefcdad6" title="start a new contention period">beginNewCycle</a>();
<a name="l00734"></a>00734 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af7e230f8713536482417699f2f6bee71"></a><!-- doxytag: member="Mac80211::handleUpperMsg" ref="af7e230f8713536482417699f2f6bee71" args="(cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Mac80211::handleUpperMsg </td>
          <td>(</td>
          <td class="paramtype">cMessage *&nbsp;</td>
          <td class="paramname"> <em>msg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Handle messages from upper layer. </p>
<p>This implementation does not support fragmentation, so it is tested if the maximum length of the MPDU is exceeded. </p>

<p>Reimplemented from <a class="el" href="a00022.html#a6de2ca07018de313a7147a03e6d77bff">BaseMacLayer</a>.</p>

<p>Definition at line <a class="el" href="a00337_source.html#l00170">170</a> of file <a class="el" href="a00337_source.html">Mac80211.cc</a>.</p>

<p>References <a class="el" href="a00337_source.html#l00959">beginNewCycle()</a>, <a class="el" href="a00337_source.html#l00207">encapsMsg()</a>, <a class="el" href="a00338_source.html#l00263">endSifs</a>, <a class="el" href="a00338_source.html#l00301">fromUpperLayer</a>, <a class="el" href="a00243_source.html#l00059">BaseMacLayer::PACKET_DROPPED</a>, <a class="el" href="a00338_source.html#l00295">queueLength</a>, <a class="el" href="a00240_source.html#l00120">BaseLayer::sendControlUp()</a>, and <a class="el" href="a00338_source.html#l00271">state</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00171"></a>00171 {
<a name="l00172"></a>00172   cPacket* pkt = <span class="keyword">static_cast&lt;</span>cPacket*<span class="keyword">&gt;</span>(msg);
<a name="l00173"></a>00173 
<a name="l00174"></a>00174   debugEV &lt;&lt; <span class="stringliteral">&quot;Mac80211::handleUpperMsg &quot;</span> &lt;&lt; msg-&gt;getName() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00175"></a>00175     <span class="keywordflow">if</span> (pkt-&gt;getBitLength() &gt; 18496){
<a name="l00176"></a>00176         error(<span class="stringliteral">&quot;packet from higher layer (%s)%s is too long for 802.11b, %d bytes (fragmentation is not supported yet)&quot;</span>,
<a name="l00177"></a>00177               pkt-&gt;getClassName(), pkt-&gt;getName(), pkt-&gt;getByteLength());
<a name="l00178"></a>00178     }
<a name="l00179"></a>00179 
<a name="l00180"></a>00180     <span class="keywordflow">if</span>(<a class="code" href="a00115.html#a969e8e3a592dffccea28596c61b2af50" title="Buffering of messages from upper layer.">fromUpperLayer</a>.size() == <a class="code" href="a00115.html#ae8892c105c3f0fb2b6f28634bb099f31" title="Maximal number of packets in the queue; should be set in the omnetpp.ini.">queueLength</a>) {
<a name="l00181"></a>00181     <span class="comment">//TODO: CSMAMacLayer does create a new mac packet and sends it up. Maybe settle on a consistent solution here</span>
<a name="l00182"></a>00182         msg-&gt;setName(<span class="stringliteral">&quot;MAC ERROR&quot;</span>);
<a name="l00183"></a>00183         msg-&gt;setKind(<a class="code" href="a00022.html#a49e0e548a6c20d002bd67afa7b76c483adebf9c77bbe6f19772866cccbef0fe4b">PACKET_DROPPED</a>);
<a name="l00184"></a>00184         <a class="code" href="a00021.html#aa1190a06fb4dfb15d8ff001468335dc8" title="Sends a control message to an upper layer.">sendControlUp</a>(msg);
<a name="l00185"></a>00185         debugEV &lt;&lt; <span class="stringliteral">&quot;packet &quot;</span> &lt;&lt; msg &lt;&lt; <span class="stringliteral">&quot; received from higher layer but MAC queue is full, signalling error\n&quot;</span>;
<a name="l00186"></a>00186         <span class="keywordflow">return</span>;
<a name="l00187"></a>00187     }
<a name="l00188"></a>00188 
<a name="l00189"></a>00189     Mac80211Pkt *mac = <span class="keyword">static_cast&lt;</span>Mac80211Pkt*<span class="keyword">&gt;</span>(<a class="code" href="a00115.html#aa44171fa07d51ec487f7481740525466" title="encapsulate packet">encapsMsg</a>(pkt));
<a name="l00190"></a>00190     debugEV &lt;&lt; <span class="stringliteral">&quot;packet &quot;</span> &lt;&lt; pkt &lt;&lt; <span class="stringliteral">&quot; received from higher layer, dest=&quot;</span> &lt;&lt; mac-&gt;getDestAddr() &lt;&lt; <span class="stringliteral">&quot;, encapsulated\n&quot;</span>;
<a name="l00191"></a>00191 
<a name="l00192"></a>00192     <a class="code" href="a00115.html#a969e8e3a592dffccea28596c61b2af50" title="Buffering of messages from upper layer.">fromUpperLayer</a>.push_back(mac);
<a name="l00193"></a>00193     <span class="comment">// If the MAC is in the IDLE state, then start a new contention period</span>
<a name="l00194"></a>00194     <span class="keywordflow">if</span> (<a class="code" href="a00115.html#a56fa75f3eb056ae29b1a4b8da0035d8c" title="Current state of the MAC.">state</a> == IDLE &amp;&amp; !<a class="code" href="a00115.html#ace80836b6fcb1681f6b2d49466f87fb0" title="Timer used to indicate the end of a SIFS.">endSifs</a>-&gt;isScheduled()) {
<a name="l00195"></a>00195         <a class="code" href="a00115.html#ab3030c86acac78401f877a61cefcdad6" title="start a new contention period">beginNewCycle</a>();
<a name="l00196"></a>00196     }
<a name="l00197"></a>00197     <span class="keywordflow">else</span>
<a name="l00198"></a>00198     {
<a name="l00199"></a>00199       debugEV &lt;&lt; <span class="stringliteral">&quot;enqueued, will be transmitted later\n&quot;</span>;
<a name="l00200"></a>00200     }
<a name="l00201"></a>00201 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab81dae24d79c2ef010301e2c219966c1"></a><!-- doxytag: member="Mac80211::initialize" ref="ab81dae24d79c2ef010301e2c219966c1" args="(int)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Mac80211::initialize </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>stage</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initialization of the module and some variables. </p>
<p>First we have to initialize the module from which we derived ours, in this case <a class="el" href="a00021.html" title="A very simple layer template.">BaseLayer</a>. </p>

<p>Reimplemented from <a class="el" href="a00022.html#a61c82dc3b225eac37f7fa9936c28c2c3">BaseMacLayer</a>.</p>

<p>Reimplemented in <a class="el" href="a00116.html#aa7351afc794f983e34dbc86d63cb3dea">Mac80211MultiChannel</a>.</p>

<p>Definition at line <a class="el" href="a00337_source.html#l00061">61</a> of file <a class="el" href="a00337_source.html">Mac80211.cc</a>.</p>

<p>References <a class="el" href="a00338_source.html#l00289">autoBitrate</a>, <a class="el" href="a00337_source.html#l01014">backoff()</a>, <a class="el" href="a00338_source.html#l00287">bitrate</a>, <a class="el" href="a00338_source.html#l00284">centerFreq</a>, <a class="el" href="a00270_source.html#l00033">MacToPhyInterface::CHANNEL_SENSE_REQUEST</a>, <a class="el" href="a00338_source.html#l00260">contention</a>, <a class="el" href="a00338_source.html#l00321">currentIFS</a>, <a class="el" href="a00284_source.html#l00152">FWMath::dBm2mW()</a>, <a class="el" href="a00338_source.html#l00278">defaultBitrate</a>, <a class="el" href="a00338_source.html#l00328">delta</a>, <a class="el" href="a00338_source.html#l00263">endSifs</a>, <a class="el" href="a00338_source.html#l00342">fsc</a>, <a class="el" href="a00242_source.html#l00306">BaseMacLayer::getConnectionManager()</a>, <a class="el" href="a00119.html#a6271dfe09bf5cef8c8afb96de00182ab">MacToPhyInterface::getCurrentRadioChannel()</a>, <a class="el" href="a00338_source.html#l00308">longRetryCounter</a>, <a class="el" href="a00243_source.html#l00081">BaseMacLayer::myMacAddr</a>, <a class="el" href="a00338_source.html#l00257">nav</a>, <a class="el" href="a00338_source.html#l00333">neighborhoodCacheMaxAge</a>, <a class="el" href="a00338_source.html#l00331">neighborhoodCacheSize</a>, <a class="el" href="a00243_source.html#l00068">BaseMacLayer::phy</a>, <a class="el" href="a00338_source.html#l00295">queueLength</a>, <a class="el" href="a00338_source.html#l00316">remainingBackoff</a>, <a class="el" href="a00338_source.html#l00324">rtsCtsThreshold</a>, <a class="el" href="a00337_source.html#l00155">senseChannelWhileIdle()</a>, <a class="el" href="a00338_source.html#l00311">shortRetryCounter</a>, <a class="el" href="a00338_source.html#l00291">snrThresholds</a>, <a class="el" href="a00338_source.html#l00271">state</a>, <a class="el" href="a00338_source.html#l00339">switching</a>, <a class="el" href="a00338_source.html#l00253">timeout</a>, and <a class="el" href="a00338_source.html#l00281">txPower</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00062"></a>00062 {
<a name="l00063"></a>00063     <a class="code" href="a00115.html#ab81dae24d79c2ef010301e2c219966c1" title="Initialization of the module and some variables.">BaseMacLayer::initialize</a>(stage);
<a name="l00064"></a>00064 
<a name="l00065"></a>00065     <span class="keywordflow">if</span> (stage == 0)
<a name="l00066"></a>00066     {
<a name="l00067"></a>00067         debugEV &lt;&lt; <span class="stringliteral">&quot;Initializing stage 0\n&quot;</span>;
<a name="l00068"></a>00068 
<a name="l00069"></a>00069         <a class="code" href="a00115.html#a9f9f566e85a76f63e63b5907bf9ad48a">switching</a> = <span class="keyword">false</span>;
<a name="l00070"></a>00070         <a class="code" href="a00115.html#a026837b7167d230bbe79a1e0630c7578">fsc</a> = intrand(0x7FFFFFFF);
<a name="l00071"></a>00071         <span class="keywordflow">if</span>(<a class="code" href="a00115.html#a026837b7167d230bbe79a1e0630c7578">fsc</a> == 0) <a class="code" href="a00115.html#a026837b7167d230bbe79a1e0630c7578">fsc</a> = 1;
<a name="l00072"></a>00072         debugEV &lt;&lt; <span class="stringliteral">&quot; fsc: &quot;</span> &lt;&lt; <a class="code" href="a00115.html#a026837b7167d230bbe79a1e0630c7578">fsc</a> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00073"></a>00073 
<a name="l00074"></a>00074         <a class="code" href="a00115.html#ae8892c105c3f0fb2b6f28634bb099f31" title="Maximal number of packets in the queue; should be set in the omnetpp.ini.">queueLength</a> = hasPar(<span class="stringliteral">&quot;queueLength&quot;</span>) ? par(<span class="stringliteral">&quot;queueLength&quot;</span>).longValue() : 10;
<a name="l00075"></a>00075 
<a name="l00076"></a>00076         <span class="comment">// timers</span>
<a name="l00077"></a>00077         <a class="code" href="a00115.html#a2d31f97b0662b8e37f090c3b996cec82" title="Timer used for time-outs after the transmission of a RTS, a CTS, or a DATA packet...">timeout</a> = <span class="keyword">new</span> cMessage(<span class="stringliteral">&quot;timeout&quot;</span>, TIMEOUT);
<a name="l00078"></a>00078         <a class="code" href="a00115.html#a35efb0198d0085a341aba515bec9146f" title="Timer used for the defer time of a node. Also called NAV : networks allocation vector...">nav</a> = <span class="keyword">new</span> cMessage(<span class="stringliteral">&quot;NAV&quot;</span>, NAV);
<a name="l00079"></a>00079         <a class="code" href="a00115.html#a7bd4f3adc205b150f9fa406fa582f0b6" title="Used to sense if the channel is idle for contention periods.">contention</a> = <span class="keyword">new</span> ChannelSenseRequest(<span class="stringliteral">&quot;contention&quot;</span>, <a class="code" href="a00119.html#a36bc50a86bf1cc0f9efd374613d61a52aa6ff58f5815b155504d37339ee5c7222" title="Channel sense control message between Mac and Phy.">MacToPhyInterface::CHANNEL_SENSE_REQUEST</a>);
<a name="l00080"></a>00080         <a class="code" href="a00115.html#a7bd4f3adc205b150f9fa406fa582f0b6" title="Used to sense if the channel is idle for contention periods.">contention</a>-&gt;setSenseMode(UNTIL_BUSY);
<a name="l00081"></a>00081         <a class="code" href="a00115.html#ace80836b6fcb1681f6b2d49466f87fb0" title="Timer used to indicate the end of a SIFS.">endSifs</a> = <span class="keyword">new</span> ChannelSenseRequest(<span class="stringliteral">&quot;end SIFS&quot;</span>, <a class="code" href="a00119.html#a36bc50a86bf1cc0f9efd374613d61a52aa6ff58f5815b155504d37339ee5c7222" title="Channel sense control message between Mac and Phy.">MacToPhyInterface::CHANNEL_SENSE_REQUEST</a>);
<a name="l00082"></a>00082         <a class="code" href="a00115.html#ace80836b6fcb1681f6b2d49466f87fb0" title="Timer used to indicate the end of a SIFS.">endSifs</a>-&gt;setSenseMode(UNTIL_BUSY);
<a name="l00083"></a>00083         <a class="code" href="a00115.html#ace80836b6fcb1681f6b2d49466f87fb0" title="Timer used to indicate the end of a SIFS.">endSifs</a>-&gt;setSenseTimeout(SIFS);
<a name="l00084"></a>00084 
<a name="l00085"></a>00085         <a class="code" href="a00115.html#a56fa75f3eb056ae29b1a4b8da0035d8c" title="Current state of the MAC.">state</a> = IDLE;
<a name="l00086"></a>00086         <a class="code" href="a00115.html#a11fb608b3564e2d2cd41b463b1a8cc90" title="Number of frame transmission attempt.">longRetryCounter</a> = 0;
<a name="l00087"></a>00087         <a class="code" href="a00115.html#a9bbc3d71eddb62c4e12dcd500a58b0bb" title="Number of frame transmission attempt.">shortRetryCounter</a> = 0;
<a name="l00088"></a>00088         <a class="code" href="a00115.html#a6ad4dd93415c98c969df05f53d739cfd" title="Number of bits in a packet before RTS/CTS is used.">rtsCtsThreshold</a> = hasPar(<span class="stringliteral">&quot;rtsCtsThreshold&quot;</span>) ? par(<span class="stringliteral">&quot;rtsCtsThreshold&quot;</span>).longValue() : 1;
<a name="l00089"></a>00089         <a class="code" href="a00115.html#a4a9d1c8d45c46f18afa0f07f5b6572f4" title="current IFS value (DIFS or EIFS) If an error has been detected, the next backoff...">currentIFS</a> = EIFS;
<a name="l00090"></a>00090 
<a name="l00091"></a>00091         <a class="code" href="a00115.html#a979883a8da4b308de4a8e79b5bbbe2e6" title="Auto bit rate adaptation -- switch.">autoBitrate</a> = hasPar(<span class="stringliteral">&quot;autoBitrate&quot;</span>) ? par(<span class="stringliteral">&quot;autoBitrate&quot;</span>).boolValue() : <span class="keyword">false</span>;
<a name="l00092"></a>00092 
<a name="l00093"></a>00093         <a class="code" href="a00115.html#a592eee2a24a6fcadd6fdf912a101719f" title="The power at which data is transmitted.">txPower</a> = hasPar(<span class="stringliteral">&quot;txPower&quot;</span>) ? par(<span class="stringliteral">&quot;txPower&quot;</span>).doubleValue() : 110.11;
<a name="l00094"></a>00094 
<a name="l00095"></a>00095 
<a name="l00096"></a>00096         <a class="code" href="a00115.html#ab9f0ea820748af6d640569fc76f39659" title="Very small value used in timer scheduling in order to avoid multiple changements...">delta</a> = 1E-9;
<a name="l00097"></a>00097 
<a name="l00098"></a>00098         debugEV &lt;&lt; <span class="stringliteral">&quot;SIFS: &quot;</span> &lt;&lt; SIFS &lt;&lt; <span class="stringliteral">&quot; DIFS: &quot;</span> &lt;&lt; DIFS &lt;&lt; <span class="stringliteral">&quot; EIFS: &quot;</span> &lt;&lt; EIFS &lt;&lt; endl;
<a name="l00099"></a>00099     }
<a name="l00100"></a>00100     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(stage == 1) {
<a name="l00101"></a>00101       <a class="code" href="a00015.html" title="Module to control the channel and handle all connection related stuff.">BaseConnectionManager</a>* cc = <a class="code" href="a00022.html#a68f36d36168a8ba5c8a4c84c17f1ba40" title="Returns a pointer to this MACs NICs ConnectionManager module.">getConnectionManager</a>();
<a name="l00102"></a>00102 
<a name="l00103"></a>00103       <span class="keywordflow">if</span>(cc-&gt;hasPar(<span class="stringliteral">&quot;pMax&quot;</span>) &amp;&amp; <a class="code" href="a00115.html#a592eee2a24a6fcadd6fdf912a101719f" title="The power at which data is transmitted.">txPower</a> &gt; cc-&gt;par(<span class="stringliteral">&quot;pMax&quot;</span>).doubleValue())
<a name="l00104"></a>00104             opp_error(<span class="stringliteral">&quot;TranmitterPower can&apos;t be bigger than pMax in ConnectionManager! &quot;</span>
<a name="l00105"></a>00105                     <span class="stringliteral">&quot;Please adjust your omnetpp.ini file accordingly.&quot;</span>);
<a name="l00106"></a>00106 
<a name="l00107"></a>00107       <span class="keywordtype">int</span> channel = <a class="code" href="a00022.html#aa7b1e6bdb734765a9f4eff7d486dfbea" title="Handler to the physical layer.">phy</a>-&gt;<a class="code" href="a00119.html#a6271dfe09bf5cef8c8afb96de00182ab" title="Returns the channel currently used by the radio.">getCurrentRadioChannel</a>();
<a name="l00108"></a>00108       <span class="keywordflow">if</span>(!(1&lt;=channel &amp;&amp; channel&lt;=14)) {
<a name="l00109"></a>00109         opp_error(<span class="stringliteral">&quot;Radio set to invalid channel %d. Please make sure the&quot;</span>
<a name="l00110"></a>00110               <span class="stringliteral">&quot; phy modules parameter \&quot;initialRadioChannel\&quot; is set to&quot;</span>
<a name="l00111"></a>00111               <span class="stringliteral">&quot; a valid 802.11 channel (1 to 14)!&quot;</span>, channel);
<a name="l00112"></a>00112       }
<a name="l00113"></a>00113       <a class="code" href="a00115.html#a67eba657efe23f5e5c21904f4744261d" title="Stores the center frequency the Mac uses.">centerFreq</a> = CENTER_FREQUENCIES[channel];
<a name="l00114"></a>00114 
<a name="l00115"></a>00115         <span class="keywordtype">bool</span> found = <span class="keyword">false</span>;
<a name="l00116"></a>00116         <a class="code" href="a00115.html#a126c9db5a54bafa6ad74eb3ee24bd936" title="Current bit rate at which data is transmitted.">bitrate</a> = hasPar(<span class="stringliteral">&quot;bitrate&quot;</span>) ? par(<span class="stringliteral">&quot;bitrate&quot;</span>).doubleValue() : BITRATES_80211[0];
<a name="l00117"></a>00117         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; 4; i++) {
<a name="l00118"></a>00118             <span class="keywordflow">if</span>(<a class="code" href="a00115.html#a126c9db5a54bafa6ad74eb3ee24bd936" title="Current bit rate at which data is transmitted.">bitrate</a> == BITRATES_80211[i]) {
<a name="l00119"></a>00119                 found = <span class="keyword">true</span>;
<a name="l00120"></a>00120                 <span class="keywordflow">break</span>;
<a name="l00121"></a>00121             }
<a name="l00122"></a>00122         }
<a name="l00123"></a>00123         <span class="keywordflow">if</span>(!found) <a class="code" href="a00115.html#a126c9db5a54bafa6ad74eb3ee24bd936" title="Current bit rate at which data is transmitted.">bitrate</a> = BITRATES_80211[0];
<a name="l00124"></a>00124         <a class="code" href="a00115.html#a226566e4a56cfed2928acc87ff3af90a" title="Default bitrate.">defaultBitrate</a> = <a class="code" href="a00115.html#a126c9db5a54bafa6ad74eb3ee24bd936" title="Current bit rate at which data is transmitted.">bitrate</a>;
<a name="l00125"></a>00125 
<a name="l00126"></a>00126         <a class="code" href="a00115.html#a1cd38454a518f922ba57f68d22e2f31e" title="Hold RSSI thresholds at which to change the bitrates.">snrThresholds</a>.push_back(hasPar(<span class="stringliteral">&quot;snr2Mbit&quot;</span>) ? par(<span class="stringliteral">&quot;snr2Mbit&quot;</span>).doubleValue() : 100);
<a name="l00127"></a>00127         <a class="code" href="a00115.html#a1cd38454a518f922ba57f68d22e2f31e" title="Hold RSSI thresholds at which to change the bitrates.">snrThresholds</a>.push_back(hasPar(<span class="stringliteral">&quot;snr5Mbit&quot;</span>) ? par(<span class="stringliteral">&quot;snr5Mbit&quot;</span>).doubleValue() : 100);
<a name="l00128"></a>00128         <a class="code" href="a00115.html#a1cd38454a518f922ba57f68d22e2f31e" title="Hold RSSI thresholds at which to change the bitrates.">snrThresholds</a>.push_back(hasPar(<span class="stringliteral">&quot;snr11Mbit&quot;</span>) ? par(<span class="stringliteral">&quot;snr11Mbit&quot;</span>).doubleValue() : 100);
<a name="l00129"></a>00129         <a class="code" href="a00115.html#a1cd38454a518f922ba57f68d22e2f31e" title="Hold RSSI thresholds at which to change the bitrates.">snrThresholds</a>.push_back(111111111); <span class="comment">// sentinel</span>
<a name="l00130"></a>00130 
<a name="l00131"></a>00131         <a class="code" href="a00115.html#ae62ff2c9617e5782f6f7231e36d1574d" title="Keep information for this many neighbors.">neighborhoodCacheSize</a> = hasPar(<span class="stringliteral">&quot;neighborhoodCacheSize&quot;</span>) ? par(<span class="stringliteral">&quot;neighborhoodCacheSize&quot;</span>).longValue() : 0;
<a name="l00132"></a>00132         <a class="code" href="a00115.html#aede2e9e4e32ef871e3a59c51564123de" title="Consider information in cache outdate if it is older than this.">neighborhoodCacheMaxAge</a> = hasPar(<span class="stringliteral">&quot;neighborhoodCacheMaxAge&quot;</span>) ? par(<span class="stringliteral">&quot;neighborhoodCacheMaxAge&quot;</span>).longValue() : 10000;
<a name="l00133"></a>00133 
<a name="l00134"></a>00134         debugEV &lt;&lt; <span class="stringliteral">&quot; MAC Address: &quot;</span> &lt;&lt; <a class="code" href="a00022.html#a8a26df9da07801d8ccb530530ef57ee2" title="MAC address.">myMacAddr</a>
<a name="l00135"></a>00135            &lt;&lt; <span class="stringliteral">&quot; rtsCtsThreshold: &quot;</span> &lt;&lt; <a class="code" href="a00115.html#a6ad4dd93415c98c969df05f53d739cfd" title="Number of bits in a packet before RTS/CTS is used.">rtsCtsThreshold</a>
<a name="l00136"></a>00136            &lt;&lt; <span class="stringliteral">&quot; bitrate: &quot;</span> &lt;&lt; <a class="code" href="a00115.html#a126c9db5a54bafa6ad74eb3ee24bd936" title="Current bit rate at which data is transmitted.">bitrate</a>
<a name="l00137"></a>00137            &lt;&lt; <span class="stringliteral">&quot; channel: &quot;</span> &lt;&lt; channel
<a name="l00138"></a>00138            &lt;&lt; <span class="stringliteral">&quot; autoBitrate: &quot;</span> &lt;&lt; <a class="code" href="a00115.html#a979883a8da4b308de4a8e79b5bbbe2e6" title="Auto bit rate adaptation -- switch.">autoBitrate</a>
<a name="l00139"></a>00139            &lt;&lt; <span class="stringliteral">&quot; 2MBit: &quot;</span> &lt;&lt; <a class="code" href="a00115.html#a1cd38454a518f922ba57f68d22e2f31e" title="Hold RSSI thresholds at which to change the bitrates.">snrThresholds</a>[0]
<a name="l00140"></a>00140            &lt;&lt; <span class="stringliteral">&quot; 5.5MBit: &quot;</span> &lt;&lt;<a class="code" href="a00115.html#a1cd38454a518f922ba57f68d22e2f31e" title="Hold RSSI thresholds at which to change the bitrates.">snrThresholds</a>[1]
<a name="l00141"></a>00141            &lt;&lt; <span class="stringliteral">&quot; 11MBit: &quot;</span> &lt;&lt; <a class="code" href="a00115.html#a1cd38454a518f922ba57f68d22e2f31e" title="Hold RSSI thresholds at which to change the bitrates.">snrThresholds</a>[2]
<a name="l00142"></a>00142            &lt;&lt; <span class="stringliteral">&quot; neighborhoodCacheSize &quot;</span> &lt;&lt; <a class="code" href="a00115.html#ae62ff2c9617e5782f6f7231e36d1574d" title="Keep information for this many neighbors.">neighborhoodCacheSize</a>
<a name="l00143"></a>00143            &lt;&lt; <span class="stringliteral">&quot; neighborhoodCacheMaxAge &quot;</span> &lt;&lt; <a class="code" href="a00115.html#aede2e9e4e32ef871e3a59c51564123de" title="Consider information in cache outdate if it is older than this.">neighborhoodCacheMaxAge</a>
<a name="l00144"></a>00144            &lt;&lt; endl;
<a name="l00145"></a>00145 
<a name="l00146"></a>00146         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; 3; i++) {
<a name="l00147"></a>00147             <a class="code" href="a00115.html#a1cd38454a518f922ba57f68d22e2f31e" title="Hold RSSI thresholds at which to change the bitrates.">snrThresholds</a>[i] = <a class="code" href="a00092.html#af308407856d9835b103f2421e373ee28">FWMath::dBm2mW</a>(<a class="code" href="a00115.html#a1cd38454a518f922ba57f68d22e2f31e" title="Hold RSSI thresholds at which to change the bitrates.">snrThresholds</a>[i]);
<a name="l00148"></a>00148         }
<a name="l00149"></a>00149 
<a name="l00150"></a>00150         <a class="code" href="a00115.html#a58484d1a6f2031548d433d18438042e9" title="remaining backoff time. If the backoff timer is interrupted, this variable holds...">remainingBackoff</a> = <a class="code" href="a00115.html#ade2c913df312fd4fc46106c1134889b8" title="Compute a backoff value.">backoff</a>();
<a name="l00151"></a>00151         <a class="code" href="a00115.html#a59cb9e6071f33bc460a2f3a662c4bc59" title="Starts a channel sense request which sense the channel for the passed duration or...">senseChannelWhileIdle</a>(<a class="code" href="a00115.html#a58484d1a6f2031548d433d18438042e9" title="remaining backoff time. If the backoff timer is interrupted, this variable holds...">remainingBackoff</a> + <a class="code" href="a00115.html#a4a9d1c8d45c46f18afa0f07f5b6572f4" title="current IFS value (DIFS or EIFS) If an error has been detected, the next backoff...">currentIFS</a>);
<a name="l00152"></a>00152     }
<a name="l00153"></a>00153 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6732e4a776e78432bf5dd9dd26de2f7d"></a><!-- doxytag: member="Mac80211::packetDuration" ref="a6732e4a776e78432bf5dd9dd26de2f7d" args="(double bits, double br)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">simtime_t Mac80211::packetDuration </td>
          <td>(</td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>bits</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>br</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>computes the duration of a transmission over the physical channel, given a certain bitrate </p>
<p>Computes the duration of the transmission of a frame over the physical channel. 'bits' should be the total length of the mac packet in bits excluding the phy header length. </p>

<p>Definition at line <a class="el" href="a00337_source.html#l01107">1107</a> of file <a class="el" href="a00337_source.html">Mac80211.cc</a>.</p>

<p>References <a class="el" href="a00243_source.html#l00093">BaseMacLayer::phyHeaderLength</a>.</p>

<p>Referenced by <a class="el" href="a00337_source.html#l00839">sendACKframe()</a>, <a class="el" href="a00337_source.html#l00935">sendBROADCASTframe()</a>, <a class="el" href="a00337_source.html#l00904">sendCTSframe()</a>, <a class="el" href="a00337_source.html#l00803">sendDATAframe()</a>, <a class="el" href="a00337_source.html#l00867">sendRTSframe()</a>, and <a class="el" href="a00337_source.html#l01081">timeOut()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01108"></a>01108 {
<a name="l01109"></a>01109     <span class="keywordflow">return</span> bits / br + <a class="code" href="a00022.html#ac01d16af5596dd0a23f8906a7225d5b0" title="The length of the phy header (in bits).">phyHeaderLength</a> / BITRATE_HEADER;
<a name="l01110"></a>01110 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1c404a5176db493c2fefb71537783607"></a><!-- doxytag: member="Mac80211::sendACKframe" ref="a1c404a5176db493c2fefb71537783607" args="(Mac80211Pkt *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Mac80211::sendACKframe </td>
          <td>(</td>
          <td class="paramtype">Mac80211Pkt *&nbsp;</td>
          <td class="paramname"> <em>af</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>send Acknoledgement </p>
<p>Send an ACK frame.Called by HandleEndSifsTimer() </p>

<p>Definition at line <a class="el" href="a00337_source.html#l00839">839</a> of file <a class="el" href="a00337_source.html">Mac80211.cc</a>.</p>

<p>References <a class="el" href="a00337_source.html#l01045">createSignal()</a>, <a class="el" href="a00276_source.html#l00050">PhyToMacControlInfo::getDeciderResult()</a>, <a class="el" href="a00243_source.html#l00081">BaseMacLayer::myMacAddr</a>, <a class="el" href="a00337_source.html#l01107">packetDuration()</a>, <a class="el" href="a00240_source.html#l00110">BaseLayer::sendDown()</a>, <a class="el" href="a00242_source.html#l00325">BaseMacLayer::setDownControlInfo()</a>, <a class="el" href="a00337_source.html#l01130">setState()</a>, and <a class="el" href="a00338_source.html#l00281">txPower</a>.</p>

<p>Referenced by <a class="el" href="a00337_source.html#l00741">handleEndSifsTimer()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00840"></a>00840 {
<a name="l00841"></a>00841     Mac80211Pkt *frame = <span class="keyword">new</span> Mac80211Pkt(<span class="stringliteral">&quot;wlan-ack&quot;</span>);
<a name="l00842"></a>00842 
<a name="l00843"></a>00843     <span class="keywordtype">double</span> br = <span class="keyword">static_cast&lt;</span><span class="keyword">const </span><a class="code" href="a00073.html" title="Defines an extended DeciderResult for the 80211 protocol which stores the bit-rate...">DeciderResult80211</a>*<span class="keyword">&gt;</span>(<a class="code" href="a00153.html#a695fcb4091796018a3315486acafc9b0" title="Returns the result of the evaluation of the Decider.">PhyToMacControlInfo::getDeciderResult</a>(af))-&gt;getBitrate();
<a name="l00844"></a>00844     <span class="keyword">delete</span> af-&gt;removeControlInfo();
<a name="l00845"></a>00845 
<a name="l00846"></a>00846     <a class="code" href="a00022.html#ab57af129814d784f2a96978f036c575a" title="Attaches a &amp;quot;control info&amp;quot; (MacToPhy) structure (object) to the message...">setDownControlInfo</a>(frame, <a class="code" href="a00115.html#a3a62f334346a15619853a8c6c87367aa" title="Creates the signal to be used for a packet to be sent.">createSignal</a>(simTime(), <a class="code" href="a00115.html#a6732e4a776e78432bf5dd9dd26de2f7d" title="computes the duration of a transmission over the physical channel, given a certain...">packetDuration</a>(LENGTH_ACK, br), <a class="code" href="a00115.html#a592eee2a24a6fcadd6fdf912a101719f" title="The power at which data is transmitted.">txPower</a>, br));
<a name="l00847"></a>00847     frame-&gt;setKind(ACK);
<a name="l00848"></a>00848     frame-&gt;setBitLength((<span class="keywordtype">int</span>)LENGTH_ACK);
<a name="l00849"></a>00849 
<a name="l00850"></a>00850     <span class="comment">// the dest address must be the src adress of the RTS or the DATA</span>
<a name="l00851"></a>00851     <span class="comment">// packet received. The src adress is the adress of the node</span>
<a name="l00852"></a>00852     frame-&gt;setSrcAddr(<a class="code" href="a00022.html#a8a26df9da07801d8ccb530530ef57ee2" title="MAC address.">myMacAddr</a>);
<a name="l00853"></a>00853     frame-&gt;setDestAddr(af-&gt;getSrcAddr());
<a name="l00854"></a>00854     frame-&gt;setDuration(0);
<a name="l00855"></a>00855 
<a name="l00856"></a>00856     <a class="code" href="a00021.html#a1873d6e3fc6d92cf8482b39f1c5ac6c8" title="Sends a message to the lower layer.">sendDown</a>(frame);
<a name="l00857"></a>00857     debugEV &lt;&lt; <span class="stringliteral">&quot;sent ACK frame!\n&quot;</span>;
<a name="l00858"></a>00858 
<a name="l00859"></a>00859     <span class="comment">// update state and display</span>
<a name="l00860"></a>00860     <a class="code" href="a00115.html#a9fc6eb078e53740d354f8ea7b9d94713" title="Sets the state, and produces a log message in between.">setState</a>(BUSY);
<a name="l00861"></a>00861 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a26b30d048980b56d79c04e859bfce009"></a><!-- doxytag: member="Mac80211::sendBROADCASTframe" ref="a26b30d048980b56d79c04e859bfce009" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Mac80211::sendBROADCASTframe </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>send broadcast frame </p>
<p>Send a BROADCAST frame.Called by handleContentionTimer() </p>

<p>Definition at line <a class="el" href="a00337_source.html#l00935">935</a> of file <a class="el" href="a00337_source.html">Mac80211.cc</a>.</p>

<p>References <a class="el" href="a00337_source.html#l01045">createSignal()</a>, <a class="el" href="a00338_source.html#l00301">fromUpperLayer</a>, <a class="el" href="a00337_source.html#l01107">packetDuration()</a>, <a class="el" href="a00337_source.html#l01190">retrieveBitrate()</a>, <a class="el" href="a00240_source.html#l00110">BaseLayer::sendDown()</a>, <a class="el" href="a00242_source.html#l00325">BaseMacLayer::setDownControlInfo()</a>, <a class="el" href="a00337_source.html#l01130">setState()</a>, and <a class="el" href="a00338_source.html#l00281">txPower</a>.</p>

<p>Referenced by <a class="el" href="a00337_source.html#l00634">handleEndContentionTimer()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00936"></a>00936 {
<a name="l00937"></a>00937     <span class="comment">// send a copy of the frame in front of the queue</span>
<a name="l00938"></a>00938     Mac80211Pkt *frame = <span class="keyword">static_cast&lt;</span>Mac80211Pkt *<span class="keyword">&gt;</span>(<a class="code" href="a00115.html#a969e8e3a592dffccea28596c61b2af50" title="Buffering of messages from upper layer.">fromUpperLayer</a>.front()-&gt;dup());
<a name="l00939"></a>00939 
<a name="l00940"></a>00940     <span class="keywordtype">double</span> br = <a class="code" href="a00115.html#a7905be98b60b2a709dfbcd7e16bc761e" title="figure out at which bitrate to send to this particular destination">retrieveBitrate</a>(frame-&gt;getDestAddr());
<a name="l00941"></a>00941 
<a name="l00942"></a>00942     simtime_t duration = <a class="code" href="a00115.html#a6732e4a776e78432bf5dd9dd26de2f7d" title="computes the duration of a transmission over the physical channel, given a certain...">packetDuration</a>(frame-&gt;getBitLength(), br);
<a name="l00943"></a>00943     <a class="code" href="a00022.html#ab57af129814d784f2a96978f036c575a" title="Attaches a &amp;quot;control info&amp;quot; (MacToPhy) structure (object) to the message...">setDownControlInfo</a>(frame, <a class="code" href="a00115.html#a3a62f334346a15619853a8c6c87367aa" title="Creates the signal to be used for a packet to be sent.">createSignal</a>(simTime(), duration, <a class="code" href="a00115.html#a592eee2a24a6fcadd6fdf912a101719f" title="The power at which data is transmitted.">txPower</a>, br));
<a name="l00944"></a>00944 
<a name="l00945"></a>00945     frame-&gt;setKind(BROADCAST);
<a name="l00946"></a>00946 
<a name="l00947"></a>00947     <a class="code" href="a00021.html#a1873d6e3fc6d92cf8482b39f1c5ac6c8" title="Sends a message to the lower layer.">sendDown</a>(frame);
<a name="l00948"></a>00948     <span class="comment">// update state and display</span>
<a name="l00949"></a>00949     <a class="code" href="a00115.html#a9fc6eb078e53740d354f8ea7b9d94713" title="Sets the state, and produces a log message in between.">setState</a>(BUSY);
<a name="l00950"></a>00950 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1fd59a589e53facb68c13be84521a49e"></a><!-- doxytag: member="Mac80211::sendCTSframe" ref="a1fd59a589e53facb68c13be84521a49e" args="(Mac80211Pkt *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Mac80211::sendCTSframe </td>
          <td>(</td>
          <td class="paramtype">Mac80211Pkt *&nbsp;</td>
          <td class="paramname"> <em>af</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>send CTS frame </p>
<p>Send a CTS frame.Called by HandleEndSifsTimer() </p>

<p>Definition at line <a class="el" href="a00337_source.html#l00904">904</a> of file <a class="el" href="a00337_source.html">Mac80211.cc</a>.</p>

<p>References <a class="el" href="a00337_source.html#l01045">createSignal()</a>, <a class="el" href="a00276_source.html#l00050">PhyToMacControlInfo::getDeciderResult()</a>, <a class="el" href="a00243_source.html#l00081">BaseMacLayer::myMacAddr</a>, <a class="el" href="a00337_source.html#l01107">packetDuration()</a>, <a class="el" href="a00240_source.html#l00110">BaseLayer::sendDown()</a>, <a class="el" href="a00242_source.html#l00325">BaseMacLayer::setDownControlInfo()</a>, <a class="el" href="a00337_source.html#l01130">setState()</a>, and <a class="el" href="a00338_source.html#l00281">txPower</a>.</p>

<p>Referenced by <a class="el" href="a00337_source.html#l00741">handleEndSifsTimer()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00905"></a>00905 {
<a name="l00906"></a>00906     Mac80211Pkt *frame = <span class="keyword">new</span> Mac80211Pkt(<span class="stringliteral">&quot;wlan-cts&quot;</span>);
<a name="l00907"></a>00907 
<a name="l00908"></a>00908     <span class="keywordtype">double</span> br = <span class="keyword">static_cast&lt;</span><span class="keyword">const </span><a class="code" href="a00073.html" title="Defines an extended DeciderResult for the 80211 protocol which stores the bit-rate...">DeciderResult80211</a>*<span class="keyword">&gt;</span>(<a class="code" href="a00153.html#a695fcb4091796018a3315486acafc9b0" title="Returns the result of the evaluation of the Decider.">PhyToMacControlInfo::getDeciderResult</a>(af))-&gt;getBitrate();
<a name="l00909"></a>00909     <span class="keyword">delete</span> af-&gt;removeControlInfo();
<a name="l00910"></a>00910 
<a name="l00911"></a>00911     <a class="code" href="a00022.html#ab57af129814d784f2a96978f036c575a" title="Attaches a &amp;quot;control info&amp;quot; (MacToPhy) structure (object) to the message...">setDownControlInfo</a>(frame, <a class="code" href="a00115.html#a3a62f334346a15619853a8c6c87367aa" title="Creates the signal to be used for a packet to be sent.">createSignal</a>(simTime(), <a class="code" href="a00115.html#a6732e4a776e78432bf5dd9dd26de2f7d" title="computes the duration of a transmission over the physical channel, given a certain...">packetDuration</a>(LENGTH_CTS, br), <a class="code" href="a00115.html#a592eee2a24a6fcadd6fdf912a101719f" title="The power at which data is transmitted.">txPower</a>, br));
<a name="l00912"></a>00912 
<a name="l00913"></a>00913     frame-&gt;setKind(CTS);
<a name="l00914"></a>00914     frame-&gt;setBitLength((<span class="keywordtype">int</span>)LENGTH_CTS);
<a name="l00915"></a>00915 
<a name="l00916"></a>00916     <span class="comment">// the dest adress must be the src adress of the RTS received. The</span>
<a name="l00917"></a>00917     <span class="comment">// src adress is the adress of the node</span>
<a name="l00918"></a>00918     frame-&gt;setSrcAddr(<a class="code" href="a00022.html#a8a26df9da07801d8ccb530530ef57ee2" title="MAC address.">myMacAddr</a>);
<a name="l00919"></a>00919     frame-&gt;setDestAddr(af-&gt;getSrcAddr());
<a name="l00920"></a>00920 
<a name="l00921"></a>00921     frame-&gt;setDuration(af-&gt;getDuration() - SIFS - <a class="code" href="a00115.html#a6732e4a776e78432bf5dd9dd26de2f7d" title="computes the duration of a transmission over the physical channel, given a certain...">packetDuration</a>(LENGTH_CTS, br));
<a name="l00922"></a>00922 
<a name="l00923"></a>00923     <span class="comment">//scheduleAt(simTime() + af-&gt;getDuration() - packetDuration(LENGTH_ACK, br) - 2 * SIFS + delta, timeout);</span>
<a name="l00924"></a>00924     debugEV &lt;&lt; <span class="stringliteral">&quot; Mac80211::sendCTSframe duration: &quot;</span> &lt;&lt;  <a class="code" href="a00115.html#a6732e4a776e78432bf5dd9dd26de2f7d" title="computes the duration of a transmission over the physical channel, given a certain...">packetDuration</a>(LENGTH_CTS, br) &lt;&lt; <span class="stringliteral">&quot; br: &quot;</span> &lt;&lt; br &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00925"></a>00925     <span class="comment">// send CTS frame</span>
<a name="l00926"></a>00926     <a class="code" href="a00021.html#a1873d6e3fc6d92cf8482b39f1c5ac6c8" title="Sends a message to the lower layer.">sendDown</a>(frame);
<a name="l00927"></a>00927 
<a name="l00928"></a>00928     <span class="comment">// update state and display</span>
<a name="l00929"></a>00929     <a class="code" href="a00115.html#a9fc6eb078e53740d354f8ea7b9d94713" title="Sets the state, and produces a log message in between.">setState</a>(WFDATA);
<a name="l00930"></a>00930 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7a4ff22b4b999827a898794923115880"></a><!-- doxytag: member="Mac80211::sendDATAframe" ref="a7a4ff22b4b999827a898794923115880" args="(Mac80211Pkt *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Mac80211::sendDATAframe </td>
          <td>(</td>
          <td class="paramtype">Mac80211Pkt *&nbsp;</td>
          <td class="paramname"> <em>af</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>send data frame </p>
<p>Send a DATA frame. Called by HandleEndSifsTimer() or <a class="el" href="a00115.html#a0a87fa1791117ef1dd1841ba217e4245" title="handle end of contention">handleEndContentionTimer()</a> </p>

<p>Definition at line <a class="el" href="a00337_source.html#l00803">803</a> of file <a class="el" href="a00337_source.html">Mac80211.cc</a>.</p>

<p>References <a class="el" href="a00337_source.html#l01045">createSignal()</a>, <a class="el" href="a00338_source.html#l00301">fromUpperLayer</a>, <a class="el" href="a00276_source.html#l00050">PhyToMacControlInfo::getDeciderResult()</a>, <a class="el" href="a00243_source.html#l00081">BaseMacLayer::myMacAddr</a>, <a class="el" href="a00337_source.html#l01107">packetDuration()</a>, <a class="el" href="a00337_source.html#l01190">retrieveBitrate()</a>, <a class="el" href="a00240_source.html#l00110">BaseLayer::sendDown()</a>, <a class="el" href="a00242_source.html#l00325">BaseMacLayer::setDownControlInfo()</a>, <a class="el" href="a00337_source.html#l01130">setState()</a>, <a class="el" href="a00338_source.html#l00311">shortRetryCounter</a>, <a class="el" href="a00338_source.html#l00253">timeout</a>, <a class="el" href="a00337_source.html#l01081">timeOut()</a>, and <a class="el" href="a00338_source.html#l00281">txPower</a>.</p>

<p>Referenced by <a class="el" href="a00337_source.html#l00634">handleEndContentionTimer()</a>, and <a class="el" href="a00337_source.html#l00741">handleEndSifsTimer()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00804"></a>00804 {
<a name="l00805"></a>00805     Mac80211Pkt *frame = <span class="keyword">static_cast&lt;</span>Mac80211Pkt *<span class="keyword">&gt;</span>(<a class="code" href="a00115.html#a969e8e3a592dffccea28596c61b2af50" title="Buffering of messages from upper layer.">fromUpperLayer</a>.front()-&gt;dup());
<a name="l00806"></a>00806     <span class="keywordtype">double</span> br;
<a name="l00807"></a>00807 
<a name="l00808"></a>00808     <span class="keywordflow">if</span>(af) {
<a name="l00809"></a>00809         br = <span class="keyword">static_cast&lt;</span><span class="keyword">const </span><a class="code" href="a00073.html" title="Defines an extended DeciderResult for the 80211 protocol which stores the bit-rate...">DeciderResult80211</a>*<span class="keyword">&gt;</span>(<a class="code" href="a00153.html#a695fcb4091796018a3315486acafc9b0" title="Returns the result of the evaluation of the Decider.">PhyToMacControlInfo::getDeciderResult</a>(af))-&gt;getBitrate();
<a name="l00810"></a>00810 
<a name="l00811"></a>00811         <span class="keyword">delete</span> af-&gt;removeControlInfo();
<a name="l00812"></a>00812     }
<a name="l00813"></a>00813     <span class="keywordflow">else</span> {
<a name="l00814"></a>00814        br  = <a class="code" href="a00115.html#a7905be98b60b2a709dfbcd7e16bc761e" title="figure out at which bitrate to send to this particular destination">retrieveBitrate</a>(frame-&gt;getDestAddr());
<a name="l00815"></a>00815 
<a name="l00816"></a>00816        <span class="keywordflow">if</span>(<a class="code" href="a00115.html#a9bbc3d71eddb62c4e12dcd500a58b0bb" title="Number of frame transmission attempt.">shortRetryCounter</a>) frame-&gt;setRetry(<span class="keyword">true</span>);
<a name="l00817"></a>00817     }
<a name="l00818"></a>00818     simtime_t duration = <a class="code" href="a00115.html#a6732e4a776e78432bf5dd9dd26de2f7d" title="computes the duration of a transmission over the physical channel, given a certain...">packetDuration</a>(frame-&gt;getBitLength(), br);
<a name="l00819"></a>00819     <a class="code" href="a00022.html#ab57af129814d784f2a96978f036c575a" title="Attaches a &amp;quot;control info&amp;quot; (MacToPhy) structure (object) to the message...">setDownControlInfo</a>(frame, <a class="code" href="a00115.html#a3a62f334346a15619853a8c6c87367aa" title="Creates the signal to be used for a packet to be sent.">createSignal</a>(simTime(), duration, <a class="code" href="a00115.html#a592eee2a24a6fcadd6fdf912a101719f" title="The power at which data is transmitted.">txPower</a>, br));
<a name="l00820"></a>00820     <span class="comment">// build a copy of the frame in front of the queue&apos;</span>
<a name="l00821"></a>00821     frame-&gt;setSrcAddr(<a class="code" href="a00022.html#a8a26df9da07801d8ccb530530ef57ee2" title="MAC address.">myMacAddr</a>);
<a name="l00822"></a>00822     frame-&gt;setKind(DATA);
<a name="l00823"></a>00823     frame-&gt;setDuration(SIFS + <a class="code" href="a00115.html#a6732e4a776e78432bf5dd9dd26de2f7d" title="computes the duration of a transmission over the physical channel, given a certain...">packetDuration</a>(LENGTH_ACK, br));
<a name="l00824"></a>00824 
<a name="l00825"></a>00825     <span class="comment">// schedule time out</span>
<a name="l00826"></a>00826     scheduleAt(simTime() + <a class="code" href="a00115.html#a424851e88bb229fcc3c59cfea80a9079" title="return a timeOut value for a certain type of frame">timeOut</a>(DATA, br), <a class="code" href="a00115.html#a2d31f97b0662b8e37f090c3b996cec82" title="Timer used for time-outs after the transmission of a RTS, a CTS, or a DATA packet...">timeout</a>);
<a name="l00827"></a>00827     debugEV &lt;&lt; <span class="stringliteral">&quot;sending DATA  to &quot;</span> &lt;&lt; frame-&gt;getDestAddr() &lt;&lt; <span class="stringliteral">&quot; with bitrate &quot;</span> &lt;&lt; br &lt;&lt; endl;
<a name="l00828"></a>00828     <span class="comment">// send DATA frame</span>
<a name="l00829"></a>00829     <a class="code" href="a00021.html#a1873d6e3fc6d92cf8482b39f1c5ac6c8" title="Sends a message to the lower layer.">sendDown</a>(frame);
<a name="l00830"></a>00830 
<a name="l00831"></a>00831     <span class="comment">// update state and display</span>
<a name="l00832"></a>00832     <a class="code" href="a00115.html#a9fc6eb078e53740d354f8ea7b9d94713" title="Sets the state, and produces a log message in between.">setState</a>(WFACK);
<a name="l00833"></a>00833 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a3104750758ab171b20ffcfeae0079a78"></a><!-- doxytag: member="Mac80211::sendRTSframe" ref="a3104750758ab171b20ffcfeae0079a78" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Mac80211::sendRTSframe </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>send RTS frame </p>
<p>Send a RTS frame.Called by handleContentionTimer() </p>

<p>Definition at line <a class="el" href="a00337_source.html#l00867">867</a> of file <a class="el" href="a00337_source.html">Mac80211.cc</a>.</p>

<p>References <a class="el" href="a00337_source.html#l01045">createSignal()</a>, <a class="el" href="a00338_source.html#l00301">fromUpperLayer</a>, <a class="el" href="a00337_source.html#l01107">packetDuration()</a>, <a class="el" href="a00337_source.html#l01190">retrieveBitrate()</a>, <a class="el" href="a00240_source.html#l00110">BaseLayer::sendDown()</a>, <a class="el" href="a00242_source.html#l00325">BaseMacLayer::setDownControlInfo()</a>, <a class="el" href="a00337_source.html#l01130">setState()</a>, <a class="el" href="a00338_source.html#l00253">timeout</a>, <a class="el" href="a00337_source.html#l01081">timeOut()</a>, and <a class="el" href="a00338_source.html#l00281">txPower</a>.</p>

<p>Referenced by <a class="el" href="a00337_source.html#l00634">handleEndContentionTimer()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00868"></a>00868 {
<a name="l00869"></a>00869     Mac80211Pkt *frame = <span class="keyword">new</span> Mac80211Pkt(<span class="stringliteral">&quot;wlan-rts&quot;</span>);
<a name="l00870"></a>00870 
<a name="l00871"></a>00871     <span class="keyword">const</span> Mac80211Pkt* frameToSend = <a class="code" href="a00115.html#a969e8e3a592dffccea28596c61b2af50" title="Buffering of messages from upper layer.">fromUpperLayer</a>.front();
<a name="l00872"></a>00872     <span class="keywordtype">double</span> br = <a class="code" href="a00115.html#a7905be98b60b2a709dfbcd7e16bc761e" title="figure out at which bitrate to send to this particular destination">retrieveBitrate</a>(frameToSend-&gt;getDestAddr());
<a name="l00873"></a>00873 
<a name="l00874"></a>00874     <a class="code" href="a00022.html#ab57af129814d784f2a96978f036c575a" title="Attaches a &amp;quot;control info&amp;quot; (MacToPhy) structure (object) to the message...">setDownControlInfo</a>(frame, <a class="code" href="a00115.html#a3a62f334346a15619853a8c6c87367aa" title="Creates the signal to be used for a packet to be sent.">createSignal</a>(simTime(),<a class="code" href="a00115.html#a6732e4a776e78432bf5dd9dd26de2f7d" title="computes the duration of a transmission over the physical channel, given a certain...">packetDuration</a>(LENGTH_RTS, br), <a class="code" href="a00115.html#a592eee2a24a6fcadd6fdf912a101719f" title="The power at which data is transmitted.">txPower</a>, br));
<a name="l00875"></a>00875 
<a name="l00876"></a>00876     frame-&gt;setKind(RTS);
<a name="l00877"></a>00877     frame-&gt;setBitLength((<span class="keywordtype">int</span>)LENGTH_RTS);
<a name="l00878"></a>00878 
<a name="l00879"></a>00879     <span class="comment">// the src adress and dest address are copied in the frame in the queue (frame to be sent)</span>
<a name="l00880"></a>00880     frame-&gt;setSrcAddr(frameToSend-&gt;getSrcAddr());
<a name="l00881"></a>00881     frame-&gt;setDestAddr(frameToSend-&gt;getDestAddr());
<a name="l00882"></a>00882 
<a name="l00883"></a>00883     <span class="keywordtype">double</span> packetSize = frameToSend-&gt;getBitLength();
<a name="l00884"></a>00884     frame-&gt;setDuration(3 * SIFS + <a class="code" href="a00115.html#a6732e4a776e78432bf5dd9dd26de2f7d" title="computes the duration of a transmission over the physical channel, given a certain...">packetDuration</a>(LENGTH_CTS, br) +
<a name="l00885"></a>00885                        <a class="code" href="a00115.html#a6732e4a776e78432bf5dd9dd26de2f7d" title="computes the duration of a transmission over the physical channel, given a certain...">packetDuration</a>(packetSize, br) +
<a name="l00886"></a>00886                        <a class="code" href="a00115.html#a6732e4a776e78432bf5dd9dd26de2f7d" title="computes the duration of a transmission over the physical channel, given a certain...">packetDuration</a>(LENGTH_ACK, br));
<a name="l00887"></a>00887 
<a name="l00888"></a>00888     debugEV &lt;&lt; <span class="stringliteral">&quot; Mac80211::sendRTSframe duration: &quot;</span> &lt;&lt;  <a class="code" href="a00115.html#a6732e4a776e78432bf5dd9dd26de2f7d" title="computes the duration of a transmission over the physical channel, given a certain...">packetDuration</a>(LENGTH_RTS, br) &lt;&lt; <span class="stringliteral">&quot; br: &quot;</span> &lt;&lt; br &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00889"></a>00889 
<a name="l00890"></a>00890     <span class="comment">// schedule time-out</span>
<a name="l00891"></a>00891     scheduleAt(simTime() + <a class="code" href="a00115.html#a424851e88bb229fcc3c59cfea80a9079" title="return a timeOut value for a certain type of frame">timeOut</a>(RTS, br), <a class="code" href="a00115.html#a2d31f97b0662b8e37f090c3b996cec82" title="Timer used for time-outs after the transmission of a RTS, a CTS, or a DATA packet...">timeout</a>);
<a name="l00892"></a>00892 
<a name="l00893"></a>00893     <span class="comment">// send RTS frame</span>
<a name="l00894"></a>00894     <a class="code" href="a00021.html#a1873d6e3fc6d92cf8482b39f1c5ac6c8" title="Sends a message to the lower layer.">sendDown</a>(frame);
<a name="l00895"></a>00895 
<a name="l00896"></a>00896     <span class="comment">// update state and display</span>
<a name="l00897"></a>00897     <a class="code" href="a00115.html#a9fc6eb078e53740d354f8ea7b9d94713" title="Sets the state, and produces a log message in between.">setState</a>(WFCTS);
<a name="l00898"></a>00898 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a59cb9e6071f33bc460a2f3a662c4bc59"></a><!-- doxytag: member="Mac80211::senseChannelWhileIdle" ref="a59cb9e6071f33bc460a2f3a662c4bc59" args="(simtime_t_cref duration)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Mac80211::senseChannelWhileIdle </td>
          <td>(</td>
          <td class="paramtype">simtime_t_cref&nbsp;</td>
          <td class="paramname"> <em>duration</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Starts a channel sense request which sense the channel for the passed duration or until the channel is busy. </p>
<p>Used during contend state to check if the channel is free. </p>

<p>Definition at line <a class="el" href="a00337_source.html#l00155">155</a> of file <a class="el" href="a00337_source.html">Mac80211.cc</a>.</p>

<p>References <a class="el" href="a00338_source.html#l00268">chSenseStart</a>, <a class="el" href="a00338_source.html#l00260">contention</a>, and <a class="el" href="a00240_source.html#l00130">BaseLayer::sendControlDown()</a>.</p>

<p>Referenced by <a class="el" href="a00337_source.html#l00959">beginNewCycle()</a>, and <a class="el" href="a00337_source.html#l00061">initialize()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00155"></a>00155                                                             {
<a name="l00156"></a>00156   <span class="keywordflow">if</span>(<a class="code" href="a00115.html#a7bd4f3adc205b150f9fa406fa582f0b6" title="Used to sense if the channel is idle for contention periods.">contention</a>-&gt;isScheduled()) {
<a name="l00157"></a>00157     error(<span class="stringliteral">&quot;Cannot start a new channel sense request because already sensing the channel!&quot;</span>);
<a name="l00158"></a>00158   }
<a name="l00159"></a>00159 
<a name="l00160"></a>00160   <a class="code" href="a00115.html#a8104daf3041394b73fe545427cbc02d7" title="Stores the the time a channel sensing started. Used to calculate the quiet-time of...">chSenseStart</a> = simTime();
<a name="l00161"></a>00161   <a class="code" href="a00115.html#a7bd4f3adc205b150f9fa406fa582f0b6" title="Used to sense if the channel is idle for contention periods.">contention</a>-&gt;setSenseTimeout(duration);
<a name="l00162"></a>00162 
<a name="l00163"></a>00163   <a class="code" href="a00021.html#a6d01a0f56978740d7617c2e338858cc3" title="Sends a control message to a lower layer.">sendControlDown</a>(<a class="code" href="a00115.html#a7bd4f3adc205b150f9fa406fa582f0b6" title="Used to sense if the channel is idle for contention periods.">contention</a>);
<a name="l00164"></a>00164 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a72e78257babff863ca8749b2bb1a97f4"></a><!-- doxytag: member="Mac80211::testMaxAttempts" ref="a72e78257babff863ca8749b2bb1a97f4" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Mac80211::testMaxAttempts </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Test if maximum number of retries to transmit is exceeded. </p>
<p>Test if the maximal retry limit is reached, and delete the frame to send in this case. </p>

<p>Definition at line <a class="el" href="a00337_source.html#l01029">1029</a> of file <a class="el" href="a00337_source.html">Mac80211.cc</a>.</p>

<p>References <a class="el" href="a00338_source.html#l00301">fromUpperLayer</a>, <a class="el" href="a00338_source.html#l00308">longRetryCounter</a>, <a class="el" href="a00243_source.html#l00059">BaseMacLayer::PACKET_DROPPED</a>, <a class="el" href="a00240_source.html#l00120">BaseLayer::sendControlUp()</a>, and <a class="el" href="a00338_source.html#l00311">shortRetryCounter</a>.</p>

<p>Referenced by <a class="el" href="a00337_source.html#l00959">beginNewCycle()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01030"></a>01030 {
<a name="l01031"></a>01031     <span class="keywordflow">if</span> ((<a class="code" href="a00115.html#a11fb608b3564e2d2cd41b463b1a8cc90" title="Number of frame transmission attempt.">longRetryCounter</a> &gt;= LONG_RETRY_LIMIT) || (<a class="code" href="a00115.html#a9bbc3d71eddb62c4e12dcd500a58b0bb" title="Number of frame transmission attempt.">shortRetryCounter</a> &gt;= SHORT_RETRY_LIMIT)) {
<a name="l01032"></a>01032       debugEV &lt;&lt; <span class="stringliteral">&quot;retry limit reached src: &quot;</span>&lt;&lt; <a class="code" href="a00115.html#a9bbc3d71eddb62c4e12dcd500a58b0bb" title="Number of frame transmission attempt.">shortRetryCounter</a> &lt;&lt; <span class="stringliteral">&quot; lrc: &quot;</span> &lt;&lt; <a class="code" href="a00115.html#a11fb608b3564e2d2cd41b463b1a8cc90" title="Number of frame transmission attempt.">longRetryCounter</a> &lt;&lt; endl;
<a name="l01033"></a>01033         <span class="comment">// initialize counter</span>
<a name="l01034"></a>01034         <a class="code" href="a00115.html#a11fb608b3564e2d2cd41b463b1a8cc90" title="Number of frame transmission attempt.">longRetryCounter</a> = 0;
<a name="l01035"></a>01035         <a class="code" href="a00115.html#a9bbc3d71eddb62c4e12dcd500a58b0bb" title="Number of frame transmission attempt.">shortRetryCounter</a> = 0;
<a name="l01036"></a>01036         <span class="comment">// delete the frame to transmit</span>
<a name="l01037"></a>01037         Mac80211Pkt *temp = <a class="code" href="a00115.html#a969e8e3a592dffccea28596c61b2af50" title="Buffering of messages from upper layer.">fromUpperLayer</a>.front();
<a name="l01038"></a>01038         <a class="code" href="a00115.html#a969e8e3a592dffccea28596c61b2af50" title="Buffering of messages from upper layer.">fromUpperLayer</a>.pop_front();
<a name="l01039"></a>01039         temp-&gt;setName(<span class="stringliteral">&quot;MAC ERROR&quot;</span>);
<a name="l01040"></a>01040         temp-&gt;setKind(<a class="code" href="a00022.html#a49e0e548a6c20d002bd67afa7b76c483adebf9c77bbe6f19772866cccbef0fe4b">PACKET_DROPPED</a>);
<a name="l01041"></a>01041         <a class="code" href="a00021.html#aa1190a06fb4dfb15d8ff001468335dc8" title="Sends a control message to an upper layer.">sendControlUp</a>(temp);
<a name="l01042"></a>01042     }
<a name="l01043"></a>01043 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a424851e88bb229fcc3c59cfea80a9079"></a><!-- doxytag: member="Mac80211::timeOut" ref="a424851e88bb229fcc3c59cfea80a9079" args="(Mac80211MessageKinds type, double br)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">simtime_t Mac80211::timeOut </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="a00115.html#ae423db101e8431b0cbd67c347076c44a">Mac80211MessageKinds</a>&nbsp;</td>
          <td class="paramname"> <em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>br</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>return a timeOut value for a certain type of frame </p>
<p>Return a time-out value for a type of frame. Called by SendRTSframe, sendCTSframe, etc. </p>

<p>Definition at line <a class="el" href="a00337_source.html#l01081">1081</a> of file <a class="el" href="a00337_source.html">Mac80211.cc</a>.</p>

<p>References <a class="el" href="a00338_source.html#l00328">delta</a>, <a class="el" href="a00338_source.html#l00301">fromUpperLayer</a>, and <a class="el" href="a00337_source.html#l01107">packetDuration()</a>.</p>

<p>Referenced by <a class="el" href="a00337_source.html#l00803">sendDATAframe()</a>, and <a class="el" href="a00337_source.html#l00867">sendRTSframe()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01082"></a>01082 {
<a name="l01083"></a>01083     simtime_t time_out = 0;
<a name="l01084"></a>01084 
<a name="l01085"></a>01085     <span class="keywordflow">switch</span> (type)
<a name="l01086"></a>01086     {
<a name="l01087"></a>01087     <span class="keywordflow">case</span> RTS:
<a name="l01088"></a>01088         time_out = SIFS + <a class="code" href="a00115.html#a6732e4a776e78432bf5dd9dd26de2f7d" title="computes the duration of a transmission over the physical channel, given a certain...">packetDuration</a>(LENGTH_RTS, br) + ST + <a class="code" href="a00115.html#a6732e4a776e78432bf5dd9dd26de2f7d" title="computes the duration of a transmission over the physical channel, given a certain...">packetDuration</a>(LENGTH_CTS, br) + <a class="code" href="a00115.html#ab9f0ea820748af6d640569fc76f39659" title="Very small value used in timer scheduling in order to avoid multiple changements...">delta</a>;
<a name="l01089"></a>01089         debugEV &lt;&lt; <span class="stringliteral">&quot; Mac80211::timeOut RTS &quot;</span> &lt;&lt; time_out &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l01090"></a>01090         <span class="keywordflow">break</span>;
<a name="l01091"></a>01091     <span class="keywordflow">case</span> DATA:
<a name="l01092"></a>01092         time_out = SIFS + <a class="code" href="a00115.html#a6732e4a776e78432bf5dd9dd26de2f7d" title="computes the duration of a transmission over the physical channel, given a certain...">packetDuration</a>(<a class="code" href="a00115.html#a969e8e3a592dffccea28596c61b2af50" title="Buffering of messages from upper layer.">fromUpperLayer</a>.front()-&gt;getBitLength(), br) + ST + <a class="code" href="a00115.html#a6732e4a776e78432bf5dd9dd26de2f7d" title="computes the duration of a transmission over the physical channel, given a certain...">packetDuration</a>(LENGTH_ACK, br) + delta;
<a name="l01093"></a>01093         debugEV &lt;&lt; <span class="stringliteral">&quot; Mac80211::timeOut DATA &quot;</span> &lt;&lt; time_out &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l01094"></a>01094         <span class="keywordflow">break</span>;
<a name="l01095"></a>01095     <span class="keywordflow">default</span>:
<a name="l01096"></a>01096         EV &lt;&lt; <span class="stringliteral">&quot;Unused frame type was given when calling timeOut(), this should not happen!\n&quot;</span>;
<a name="l01097"></a>01097         <span class="keywordflow">break</span>;
<a name="l01098"></a>01098     }
<a name="l01099"></a>01099     <span class="keywordflow">return</span> time_out;
<a name="l01100"></a>01100 }
</pre></div></p>

</div>
</div>
<hr/><h2>Member Data Documentation</h2>
<a class="anchor" id="a226566e4a56cfed2928acc87ff3af90a"></a><!-- doxytag: member="Mac80211::defaultBitrate" ref="a226566e4a56cfed2928acc87ff3af90a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="a00115.html#a226566e4a56cfed2928acc87ff3af90a">Mac80211::defaultBitrate</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Default bitrate. </p>
<p>The default bitrate must be set in the omnetpp.ini. It is used whenever an auto bitrate is not appropriate, like broadcasts. </p>

<p>Definition at line <a class="el" href="a00338_source.html#l00278">278</a> of file <a class="el" href="a00338_source.html">Mac80211.h</a>.</p>

<p>Referenced by <a class="el" href="a00337_source.html#l00061">initialize()</a>, and <a class="el" href="a00337_source.html#l01190">retrieveBitrate()</a>.</p>

</div>
</div>
<a class="anchor" id="a026837b7167d230bbe79a1e0630c7578"></a><!-- doxytag: member="Mac80211::fsc" ref="a026837b7167d230bbe79a1e0630c7578" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="a00115.html#a026837b7167d230bbe79a1e0630c7578">Mac80211::fsc</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>sequence control -- to detect duplicates </p>

<p>Definition at line <a class="el" href="a00338_source.html#l00342">342</a> of file <a class="el" href="a00338_source.html">Mac80211.h</a>.</p>

<p>Referenced by <a class="el" href="a00337_source.html#l00207">encapsMsg()</a>, and <a class="el" href="a00337_source.html#l00061">initialize()</a>.</p>

</div>
</div>
<a class="anchor" id="a11fb608b3564e2d2cd41b463b1a8cc90"></a><!-- doxytag: member="Mac80211::longRetryCounter" ref="a11fb608b3564e2d2cd41b463b1a8cc90" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned <a class="el" href="a00115.html#a11fb608b3564e2d2cd41b463b1a8cc90">Mac80211::longRetryCounter</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Number of frame transmission attempt. </p>
<p>Incremented when the SHORT_RETRY_LIMIT is hit, or when an ACK or CTS is missing. </p>

<p>Definition at line <a class="el" href="a00338_source.html#l00308">308</a> of file <a class="el" href="a00338_source.html">Mac80211.h</a>.</p>

<p>Referenced by <a class="el" href="a00337_source.html#l01014">backoff()</a>, <a class="el" href="a00337_source.html#l00569">handleACKframe()</a>, <a class="el" href="a00337_source.html#l00783">handleEndTransmission()</a>, <a class="el" href="a00337_source.html#l00363">handleMsgNotForMe()</a>, <a class="el" href="a00337_source.html#l00061">initialize()</a>, <a class="el" href="a00337_source.html#l01190">retrieveBitrate()</a>, and <a class="el" href="a00337_source.html#l01029">testMaxAttempts()</a>.</p>

</div>
</div>
<a class="anchor" id="a9f9f566e85a76f63e63b5907bf9ad48a"></a><!-- doxytag: member="Mac80211::switching" ref="a9f9f566e85a76f63e63b5907bf9ad48a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="a00115.html#a9f9f566e85a76f63e63b5907bf9ad48a">Mac80211::switching</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>take care of switchover times </p>

<p>Definition at line <a class="el" href="a00338_source.html#l00339">339</a> of file <a class="el" href="a00338_source.html">Mac80211.h</a>.</p>

<p>Referenced by <a class="el" href="a00337_source.html#l00611">handleBroadcastMsg()</a>, <a class="el" href="a00337_source.html#l00445">handleMsgForMe()</a>, and <a class="el" href="a00337_source.html#l00061">initialize()</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>src/modules/mac/<a class="el" href="a00338_source.html">Mac80211.h</a></li>
<li>src/modules/mac/<a class="el" href="a00337_source.html">Mac80211.cc</a></li>
</ul>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed Dec 14 16:01:50 2011 for MiXiM by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
