<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>MiXiM: examples/analogueModels/RandomFreqTimeModel.cc Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_26bed05fc529f5fde321d1d67528533e.html">examples</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_79a13de4fb95c9e9b7df5de7da5b42bb.html">analogueModels</a>
  </div>
</div>
<div class="contents">
<h1>RandomFreqTimeModel.cc</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#include &quot;RandomFreqTimeModel.h&quot;</span>
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 <span class="preprocessor">#include &quot;AirFrame_m.h&quot;</span>
<a name="l00009"></a><a class="code" href="a00161.html#a0d96416f4f3e9896e33f00d52675553b">00009</a> <span class="keywordtype">void</span> <a class="code" href="a00161.html#a0d96416f4f3e9896e33f00d52675553b" title="Has to be overriden by every implementation.">RandomFreqTimeModel::filterSignal</a>(AirFrame *frame, <span class="keyword">const</span> <a class="code" href="a00062.html" title="Class for storing 3D coordinates.">Coord</a>&amp; <span class="comment">/*sendersPos*/</span>, <span class="keyword">const</span> <a class="code" href="a00062.html" title="Class for storing 3D coordinates.">Coord</a>&amp; <span class="comment">/*receiverPos*/</span>) {
<a name="l00010"></a>00010   <a class="code" href="a00168.html" title="The signal class stores the physical representation of the signal of an AirFrame...">Signal</a>&amp; signal = frame-&gt;getSignal();
<a name="l00011"></a>00011 
<a name="l00012"></a>00012   <span class="comment">/* At first get a new instance of the default Mapping implementation</span>
<a name="l00013"></a>00013 <span class="comment">   * which is able to represent our attenuation mapping.</span>
<a name="l00014"></a>00014 <span class="comment">   * the first parameter of &quot;createMapping&quot; gets the DimensionSet the</span>
<a name="l00015"></a>00015 <span class="comment">   * Mapping should use as domain and the second parameter sets the</span>
<a name="l00016"></a>00016 <span class="comment">   * interpolation method to be used to calculate the values between</span>
<a name="l00017"></a>00017 <span class="comment">   * two Mapping entries.</span>
<a name="l00018"></a>00018 <span class="comment">   *</span>
<a name="l00019"></a>00019 <span class="comment">   * Note 1: At the moment only LINEAR interpolation is implemented.</span>
<a name="l00020"></a>00020 <span class="comment">   *</span>
<a name="l00021"></a>00021 <span class="comment">   * Note 2: For now the same interpolation method is used for</span>
<a name="l00022"></a>00022 <span class="comment">   * interpolation in every dimension. Later it might be possible</span>
<a name="l00023"></a>00023 <span class="comment">   * to define different interpolation methods for different</span>
<a name="l00024"></a>00024 <span class="comment">   * dimensions. For example: While linear interpolation of time</span>
<a name="l00025"></a>00025 <span class="comment">   * makes sence in this case, using NEAREST for frequency  whould make</span>
<a name="l00026"></a>00026 <span class="comment">   * more sense.</span>
<a name="l00027"></a>00027 <span class="comment">   */</span>
<a name="l00028"></a>00028   <a class="code" href="a00121.html" title="Represents a changeable mapping (mathematical function) from at least time to Argument::mapped_type...">Mapping</a>* attMapping = <a class="code" href="a00123.html#a0c61c76ba04339162563339b23bf42e9" title="Returns an appropriate changeable Mapping with the specified domain and the specified...">MappingUtils::createMapping</a>(<a class="code" href="a00161.html#a918823c159b50a6f90c51c1b79b9018a" title="stores the dimensions this analogue model applies to.">dimensions</a>, <a class="code" href="a00121.html#aa713c0cd84f74727888bef5b9e8b0643ac8a952576b8d13258ba0f3c0f1584f9b" title="interpolates linear with next lower and next upper entry constant before the first...">Mapping::LINEAR</a>);
<a name="l00029"></a>00029 
<a name="l00030"></a>00030   <span class="comment">/* Get start and end of the signal to avoid unnecessary calculation</span>
<a name="l00031"></a>00031 <span class="comment">   * of attenuation. (Normally we don&apos;t wan&apos;t to attenuate the signal</span>
<a name="l00032"></a>00032 <span class="comment">   * outside its start and end time since it probably isn&apos;t defined there.*/</span>
<a name="l00033"></a>00033   simtime_t sStart = signal.<a class="code" href="a00168.html#a7c4710243cf87caf7dfc9f313e2619b2" title="Returns the point in time when the receiving of the Signal started at the receiver...">getReceptionStart</a>();
<a name="l00034"></a>00034   simtime_t sEnd = signal.<a class="code" href="a00168.html#a2875223239e124d85949e1116cc12ae9" title="Returns the point in time when the receiving of the Signal ended at the receiver...">getReceptionEnd</a>();
<a name="l00035"></a>00035 
<a name="l00036"></a>00036   simtime_t interval = (sEnd - sStart) / 10.0; <span class="comment">//lets divide it into 10 steps</span>
<a name="l00037"></a>00037 
<a name="l00038"></a>00038   <a class="code" href="a00009.html" title="Defines an argument for a mapping.">Argument</a> pos(<a class="code" href="a00161.html#a918823c159b50a6f90c51c1b79b9018a" title="stores the dimensions this analogue model applies to.">dimensions</a>); <span class="comment">//create an Argument which we will use as parameter</span>
<a name="l00039"></a>00039                 <span class="comment">//to set the values inside the mapping</span>
<a name="l00040"></a>00040 
<a name="l00041"></a>00041   <span class="keywordflow">for</span>(<span class="keywordtype">double</span> freq = 2.412; freq &lt;= 2.472; freq += 0.01){
<a name="l00042"></a>00042     <span class="comment">//assure attenuation is set at end of freq range</span>
<a name="l00043"></a>00043     <span class="keywordflow">if</span>(freq &gt; 2.465)
<a name="l00044"></a>00044       freq = 2.472;
<a name="l00045"></a>00045 
<a name="l00046"></a>00046     pos.<a class="code" href="a00009.html#a27bd7000e865670a673039233424d2ab" title="Changes the value for the specified dimension.">setArgValue</a>(<a class="code" href="a00161.html#a90eae73608986a38d5dcd71c4ddce7a4" title="shortcut to the frequency dimension, to avoid using &amp;#39;Dimension(&amp;quot;frequency&amp;quot;)&amp;#39;...">frequency</a>, freq*1e9); <span class="comment">// update arguments position in frequency dimension</span>
<a name="l00047"></a>00047 
<a name="l00048"></a>00048     <span class="comment">//create time entries for this frequency</span>
<a name="l00049"></a>00049     <span class="comment">//the comparision to &quot;sEnd + (interval * 0.5)&quot; is used to avoid floating point errors</span>
<a name="l00050"></a>00050     <span class="keywordflow">for</span>(simtime_t t = sStart; t &lt;= sEnd - (interval * 0.5); t+=interval){
<a name="l00051"></a>00051 
<a name="l00052"></a>00052       pos.<a class="code" href="a00009.html#a8087982f050bdc61d787b128ca9ac8f9" title="Changes the time value of this argument.">setTime</a>(t); <span class="comment">// update arguments position in time dimension</span>
<a name="l00053"></a>00053 
<a name="l00054"></a>00054       <span class="comment">/* Create random attenuation between 0.1 and 1.0.</span>
<a name="l00055"></a>00055 <span class="comment">       * Since the attenuation value is multiplied to the transmission power mapping</span>
<a name="l00056"></a>00056 <span class="comment">       * it should be between 0.0 and 1.0, otherwise it whouldn&apos;t be a real</span>
<a name="l00057"></a>00057 <span class="comment">       * attenuation.*/</span>
<a name="l00058"></a>00058       <span class="keywordtype">double</span> att = (double)rand() / (double)RAND_MAX * 0.9 + 0.1;
<a name="l00059"></a>00059 
<a name="l00060"></a>00060       attMapping-&gt;<a class="code" href="a00121.html#ab8906dfac661d5c6a0a35cf1744f06ed" title="Changes the value of the Mapping at the specified position.">setValue</a>(pos, att); <span class="comment">//put the attenuation at the current position into the mapping</span>
<a name="l00061"></a>00061     }
<a name="l00062"></a>00062 
<a name="l00063"></a>00063     <span class="comment">//assure that the attenuation is set at the end of the signal</span>
<a name="l00064"></a>00064     pos.<a class="code" href="a00009.html#a8087982f050bdc61d787b128ca9ac8f9" title="Changes the time value of this argument.">setTime</a>(sEnd); <span class="comment">// update arguments position in time dimension</span>
<a name="l00065"></a>00065     <span class="keywordtype">double</span> att = (double)rand() / (double)RAND_MAX * 0.9 + 0.1;
<a name="l00066"></a>00066     attMapping-&gt;<a class="code" href="a00121.html#ab8906dfac661d5c6a0a35cf1744f06ed" title="Changes the value of the Mapping at the specified position.">setValue</a>(pos, att); <span class="comment">//put the attenuation at the current position into the mapping</span>
<a name="l00067"></a>00067   }
<a name="l00068"></a>00068 
<a name="l00069"></a>00069   <span class="comment">//at last add the created attenuation mapping to the signal</span>
<a name="l00070"></a>00070   signal.<a class="code" href="a00168.html#a0beeef0f27c33145a0fca521df1c5f5c" title="Adds a function representing an attenuation of the signal.">addAttenuation</a>(attMapping);
<a name="l00071"></a>00071 }
</pre></div></div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed Dec 14 16:01:42 2011 for MiXiM by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
