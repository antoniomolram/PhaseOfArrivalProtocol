<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>MiXiM: src/modules/analogueModel/UWBIRIEEE802154APathlossModel.cc Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_e80fc4adf425b1e0d708b53057b2371a.html">src</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_85bbfa91d08b4b2ab0ddd52a3b24ebc1.html">modules</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_f96ed16ec4cf40f06a01884ec16350a3.html">analogueModel</a>
  </div>
</div>
<div class="contents">
<h1>UWBIRIEEE802154APathlossModel.cc</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* -*- mode:c++ -*- ********************************************************</span>
<a name="l00002"></a>00002 <span class="comment"> * file:        UWBIRIEEE802154APathlossModel.h</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * author:      Jerome Rousselot &lt;jerome.rousselot@csem.ch&gt;</span>
<a name="l00005"></a>00005 <span class="comment"> *</span>
<a name="l00006"></a>00006 <span class="comment"> * copyright:   (C) 2008-2009 Centre Suisse d&apos;Electronique et Microtechnique (CSEM) SA</span>
<a name="l00007"></a>00007 <span class="comment"> *        Systems Engineering</span>
<a name="l00008"></a>00008 <span class="comment"> *              Real-Time Software and Networking</span>
<a name="l00009"></a>00009 <span class="comment"> *              Jaquet-Droz 1, CH-2002 Neuchatel, Switzerland.</span>
<a name="l00010"></a>00010 <span class="comment"> *</span>
<a name="l00011"></a>00011 <span class="comment"> *              This program is free software; you can redistribute it</span>
<a name="l00012"></a>00012 <span class="comment"> *              and/or modify it under the terms of the GNU General Public</span>
<a name="l00013"></a>00013 <span class="comment"> *              License as published by the Free Software Foundation; either</span>
<a name="l00014"></a>00014 <span class="comment"> *              version 2 of the License, or (at your option) any later</span>
<a name="l00015"></a>00015 <span class="comment"> *              version.</span>
<a name="l00016"></a>00016 <span class="comment"> *              For further information see file COPYING</span>
<a name="l00017"></a>00017 <span class="comment"> *              in the top level directory</span>
<a name="l00018"></a>00018 <span class="comment"> * description: this AnalogueModel implements the IEEE 802.15.4A Channel Model</span>
<a name="l00019"></a>00019 <span class="comment"> ***************************************************************************/</span>
<a name="l00020"></a>00020 
<a name="l00021"></a>00021 <span class="preprocessor">#include &quot;UWBIRIEEE802154APathlossModel.h&quot;</span>
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 <span class="preprocessor">#include &lt;map&gt;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;limits&gt;</span>
<a name="l00025"></a>00025 
<a name="l00026"></a>00026 <span class="preprocessor">#include &quot;IEEE802154A.h&quot;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &quot;AirFrame_m.h&quot;</span>
<a name="l00028"></a>00028 
<a name="l00029"></a>00029 <span class="keyword">const</span> <span class="keywordtype">double</span> UWBIRIEEE802154APathlossModel::PL0 = 0.000040738; <span class="comment">// -43.9 dB</span>
<a name="l00030"></a>00030 <span class="keyword">const</span> <span class="keywordtype">double</span> UWBIRIEEE802154APathlossModel::pathloss_exponent = 1.79;
<a name="l00031"></a>00031 <span class="keyword">const</span> <span class="keywordtype">double</span> UWBIRIEEE802154APathlossModel::meanL = 3;
<a name="l00032"></a>00032 <span class="keyword">const</span> <span class="keywordtype">double</span> UWBIRIEEE802154APathlossModel::Lambda = 0.047E9;
<a name="l00033"></a>00033 <span class="keyword">const</span> <span class="keywordtype">double</span> UWBIRIEEE802154APathlossModel::lambda1 = 1.54E9;
<a name="l00034"></a>00034 <span class="keyword">const</span> <span class="keywordtype">double</span> UWBIRIEEE802154APathlossModel::lambda2 = 0.15E9;
<a name="l00035"></a>00035 <span class="keyword">const</span> <span class="keywordtype">double</span> UWBIRIEEE802154APathlossModel::Beta = 0.095;
<a name="l00036"></a>00036 <span class="keyword">const</span> <span class="keywordtype">double</span> UWBIRIEEE802154APathlossModel::Gamma = 22.61E-9;
<a name="l00037"></a>00037 <span class="keyword">const</span> <span class="keywordtype">double</span> UWBIRIEEE802154APathlossModel::k_gamma = 0;
<a name="l00038"></a>00038 <span class="keyword">const</span> <span class="keywordtype">double</span> UWBIRIEEE802154APathlossModel::gamma_0 = 12.53 * 0.001 * 0.001 * 0.01;
<a name="l00039"></a>00039 <span class="keyword">const</span> <span class="keywordtype">double</span> UWBIRIEEE802154APathlossModel::sigma_cluster = 1.883649089; <span class="comment">// 2.75 dB</span>
<a name="l00040"></a>00040 
<a name="l00041"></a>00041 <span class="keyword">const</span> <span class="keywordtype">double</span> UWBIRIEEE802154APathlossModel::fc = 4.492E9; <span class="comment">// mandatory band 3, center frequency, Hz</span>
<a name="l00042"></a>00042 <span class="keyword">const</span> <span class="keywordtype">double</span> UWBIRIEEE802154APathlossModel::BW = 500E6;  <span class="comment">//  mandatory band 3, bandwidth, Hz</span>
<a name="l00043"></a>00043 <span class="keyword">const</span> <span class="keywordtype">double</span> UWBIRIEEE802154APathlossModel::fcMHz = 4492; <span class="comment">// mandatory band 3, center frequency, MHz</span>
<a name="l00044"></a>00044 
<a name="l00045"></a>00045 <span class="keyword">const</span> <span class="keywordtype">double</span> UWBIRIEEE802154APathlossModel::d0 = 1;
<a name="l00046"></a>00046 
<a name="l00047"></a>00047     <span class="comment">// antenna parameters</span>
<a name="l00048"></a>00048 <span class="keyword">const</span> <span class="keywordtype">double</span> UWBIRIEEE802154APathlossModel::ntx = 1;
<a name="l00049"></a>00049 <span class="keyword">const</span> <span class="keywordtype">double</span> UWBIRIEEE802154APathlossModel::nrx = 1;
<a name="l00050"></a>00050 
<a name="l00051"></a>00051 
<a name="l00052"></a>00052 <span class="keyword">const</span> <span class="keywordtype">bool</span> UWBIRIEEE802154APathlossModel::implemented_CMs[] = {
<a name="l00053"></a>00053             <span class="keyword">false</span>, <span class="comment">//  There is no Channel Model 0: start at 1</span>
<a name="l00054"></a>00054             <span class="keyword">true</span>,  <span class="comment">//  CM1</span>
<a name="l00055"></a>00055             <span class="keyword">true</span>,  <span class="comment">//  CM2</span>
<a name="l00056"></a>00056             <span class="keyword">true</span>,  <span class="comment">//  CM3</span>
<a name="l00057"></a>00057             <span class="keyword">false</span>, <span class="comment">//  CM4 (requires alternate PDP)</span>
<a name="l00058"></a>00058             <span class="keyword">true</span>,  <span class="comment">//  CM5</span>
<a name="l00059"></a>00059             <span class="keyword">true</span>,  <span class="comment">//  CM6</span>
<a name="l00060"></a>00060             <span class="keyword">true</span>,  <span class="comment">//  CM7</span>
<a name="l00061"></a>00061             <span class="keyword">false</span>,  <span class="comment">//  CM8 (alternate PDP)</span>
<a name="l00062"></a>00062             <span class="keyword">false</span>  <span class="comment">//  CM9 (requires alternate PDP)</span>
<a name="l00063"></a>00063         };
<a name="l00064"></a>00064 
<a name="l00065"></a>00065 <span class="keyword">const</span> <a class="code" href="a00045.html">UWBIRIEEE802154APathlossModel::CMconfig</a> UWBIRIEEE802154APathlossModel::CMconfigs[] = {
<a name="l00066"></a>00066     <span class="comment">// CM0</span>
<a name="l00067"></a>00067     {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
<a name="l00068"></a>00068     <span class="comment">// *CM1*</span>
<a name="l00069"></a>00069       <span class="comment">//PL0,      n, sigma_s (undefined)</span>
<a name="l00070"></a>00070     { 0.000040738, 1.79,  0,
<a name="l00071"></a>00071       <span class="comment">//Aant, kappa, Lmean,   Lambda</span>
<a name="l00072"></a>00072       3,    1.12,   3,    0.047E9,
<a name="l00073"></a>00073       <span class="comment">//lambda_1, lambda_2,   Beta</span>
<a name="l00074"></a>00074       1.54E9,   0.15E9,   0.095,
<a name="l00075"></a>00075       <span class="comment">//Gamma, k_gamma, gamma_0, sigma_cluster,</span>
<a name="l00076"></a>00076       22.61E-9, 0,  12.53E-9, 1.883649089,
<a name="l00077"></a>00077       <span class="comment">//m_0, k_m, var_m_0, var_k_m, strong_m_0 (undefined)</span>
<a name="l00078"></a>00078       0.67,   0,  0.28,     0,    0,
<a name="l00079"></a>00079       <span class="comment">//gamma_rise, gamma_1, xi (all undefined)</span>
<a name="l00080"></a>00080       0, 0, 0},
<a name="l00081"></a>00081 
<a name="l00082"></a>00082     <span class="comment">// *CM2*</span>
<a name="l00083"></a>00083       <span class="comment">//PL0,      n, sigma_s (undefined)</span>
<a name="l00084"></a>00084     { 0.00001349, 4.58, 0,
<a name="l00085"></a>00085       <span class="comment">//Aant, kappa, Lmean,   Lambda</span>
<a name="l00086"></a>00086       3,    1.12,   3.5,  0.12E9,
<a name="l00087"></a>00087       <span class="comment">//lambda_1, lambda_2,   Beta</span>
<a name="l00088"></a>00088       1.77E9,   0.15E9,   0.045,
<a name="l00089"></a>00089       <span class="comment">//Gamma, k_gamma, gamma_0, sigma_cluster,</span>
<a name="l00090"></a>00090       26.27E-9, 0,  17.5E-9,  1.963360277,
<a name="l00091"></a>00091       <span class="comment">//m_0, k_m, var_m_0, var_k_m, strong_m_0 (undefined)</span>
<a name="l00092"></a>00092       0.69,   0,  0.32,     0,    0,
<a name="l00093"></a>00093       <span class="comment">//gamma_rise, gamma_1, xi (all undefined)</span>
<a name="l00094"></a>00094       0, 0, 0},
<a name="l00095"></a>00095 
<a name="l00096"></a>00096     <span class="comment">// *CM3*</span>
<a name="l00097"></a>00097       <span class="comment">//PL0,      n, sigma_s (undefined)</span>
<a name="l00098"></a>00098     { 0.000218776, 1.63, 1.9,
<a name="l00099"></a>00099       <span class="comment">//Aant, kappa, Lmean,   Lambda</span>
<a name="l00100"></a>00100       3,    -3.5,   5.4,  0.016E9,
<a name="l00101"></a>00101       <span class="comment">//lambda_1, lambda_2,   Beta</span>
<a name="l00102"></a>00102       0.19E9,   2.97E9,   0.0184,
<a name="l00103"></a>00103       <span class="comment">//Gamma, k_gamma, gamma_0, sigma_cluster (undefined),</span>
<a name="l00104"></a>00104       14.6E-9, 0,   6.4E-9,  0,
<a name="l00105"></a>00105       <span class="comment">//m_0, k_m, var_m_0, var_k_m, strong_m_0 (undefined)</span>
<a name="l00106"></a>00106       0.42,   0,  0.31,     0,    0,
<a name="l00107"></a>00107       <span class="comment">//gamma_rise, gamma_1, xi (all undefined)</span>
<a name="l00108"></a>00108       0, 0, 0},
<a name="l00109"></a>00109 
<a name="l00110"></a>00110     <span class="comment">// *CM4*</span>
<a name="l00111"></a>00111       <span class="comment">//PL0,      n, sigma_s (undefined)</span>
<a name="l00112"></a>00112     { 0.000007244, 3.07, 3.9,
<a name="l00113"></a>00113       <span class="comment">//Aant, kappa, Lmean,   Lambda (undefined)</span>
<a name="l00114"></a>00114       3,    -5.3,   1,  0,
<a name="l00115"></a>00115       <span class="comment">//lambda_1, lambda_2,   Beta (all undefined)</span>
<a name="l00116"></a>00116       0,  0,  0,
<a name="l00117"></a>00117       <span class="comment">//Gamma, k_gamma, gamma_0, sigma_cluster (all undefined),</span>
<a name="l00118"></a>00118       0, 0,   0,  0,
<a name="l00119"></a>00119       <span class="comment">//m_0, k_m, var_m_0, var_k_m, strong_m_0 (undefined)</span>
<a name="l00120"></a>00120       0.5,  0,  0.25,     0,    0,
<a name="l00121"></a>00121       <span class="comment">//gamma_rise, gamma_1, xi</span>
<a name="l00122"></a>00122       15.21, 11.84, 0.86},
<a name="l00123"></a>00123 
<a name="l00124"></a>00124     <span class="comment">// *CM5* Outdoor LOS</span>
<a name="l00125"></a>00125       <span class="comment">//PL0,      n, sigma_s</span>
<a name="l00126"></a>00126     { 0.000046881, 1.76, 0.83,
<a name="l00127"></a>00127       <span class="comment">//Aant, kappa, Lmean,   Lambda</span>
<a name="l00128"></a>00128       3,    -1.6,   13.6, 0.0048E9,
<a name="l00129"></a>00129       <span class="comment">//lambda_1, lambda_2,   Beta</span>
<a name="l00130"></a>00130       0.27E9,   2.41E9,   0.062,
<a name="l00131"></a>00131       <span class="comment">//Gamma, k_gamma, gamma_0, sigma_cluster (undefined),</span>
<a name="l00132"></a>00132       31.7E-9, 0,   3.7E-9,  0,
<a name="l00133"></a>00133       <span class="comment">//m_0, k_m, var_m_0, var_k_m, strong_m_0 (undefined)</span>
<a name="l00134"></a>00134       0.77,   0,  0.78,     0,    0,
<a name="l00135"></a>00135       <span class="comment">//gamma_rise, gamma_1, xi (all undefined)</span>
<a name="l00136"></a>00136       0, 0, 0},
<a name="l00137"></a>00137 
<a name="l00138"></a>00138       <span class="comment">// *CM6* Outdoor NLOS</span>
<a name="l00139"></a>00139         <span class="comment">//PL0,      n, sigma_s</span>
<a name="l00140"></a>00140     { 0.000046881, 2.5, 2,
<a name="l00141"></a>00141       <span class="comment">//Aant, kappa, Lmean,   Lambda</span>
<a name="l00142"></a>00142       3,    0.4,  10.5, 0.0243E9,
<a name="l00143"></a>00143       <span class="comment">//lambda_1, lambda_2,   Beta</span>
<a name="l00144"></a>00144       0.15E9,   1.13E9,   0.062,
<a name="l00145"></a>00145       <span class="comment">//Gamma, k_gamma, gamma_0, sigma_cluster (undefined),</span>
<a name="l00146"></a>00146       104.7E-9, 0,  9.3E-9,  0,
<a name="l00147"></a>00147       <span class="comment">//m_0, k_m, var_m_0, var_k_m, strong_m_0 (undefined)</span>
<a name="l00148"></a>00148       0.56,   0,  0.25,     0,    0,
<a name="l00149"></a>00149       <span class="comment">//gamma_rise, gamma_1, xi (all undefined)</span>
<a name="l00150"></a>00150       0, 0, 0},
<a name="l00151"></a>00151 
<a name="l00152"></a>00152       <span class="comment">// *CM7* Open Outdoor NLOS</span>
<a name="l00153"></a>00153         <span class="comment">//PL0,      n, sigma_s</span>
<a name="l00154"></a>00154     { 0.000012706, 1.58, 3.96,
<a name="l00155"></a>00155       <span class="comment">//Aant, kappa (?), Lmean,   Lambda</span>
<a name="l00156"></a>00156       3,    0,  3.31, 0.0305E9,
<a name="l00157"></a>00157       <span class="comment">//lambda_1, lambda_2,   Beta</span>
<a name="l00158"></a>00158       0.0225E9,   0,  0,
<a name="l00159"></a>00159       <span class="comment">//Gamma, k_gamma, gamma_0, sigma_cluster (undefined),</span>
<a name="l00160"></a>00160       56E-9, 0,   0.92E-9,  0,
<a name="l00161"></a>00161       <span class="comment">//m_0, k_m, var_m_0, var_k_m, strong_m_0 (undefined)</span>
<a name="l00162"></a>00162       4.1,  0,  2.5,    0,    0,
<a name="l00163"></a>00163       <span class="comment">//gamma_rise, gamma_1, xi (all undefined)</span>
<a name="l00164"></a>00164       0, 0, 0},
<a name="l00165"></a>00165 
<a name="l00166"></a>00166       <span class="comment">// *CM8* Industrial LOS</span>
<a name="l00167"></a>00167         <span class="comment">//PL0,      n, sigma_s</span>
<a name="l00168"></a>00168     { 0.000002138, 1.2, 6,
<a name="l00169"></a>00169       <span class="comment">//Aant, kappa (?), Lmean,   Lambda</span>
<a name="l00170"></a>00170       3,    -5.6,   4.75, 0.0709E9,
<a name="l00171"></a>00171       <span class="comment">//lambda_1, lambda_2,   Beta (all undefined)</span>
<a name="l00172"></a>00172       0,  0,  0,
<a name="l00173"></a>00173       <span class="comment">//Gamma, k_gamma, gamma_0, sigma_cluster (undefined),</span>
<a name="l00174"></a>00174       13.47E-9, 0.926,  0.651E-9,  4.32,
<a name="l00175"></a>00175       <span class="comment">//m_0, k_m, var_m_0, var_k_m, strong_m_0</span>
<a name="l00176"></a>00176       0.36,   0,  1.13,     0,    12.99,
<a name="l00177"></a>00177       <span class="comment">//gamma_rise, gamma_1, xi (all undefined)</span>
<a name="l00178"></a>00178       0, 0, 0},
<a name="l00179"></a>00179 
<a name="l00180"></a>00180     {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}  <span class="comment">// CM9</span>
<a name="l00181"></a>00181 };
<a name="l00182"></a>00182 
<a name="l00183"></a><a class="code" href="a00197.html#a7f3f8f2b34a9925f037e88e4e4359ae2">00183</a> <span class="keywordtype">void</span> <a class="code" href="a00197.html#a7f3f8f2b34a9925f037e88e4e4359ae2" title="Has to be overriden by every implementation.">UWBIRIEEE802154APathlossModel::filterSignal</a>(AirFrame *frame, <span class="keyword">const</span> <a class="code" href="a00062.html" title="Class for storing 3D coordinates.">Coord</a>&amp; <span class="comment">/*sendersPos*/</span>, <span class="keyword">const</span> <a class="code" href="a00062.html" title="Class for storing 3D coordinates.">Coord</a>&amp; <span class="comment">/*receiverPos*/</span>)
<a name="l00184"></a>00184 {
<a name="l00185"></a>00185     <a class="code" href="a00168.html" title="The signal class stores the physical representation of the signal of an AirFrame...">Signal</a>&amp; signal = frame-&gt;getSignal();
<a name="l00186"></a>00186     <span class="comment">// We create a new &quot;fake&quot; txPower to add multipath taps</span>
<a name="l00187"></a>00187     <span class="comment">// and then attenuation is applied to all pulses.</span>
<a name="l00188"></a>00188 
<a name="l00189"></a>00189     <span class="comment">// (1) Power Delay Profile realization</span>
<a name="l00190"></a>00190     <span class="keyword">using</span> std::max;
<a name="l00191"></a>00191 
<a name="l00192"></a>00192     txPower    = signal.<a class="code" href="a00168.html#a392ecf1a624edfb90243e7227370a772" title="Returns the function representing the transmission power of the signal.">getTransmissionPower</a>();
<a name="l00193"></a>00193     newTxPower = <span class="keyword">new</span> <a class="code" href="a00186.html">TimeMapping&lt;Linear&gt;</a>(); <span class="comment">//dynamic_cast&lt;TimeMapping&lt;Linear&gt;*&gt; (txPower-&gt;clone()); // create working copy</span>
<a name="l00194"></a>00194     pulsesIter = newTxPower-&gt;<a class="code" href="a00186.html#a99f25f5769ab59fd41080fedfa0dbaa5" title="Returns a pointer of a new Iterator which is able to iterate over the function and...">createIterator</a>(); <span class="comment">// create an iterator that we will use many times in addEchoes</span>
<a name="l00195"></a>00195     <span class="comment">// generate number of clusters for this channel (channel coherence time &gt; packet air time)</span>
<a name="l00196"></a>00196     L = max(1, poisson(cfg.Lmean));
<a name="l00197"></a>00197     <span class="comment">// Choose block shadowing</span>
<a name="l00198"></a>00198     S = powf(10.,(normal(0, cfg.sigma_s)/10.));
<a name="l00199"></a>00199 
<a name="l00200"></a>00200     <span class="comment">// Loop on each value of the original mapping and generate multipath echoes</span>
<a name="l00201"></a>00201     <a class="code" href="a00056.html" title="Defines an const iterator for a ConstMapping which is able to iterate over the Mapping...">ConstMappingIterator</a>* iter = txPower-&gt;<a class="code" href="a00055.html#a5ff3a15fe6d536fa7a26a3fe1ff1b274" title="Returns a pointer of a new Iterator which is able to iterate over this Mapping.">createConstIterator</a>();
<a name="l00202"></a>00202 
<a name="l00203"></a>00203     <span class="keywordflow">while</span> (iter-&gt;<a class="code" href="a00056.html#a4a6348a453418da95978e570fec046fc" title="Returns true if the current position of the iterator is in range of the function...">inRange</a>()) {
<a name="l00204"></a>00204         <span class="comment">// generate echoes for each non zero value</span>
<a name="l00205"></a>00205         <span class="keywordflow">if</span> (iter-&gt;<a class="code" href="a00056.html#ad4419c259e747867f003d07d62d4259f" title="Returns the value of the Mapping at the current position.">getValue</a>() != 0) {
<a name="l00206"></a>00206           <span class="comment">// give the pulse start position</span>
<a name="l00207"></a>00207             addEchoes(iter-&gt;<a class="code" href="a00056.html#a047e853613d5a19ff34526d0cff8fcf9" title="Returns the current position of the iterator.">getPosition</a>().<a class="code" href="a00009.html#a2ecb3b041b5b8721d6767531e4ac792a" title="Returns the time value of this argument.">getTime</a>() - <a class="code" href="a00095.html#ab29d6f969fd0446306f9bca3d0f2bf66" title="mandatory pulse duration ( = 1 / bandwidth = 2 ns)">IEEE802154A::mandatory_pulse</a>/2);
<a name="l00208"></a>00208         }
<a name="l00209"></a>00209         <span class="keywordflow">if</span> (!iter-&gt;<a class="code" href="a00056.html#ad4bac7233c154b7086c6124d2e21be49" title="Returns true if the iterator has a next value it can iterate to on a call to &amp;quot;next()&amp;quot;...">hasNext</a>()) {
<a name="l00210"></a>00210             <span class="keywordflow">break</span>;
<a name="l00211"></a>00211         }
<a name="l00212"></a>00212         iter-&gt;<a class="code" href="a00056.html#afdafa6870cd19b3d35674a7bc777585d" title="Iterates to the next position of the Mapping.">next</a>();
<a name="l00213"></a>00213     }
<a name="l00214"></a>00214     <span class="keyword">delete</span> iter;
<a name="l00215"></a>00215     <span class="keyword">delete</span> pulsesIter;
<a name="l00216"></a>00216     signal.<a class="code" href="a00168.html#ad8c5494d0f7bd564bf14dc0c90f9a361" title="Sets the function representing the transmission power of the signal.">setTransmissionPower</a>(newTxPower);
<a name="l00217"></a>00217 
<a name="l00218"></a>00218 
<a name="l00219"></a>00219     <span class="comment">// Total radiated power Prx at that distance  [W]</span>
<a name="l00220"></a>00220     <span class="comment">//double attenuation = 0.5 * ntx * nrx * cfg.PL0 / pow(distance / d0, cfg.n);</span>
<a name="l00221"></a>00221     <span class="keywordtype">double</span> attenuation = getPathloss(fc, BW);
<a name="l00222"></a>00222     pathlosses.record(attenuation);
<a name="l00223"></a>00223     <span class="comment">// Power intensity I at that distance [W/mÂ²]</span>
<a name="l00224"></a>00224     <span class="comment">//attenuation = attenuation /(4*PI*pow(distance, cfg.n));</span>
<a name="l00225"></a>00225     <span class="comment">// create mapping</span>
<a name="l00226"></a>00226     <a class="code" href="a00176.html" title="TODO: short description for this class.">SimpleTimeConstMapping</a>* attMapping = <span class="keyword">new</span> <a class="code" href="a00176.html" title="TODO: short description for this class.">SimpleTimeConstMapping</a>(
<a name="l00227"></a>00227         attenuation, signal.<a class="code" href="a00168.html#a7c4710243cf87caf7dfc9f313e2619b2" title="Returns the point in time when the receiving of the Signal started at the receiver...">getReceptionStart</a>(), signal.<a class="code" href="a00168.html#a2875223239e124d85949e1116cc12ae9" title="Returns the point in time when the receiving of the Signal ended at the receiver...">getReceptionEnd</a>());
<a name="l00228"></a>00228 
<a name="l00229"></a>00229     signal.<a class="code" href="a00168.html#a0beeef0f27c33145a0fca521df1c5f5c" title="Adds a function representing an attenuation of the signal.">addAttenuation</a>(attMapping);
<a name="l00230"></a>00230 
<a name="l00231"></a>00231 }
<a name="l00232"></a>00232 
<a name="l00233"></a>00233 <span class="keywordtype">void</span> UWBIRIEEE802154APathlossModel::addEchoes(simtime_t_cref pulseStart) {
<a name="l00234"></a>00234     <span class="keyword">using</span> std::map;
<a name="l00235"></a>00235     <span class="keyword">using</span> std::numeric_limits;
<a name="l00236"></a>00236 
<a name="l00237"></a>00237     <span class="comment">// statistics</span>
<a name="l00238"></a>00238     nbCalls = nbCalls + 1;
<a name="l00239"></a>00239     <span class="keywordtype">double</span> power = 0;
<a name="l00240"></a>00240     <span class="comment">// loop control variables</span>
<a name="l00241"></a>00241     <span class="keywordtype">bool</span> moreTaps = <span class="keyword">true</span>;
<a name="l00242"></a>00242     arg.<a class="code" href="a00009.html#a8087982f050bdc61d787b128ca9ac8f9" title="Changes the time value of this argument.">setTime</a>(pulseStart + <a class="code" href="a00095.html#ab29d6f969fd0446306f9bca3d0f2bf66" title="mandatory pulse duration ( = 1 / bandwidth = 2 ns)">IEEE802154A::mandatory_pulse</a>/2);
<a name="l00243"></a>00243     <span class="keywordtype">double</span> pulseEnergy = txPower-&gt;<a class="code" href="a00055.html#afabbd15bb8f50e45901f99633d0a47c9" title="Returns the value of this Mapping at the position specified by the passed Argument...">getValue</a>(arg);
<a name="l00244"></a>00244     <span class="keywordflow">if</span>(doShadowing) {
<a name="l00245"></a>00245       pulseEnergy = pulseEnergy - S;
<a name="l00246"></a>00246     }
<a name="l00247"></a>00247     simtime_t tau_kl = SIMTIME_ZERO;
<a name="l00248"></a>00248     <span class="comment">//simtime_t fromClusterStart = SIMTIME_ZERO;</span>
<a name="l00249"></a>00249     <span class="comment">// start time of cluster number &quot;cluster&quot;</span>
<a name="l00250"></a>00250     clusterStart = 0;
<a name="l00251"></a>00251     gamma_l = cfg.gamma_0;
<a name="l00252"></a>00252     Mcluster = normal(0, cfg.sigma_cluster);
<a name="l00253"></a>00253     Omega_l = pow(10, Mcluster / 10);
<a name="l00254"></a>00254     <span class="comment">// tapEnergy values are normalized</span>
<a name="l00255"></a>00255     <span class="keywordtype">double</span> tapEnergy = sqrt( Omega_l / ( cfg.gamma_0 * ( (1-cfg.Beta)*cfg.lambda_1 + cfg.Beta*cfg.lambda_2 + 1 ) ) );
<a name="l00256"></a>00256     <span class="comment">// nakagami fading parameters</span>
<a name="l00257"></a>00257     <span class="comment">//double mfactor = 0;</span>
<a name="l00258"></a>00258     <span class="comment">//double mmean = 0, msigma = 0;</span>
<a name="l00259"></a>00259     <span class="comment">//bool firstTap = true;</span>
<a name="l00260"></a>00260     simtime_t echoEnd = SIMTIME_ZERO;
<a name="l00261"></a>00261     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> cluster = 0; cluster &lt; L; cluster++) {
<a name="l00262"></a>00262         <span class="keywordflow">while</span> (moreTaps) {
<a name="l00263"></a>00263             <span class="comment">// modify newTxPower</span>
<a name="l00264"></a>00264             <span class="comment">// we add three points for linear interpolation</span>
<a name="l00265"></a>00265           <span class="comment">// we set the start and end point before adding the new values for correct interpolation</span>
<a name="l00266"></a>00266             <span class="keywordtype">double</span> pValueStart = newTxPower-&gt;<a class="code" href="a00186.html#a4f46930630d6c6a79b34211992840731" title="Returns the value of this Function at the position specified by the passed Argument...">getValue</a>(arg);
<a name="l00267"></a>00267             <span class="keywordtype">double</span> pValueEnd = newTxPower-&gt;<a class="code" href="a00186.html#a4f46930630d6c6a79b34211992840731" title="Returns the value of this Function at the position specified by the passed Argument...">getValue</a>(arg);
<a name="l00268"></a>00268             simtime_t echoStart = pulseStart + clusterStart + tau_kl;
<a name="l00269"></a>00269             echoEnd = pulseStart + clusterStart + tau_kl + <a class="code" href="a00095.html#ab29d6f969fd0446306f9bca3d0f2bf66" title="mandatory pulse duration ( = 1 / bandwidth = 2 ns)">IEEE802154A::mandatory_pulse</a>;
<a name="l00270"></a>00270             simtime_t echoPeak = pulseStart + clusterStart + tau_kl + IEEE802154A::mandatory_pulse/2;
<a name="l00271"></a>00271             arg.<a class="code" href="a00009.html#a8087982f050bdc61d787b128ca9ac8f9" title="Changes the time value of this argument.">setTime</a>(echoEnd);
<a name="l00272"></a>00272             newTxPower-&gt;<a class="code" href="a00186.html#a453ce64062fa7afd7398735a9cf499a6" title="Changes the value of the function at the specified position.">setValue</a>(arg, pValueEnd);
<a name="l00273"></a>00273             arg.<a class="code" href="a00009.html#a8087982f050bdc61d787b128ca9ac8f9" title="Changes the time value of this argument.">setTime</a>(echoStart);
<a name="l00274"></a>00274             newTxPower-&gt;<a class="code" href="a00186.html#a453ce64062fa7afd7398735a9cf499a6" title="Changes the value of the function at the specified position.">setValue</a>(arg, pValueStart);
<a name="l00275"></a>00275             <span class="keywordtype">bool</span> raising = <span class="keyword">true</span>;
<a name="l00276"></a>00276 
<a name="l00277"></a>00277             <span class="comment">/*if(!firstTap) {</span>
<a name="l00278"></a>00278 <span class="comment">              mfactor = cfg.m_0;</span>
<a name="l00279"></a>00279 <span class="comment">            } else {</span>
<a name="l00280"></a>00280 <span class="comment">              mmean = cfg.m_0 - cfg.k_m*SIMTIME_DBL(tau_kl);</span>
<a name="l00281"></a>00281 <span class="comment">              msigma = cfg.var_m_0 - cfg.var_k_m*SIMTIME_DBL(tau_kl);</span>
<a name="l00282"></a>00282 <span class="comment">              mfactor = normal(mmean, msigma);</span>
<a name="l00283"></a>00283 <span class="comment">            }*/</span>
<a name="l00284"></a>00284             <span class="comment">/*</span>
<a name="l00285"></a>00285 <span class="comment">            if(doSmallScaleShadowing) {</span>
<a name="l00286"></a>00286 <span class="comment">              double tmp = sqrt(mfactor*mfactor-mfactor);</span>
<a name="l00287"></a>00287 <span class="comment">              double riceK = tmp/(mfactor-tmp);</span>
<a name="l00288"></a>00288 <span class="comment">              //dw;</span>
<a name="l00289"></a>00289 <span class="comment">              finalTapEnergy = finalTapEnergy * 10^(mfactor/10);</span>
<a name="l00290"></a>00290 <span class="comment">            }</span>
<a name="l00291"></a>00291 <span class="comment">            */</span>
<a name="l00292"></a>00292             <span class="keywordtype">double</span> finalTapEnergy = tapEnergy * pulseEnergy;
<a name="l00293"></a>00293 
<a name="l00294"></a>00294             <span class="comment">// We cannot add intermediate points &quot;online&quot; as we need the interpolated</span>
<a name="l00295"></a>00295             <span class="comment">// values of the signal before adding this echo pulse.</span>
<a name="l00296"></a>00296             map&lt;simtime_t, double&gt; intermediatePoints;
<a name="l00297"></a>00297             <span class="comment">// We need to evaluate all points of the mapping already stored that intersect</span>
<a name="l00298"></a>00298             <span class="comment">// with this pulse.</span>
<a name="l00299"></a>00299             pulsesIter-&gt;<a class="code" href="a00056.html#ae3cdbe2115d0e87af0da549b675f2bf8" title="Lets the iterator point to the passed position.">jumpTo</a>(arg);
<a name="l00300"></a>00300             simtime_t currentPoint = echoStart;
<a name="l00301"></a>00301             <span class="keywordflow">while</span>(currentPoint &lt; echoEnd) {
<a name="l00302"></a>00302               <span class="keywordflow">if</span>(raising &amp;&amp; pulsesIter-&gt;<a class="code" href="a00056.html#a1f4cae3b170754a76049b8e81b2e3c07" title="Returns the position the next call to &amp;quot;next()&amp;quot; of this Iterator would iterate...">getNextPosition</a>().<a class="code" href="a00009.html#a2ecb3b041b5b8721d6767531e4ac792a" title="Returns the time value of this argument.">getTime</a>() &lt; echoPeak) {
<a name="l00303"></a>00303                 <span class="comment">// there is a point in the first half of the echo</span>
<a name="l00304"></a>00304                 <span class="comment">// retrieve its value</span>
<a name="l00305"></a>00305                 pulsesIter-&gt;<a class="code" href="a00056.html#afdafa6870cd19b3d35674a7bc777585d" title="Iterates to the next position of the Mapping.">next</a>();
<a name="l00306"></a>00306                 <span class="keywordtype">double</span> oldValue = pulsesIter-&gt;<a class="code" href="a00056.html#ad4419c259e747867f003d07d62d4259f" title="Returns the value of the Mapping at the current position.">getValue</a>();
<a name="l00307"></a>00307                 currentPoint = pulsesIter-&gt;<a class="code" href="a00056.html#a047e853613d5a19ff34526d0cff8fcf9" title="Returns the current position of the iterator.">getPosition</a>().<a class="code" href="a00009.html#a2ecb3b041b5b8721d6767531e4ac792a" title="Returns the time value of this argument.">getTime</a>();
<a name="l00308"></a>00308                 <span class="comment">// interpolate current echo point</span>
<a name="l00309"></a>00309                 <span class="keywordtype">double</span> echoValue = SIMTIME_DBL((currentPoint - echoStart)/(0.5*IEEE802154A::mandatory_pulse));
<a name="l00310"></a>00310                 echoValue = echoValue * finalTapEnergy;
<a name="l00311"></a>00311                 intermediatePoints[currentPoint] = echoValue + oldValue;
<a name="l00312"></a>00312               } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(raising &amp;&amp; pulsesIter-&gt;<a class="code" href="a00056.html#a1f4cae3b170754a76049b8e81b2e3c07" title="Returns the position the next call to &amp;quot;next()&amp;quot; of this Iterator would iterate...">getNextPosition</a>().<a class="code" href="a00009.html#a2ecb3b041b5b8721d6767531e4ac792a" title="Returns the time value of this argument.">getTime</a>() &gt;= echoPeak) {
<a name="l00313"></a>00313           <span class="comment">// We reached the peak of the pulse.</span>
<a name="l00314"></a>00314                 currentPoint = echoPeak;
<a name="l00315"></a>00315                 arg.<a class="code" href="a00009.html#a8087982f050bdc61d787b128ca9ac8f9" title="Changes the time value of this argument.">setTime</a>(currentPoint);
<a name="l00316"></a>00316                 pulsesIter-&gt;<a class="code" href="a00056.html#ae3cdbe2115d0e87af0da549b675f2bf8" title="Lets the iterator point to the passed position.">jumpTo</a>(arg);
<a name="l00317"></a>00317                 <span class="keywordtype">double</span> oldValue = pulsesIter-&gt;<a class="code" href="a00056.html#ad4419c259e747867f003d07d62d4259f" title="Returns the value of the Mapping at the current position.">getValue</a>();
<a name="l00318"></a>00318                 intermediatePoints[currentPoint] = oldValue + finalTapEnergy;
<a name="l00319"></a>00319           raising = <span class="keyword">false</span>;
<a name="l00320"></a>00320               } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!raising &amp;&amp; pulsesIter-&gt;<a class="code" href="a00056.html#a1f4cae3b170754a76049b8e81b2e3c07" title="Returns the position the next call to &amp;quot;next()&amp;quot; of this Iterator would iterate...">getNextPosition</a>().<a class="code" href="a00009.html#a2ecb3b041b5b8721d6767531e4ac792a" title="Returns the time value of this argument.">getTime</a>() &lt; echoEnd) {
<a name="l00321"></a>00321                 <span class="comment">// there is a point in the second half of the echo</span>
<a name="l00322"></a>00322                 <span class="comment">// retrieve its value</span>
<a name="l00323"></a>00323                 pulsesIter-&gt;<a class="code" href="a00056.html#afdafa6870cd19b3d35674a7bc777585d" title="Iterates to the next position of the Mapping.">next</a>();
<a name="l00324"></a>00324                 <span class="keywordtype">double</span> oldValue = pulsesIter-&gt;<a class="code" href="a00056.html#ad4419c259e747867f003d07d62d4259f" title="Returns the value of the Mapping at the current position.">getValue</a>();
<a name="l00325"></a>00325                 currentPoint = pulsesIter-&gt;<a class="code" href="a00056.html#a047e853613d5a19ff34526d0cff8fcf9" title="Returns the current position of the iterator.">getPosition</a>().<a class="code" href="a00009.html#a2ecb3b041b5b8721d6767531e4ac792a" title="Returns the time value of this argument.">getTime</a>();
<a name="l00326"></a>00326                 <span class="comment">// interpolate current echo point</span>
<a name="l00327"></a>00327                 <span class="keywordtype">double</span> echoValue = 1 - SIMTIME_DBL((currentPoint - echoPeak)/(0.5*IEEE802154A::mandatory_pulse));
<a name="l00328"></a>00328                 echoValue = echoValue * finalTapEnergy;
<a name="l00329"></a>00329                 intermediatePoints[currentPoint] = echoValue + oldValue;
<a name="l00330"></a>00330               } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!raising &amp;&amp; pulsesIter-&gt;<a class="code" href="a00056.html#a1f4cae3b170754a76049b8e81b2e3c07" title="Returns the position the next call to &amp;quot;next()&amp;quot; of this Iterator would iterate...">getNextPosition</a>().<a class="code" href="a00009.html#a2ecb3b041b5b8721d6767531e4ac792a" title="Returns the time value of this argument.">getTime</a>() &gt;= echoEnd) {
<a name="l00331"></a>00331                 currentPoint = echoEnd; <span class="comment">// nothing to do, we already set this point</span>
<a name="l00332"></a>00332               }
<a name="l00333"></a>00333             }
<a name="l00334"></a>00334 
<a name="l00335"></a>00335             <span class="comment">// Add all points stored in intermediatePoints.</span>
<a name="l00336"></a>00336             map&lt;simtime_t, double&gt;::iterator newPointsIter;
<a name="l00337"></a>00337             newPointsIter = intermediatePoints.begin();
<a name="l00338"></a>00338             <span class="keywordflow">while</span>(newPointsIter != intermediatePoints.end()) {
<a name="l00339"></a>00339               arg.<a class="code" href="a00009.html#a8087982f050bdc61d787b128ca9ac8f9" title="Changes the time value of this argument.">setTime</a>(newPointsIter-&gt;first);
<a name="l00340"></a>00340               newTxPower-&gt;<a class="code" href="a00186.html#a453ce64062fa7afd7398735a9cf499a6" title="Changes the value of the function at the specified position.">setValue</a>(arg, newPointsIter-&gt;second);
<a name="l00341"></a>00341               newPointsIter++;
<a name="l00342"></a>00342             }
<a name="l00343"></a>00343 
<a name="l00344"></a>00344             power = power + finalTapEnergy; <span class="comment">// statistics</span>
<a name="l00345"></a>00345 
<a name="l00346"></a>00346             <span class="comment">// Update values for next iteration</span>
<a name="l00347"></a>00347             <span class="keywordtype">double</span> mix1 = exponential(1 / cfg.lambda_1);
<a name="l00348"></a>00348             <span class="keywordtype">double</span> mix2 = exponential(1 / cfg.lambda_2);
<a name="l00349"></a>00349             <span class="keywordflow">if</span>(mix1 == numeric_limits&lt;double&gt;::infinity()) {
<a name="l00350"></a>00350                 mix1 = 0;
<a name="l00351"></a>00351             }
<a name="l00352"></a>00352             <span class="keywordflow">if</span>(mix2 == numeric_limits&lt;double&gt;::infinity()) {
<a name="l00353"></a>00353                 mix2 = 0;
<a name="l00354"></a>00354             }
<a name="l00355"></a>00355             tau_kl += mix1 * cfg.Beta + (1 - cfg.Beta) * mix2;
<a name="l00356"></a>00356             <span class="comment">//fromClusterStart += tau_kl;</span>
<a name="l00357"></a>00357             tapEnergy = SIMTIME_DBL(gamma_l) * ((1 - cfg.Beta) * cfg.lambda_1 + cfg.Beta * cfg.lambda_2 + 1);
<a name="l00358"></a>00358             tapEnergy = Omega_l / tapEnergy;
<a name="l00359"></a>00359             tapEnergy = tapEnergy * exp(-SIMTIME_DBL(tau_kl) / SIMTIME_DBL(gamma_l));
<a name="l00360"></a>00360             tapEnergy = sqrt(tapEnergy);
<a name="l00361"></a>00361             <span class="keywordflow">if</span> (tapEnergy &lt; tapThreshold) {
<a name="l00362"></a>00362                 moreTaps = <span class="keyword">false</span>;
<a name="l00363"></a>00363             }
<a name="l00364"></a>00364         }
<a name="l00365"></a>00365         <span class="keywordtype">double</span> nextClusterStart = exponential(1 / cfg.Lambda);
<a name="l00366"></a>00366         <span class="keywordflow">if</span>(nextClusterStart &gt; 0.001 || nextClusterStart == numeric_limits&lt;double&gt;::infinity()) {
<a name="l00367"></a>00367           moreTaps = <span class="keyword">false</span>;
<a name="l00368"></a>00368         } <span class="keywordflow">else</span> {
<a name="l00369"></a>00369           clusterStart = clusterStart + nextClusterStart; <span class="comment">// sum(x_n) over n=1..cluster</span>
<a name="l00370"></a>00370           gamma_l = cfg.k_gamma * clusterStart + cfg.gamma_0;
<a name="l00371"></a>00371           Mcluster = normal(0, cfg.sigma_cluster);
<a name="l00372"></a>00372           Omega_l = pow(10, (10 * log( exp( -SIMTIME_DBL(clusterStart) / cfg.Gamma ) ) + Mcluster) / 10);
<a name="l00373"></a>00373           <span class="comment">// new constraint to increase speed</span>
<a name="l00374"></a>00374           <span class="keywordflow">if</span>(Omega_l &gt; 0.1) {
<a name="l00375"></a>00375             moreTaps = <span class="keyword">true</span>;
<a name="l00376"></a>00376           } <span class="keywordflow">else</span> {
<a name="l00377"></a>00377           moreTaps = <span class="keyword">false</span>;
<a name="l00378"></a>00378           }
<a name="l00379"></a>00379         }
<a name="l00380"></a>00380     }
<a name="l00381"></a>00381     arg.<a class="code" href="a00009.html#a8087982f050bdc61d787b128ca9ac8f9" title="Changes the time value of this argument.">setTime</a>(echoEnd);
<a name="l00382"></a>00382     newTxPower-&gt;<a class="code" href="a00186.html#a453ce64062fa7afd7398735a9cf499a6" title="Changes the value of the function at the specified position.">setValue</a>(arg, 0);
<a name="l00383"></a>00383     averagePower = averagePower + power;
<a name="l00384"></a>00384     averagePowers.record( averagePower / ((<span class="keywordtype">double</span>) nbCalls));
<a name="l00385"></a>00385 }
<a name="l00386"></a>00386 
<a name="l00387"></a>00387 <span class="comment">/*</span>
<a name="l00388"></a>00388 <span class="comment"> * Returns the integral of formula (12) assuming constant nrx, ntx over BW</span>
<a name="l00389"></a>00389 <span class="comment"> * and kappa != 0.5</span>
<a name="l00390"></a>00390 <span class="comment"> */</span>
<a name="l00391"></a>00391 <span class="keywordtype">double</span> UWBIRIEEE802154APathlossModel::getPathloss(<span class="keywordtype">double</span> <span class="comment">/*fc*/</span>, <span class="keywordtype">double</span> <span class="comment">/*BW*/</span>)<span class="keyword"> const </span>{
<a name="l00392"></a>00392   <span class="keywordtype">double</span> pathloss = 0.5; <span class="comment">// &quot;antenna attenuation factor&quot;</span>
<a name="l00393"></a>00393   pathloss = pathloss * cfg.PL0;  <span class="comment">// pathloss at reference distance</span>
<a name="l00394"></a>00394   pathloss = pathloss * ntx * nrx; <span class="comment">// antenna effects</span>
<a name="l00395"></a>00395   pathloss = pathloss / pow(distance/d0, cfg.n); <span class="comment">// distance</span>
<a name="l00396"></a>00396   <span class="comment">/*</span>
<a name="l00397"></a>00397 <span class="comment">  // and frequency dependent effects</span>
<a name="l00398"></a>00398 <span class="comment">  pathloss = pathloss / pow(fc, 2*(cfg.kappa+1));</span>
<a name="l00399"></a>00399 <span class="comment">  pathloss = pathloss / (-2*cfg.kappa-1);</span>
<a name="l00400"></a>00400 <span class="comment">  pathloss = pathloss * ( pow(fc+BW/2,-2*cfg.kappa-1) - pow(fc-BW/2,-2*cfg.kappa-1) );</span>
<a name="l00401"></a>00401 <span class="comment">  */</span>
<a name="l00402"></a>00402   <span class="comment">// old version was ignoring frequency dependent effects</span>
<a name="l00403"></a>00403   <span class="comment">//double attenuation = 0.5 * ntx * nrx * cfg.PL0 / pow(distance / d0, cfg.n);</span>
<a name="l00404"></a>00404   <span class="keywordflow">return</span> pathloss;
<a name="l00405"></a>00405 }
<a name="l00406"></a>00406 
<a name="l00407"></a>00407 <span class="keywordtype">double</span> UWBIRIEEE802154APathlossModel::Rayleigh(<span class="keywordtype">double</span> param) {
<a name="l00408"></a>00408     <span class="keywordflow">return</span> weibull(2, sqrt(2.0) * param);
<a name="l00409"></a>00409 }
<a name="l00410"></a>00410 
</pre></div></div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed Dec 14 16:01:43 2011 for MiXiM by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
