<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>MiXiM: MoBANLocal Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
      <li><a href="classes.html"><span>Class&nbsp;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>MoBANLocal Class Reference<br/>
<small>
[<a class="el" href="a00448.html">mobility - modules handling the mobility of the hosts</a>]</small>
</h1><!-- doxytag: class="MoBANLocal" --><!-- doxytag: inherits="BaseMobility" -->
<p>This is the local mobility module of MoBAN. It should be instantiated in each node that belongs to a WBAN. The NED parameter "coordinatorIndex" determine to which WBAN (<a class="el" href="a00125.html" title="This is the coordinator module of the MoBAN mobility model. It should be instantiated...">MoBANCoordinator</a>) it belongs. The current implementation uses the Random Walk Mobility Model (RWMM) for individual (local) movement with a sphere around the node, with given speed and sphere radius of the current posture. The reference point of the node it the current posture, the sphere radius, and the speed is given by the corresponding coordinator through the signaling system. RWMM determines the location of node at ant time relative to the given reference point.  
<a href="#_details">More...</a></p>

<p><code>#include &lt;<a class="el" href="a00366_source.html">MoBANLocal.h</a>&gt;</code></p>

<p>Inherits <a class="el" href="a00023.html">BaseMobility</a>.</p>
<div class="dynheader">
Collaboration diagram for MoBANLocal:</div>
<div class="dynsection">
<div class="center"><img src="a00685.png" border="0" usemap="#MoBANLocal_coll__map" alt="Collaboration graph"/></div>
<map name="MoBANLocal_coll__map" id="MoBANLocal_coll__map">
<area shape="rect" href="a00023.html" title="Base module for all mobility modules." alt="" coords="132,131,228,157"/><area shape="rect" href="a00062.html" title="Class for storing 3D coordinates." alt="" coords="5,5,61,32"/><area shape="rect" href="a00177.html" title="Helper function to initialize signal change identifier on use and not on initializing..." alt="" coords="153,5,268,32"/></map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>

<p><a href="a00686.html">List of all members.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a2838f6184efad9d12ec25e6d46494aea"></a><!-- doxytag: member="MoBANLocal::initialize" ref="a2838f6184efad9d12ec25e6d46494aea" args="(int)" -->
virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00126.html#a2838f6184efad9d12ec25e6d46494aea">initialize</a> (int)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initializes the parameters of the local mobility module. <br/></td></tr>
<tr><td colspan="2"><h2>Static Public Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a9143c05cc2bb615c574e42c371dc0ed2"></a><!-- doxytag: member="MoBANLocal::catBBMoBANMsgSignal" ref="a9143c05cc2bb615c574e42c371dc0ed2" args="" -->
static const <a class="el" href="a00177.html">simsignalwrap_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00126.html#a9143c05cc2bb615c574e42c371dc0ed2">catBBMoBANMsgSignal</a> = <a class="el" href="a00177.html">simsignalwrap_t</a>( &quot;org.mixim.modules.utility.bbmobanmessage&quot; )</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Variable to keep the category of the information that the coordinator publishes. <br/></td></tr>
<tr><td colspan="2"><h2>Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00126.html#a258a0ef18dbf4ac01149186360e6fe45">makeMove</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"><a class="el" href="a00127.html" title="Class to store object position and movement.">Move</a> the node.  <a href="#a258a0ef18dbf4ac01149186360e6fe45"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00126.html#a7a181399edf633b6598fad60cf2fbce7">setTargetPosition</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Selects a target position for the next move and set the corresponding variables.  <a href="#a7a181399edf633b6598fad60cf2fbce7"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00126.html#a6d98f00ff0849bd439cea5e4de51009d">receiveSignal</a> (cComponent *source, simsignal_t signalID, cObject *obj)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Function which is called when something is written to the signaling system of this node.  <a href="#a6d98f00ff0849bd439cea5e4de51009d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="a00062.html">Coord</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00126.html#a4a1125784d786481c4c294e08611e432">insideWorld</a> (<a class="el" href="a00062.html">Coord</a> apoint)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Gets a position and return the nearest point inside the simulation area if the point is outside the area.  <a href="#a4a1125784d786481c4c294e08611e432"></a><br/></td></tr>
<tr><td colspan="2"><h2>Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a628f8fb181849c61bebd69d4f5351f1d"></a><!-- doxytag: member="MoBANLocal::referencePoint" ref="a628f8fb181849c61bebd69d4f5351f1d" args="" -->
<a class="el" href="a00062.html">Coord</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00126.html#a628f8fb181849c61bebd69d4f5351f1d">referencePoint</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Reference point of the node in the current posture. It is gotten from the MoBAN coordinator through signaling system. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ad7c99333da43a55b3c6655a06fc9a325"></a><!-- doxytag: member="MoBANLocal::radius" ref="ad7c99333da43a55b3c6655a06fc9a325" args="" -->
double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00126.html#ad7c99333da43a55b3c6655a06fc9a325">radius</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The radius of local mobility of the node in the current posture. It is gotten from the MoBAN coordinator through signaling system. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a4b7f222408bca8188bb9a362d4eeff9f"></a><!-- doxytag: member="MoBANLocal::speed" ref="a4b7f222408bca8188bb9a362d4eeff9f" args="" -->
double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00126.html#a4b7f222408bca8188bb9a362d4eeff9f">speed</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The speed of local mobility of the node in the current posture. It is gotten from the MoBAN coordinator through signaling system. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aaa6b82daba1c4e565dd423c8664a2b8e"></a><!-- doxytag: member="MoBANLocal::targetPos" ref="aaa6b82daba1c4e565dd423c8664a2b8e" args="" -->
<a class="el" href="a00062.html">Coord</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00126.html#aaa6b82daba1c4e565dd423c8664a2b8e">targetPos</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The relative target position of the current move. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="abd5c3b29659ab13237020690419920b0"></a><!-- doxytag: member="MoBANLocal::stepTarget" ref="abd5c3b29659ab13237020690419920b0" args="" -->
<a class="el" href="a00062.html">Coord</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00126.html#abd5c3b29659ab13237020690419920b0">stepTarget</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The relative position of the node in the next step. <br/></td></tr>
<tr><td colspan="2"><div class="groupHeader"></div></td></tr>
<tr><td colspan="2"><div class="groupText"><p><a class="anchor" id="amgrpd41d8cd98f00b204e9800998ecf8427e"></a> </p>
<br/><br/></div></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="a00062.html">Coord</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00126.html#a4eb2487496c63ac1efb3299e209975d0">stepSize</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">parameters to handle the movement of the host  <a href="#a4eb2487496c63ac1efb3299e209975d0"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ac998540c2c7448b9cfad9f9f5a3680b5"></a><!-- doxytag: member="MoBANLocal::numSteps" ref="ac998540c2c7448b9cfad9f9f5a3680b5" args="" -->
int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00126.html#ac998540c2c7448b9cfad9f9f5a3680b5">numSteps</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Total number of steps. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="abc9d20b66bc211e3208629c1f6d8f92d"></a><!-- doxytag: member="MoBANLocal::step" ref="abc9d20b66bc211e3208629c1f6d8f92d" args="" -->
int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00126.html#abc9d20b66bc211e3208629c1f6d8f92d">step</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Number of steps already moved. <br/></td></tr>
<tr><td colspan="2"><h2>Private Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a435dc3958843aa51c423cdea292ce403"></a><!-- doxytag: member="MoBANLocal::MoBANLocal" ref="a435dc3958843aa51c423cdea292ce403" args="(const MoBANLocal &amp;)" -->
&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00126.html#a435dc3958843aa51c423cdea292ce403">MoBANLocal</a> (const <a class="el" href="a00126.html">MoBANLocal</a> &amp;)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Copy constructor is not allowed. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a7a185cd7b8b159389935992737b97419"></a><!-- doxytag: member="MoBANLocal::operator=" ref="a7a185cd7b8b159389935992737b97419" args="(const MoBANLocal &amp;)" -->
<a class="el" href="a00126.html">MoBANLocal</a> &amp;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00126.html#a7a185cd7b8b159389935992737b97419">operator=</a> (const <a class="el" href="a00126.html">MoBANLocal</a> &amp;)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Assignment operator is not allowed. <br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>This is the local mobility module of MoBAN. It should be instantiated in each node that belongs to a WBAN. The NED parameter "coordinatorIndex" determine to which WBAN (<a class="el" href="a00125.html" title="This is the coordinator module of the MoBAN mobility model. It should be instantiated...">MoBANCoordinator</a>) it belongs. The current implementation uses the Random Walk Mobility Model (RWMM) for individual (local) movement with a sphere around the node, with given speed and sphere radius of the current posture. The reference point of the node it the current posture, the sphere radius, and the speed is given by the corresponding coordinator through the signaling system. RWMM determines the location of node at ant time relative to the given reference point. </p>
<dl class="author"><dt><b>Author:</b></dt><dd>Majid Nabi </dd></dl>

<p>Definition at line <a class="el" href="a00366_source.html#l00058">58</a> of file <a class="el" href="a00366_source.html">MoBANLocal.h</a>.</p>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a4a1125784d786481c4c294e08611e432"></a><!-- doxytag: member="MoBANLocal::insideWorld" ref="a4a1125784d786481c4c294e08611e432" args="(Coord apoint)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="a00062.html">Coord</a> MoBANLocal::insideWorld </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="a00062.html">Coord</a>&nbsp;</td>
          <td class="paramname"> <em>apoint</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Gets a position and return the nearest point inside the simulation area if the point is outside the area. </p>
<p>Gets a position and return the nearest point inside the simulation area if the point is outside the area </p>

<p>Definition at line <a class="el" href="a00365_source.html#l00177">177</a> of file <a class="el" href="a00365_source.html">MoBANLocal.cc</a>.</p>

<p>References <a class="el" href="a00251_source.html#l00081">BaseWorldUtility::getPgs()</a>, and <a class="el" href="a00245_source.html#l00106">BaseMobility::world</a>.</p>

<p>Referenced by <a class="el" href="a00365_source.html#l00129">makeMove()</a>, <a class="el" href="a00365_source.html#l00153">receiveSignal()</a>, and <a class="el" href="a00365_source.html#l00074">setTargetPosition()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00178"></a>00178 {
<a name="l00179"></a>00179   <span class="keywordtype">double</span> xmax, ymax, zmax;
<a name="l00180"></a>00180 
<a name="l00181"></a>00181   <a class="code" href="a00062.html" title="Class for storing 3D coordinates.">Coord</a> NearestBorder = apoint;
<a name="l00182"></a>00182 
<a name="l00183"></a>00183   xmax = <a class="code" href="a00023.html#a6622a6eae6f6fb4bc2511a9f2d7f0593" title="Pointer to BaseWorldUtility -- these two must know each other.">world</a>-&gt;<a class="code" href="a00027.html#a179c8bf9d4613cbb1af0a85d779827a6" title="Returns the playgroundSize.">getPgs</a>()-&gt;x;
<a name="l00184"></a>00184   ymax = <a class="code" href="a00023.html#a6622a6eae6f6fb4bc2511a9f2d7f0593" title="Pointer to BaseWorldUtility -- these two must know each other.">world</a>-&gt;<a class="code" href="a00027.html#a179c8bf9d4613cbb1af0a85d779827a6" title="Returns the playgroundSize.">getPgs</a>()-&gt;y;
<a name="l00185"></a>00185   zmax = <a class="code" href="a00023.html#a6622a6eae6f6fb4bc2511a9f2d7f0593" title="Pointer to BaseWorldUtility -- these two must know each other.">world</a>-&gt;<a class="code" href="a00027.html#a179c8bf9d4613cbb1af0a85d779827a6" title="Returns the playgroundSize.">getPgs</a>()-&gt;z;
<a name="l00186"></a>00186 
<a name="l00187"></a>00187   <span class="keywordflow">if</span> (NearestBorder.x &lt; 0)
<a name="l00188"></a>00188     NearestBorder.x = (0.0);
<a name="l00189"></a>00189 
<a name="l00190"></a>00190   <span class="keywordflow">if</span> (NearestBorder.y &lt; 0)
<a name="l00191"></a>00191     NearestBorder.y = (0.0);
<a name="l00192"></a>00192 
<a name="l00193"></a>00193   <span class="keywordflow">if</span> (NearestBorder.z &lt; 0)
<a name="l00194"></a>00194     NearestBorder.z = (0.0);
<a name="l00195"></a>00195 
<a name="l00196"></a>00196   <span class="keywordflow">if</span> (NearestBorder.x &gt; xmax)
<a name="l00197"></a>00197     NearestBorder.x = (xmax);
<a name="l00198"></a>00198 
<a name="l00199"></a>00199   <span class="keywordflow">if</span> (NearestBorder.y &gt; ymax)
<a name="l00200"></a>00200     NearestBorder.y = (ymax);
<a name="l00201"></a>00201 
<a name="l00202"></a>00202   <span class="keywordflow">if</span> (NearestBorder.z &gt; zmax)
<a name="l00203"></a>00203     NearestBorder.z = (zmax);
<a name="l00204"></a>00204 
<a name="l00205"></a>00205   <span class="keywordflow">return</span> NearestBorder;
<a name="l00206"></a>00206 
<a name="l00207"></a>00207 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a258a0ef18dbf4ac01149186360e6fe45"></a><!-- doxytag: member="MoBANLocal::makeMove" ref="a258a0ef18dbf4ac01149186360e6fe45" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void MoBANLocal::makeMove </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><a class="el" href="a00127.html" title="Class to store object position and movement.">Move</a> the node. </p>
<p><a class="el" href="a00127.html" title="Class to store object position and movement.">Move</a> the host if the destination is not reached yet. Otherwise calculate a new random position. This function is called by the <a class="el" href="a00023.html" title="Base module for all mobility modules.">BaseMobility</a> module considering the given update time interval. </p>

<p>Reimplemented from <a class="el" href="a00023.html#a9774524fd5f2d3ef348dc67f2af0f491">BaseMobility</a>.</p>

<p>Definition at line <a class="el" href="a00365_source.html#l00129">129</a> of file <a class="el" href="a00365_source.html">MoBANLocal.cc</a>.</p>

<p>References <a class="el" href="a00289_source.html#l00185">Move::info()</a>, <a class="el" href="a00365_source.html#l00177">insideWorld()</a>, <a class="el" href="a00245_source.html#l00109">BaseMobility::move</a>, <a class="el" href="a00366_source.html#l00084">numSteps</a>, <a class="el" href="a00366_source.html#l00071">referencePoint</a>, <a class="el" href="a00289_source.html#l00105">Move::setStart()</a>, <a class="el" href="a00365_source.html#l00074">setTargetPosition()</a>, <a class="el" href="a00366_source.html#l00086">step</a>, <a class="el" href="a00366_source.html#l00082">stepSize</a>, and <a class="el" href="a00366_source.html#l00093">stepTarget</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00130"></a>00130 {
<a name="l00131"></a>00131     <span class="comment">// increment number of steps</span>
<a name="l00132"></a>00132     <a class="code" href="a00126.html#abc9d20b66bc211e3208629c1f6d8f92d" title="Number of steps already moved.">step</a>++;
<a name="l00133"></a>00133 
<a name="l00134"></a>00134     <span class="keywordflow">if</span>( <a class="code" href="a00126.html#abc9d20b66bc211e3208629c1f6d8f92d" title="Number of steps already moved.">step</a> == <a class="code" href="a00126.html#ac998540c2c7448b9cfad9f9f5a3680b5" title="Total number of steps.">numSteps</a> ){
<a name="l00135"></a>00135       EV &lt;&lt; <span class="stringliteral">&quot;destination reached. &quot;</span> &lt;&lt; <a class="code" href="a00023.html#a1034fe1aa236bfa5bc2ae4adf3de8da2" title="Stores the current position and move pattern of the host.">move</a>.<a class="code" href="a00127.html#a0287300e9580229fdd0c4c2c13e9527d" title="Returns information about the current state.">info</a>() &lt;&lt; endl;
<a name="l00136"></a>00136       <a class="code" href="a00126.html#a7a181399edf633b6598fad60cf2fbce7" title="Selects a target position for the next move and set the corresponding variables.">setTargetPosition</a>();
<a name="l00137"></a>00137   }
<a name="l00138"></a>00138     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="a00126.html#abc9d20b66bc211e3208629c1f6d8f92d" title="Number of steps already moved.">step</a> &lt; <a class="code" href="a00126.html#ac998540c2c7448b9cfad9f9f5a3680b5" title="Total number of steps.">numSteps</a> ){
<a name="l00139"></a>00139       <span class="comment">// step forward</span>
<a name="l00140"></a>00140       <a class="code" href="a00126.html#abd5c3b29659ab13237020690419920b0" title="The relative position of the node in the next step.">stepTarget</a> += <a class="code" href="a00126.html#a4eb2487496c63ac1efb3299e209975d0" title="parameters to handle the movement of the host">stepSize</a>;
<a name="l00141"></a>00141       <a class="code" href="a00023.html#a1034fe1aa236bfa5bc2ae4adf3de8da2" title="Stores the current position and move pattern of the host.">move</a>.<a class="code" href="a00127.html#a385a1d6229f2490fdbe26f9266f29188" title="Sets start position (components in meters) and start time.">setStart</a>(<a class="code" href="a00126.html#a4a1125784d786481c4c294e08611e432" title="Gets a position and return the nearest point inside the simulation area if the point...">insideWorld</a>(<a class="code" href="a00126.html#abd5c3b29659ab13237020690419920b0" title="The relative position of the node in the next step.">stepTarget</a>+<a class="code" href="a00126.html#a628f8fb181849c61bebd69d4f5351f1d" title="Reference point of the node in the current posture. It is gotten from the MoBAN coordinator...">referencePoint</a>),simTime());
<a name="l00142"></a>00142     }
<a name="l00143"></a>00143     <span class="keywordflow">else</span>{
<a name="l00144"></a>00144       error(<span class="stringliteral">&quot;step cannot be bigger than numSteps&quot;</span>);
<a name="l00145"></a>00145     }
<a name="l00146"></a>00146 
<a name="l00147"></a>00147 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6d98f00ff0849bd439cea5e4de51009d"></a><!-- doxytag: member="MoBANLocal::receiveSignal" ref="a6d98f00ff0849bd439cea5e4de51009d" args="(cComponent *source, simsignal_t signalID, cObject *obj)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void MoBANLocal::receiveSignal </td>
          <td>(</td>
          <td class="paramtype">cComponent *&nbsp;</td>
          <td class="paramname"> <em>source</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">simsignal_t&nbsp;</td>
          <td class="paramname"> <em>signalID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cObject *&nbsp;</td>
          <td class="paramname"> <em>obj</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Function which is called when something is written to the signaling system of this node. </p>
<p>This function is called once something is written to the signaling system of this node. If the written item has specific category dedicated for the type that MoBAN coordinator writes, the item will be read and the corresponding variables are set. </p>

<p>Reimplemented from <a class="el" href="a00024.html#a9195e1fe5a0ca770e7d29351e0ab2ecf">BaseModule</a>.</p>

<p>Definition at line <a class="el" href="a00365_source.html#l00153">153</a> of file <a class="el" href="a00365_source.html">MoBANLocal.cc</a>.</p>

<p>References <a class="el" href="a00366_source.html#l00109">catBBMoBANMsgSignal</a>, <a class="el" href="a00284_source.html#l00113">FWMath::close()</a>, <a class="el" href="a00246_source.html#l00093">BaseModule::findHost()</a>, <a class="el" href="a00365_source.html#l00177">insideWorld()</a>, <a class="el" href="a00245_source.html#l00109">BaseMobility::move</a>, <a class="el" href="a00366_source.html#l00074">radius</a>, <a class="el" href="a00366_source.html#l00071">referencePoint</a>, <a class="el" href="a00289_source.html#l00081">Move::setSpeed()</a>, <a class="el" href="a00289_source.html#l00105">Move::setStart()</a>, <a class="el" href="a00366_source.html#l00077">speed</a>, and <a class="el" href="a00366_source.html#l00093">stepTarget</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00154"></a>00154 {
<a name="l00155"></a>00155     <span class="keywordflow">if</span>(signalID == <a class="code" href="a00126.html#a9143c05cc2bb615c574e42c371dc0ed2" title="Variable to keep the category of the information that the coordinator publishes.">catBBMoBANMsgSignal</a>)
<a name="l00156"></a>00156     {
<a name="l00157"></a>00157       <a class="code" href="a00031.html">BBMoBANMessage</a> m(*static_cast&lt;const BBMoBANMessage*&gt;(obj));
<a name="l00158"></a>00158       <a class="code" href="a00126.html#a628f8fb181849c61bebd69d4f5351f1d" title="Reference point of the node in the current posture. It is gotten from the MoBAN coordinator...">referencePoint</a>= m.position;
<a name="l00159"></a>00159 
<a name="l00160"></a>00160       <a class="code" href="a00126.html#a4b7f222408bca8188bb9a362d4eeff9f" title="The speed of local mobility of the node in the current posture. It is gotten from...">speed</a> = m.speed;
<a name="l00161"></a>00161       <span class="keywordflow">if</span> ( !<a class="code" href="a00092.html#a38d2500887b49de2a2b5f8610f7ba6d1">FWMath::close</a>(<a class="code" href="a00126.html#a4b7f222408bca8188bb9a362d4eeff9f" title="The speed of local mobility of the node in the current posture. It is gotten from...">speed</a>,0.0) )
<a name="l00162"></a>00162          <a class="code" href="a00023.html#a1034fe1aa236bfa5bc2ae4adf3de8da2" title="Stores the current position and move pattern of the host.">move</a>.<a class="code" href="a00127.html#af80f74d5fc42ec7fcedf9940c9d01655" title="Sets the current speed in meters per second.">setSpeed</a>(<a class="code" href="a00126.html#a4b7f222408bca8188bb9a362d4eeff9f" title="The speed of local mobility of the node in the current posture. It is gotten from...">speed</a>); <span class="comment">// IF WE SET ZERO, it is not going to move anymore</span>
<a name="l00163"></a>00163 
<a name="l00164"></a>00164         <a class="code" href="a00126.html#ad7c99333da43a55b3c6655a06fc9a325" title="The radius of local mobility of the node in the current posture. It is gotten from...">radius</a> = m.radius;
<a name="l00165"></a>00165 
<a name="l00166"></a>00166       <a class="code" href="a00023.html#a1034fe1aa236bfa5bc2ae4adf3de8da2" title="Stores the current position and move pattern of the host.">move</a>.<a class="code" href="a00127.html#a385a1d6229f2490fdbe26f9266f29188" title="Sets start position (components in meters) and start time.">setStart</a>(<a class="code" href="a00126.html#a4a1125784d786481c4c294e08611e432" title="Gets a position and return the nearest point inside the simulation area if the point...">insideWorld</a>(<a class="code" href="a00126.html#abd5c3b29659ab13237020690419920b0" title="The relative position of the node in the next step.">stepTarget</a>+<a class="code" href="a00126.html#a628f8fb181849c61bebd69d4f5351f1d" title="Reference point of the node in the current posture. It is gotten from the MoBAN coordinator...">referencePoint</a>),simTime());
<a name="l00167"></a>00167 
<a name="l00168"></a>00168         EV&lt;&lt;<span class="stringliteral">&quot;Node &quot;</span>&lt;&lt; <a class="code" href="a00024.html#aabf0226159b22b46e70031fd3bb3b1b2" title="Function to get a pointer to the host module.">FindModule&lt;&gt;::findHost</a>(<span class="keyword">this</span>)-&gt;getIndex() &lt;&lt;<span class="stringliteral">&quot; received new reference point.&quot;</span>&lt;&lt;endl;
<a name="l00169"></a>00169         EV&lt;&lt; <span class="stringliteral">&quot;New speed:&quot;</span> &lt;&lt; <a class="code" href="a00126.html#a4b7f222408bca8188bb9a362d4eeff9f" title="The speed of local mobility of the node in the current posture. It is gotten from...">speed</a> &lt;&lt;<span class="stringliteral">&quot; , new radius: &quot;</span>&lt;&lt; <a class="code" href="a00126.html#ad7c99333da43a55b3c6655a06fc9a325" title="The radius of local mobility of the node in the current posture. It is gotten from...">radius</a> &lt;&lt;endl;
<a name="l00170"></a>00170 
<a name="l00171"></a>00171     }
<a name="l00172"></a>00172 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7a181399edf633b6598fad60cf2fbce7"></a><!-- doxytag: member="MoBANLocal::setTargetPosition" ref="a7a181399edf633b6598fad60cf2fbce7" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void MoBANLocal::setTargetPosition </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Selects a target position for the next move and set the corresponding variables. </p>
<p>Calculate a new random position within a sphere around the reference point with the given radius. It also calculates the number of steps the node needs to reach this position with the given speed </p>

<p>Definition at line <a class="el" href="a00365_source.html#l00074">74</a> of file <a class="el" href="a00365_source.html">MoBANLocal.cc</a>.</p>

<p>References <a class="el" href="a00282_source.html#l00178">Coord::distance()</a>, <a class="el" href="a00289_source.html#l00073">Move::getSpeed()</a>, <a class="el" href="a00289_source.html#l00089">Move::getStartPos()</a>, <a class="el" href="a00282_source.html#l00069">Coord::info()</a>, <a class="el" href="a00365_source.html#l00177">insideWorld()</a>, <a class="el" href="a00245_source.html#l00109">BaseMobility::move</a>, <a class="el" href="a00366_source.html#l00084">numSteps</a>, <a class="el" href="a00366_source.html#l00074">radius</a>, <a class="el" href="a00366_source.html#l00071">referencePoint</a>, <a class="el" href="a00284_source.html#l00132">FWMath::round()</a>, <a class="el" href="a00289_source.html#l00105">Move::setStart()</a>, <a class="el" href="a00366_source.html#l00077">speed</a>, <a class="el" href="a00366_source.html#l00086">step</a>, <a class="el" href="a00366_source.html#l00082">stepSize</a>, <a class="el" href="a00366_source.html#l00093">stepTarget</a>, <a class="el" href="a00366_source.html#l00090">targetPos</a>, and <a class="el" href="a00245_source.html#l00118">BaseMobility::updateInterval</a>.</p>

<p>Referenced by <a class="el" href="a00365_source.html#l00129">makeMove()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00075"></a>00075 {
<a name="l00076"></a>00076   <a class="code" href="a00062.html" title="Class for storing 3D coordinates.">Coord</a> currentRelativePosition;
<a name="l00077"></a>00077 
<a name="l00078"></a>00078   <span class="keywordflow">if</span> (<a class="code" href="a00126.html#a4b7f222408bca8188bb9a362d4eeff9f" title="The speed of local mobility of the node in the current posture. It is gotten from...">speed</a> != 0)
<a name="l00079"></a>00079   {
<a name="l00080"></a>00080     <span class="comment">// Find a uniformly random position within a sphere around the reference point</span>
<a name="l00081"></a>00081     <span class="keywordtype">double</span> x  = uniform(-1*<a class="code" href="a00126.html#ad7c99333da43a55b3c6655a06fc9a325" title="The radius of local mobility of the node in the current posture. It is gotten from...">radius</a>, <a class="code" href="a00126.html#ad7c99333da43a55b3c6655a06fc9a325" title="The radius of local mobility of the node in the current posture. It is gotten from...">radius</a>);
<a name="l00082"></a>00082     <span class="keywordtype">double</span> y  = uniform(-1*<a class="code" href="a00126.html#ad7c99333da43a55b3c6655a06fc9a325" title="The radius of local mobility of the node in the current posture. It is gotten from...">radius</a>, <a class="code" href="a00126.html#ad7c99333da43a55b3c6655a06fc9a325" title="The radius of local mobility of the node in the current posture. It is gotten from...">radius</a>);
<a name="l00083"></a>00083     <span class="keywordtype">double</span> z =  uniform(-1*<a class="code" href="a00126.html#ad7c99333da43a55b3c6655a06fc9a325" title="The radius of local mobility of the node in the current posture. It is gotten from...">radius</a>, <a class="code" href="a00126.html#ad7c99333da43a55b3c6655a06fc9a325" title="The radius of local mobility of the node in the current posture. It is gotten from...">radius</a>);
<a name="l00084"></a>00084     <span class="keywordflow">while</span> (x*x+y*y+z*z &gt; <a class="code" href="a00126.html#ad7c99333da43a55b3c6655a06fc9a325" title="The radius of local mobility of the node in the current posture. It is gotten from...">radius</a>*<a class="code" href="a00126.html#ad7c99333da43a55b3c6655a06fc9a325" title="The radius of local mobility of the node in the current posture. It is gotten from...">radius</a>)
<a name="l00085"></a>00085     {
<a name="l00086"></a>00086       x  = uniform(-1*radius, radius);
<a name="l00087"></a>00087       y  = uniform(-1*radius, radius);
<a name="l00088"></a>00088       z =  uniform(-1*radius, radius);
<a name="l00089"></a>00089     }
<a name="l00090"></a>00090 
<a name="l00091"></a>00091     <a class="code" href="a00126.html#aaa6b82daba1c4e565dd423c8664a2b8e" title="The relative target position of the current move.">targetPos</a>.x = (x);
<a name="l00092"></a>00092     <a class="code" href="a00126.html#aaa6b82daba1c4e565dd423c8664a2b8e" title="The relative target position of the current move.">targetPos</a>.y = (y);
<a name="l00093"></a>00093     <a class="code" href="a00126.html#aaa6b82daba1c4e565dd423c8664a2b8e" title="The relative target position of the current move.">targetPos</a>.z = (z);
<a name="l00094"></a>00094 
<a name="l00095"></a>00095     currentRelativePosition = <a class="code" href="a00023.html#a1034fe1aa236bfa5bc2ae4adf3de8da2" title="Stores the current position and move pattern of the host.">move</a>.<a class="code" href="a00127.html#aeab90c9059a2c9214e491a58833b3c3c" title="Returns the start position.">getStartPos</a>()- <a class="code" href="a00126.html#a628f8fb181849c61bebd69d4f5351f1d" title="Reference point of the node in the current posture. It is gotten from the MoBAN coordinator...">referencePoint</a>;
<a name="l00096"></a>00096     <span class="keywordtype">double</span> distance = currentRelativePosition.<a class="code" href="a00062.html#ab6a7bfcc5c55e5d8edbc7c0cb5a11626" title="Returns the distance to Coord &amp;#39;a&amp;#39;.">distance</a>(<a class="code" href="a00126.html#aaa6b82daba1c4e565dd423c8664a2b8e" title="The relative target position of the current move.">targetPos</a>);
<a name="l00097"></a>00097 
<a name="l00098"></a>00098     simtime_t totalTime = distance / <a class="code" href="a00023.html#a1034fe1aa236bfa5bc2ae4adf3de8da2" title="Stores the current position and move pattern of the host.">move</a>.<a class="code" href="a00127.html#a3db12757bf11ac7f025b2496d09e4941" title="Returns the current speed.">getSpeed</a>();
<a name="l00099"></a>00099     <span class="keywordflow">if</span> (totalTime &gt;= <a class="code" href="a00023.html#af3cdd1192cfb8e70e53f36d03a20f1b5" title="Time interval (in seconds) to update the hosts position.">updateInterval</a>)
<a name="l00100"></a>00100       <a class="code" href="a00126.html#ac998540c2c7448b9cfad9f9f5a3680b5" title="Total number of steps.">numSteps</a> = <a class="code" href="a00092.html#ad5b2d4a46bf7af77e9cc0070b6a82c18">FWMath::round</a>(totalTime / <a class="code" href="a00023.html#af3cdd1192cfb8e70e53f36d03a20f1b5" title="Time interval (in seconds) to update the hosts position.">updateInterval</a>);
<a name="l00101"></a>00101     <span class="keywordflow">else</span>
<a name="l00102"></a>00102       <a class="code" href="a00126.html#ac998540c2c7448b9cfad9f9f5a3680b5" title="Total number of steps.">numSteps</a> = 1; <span class="comment">//The selected target position is quite close so that in less than one step, it will be reached with the given velocity.</span>
<a name="l00103"></a>00103 
<a name="l00104"></a>00104     <a class="code" href="a00126.html#a4eb2487496c63ac1efb3299e209975d0" title="parameters to handle the movement of the host">stepSize</a> = (<a class="code" href="a00126.html#aaa6b82daba1c4e565dd423c8664a2b8e" title="The relative target position of the current move.">targetPos</a> - currentRelativePosition)/<a class="code" href="a00126.html#ac998540c2c7448b9cfad9f9f5a3680b5" title="Total number of steps.">numSteps</a>;
<a name="l00105"></a>00105     <a class="code" href="a00126.html#abd5c3b29659ab13237020690419920b0" title="The relative position of the node in the next step.">stepTarget</a> = (<a class="code" href="a00023.html#a1034fe1aa236bfa5bc2ae4adf3de8da2" title="Stores the current position and move pattern of the host.">move</a>.<a class="code" href="a00127.html#aeab90c9059a2c9214e491a58833b3c3c" title="Returns the start position.">getStartPos</a>()-<a class="code" href="a00126.html#a628f8fb181849c61bebd69d4f5351f1d" title="Reference point of the node in the current posture. It is gotten from the MoBAN coordinator...">referencePoint</a>) + <a class="code" href="a00126.html#a4eb2487496c63ac1efb3299e209975d0" title="parameters to handle the movement of the host">stepSize</a>;
<a name="l00106"></a>00106   }
<a name="l00107"></a>00107   <span class="keywordflow">else</span>
<a name="l00108"></a>00108   {
<a name="l00109"></a>00109     <a class="code" href="a00126.html#ac998540c2c7448b9cfad9f9f5a3680b5" title="Total number of steps.">numSteps</a> = 1;
<a name="l00110"></a>00110     <a class="code" href="a00126.html#aaa6b82daba1c4e565dd423c8664a2b8e" title="The relative target position of the current move.">targetPos</a> = <a class="code" href="a00126.html#a628f8fb181849c61bebd69d4f5351f1d" title="Reference point of the node in the current posture. It is gotten from the MoBAN coordinator...">referencePoint</a>;
<a name="l00111"></a>00111     <a class="code" href="a00126.html#a4eb2487496c63ac1efb3299e209975d0" title="parameters to handle the movement of the host">stepSize</a> = <a class="code" href="a00062.html" title="Class for storing 3D coordinates.">Coord</a>(0,0,0);
<a name="l00112"></a>00112     <a class="code" href="a00126.html#abd5c3b29659ab13237020690419920b0" title="The relative position of the node in the next step.">stepTarget</a> = <a class="code" href="a00062.html" title="Class for storing 3D coordinates.">Coord</a>(0,0,0);
<a name="l00113"></a>00113   }
<a name="l00114"></a>00114 
<a name="l00115"></a>00115 
<a name="l00116"></a>00116   <a class="code" href="a00023.html#a1034fe1aa236bfa5bc2ae4adf3de8da2" title="Stores the current position and move pattern of the host.">move</a>.<a class="code" href="a00127.html#a385a1d6229f2490fdbe26f9266f29188" title="Sets start position (components in meters) and start time.">setStart</a>(<a class="code" href="a00126.html#a4a1125784d786481c4c294e08611e432" title="Gets a position and return the nearest point inside the simulation area if the point...">insideWorld</a>(<a class="code" href="a00126.html#abd5c3b29659ab13237020690419920b0" title="The relative position of the node in the next step.">stepTarget</a> + <a class="code" href="a00126.html#a628f8fb181849c61bebd69d4f5351f1d" title="Reference point of the node in the current posture. It is gotten from the MoBAN coordinator...">referencePoint</a>),simTime());
<a name="l00117"></a>00117 
<a name="l00118"></a>00118     <a class="code" href="a00126.html#abc9d20b66bc211e3208629c1f6d8f92d" title="Number of steps already moved.">step</a> = 0;
<a name="l00119"></a>00119 
<a name="l00120"></a>00120   EV &lt;&lt; <span class="stringliteral">&quot;new targetPos: &quot;</span> &lt;&lt; <a class="code" href="a00126.html#aaa6b82daba1c4e565dd423c8664a2b8e" title="The relative target position of the current move.">targetPos</a>.<a class="code" href="a00062.html#a86994bfa7096155d951abb03dcf30bf1" title="Returns a string with the value of the coordinate.">info</a>() &lt;&lt; <span class="stringliteral">&quot; numSteps=&quot;</span> &lt;&lt; <a class="code" href="a00126.html#ac998540c2c7448b9cfad9f9f5a3680b5" title="Total number of steps.">numSteps</a> &lt;&lt; endl;
<a name="l00121"></a>00121 
<a name="l00122"></a>00122 }
</pre></div></p>

</div>
</div>
<hr/><h2>Member Data Documentation</h2>
<a class="anchor" id="a4eb2487496c63ac1efb3299e209975d0"></a><!-- doxytag: member="MoBANLocal::stepSize" ref="a4eb2487496c63ac1efb3299e209975d0" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="a00062.html">Coord</a> <a class="el" href="a00126.html#a4eb2487496c63ac1efb3299e209975d0">MoBANLocal::stepSize</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>parameters to handle the movement of the host </p>
<p>Size of a step </p>

<p>Definition at line <a class="el" href="a00366_source.html#l00082">82</a> of file <a class="el" href="a00366_source.html">MoBANLocal.h</a>.</p>

<p>Referenced by <a class="el" href="a00365_source.html#l00052">initialize()</a>, <a class="el" href="a00365_source.html#l00129">makeMove()</a>, and <a class="el" href="a00365_source.html#l00074">setTargetPosition()</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>src/modules/mobility/<a class="el" href="a00366_source.html">MoBANLocal.h</a></li>
<li>src/modules/mobility/<a class="el" href="a00365_source.html">MoBANLocal.cc</a></li>
</ul>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed Dec 14 16:01:50 2011 for MiXiM by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
